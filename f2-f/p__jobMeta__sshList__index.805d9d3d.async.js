"use strict";(self.webpackChunkf2=self.webpackChunkf2||[]).push([[3322],{61487:function(z,g,e){var m=e(98037),a=e(58006),f=e(75271),M=e(34832),i=e(52676),c=["fieldProps","min","proFieldProps","max"],F=function(s,v){var u=s.fieldProps,d=s.min,S=s.proFieldProps,C=s.max,O=(0,a.Z)(s,c);return(0,i.jsx)(M.Z,(0,m.Z)({valueType:"digit",fieldProps:(0,m.Z)({min:d,max:C},u),ref:v,filedConfig:{defaultProps:{width:"100%"}},proFieldProps:S},O))},l=f.forwardRef(F);g.Z=l},82715:function(z,g,e){var m=e(99459),a=e(98037),f=e(58006),M=e(18542),i=e(44725),c=e(86432),F=e(71770),l=e(75271),o=e(34832),s=e(52676),v=["fieldProps","proFieldProps"],u=["fieldProps","proFieldProps"],d="text",S=function(r){var n=r.fieldProps,p=r.proFieldProps,x=(0,f.Z)(r,v);return(0,s.jsx)(o.Z,(0,a.Z)({valueType:d,fieldProps:n,filedConfig:{valueType:d},proFieldProps:p},x))},C=function(r){var n=(0,M.Z)(r.open||!1,{value:r.open,onChange:r.onOpenChange}),p=(0,m.Z)(n,2),x=p[0],R=p[1];return(0,s.jsx)(i.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(L){var P,U=L.getFieldValue(r.name||[]);return(0,s.jsx)(c.Z,(0,a.Z)((0,a.Z)({getPopupContainer:function(_){return _&&_.parentNode?_.parentNode:_},onOpenChange:function(_){return R(_)},content:(0,s.jsxs)("div",{style:{padding:"4px 0"},children:[(P=r.statusRender)===null||P===void 0?void 0:P.call(r,U),r.strengthText?(0,s.jsx)("div",{style:{marginTop:10},children:(0,s.jsx)("span",{children:r.strengthText})}):null]}),overlayStyle:{width:240},placement:"rightTop"},r.popoverProps),{},{open:x,children:r.children}))}})},O=function(r){var n=r.fieldProps,p=r.proFieldProps,x=(0,f.Z)(r,u),R=(0,l.useState)(!1),D=(0,m.Z)(R,2),L=D[0],P=D[1];return n!=null&&n.statusRender&&x.name?(0,s.jsx)(C,{name:x.name,statusRender:n==null?void 0:n.statusRender,popoverProps:n==null?void 0:n.popoverProps,strengthText:n==null?void 0:n.strengthText,open:L,onOpenChange:P,children:(0,s.jsx)("div",{children:(0,s.jsx)(o.Z,(0,a.Z)({valueType:"password",fieldProps:(0,a.Z)((0,a.Z)({},(0,F.Z)(n,["statusRender","popoverProps","strengthText"])),{},{onBlur:function(j){var _;n==null||(_=n.onBlur)===null||_===void 0||_.call(n,j),P(!1)},onClick:function(j){var _;n==null||(_=n.onClick)===null||_===void 0||_.call(n,j),P(!0)}}),proFieldProps:p,filedConfig:{valueType:d}},x))})}):(0,s.jsx)(o.Z,(0,a.Z)({valueType:"password",fieldProps:n,proFieldProps:p,filedConfig:{valueType:d}},x))},h=S;h.Password=O,h.displayName="ProFormComponent",g.Z=h},56247:function(z,g,e){var m=e(98037),a=e(58006),f=e(75271),M=e(34832),i=e(52676),c=["fieldProps","proFieldProps"],F=function(o,s){var v=o.fieldProps,u=o.proFieldProps,d=(0,a.Z)(o,c);return(0,i.jsx)(M.Z,(0,m.Z)({ref:s,valueType:"textarea",fieldProps:v,proFieldProps:u},d))};g.Z=f.forwardRef(F)},1743:function(z,g,e){e.d(g,{V2:function(){return f}});var m=15,a=[10,15,20,50,100],f={defaultPageSize:m,showSizeChanger:!0,pageSizeOptions:a}},38419:function(z,g,e){var m=e(90228),a=e.n(m),f=e(87999),M=e.n(f),i=e(99503),c=e(84297),F=e(41901),l=e(75271),o=e(52676),s=function(u){var d=u.changeFlowDesign,S=u.selectedRowsState,C=u.modalTitle,O=C===void 0?"\u6279\u91CF\u66F4\u6539\u4E1A\u52A1":C,h=u.buttonText,E=h===void 0?"\u6279\u91CF\u66F4\u6539\u4E1A\u52A1":h,r=u.buttonType,n=r===void 0?"primary":r,p=u.onSuccess,x=u.trigger,R=u.selectListKey,D=R===void 0?"select_list":R;return(0,o.jsx)(c.Y,{width:400,title:O,layout:"horizontal",trigger:x||(0,o.jsx)(F.ZP,{type:n,children:E}),autoFocusFirstInput:!0,modalProps:{destroyOnClose:!0,onCancel:function(){return console.log("run")}},submitTimeout:2e3,onFinish:function(){var L=M()(a()().mark(function P(U){var j;return a()().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return j={tenantid:U.tenantid},j[D]=S.map(function(Q){return String(Q.id)}),N.next=4,d(j);case 4:return p==null||p(),N.abrupt("return",!0);case 6:case"end":return N.stop()}},P)}));return function(P){return L.apply(this,arguments)}}(),children:(0,o.jsx)(i.er,{syncUrlParams:!1,showDefaultValue:!1,label:"\u6D41\u7A0B\u6240\u5C5E\u7684\u4E1A\u52A1"})},"clone")};g.Z=s},67254:function(z,g,e){var m=e(26068),a=e.n(m),f=e(67825),M=e.n(f),i=e(53649),c=e.n(i),F=e(99503),l=e(77777),o=e(88230),s=e(75271),v=e(52676),u=["children","extra","ghost","title"],d,S,C=(0,o.kc)(function(h){var E=h.css;return{pageContainer:{"& .ant-page-header-heading":E(d||(d=c()([`
      margin-bottom: -50px;
    `]))),"& .ant-page-header-heading-extra":E(S||(S=c()([`
      position: absolute;
      top: 17px;
      right: 20px;
    `])))}}}),O=function(E){var r=E.children,n=E.extra,p=n===void 0?(0,v.jsx)(F.er,{}):n,x=E.ghost,R=x===void 0?!1:x,D=E.title,L=D===void 0?!1:D,P=M()(E,u),U=C(),j=U.styles;return(0,v.jsx)(l._z,a()(a()({ghost:R,extra:p,className:j.pageContainer,title:L},P),{},{children:r}))};g.Z=O},78474:function(z,g,e){e.d(g,{j:function(){return f},t:function(){return M}});var m=e(54388),a=e(87300);function f(i,c,F,l,o,s){var v=o!=null?o:a.ZP,u=(0,m.useRequest)(i(c,F),{manual:!0,onSuccess:function(O){if(O.code!==0?v.error(O.msg):v.success(O.msg),s)s();else{var h;l==null||(h=l.current)===null||h===void 0||h.reload(!1)}},onError:function(){v.error("\u64CD\u4F5C\u5931\u8D25")}}),d=u.run,S=u.loading;return{runOpt:d,loading:S}}function M(i){var c=i.optMethod,F=i.optType,l=i.method,o=i.actionRef,s=i.messageApi,v=i.onSuccessCallback,u=i.showSuccessMessage,d=u===void 0?!0:u,S=s!=null?s:a.ZP,C=(0,m.useRequest)(c(F,l),{manual:!0,onSuccess:function(r){var n=typeof r.msg=="string"?r.msg:JSON.stringify(r.msg);if(r.code!==0)S.error(n);else if(v)v(r);else{var p;d&&S.success(n),o==null||(p=o.current)===null||p===void 0||p.reload(!1)}},onError:function(){S.error("\u64CD\u4F5C\u5931\u8D25")}}),O=C.run,h=C.loading;return{runOpt:O,loading:h}}},63925:function(z,g,e){e.r(g),e.d(g,{default:function(){return Oe}});var m=e(90228),a=e.n(m),f=e(26068),M=e.n(f),i=e(87999),c=e.n(i),F=e(48305),l=e.n(F),o=e(1743),s=e(38419),v=e(67254),u=e(78474),d=e(19048),S=e(90254),C=e(54388),O=e(37665),h=e(87300),E=e(38902),r=e(64085),n=e(20877),p=e(67870),x=e(84249),R=e(41901),D=e(75271),L=e(14443),P=e(82715),U=e(61487),j=e(56247),_=e(44725),N=e(65825),Q=e(58578),t=e(52676),Pe=function(Z){var K=Z.drawerData,I=Z.sshData,ae=Z.onVisibleChange,te=Z.onSubmit,ne=_.Z.useForm(),ue=l()(ne,1),J=ue[0],oe=h.ZP.useMessage(),H=l()(oe,2),re=H[0],le=H[1];(0,D.useEffect)(function(){K.show&&(I?J.setFieldsValue(I):J.resetFields())},[I,J,K.show]);var se=function(){var k=c()(a()().mark(function $(B){var V,G,T;return a()().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:if(G=(V=B.label)===null||V===void 0?void 0:V.trim(),T=/^[a-zA-Z0-9_-]+$/g,!(G&&!T.test(G))){W.next=5;break}return re.error("\u3010".concat(G,"\u3011 \u6821\u9A8C\u4E0D\u901A\u8FC7\uFF0C\u53EA\u80FD\u4F7F\u7528\u82F1\u6587 \u6570\u5B57 _ -")),W.abrupt("return",!1);case 5:if(!(K.action==="post"&&!B.ssh_pwd&&!B.ssh_key)){W.next=8;break}return re.error("\u3010".concat(B.name,"\u3011 \u6821\u9A8C\u4E0D\u901A\u8FC7\uFF0C\u5FC5\u987B\u63D0\u4F9B\u4E00\u79CD\u8BA4\u8BC1\u65B9\u5F0F")),W.abrupt("return",!1);case 8:return W.abrupt("return",!0);case 9:case"end":return W.stop()}},$)}));return function(B){return k.apply(this,arguments)}}();return(0,t.jsxs)(L.a,{form:J,title:K.title,open:K.show,onOpenChange:ae,width:"60%",layout:"horizontal",labelCol:{flex:"100px"},drawerProps:{maskClosable:!1,destroyOnClose:!0},onFinish:function(){var k=c()(a()().mark(function $(B){var V;return a()().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,se(B);case 2:if(V=T.sent,V){T.next=5;break}return T.abrupt("return",!1);case 5:return T.next=7,te(B);case 7:return T.abrupt("return",!0);case 8:case"end":return T.stop()}},$)}));return function($){return k.apply(this,arguments)}}(),initialValues:{ssh_port:22},children:[le,(0,t.jsx)(P.Z,{name:"name",label:"\u540D\u79F0",rules:[{required:!0,message:"\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"}],placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0",fieldProps:{maxLength:50}}),(0,t.jsx)(P.Z,{name:"label",label:"\u6807\u7B7E",rules:[{required:!0,message:"\u6807\u7B7E\u4E0D\u80FD\u4E3A\u7A7A"}],placeholder:"\u8BF7\u8F93\u5165\u51ED\u8BC1label",fieldProps:{maxLength:25}}),(0,t.jsxs)(N.Z,{children:[(0,t.jsx)(Q.Z,{span:12,children:(0,t.jsx)(P.Z,{name:"ssh_user",label:"SSH\u7528\u6237",rules:[{required:!0,message:"SSH\u7528\u6237\u4E0D\u80FD\u4E3A\u7A7A"}],placeholder:"SSH\u7528\u6237...",fieldProps:{maxLength:20}})}),(0,t.jsx)(Q.Z,{span:6}),(0,t.jsx)(Q.Z,{span:6,children:(0,t.jsx)(U.Z,{name:"ssh_port",label:"SSH\u7AEF\u53E3",rules:[{required:!0,message:"\u7AEF\u53E3\u4E0D\u80FD\u4E3A\u7A7A"}],min:1,max:65535,placeholder:"SSH \u7AEF\u53E3"})})]}),K.action==="post"&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(_.Z.Item,{label:"SSH \u5BC6\u7801",name:"ssh_pwd",rules:[{required:!0,message:""}],children:(0,t.jsxs)("div",{children:[(0,t.jsx)(n.Z,{message:"\u4E0D\u652F\u6301\u4FEE\u6539\uFF0C\u5982\u679C\u8981\u4FEE\u6539\u8BF7\u91CD\u65B0\u521B\u5EFA\u3002",type:"info",showIcon:!0,style:{marginBottom:8}}),(0,t.jsx)(P.Z,{name:"ssh_pwd",placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801",rules:[{required:!0,message:"SSH\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A"}],fieldProps:{maxLength:188},noStyle:!0})]})}),(0,t.jsx)(_.Z.Item,{label:"SSH KEY",name:"ssh_key",rules:[{required:!0,message:""}],children:(0,t.jsxs)("div",{children:[(0,t.jsx)(n.Z,{message:"\u4E0D\u652F\u6301\u4FEE\u6539\uFF0C\u5982\u679C\u8981\u4FEE\u6539\u8BF7\u91CD\u65B0\u521B\u5EFA\u3002",type:"info",showIcon:!0,style:{marginBottom:8}}),(0,t.jsx)(j.Z,{name:"ssh_key",placeholder:"\u8BF7\u8F93\u5165SSH\u5BC6\u94A5",rules:[{required:!0,message:"SSH KEY\u4E0D\u80FD\u4E3A\u7A7A"}],fieldProps:{maxLength:65535,autoSize:{minRows:10,maxRows:15}},noStyle:!0})]})})]}),(0,t.jsx)(j.Z,{name:"description",label:"\u8BE6\u60C5\u5907\u6CE8",placeholder:"\u5907\u6CE8\u4E00\u4E0B",fieldProps:{maxLength:200}})]})},ge=Pe,X=e(23261);function fe(){return(0,X.eg)("/api/job/v1/meta/ssh/")}function de(pe,Z){return(0,X.S_)("/api/job/v1/meta/ssh/",Z)}function Se(){return(0,X.S_)("/api/job/v1/meta/ssh/","DELETE")}function Ce(){return(0,X.S_)("/api/job/v1/meta/ssh/sync/","POST")}function De(){return(0,X.S_)("/api/job/v1/meta/ssh/","PATCH")}var Fe=function(){var Z,K,I=(0,D.useRef)(),ae=(0,D.useState)(""),te=l()(ae,2),ne=te[0],ue=te[1],J=(0,O.Z)(ne,{wait:300}),oe=(0,C.useModel)("@@initialState"),H=oe.initialState,re=(Z=H==null?void 0:H.currentBizId)!==null&&Z!==void 0?Z:"",le=(K=H==null?void 0:H.currentBizName)!==null&&K!==void 0?K:"\u6240\u6709\u9879\u76EE",se=re==="500",k=h.ZP.useMessage(),$=l()(k,2),B=$[0],V=$[1],G=(0,D.useState)([]),T=l()(G,2),q=T[0],W=T[1],_e=(0,u.j)(Se,void 0,"DELETE",I,B),xe=_e.runOpt,Te=_e.loading,me=(0,u.j)(Ce,void 0,"POST",I,B),Me=me.runOpt,je=me.loading,Be=(0,u.j)(de,"create","POST",I,B),Ae=Be.runOpt,ye=(0,u.j)(de,"update","PUT",I,B),be=ye.runOpt,Re=(0,u.j)(De,void 0,"PATCH",I,B),Ie=Re.runOpt,Le=(0,D.useState)(!1),ce=l()(Le,2),Ze=ce[0],ie=ce[1],Ke=(0,D.useState)(),ve=l()(Ke,2),ee=ve[0],he=ve[1],We=(0,C.useSearchParams)(),Ue=l()(We,1),He=Ue[0];(0,D.useEffect)(function(){var A;(A=I.current)===null||A===void 0||A.reload()},[He]);var $e=[{title:"\u540D\u79F0",dataIndex:"name",width:200},{title:"\u6807\u8BB0",dataIndex:"label",width:120},{title:"\u7528\u6237",dataIndex:"ssh_user",width:100},{title:"\u7AEF\u53E3",dataIndex:"ssh_port",width:100},{title:"\u4E1A\u52A1",dataIndex:"biz_cn_name",width:100},{title:"\u66F4\u65B0\u4EBA",dataIndex:"update_by",width:100},{title:"\u66F4\u65B0\u65F6\u95F4",dataIndex:"update_time",width:150},{title:"\u64CD\u4F5C",dataIndex:"option",valueType:"option",width:80,fixed:"right",render:function(y,b){return[(0,t.jsx)(E.Z.Link,{onClick:function(){he(b),ie(!0)},disabled:se,children:"\u7F16\u8F91"},"edit"),(0,t.jsx)(r.Z,{title:"\u5220\u9664SSH",description:(0,t.jsxs)(t.Fragment,{children:["\u5220\u9664\u300A",b.name,"\u300B\u4E4B\u540E\u65E0\u6CD5\u627E\u56DE\uFF0C\u8BF7\u8C28\u614E\u64CD\u4F5C\uFF01"]}),onConfirm:function(){xe({id_list:[b.id]})},okButtonProps:{loading:Te},children:(0,t.jsx)(E.Z.Link,{type:"danger",children:"\u5220\u9664"})},"delete")]}}];return(0,t.jsxs)(v.Z,{ghost:!1,children:[V,(0,t.jsx)(n.Z,{type:"success",showIcon:!0,message:le,description:(0,t.jsxs)(t.Fragment,{children:["\u672C\u670D\u52A1\u4E3B\u8981\u7528\u4E8E\u975EAgent\u7528\u6237\u6267\u884C\u4F5C\u4E1A\u4F7F\u7528\u3002",(0,t.jsx)("br",{}),"\u4F8B\u5982\uFF1A\u4F7F\u7528MAC\u8FDB\u884C\u5BA2\u6237\u7AEF\u6784\u5EFA\uFF0C\u53EA\u6709\u767B\u5F55\u7684\u7528\u6237\u624D\u80FD\u4F7F\u7528\u94A5\u5319\u4E32\u529F\u80FD\u3002"]}),style:{marginBottom:16}}),(0,t.jsx)(S.Z,{actionRef:I,params:{searchValue:J},rowKey:"id",search:!1,defaultSize:"small",request:fe(),columns:$e,scroll:{x:1200},rowSelection:{onChange:function(y,b){W(b)}},tableAlertRender:function(y){var b=y.selectedRowKeys,w=y.onCleanSelected;return(0,t.jsx)(p.Z,{size:24,children:(0,t.jsxs)("span",{children:["\u5DF2\u9009 ",b.length," \u9879",(0,t.jsx)("a",{style:{marginInlineStart:8},onClick:w,children:"\u53D6\u6D88\u9009\u62E9"})]})})},tableAlertOptionRender:function(y){var b=y.onCleanSelected;return(q==null?void 0:q.length)>0&&(0,t.jsx)(s.Z,{changeFlowDesign:function(Ee){return Ie(Ee)},selectedRowsState:q,buttonText:"\u6279\u91CF\u66F4\u6539\u4E1A\u52A1",onSuccess:function(){b()},selectListKey:"id_list"})},pagination:o.V2,toolbar:{search:(0,t.jsx)(x.Z,{prefix:(0,t.jsx)(d.Z,{}),style:{width:350},placeholder:"\u8F93\u5165\u5173\u952E\u5B57\u5168\u5C40\u641C\u7D22",allowClear:!0,value:ne,onChange:function(y){return ue(y.target.value)}}),actions:[(0,t.jsx)(R.ZP,{type:"primary",onClick:function(){he(void 0),ie(!0)},disabled:se,children:"\u6DFB\u52A0SSH\u4FE1\u606F"},"add"),(0,t.jsx)(R.ZP,{onClick:function(){return Me({})},loading:je,children:"\u5237\u65B0\u7F13\u5B58"},"sync")]}}),(0,t.jsx)(ge,{drawerData:{show:Ze,title:ee?"\u7F16\u8F91SSH\u4FE1\u606F":"\u65B0\u589ESSH\u4FE1\u606F",action:ee?"put":"post"},sshData:ee,onVisibleChange:function(y){ie(y)},onSubmit:function(){var A=c()(a()().mark(function y(b){var w;return a()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:if(w=M()(M()({},ee),b),!ee){Y.next=6;break}return Y.next=4,be(w);case 4:Y.next=8;break;case 6:return Y.next=8,Ae(b);case 8:case"end":return Y.stop()}},y)}));return function(y){return A.apply(this,arguments)}}()})]})},Oe=Fe}}]);
