"use strict";(self.webpackChunkf2=self.webpackChunkf2||[]).push([[7654],{61487:function(K,P,u){var E=u(98037),r=u(58006),D=u(75271),g=u(34832),o=u(52676),F=["fieldProps","min","proFieldProps","max"],A=function(n,c){var h=n.fieldProps,m=n.min,_=n.proFieldProps,i=n.max,p=(0,r.Z)(n,F);return(0,o.jsx)(g.Z,(0,E.Z)({valueType:"digit",fieldProps:(0,E.Z)({min:m,max:i},h),ref:c,filedConfig:{defaultProps:{width:"100%"}},proFieldProps:_},p))},d=D.forwardRef(A);P.Z=d},82715:function(K,P,u){var E=u(99459),r=u(98037),D=u(58006),g=u(18542),o=u(44725),F=u(86432),A=u(71770),d=u(75271),l=u(34832),n=u(52676),c=["fieldProps","proFieldProps"],h=["fieldProps","proFieldProps"],m="text",_=function(t){var e=t.fieldProps,C=t.proFieldProps,B=(0,D.Z)(t,c);return(0,n.jsx)(l.Z,(0,r.Z)({valueType:m,fieldProps:e,filedConfig:{valueType:m},proFieldProps:C},B))},i=function(t){var e=(0,g.Z)(t.open||!1,{value:t.open,onChange:t.onOpenChange}),C=(0,E.Z)(e,2),B=C[0],I=C[1];return(0,n.jsx)(o.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(L){var M,Z=L.getFieldValue(t.name||[]);return(0,n.jsx)(F.Z,(0,r.Z)((0,r.Z)({getPopupContainer:function(v){return v&&v.parentNode?v.parentNode:v},onOpenChange:function(v){return I(v)},content:(0,n.jsxs)("div",{style:{padding:"4px 0"},children:[(M=t.statusRender)===null||M===void 0?void 0:M.call(t,Z),t.strengthText?(0,n.jsx)("div",{style:{marginTop:10},children:(0,n.jsx)("span",{children:t.strengthText})}):null]}),overlayStyle:{width:240},placement:"rightTop"},t.popoverProps),{},{open:B,children:t.children}))}})},p=function(t){var e=t.fieldProps,C=t.proFieldProps,B=(0,D.Z)(t,h),I=(0,d.useState)(!1),O=(0,E.Z)(I,2),L=O[0],M=O[1];return e!=null&&e.statusRender&&B.name?(0,n.jsx)(i,{name:B.name,statusRender:e==null?void 0:e.statusRender,popoverProps:e==null?void 0:e.popoverProps,strengthText:e==null?void 0:e.strengthText,open:L,onOpenChange:M,children:(0,n.jsx)("div",{children:(0,n.jsx)(l.Z,(0,r.Z)({valueType:"password",fieldProps:(0,r.Z)((0,r.Z)({},(0,A.Z)(e,["statusRender","popoverProps","strengthText"])),{},{onBlur:function(b){var v;e==null||(v=e.onBlur)===null||v===void 0||v.call(e,b),M(!1)},onClick:function(b){var v;e==null||(v=e.onClick)===null||v===void 0||v.call(e,b),M(!0)}}),proFieldProps:C,filedConfig:{valueType:m}},B))})}):(0,n.jsx)(l.Z,(0,r.Z)({valueType:"password",fieldProps:e,proFieldProps:C,filedConfig:{valueType:m}},B))},f=_;f.Password=p,f.displayName="ProFormComponent",P.Z=f},67254:function(K,P,u){var E=u(26068),r=u.n(E),D=u(67825),g=u.n(D),o=u(53649),F=u.n(o),A=u(99503),d=u(77777),l=u(88230),n=u(75271),c=u(52676),h=["children","extra","ghost","title"],m,_,i=(0,l.kc)(function(f){var a=f.css;return{pageContainer:{"& .ant-page-header-heading":a(m||(m=F()([`
      margin-bottom: -50px;
    `]))),"& .ant-page-header-heading-extra":a(_||(_=F()([`
      position: absolute;
      top: 17px;
      right: 20px;
    `])))}}}),p=function(a){var t=a.children,e=a.extra,C=e===void 0?(0,c.jsx)(A.er,{}):e,B=a.ghost,I=B===void 0?!1:B,O=a.title,L=O===void 0?!1:O,M=g()(a,h),Z=i(),b=Z.styles;return(0,c.jsx)(d._z,r()(r()({ghost:I,extra:C,className:b.pageContainer,title:L},M),{},{children:t}))};P.Z=p},78474:function(K,P,u){u.d(P,{j:function(){return D},t:function(){return g}});var E=u(54388),r=u(87300);function D(o,F,A,d,l,n){var c=l!=null?l:r.ZP,h=(0,E.useRequest)(o(F,A),{manual:!0,onSuccess:function(p){if(p.code!==0?c.error(p.msg):c.success(p.msg),n)n();else{var f;d==null||(f=d.current)===null||f===void 0||f.reload(!1)}},onError:function(){c.error("\u64CD\u4F5C\u5931\u8D25")}}),m=h.run,_=h.loading;return{runOpt:m,loading:_}}function g(o){var F=o.optMethod,A=o.optType,d=o.method,l=o.actionRef,n=o.messageApi,c=o.onSuccessCallback,h=o.showSuccessMessage,m=h===void 0?!0:h,_=n!=null?n:r.ZP,i=(0,E.useRequest)(F(A,d),{manual:!0,onSuccess:function(t){var e=typeof t.msg=="string"?t.msg:JSON.stringify(t.msg);if(t.code!==0)_.error(e);else if(c)c(t);else{var C;m&&_.success(e),l==null||(C=l.current)===null||C===void 0||C.reload(!1)}},onError:function(){_.error("\u64CD\u4F5C\u5931\u8D25")}}),p=i.run,f=i.loading;return{runOpt:p,loading:f}}},74353:function(K,P,u){u.r(P),u.d(P,{default:function(){return mu}});var E=u(90228),r=u.n(E),D=u(26068),g=u.n(D),o=u(67825),F=u.n(o),A=u(87999),d=u.n(A),l=u(48305),n=u.n(l),c=u(99503),h=u(67254),m=u(80696),_=u(78474),i=u(79886),p=u(84286),f=u(36903),a=u(41891),t=u(59050),e=u(82715),C=u(54805),B=u(66130),I=u(61487),O=u(54388),L=u(87300),M=u(38902),Z=u(20877),b=u(67870),v=u(41901),au=u(44725),Y=u(75271),su=u(23261);function lu(pu,H){return(0,su.S_)("/api/job/v1/fast/cloud/",H)}var s=u(52676),iu=["cloud_native_task_name","source"],du=["static_hosts"],cu=function(){var H,G,vu=a.A.useForm(),_u=n()(vu,1),z=_u[0],Eu=(0,O.useModel)("@@initialState"),V=Eu.initialState,J=(H=V==null?void 0:V.currentBizId)!==null&&H!==void 0?H:"",k=J==="500",Fu=(G=V==null?void 0:V.currentBizName)!==null&&G!==void 0?G:"\u6240\u6709\u9879\u76EE",hu=L.ZP.useMessage(),w=n()(hu,2),fu=w[0],Cu=w[1],Pu=(0,Y.useState)(function(){return{}}),q=n()(Pu,2),Q=q[0],Du=q[1],gu=(0,Y.useRef)(),N=new Date,uu={name:"\u5FEB\u901F\u65E0\u670D\u52A1\u6D41\u6C34\u7EBF\u6267\u884C-".concat(N.getFullYear()).concat(N.getMonth()+1).concat(N.getDate()).concat(N.getHours()).concat(N.getMinutes()).concat(N.getSeconds()),task_name:"cloudNativeScriptExecute",time_out:1800,source:"fromHandle",node_type:"static_hosts",task_data:f.H0},Bu=(0,O.useRequest)(function(){return(0,i.aG)({page:1,limit:300})},{refreshDeps:[J]}),eu=Bu.data,Au=eu===void 0?[]:eu,Ou=(0,O.useRequest)(function(){return(0,p.Xn)()},{refreshDeps:[J]}),nu=Ou.data,tu=nu===void 0?[]:nu,ou=(0,_.t)({optMethod:lu,optType:void 0,method:"POST",actionRef:gu,messageApi:fu,onSuccessCallback:function(){L.ZP.success((0,s.jsxs)("span",{children:["\u4EFB\u52A1\u89E6\u53D1\u6210\u529F\uFF01\u53EF\u5728"," ",(0,s.jsx)(M.Z.Link,{onClick:function(){return O.history.push("/orderCenter/orderList")},children:"\u5DE5\u4F5C\u53F0"})," ","\u4E2D\u67E5\u770B\u4EFB\u52A1\u6267\u884C\u60C5\u51B5"]}))},showSuccessMessage:!1}),Mu=ou.runOpt,Tu=ou.loading,ju=function(j){Du(j)},xu=function(){var T=d()(r()().mark(function j(x){var R,W,U,y,$,yu,ru;return r()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.prev=0,W=x.cloud_native_task_name,U=x.source,y=F()(x,iu),$=Q.static_hosts,yu=F()(Q,du),ru=g()(g()({},y),{},{static_hosts:(R=$==null?void 0:$.map(function(X){return{agent_id:X.agent_id,ip:X.ip,hostname:X.hostname}}))!==null&&R!==void 0?R:[],task_name:uu.task_name}),S.next=6,Mu(ru);case 6:S.next=11;break;case 8:S.prev=8,S.t0=S.catch(0),console.log(S.t0);case 11:case"end":return S.stop()}},j,null,[[0,8]])}));return function(x){return T.apply(this,arguments)}}();return(0,s.jsxs)(h.Z,{children:[Cu,(0,s.jsx)(Z.Z,{type:"info",showIcon:!0,message:"".concat(Fu),description:"\u5FEB\u901F\u6267\u884C\u65E0\u670D\u52A1\u6D41\u6C34\u7EBF\uFF0C\u9ED8\u8BA4\u8D85\u65F6\u65F6\u95F4\u4E3A1800\u79D2\uFF0C\u81EA\u52A8\u7ED3\u5355\u65F6\u95F4\u4E3A1\u5929\u3002",style:{marginBottom:16}}),(0,s.jsx)(t.Z,{children:(0,s.jsxs)(a.A,{layout:"horizontal",labelCol:{flex:"120px"},form:z,initialValues:uu,onFinish:xu,disabled:k,submitter:{render:function(j){return(0,s.jsxs)(b.Z,{style:{marginTop:16,marginLeft:120},children:[(0,s.jsx)(v.ZP,{type:"primary",loading:Tu,onClick:function(){var R;return(R=j.form)===null||R===void 0?void 0:R.submit()},children:"\u5FEB\u901F\u6267\u884C"}),(0,s.jsx)(v.ZP,{onClick:function(){return window.open("/f2/orderCenter/myCreate","_blank")},children:"\u67E5\u770B\u4EFB\u52A1"})]})}},children:[(0,s.jsx)(e.Z,{name:"name",label:"\u4EFB\u52A1\u540D\u79F0",placeholder:"\u8BF7\u8F93\u5165\u4EFB\u52A1\u540D\u79F0",rules:[{required:!0,message:"\u4EFB\u52A1\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"},{max:30,message:"\u4EFB\u52A1\u540D\u79F0\u4E0D\u8981\u592A\u957F"},{min:2,message:"\u4EFB\u52A1\u540D\u79F0\u4E0D\u8981\u592A\u77ED"}],fieldProps:{autoFocus:!1}}),(0,s.jsx)(m.Z,{drawerData:{show:!0},formData:Q,onChange:ju,label:"\u76EE\u6807\u96C6\u7FA4",modalTitle:"\u4E91\u539F\u751F\u96C6\u7FA4",triggerButtonText:"\u9009\u62E9\u96C6\u7FA4",isCloudNative:!0,labelCol:{flex:"120px"},required:!0}),(0,s.jsx)(C.Z.Group,{name:"source",label:"\u58F0\u660E\u6765\u6E90",options:[{label:"\u624B\u5DE5\u5F55\u5165",value:"fromHandle"},{label:"\u58F0\u660E\u5E93",value:"fromSystem"}]}),(0,s.jsx)(a.A.Item,{noStyle:!0,shouldUpdate:function(j,x){return j.source!==x.source},children:function(j){var x=j.getFieldValue,R=x("source");return(0,s.jsxs)(s.Fragment,{children:[R==="fromSystem"&&(0,s.jsx)(B.Z,{name:"cloud_native_task_name",label:"\u58F0\u660E\u540D\u79F0",options:tu.map(function(W){return{label:W.task_name,value:W.task_name,key:W.id}}),fieldProps:{showSearch:!0,allowClear:!0,filterOption:function(U,y){return(y==null?void 0:y.label).toLowerCase().includes(U.toLowerCase())},onChange:function(U){var y=tu.find(function($){return $.task_name===U});z.setFieldValue("task_data",y==null?void 0:y.task_data)}}}),(0,s.jsx)(au.Z.Item,{name:"task_data",label:"\u58F0\u660E\u5185\u5BB9",rules:[{required:!0,message:"\u58F0\u660E\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A"}],children:(0,s.jsx)(c.ML,{height:"600px",showFullScreenButton:!0,language:"yaml",theme:"vs-dark",onChange:function(U){return z.setFieldValue("task_data",U)},options:{minimap:{enabled:!1},scrollBeyondLastLine:!1,readOnly:k,scrollbar:{alwaysConsumeMouseWheel:!1}}})})]})}}),(0,s.jsx)(I.Z,{name:"time_out",label:"\u8D85\u65F6\u65F6\u95F4",min:5,max:9999999,rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u8D85\u65F6\u65F6\u95F4"}]}),(0,s.jsx)(B.Z,{name:"voucher_info",label:"\u9009\u62E9\u51ED\u8BC1",mode:"multiple",fieldProps:{maxLength:250,showSearch:!0},options:Au.map(function(T){return{label:T.v_key,value:"".concat(T.tenantid,"___").concat(T.v_key,"___").concat(T.v_type)}})})]})})]})},mu=cu},79886:function(K,P,u){u.d(P,{Qw:function(){return c},Te:function(){return l},aG:function(){return A},kL:function(){return _},n1:function(){return m},pj:function(){return F},r0:function(){return h}});var E=u(90228),r=u.n(E),D=u(87999),g=u.n(D),o=u(23261);function F(){return(0,o.eg)("/api/job/v1/meta/voucher/")}function A(i){return d.apply(this,arguments)}function d(){return d=g()(r()().mark(function i(p){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,o.dT)("/api/job/v1/meta/voucher/",p));case 1:case"end":return a.stop()}},i)})),d.apply(this,arguments)}function l(i,p){return(0,o.S_)("/api/job/v1/meta/voucher/",p)}function n(){return commonOperationApi("/api/job/v1/meta/voucher/","PUT")}function c(){return(0,o.S_)("/api/job/v1/meta/voucher/","DELETE")}function h(){return(0,o.S_)("/api/job/v1/meta/voucher/sync/","POST")}function m(){return(0,o.S_)("/api/job/v1/meta/voucher/","PATCH")}function _(i){return(0,o.W8)("/api/job/v1/resource/voucher_associate/",i)}},36903:function(K,P,u){u.d(P,{H0:function(){return g},JH:function(){return D},zB:function(){return r}});var E="cli_a270b45f63b9100b",r={free:"\u7A7A\u95F2",busy:"\u7E41\u5FD9",lock:"\u9501\u5B9A",offline:"\u79BB\u7EBF",maintain:"\u7EF4\u62A4"},D={python:"python",sh:"shell",go:"go",lua:"lua",perl:"perl",php:"php",javascript:"javascript",typescript:"typescript"},g=`
require:
  fields:
    - "field_1"
  vouchers:
    - "voucher1"
# [\u53EF\u9009] pod \u7684\u8D44\u6E90\u9650\u5236
# \u7528\u6237\u53EF\u4EE5\u9009\u62E9\u5728\u4EFB\u52A1\u7EA7\u6307\u5B9A\u8D44\u6E90\u9700\u6C42\uFF0C\u800C\u4E0D\u662F\u5728\u6BCF\u4E2A Step \u4E0A\u6307\u5B9A\u8D44\u6E90\u9700\u6C42\u3002\u5982\u679C\u7528\u6237\u6307\u5B9A\u4E86\u4EFB\u52A1\u7EA7\u8D44\u6E90\u8981\u6C42\uFF0C
# \u5B83\u5C06\u786E\u4FDD kubelet \u53EA\u4E3A\u6267\u884C Task \u7684 Steps \u4FDD\u7559\u8BE5\u6570\u91CF\u7684\u8D44\u6E90\u3002\u5982\u679C\u7528\u6237\u6307\u5B9A\u4E86\u4EFB\u52A1\u7EA7\u8D44\u6E90\u9650\u5236\uFF0C\u5219\u4EFB\u4F55 Step \u90FD\u4E0D\u80FD\u4F7F\u7528\u8D85\u8FC7\u8BE5\u6570\u91CF\u7684\u8D44\u6E90\u3002
computeResources:
  requests:
    memory: "64Mi" # \u7533\u8BF7 512 MB \u7684\u5185\u5B58
    cpu: "30m" # \u7533\u8BF7 1 Core \u7684 CPU
  limits:
    memory: "64Mi" # \u7533\u8BF7 512 MB \u7684\u5185\u5B58
    cpu: "30m" # \u7533\u8BF7 1 Core \u7684 CPU
# [\u5FC5\u9009] \u4EFB\u52A1\u5B9A\u4E49
taskSpec:
  # [\u5FC5\u9009] \u4EFB\u52A1\u5C55\u793A\u540D\u79F0
  displayName: "cc-test"
  # [\u53EF\u9009] \u63CF\u8FF0
  description: "\u8FD9\u662F\u4E00\u4EFD\u63CF\u8FF0"
  # [\u5FC5\u9009] \u4EFB\u52A1\u6B65\u9AA4\u5B9A\u4E49
  # \u4EFB\u52A1\u6709\u4E24\u79CD\u6A21\u5F0F(\u53EA\u80FD\u9009\u5176\u4E00)
  # - script \u6A21\u5F0F:
  # - command \u6A21\u5F0F:
  steps:
    # [\u5FC5\u9009] \u6B65\u9AA4\u540D\u79F0
    - name: "hello world"
      # [\u53EF\u9009] \u5F53 step \u51FA\u9519\u65F6\u7684\u5904\u7406\u65B9\u5F0F
      # [ continue | stopAndFail  | waitUntilTimeout ]
      onError: waitUntilTimeout
      # [\u53EF\u9009] \u8D85\u65F6\u65F6\u95F4(\u9ED8\u8BA460\u5206\u949F)
      # \u6301\u7EED\u65F6\u95F4\u5B57\u7B26\u4E32\u662F\u53EF\u80FD\u6709\u7B26\u53F7\u7684\u5341\u8FDB\u5236\u6570\u5B57\u5E8F\u5217\uFF0C\u6BCF\u4E2A\u5341\u8FDB\u5236\u6570\u5B57\u90FD\u5E26\u6709\u53EF\u9009\u7684\u5206\u6570\u548C\u5355\u4F4D\u540E\u7F00\uFF0C
      # \u4F8B\u5982\u201C300ms\u201D\u3001\u201C-1.5h\u201D\u6216\u201C2h45m\u201D\u3002\u6709\u6548\u7684\u65F6\u95F4\u5355\u4F4D\u4E3A\u201Cns\u201D\u3001\u201Cus\u201D\uFF08\u6216\u201C\u03BCs\u201D\uFF09\u3001\u201Cms\u201D\u3001\u201Cs\u201D\u3001\u201Cm\u201D\u3001\u201Ch\u201D\u3002
      timeout: "200s"
      # [\u5FC5\u9009] \u4EFB\u52A1\u8FD0\u884C\u6240\u5904\u7684\u955C\u50CF
      image: "harbor.123u.com/public/rocky9.1-python3:latest"
      # [\u5FC5\u9009] \u8FD0\u884C\u7684\u811A\u672C(\u4E0E command \u4E8C\u9009\u4E00)
      script: |
        #!/bin/sh
        set -euo pipefail
        echo hello world

`}}]);
