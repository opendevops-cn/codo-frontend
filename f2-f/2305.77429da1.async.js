"use strict";(self.webpackChunkf2=self.webpackChunkf2||[]).push([[2305],{82715:function(Fe,A,e){var _=e(99459),f=e(98037),U=e(58006),b=e(18542),F=e(44725),l=e(86432),C=e(71770),g=e(75271),N=e(34832),m=e(52676),le=["fieldProps","proFieldProps"],de=["fieldProps","proFieldProps"],O="text",ce=function(a){var r=a.fieldProps,E=a.proFieldProps,S=(0,U.Z)(a,le);return(0,m.jsx)(N.Z,(0,f.Z)({valueType:O,fieldProps:r,filedConfig:{valueType:O},proFieldProps:E},S))},fe=function(a){var r=(0,b.Z)(a.open||!1,{value:a.open,onChange:a.onOpenChange}),E=(0,_.Z)(r,2),S=E[0],G=E[1];return(0,m.jsx)(F.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(p){var h,n=p.getFieldValue(a.name||[]);return(0,m.jsx)(l.Z,(0,f.Z)((0,f.Z)({getPopupContainer:function(i){return i&&i.parentNode?i.parentNode:i},onOpenChange:function(i){return G(i)},content:(0,m.jsxs)("div",{style:{padding:"4px 0"},children:[(h=a.statusRender)===null||h===void 0?void 0:h.call(a,n),a.strengthText?(0,m.jsx)("div",{style:{marginTop:10},children:(0,m.jsx)("span",{children:a.strengthText})}):null]}),overlayStyle:{width:240},placement:"rightTop"},a.popoverProps),{},{open:S,children:a.children}))}})},ne=function(a){var r=a.fieldProps,E=a.proFieldProps,S=(0,U.Z)(a,de),G=(0,g.useState)(!1),w=(0,_.Z)(G,2),p=w[0],h=w[1];return r!=null&&r.statusRender&&S.name?(0,m.jsx)(fe,{name:S.name,statusRender:r==null?void 0:r.statusRender,popoverProps:r==null?void 0:r.popoverProps,strengthText:r==null?void 0:r.strengthText,open:p,onOpenChange:h,children:(0,m.jsx)("div",{children:(0,m.jsx)(N.Z,(0,f.Z)({valueType:"password",fieldProps:(0,f.Z)((0,f.Z)({},(0,C.Z)(r,["statusRender","popoverProps","strengthText"])),{},{onBlur:function(D){var i;r==null||(i=r.onBlur)===null||i===void 0||i.call(r,D),h(!1)},onClick:function(D){var i;r==null||(i=r.onClick)===null||i===void 0||i.call(r,D),h(!0)}}),proFieldProps:E,filedConfig:{valueType:O}},S))})}):(0,m.jsx)(N.Z,(0,f.Z)({valueType:"password",fieldProps:r,proFieldProps:E,filedConfig:{valueType:O}},S))},R=ce;R.Password=ne,R.displayName="ProFormComponent",A.Z=R},30168:function(Fe,A,e){e.d(A,{OV:function(){return f}});var _=e(60164),f=function(F,l){var C=(0,_.ac)({minWidth:l||1700}),g=C?F.wide:F.small;return{isWideScreen:C,width:g}},U=function(F){var l=useMediaQuery({minWidth:1700}),C=useMediaQuery({maxWidth:1699});return l?{type:"wide",width:F.wide}:C?{type:"small",width:F.small}:{type:"small",width:F.small}};A.ZP=f},41578:function(Fe,A,e){e.d(A,{K:function(){return i}});var _=e(90228),f=e.n(_),U=e(87999),b=e.n(U),F=e(26068),l=e.n(F),C=e(48305),g=e.n(C),N=e(94642),m=e(38153),le=e(78474),de=e(79937),O=e(54388),ce=e(14443),fe=e(82715),ne=e(17931),R=e(87300),te=e(44725),a=e(38902),r=e(41901),E=e(40506),S=e(50876),G=e(32699),w=e.n(G),p=e(75271),h=e(84286),n=e(52676),D=function(j){var H,ae=j.actionRef,J=j.onSuccess,d=j.record,W=j.open,I=j.onOpenChange,L=R.ZP.useMessage(),V=g()(L,2),ve=V[0],se=V[1],me=te.Z.useForm(),oe=g()(me,1),M=oe[0],ge=(0,p.useState)(null),Q=g()(ge,2),o=Q[0],z=Q[1],ie=(0,p.useState)([]),ue=g()(ie,2),X=ue[0],$=ue[1],Y=(0,p.useRef)(null),pe=(0,p.useState)({custom_fields:[]}),q=g()(pe,2),Z=q[0],ee=q[1],he=(0,p.useState)({}),Te=g()(he,1),T=Te[0],c=(0,p.useMemo)(function(){return{formSchema:T,setFormSchema:function(){}}},[T]),x=(0,le.t)({optMethod:h.g3,optType:void 0,method:"POST",actionRef:ae,messageApi:ve,onSuccessCallback:function(){R.ZP.success((0,n.jsxs)("span",{children:["\u4EFB\u52A1\u89E6\u53D1\u6210\u529F\uFF01\u53EF\u5728"," ",(0,n.jsx)(a.Z.Link,{onClick:function(){return O.history.push("/orderCenter/orderList")},children:"\u5DE5\u4F5C\u53F0"})," ","\u4E2D\u67E5\u770B\u4EFB\u52A1\u6267\u884C\u60C5\u51B5"]}))},showSuccessMessage:!1}),xe=x.runOpt,ye=function(s){if(s)try{var u=JSON.parse(s),k=[];Object.entries(u).forEach(function(y){var K=g()(y,2),re=K[0],P=K[1];re.startsWith("Event_")&&P.type==="\u5B9A\u65F6\u5668\u4E8B\u4EF6"&&k.push({id:re,name:P.name,eventdatetime:P.eventdatetime,eventdatetime_role:P.eventdatetime_role,type:P.type,bpm_id:P.bpm_id})}),$(k)}catch(y){console.error("\u89E3\u6790flow_data\u5931\u8D25:",y)}},Re=(0,O.useRequest)(function(t){return(0,h.lZ)({filter_map:{id:t}})},{manual:!0,onSuccess:function(s){if(s!=null&&s[0]&&o){var u=s[0];z(l()(l()(l()({},o),u),{},{id:u.id,originalId:o.originalId})),ye(u.flow_data)}},onError:function(){R.ZP.error("\u83B7\u53D6\u6D41\u7A0B\u7248\u672C\u5931\u8D25")}}),De=Re.run,je=(0,O.useRequest)(function(t){return(0,h.nR)({flow_id:t})},{manual:!0,onSuccess:function(s){var u;ee((u=s==null?void 0:s.form_config)!==null&&u!==void 0?u:[])}}),Me=je.run;(0,p.useEffect)(function(){if(W&&d){var t=d.id,s=l()(l()({},d),{},{flow_name:d.flow_name||d.name,details:d.details||d.description,originalId:t});z(s),M.setFieldsValue(l()({name:"".concat(s.flow_name,"\u4EFB\u52A1"),start_time:new Date},d)),d.flow_version_id&&De(d.flow_version_id),setTimeout(function(){Me(t)},50)}else z(null),ee({custom_fields:[]}),$([])},[W,d,M]);var Pe=function(){I(!1)},Ee=function(){var t=b()(f()().mark(function s(){var u,k,y,K,re,P=arguments;return f()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return u=P.length>0&&P[0]!==void 0?P[0]:{},v.prev=1,v.next=4,M.getFieldsValue();case 4:return y=v.sent,K={},X.forEach(function(B){var Ce=B.id.replace("Event_",""),Ze="timer_".concat(B.id),Oe=M.getFieldValue(Ze);Oe&&(K["force_params_str:Event_".concat(Ce,":eventdatetime")]=Oe.toISOString())}),re={flow_version_id:o==null?void 0:o.flow_version_id,flow_version_name:o==null?void 0:o.flow_version_name,global_params:l()(l()({},w().mapValues(w().omit(u,"$formSchema"),function(B){try{return typeof B=="string"?JSON.parse(B):B}catch(Ce){return B}})),K),start_time:y==null||(k=y.start_time)===null||k===void 0?void 0:k.toISOString()},v.next=10,xe(re);case 10:return ee({custom_fields:[]}),$([]),I(!1),J==null||J(),v.abrupt("return",!0);case 17:return v.prev=17,v.t0=v.catch(1),console.error("Error triggering task:",v.t0),v.abrupt("return",!1);case 21:case"end":return v.stop()}},s,null,[[1,17]])}));return function(){return t.apply(this,arguments)}}();return(0,n.jsxs)(n.Fragment,{children:[se,(0,n.jsxs)(ce.a,{title:o?"\u89E6\u53D1\u4EFB\u52A1 - ".concat(o.flow_name):"\u89E6\u53D1\u4EFB\u52A1",width:"75%",layout:"horizontal",labelCol:{span:2},open:W,onOpenChange:I,form:M,drawerProps:{destroyOnClose:!0,onClose:Pe},initialValues:o?l()({name:"".concat(o.flow_name,"\u4EFB\u52A1"),start_time:new Date},o):void 0,submitter:{render:function(){return[(0,n.jsx)(r.ZP,{onClick:function(){return Pe()},children:"\u53D6\u6D88"},"cancel"),(0,n.jsx)(r.ZP,{type:"primary",onClick:function(){var u;(u=Y.current)!==null&&u!==void 0&&u.submit?Y.current.submit():Ee({})},children:"\u63D0\u4EA4"},"submit")]}},children:[(0,n.jsx)(fe.Z,{name:"name",label:"\u4EFB\u52A1\u540D\u79F0",placeholder:"\u8BF7\u8F93\u5165\u4EFB\u52A1\u540D\u79F0",fieldProps:{maxLength:30},labelCol:{style:{width:"148px",marginRight:"-1px"}},disabled:!0,rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u4EFB\u52A1\u540D\u79F0"}]}),Z&&(Z==null||(H=Z.custom_fields)===null||H===void 0?void 0:H.length)>0&&(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(m.Bl.Provider,{value:c,children:(0,n.jsx)(N.Z,{children:o&&(0,n.jsx)(de.Z,{ref:Y,open:W,onFinish:Ee,formInfo:Z})})})}),(0,n.jsx)(ne.Z,{name:"start_time",label:"\u5F00\u59CB\u65F6\u95F4",initialValue:new Date,labelCol:{style:{width:"148px",marginRight:"-1px"}}}),X.length>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(E.Z,{orientation:"left",children:"\u7CFB\u7EDF\u53C2\u6570"}),X.map(function(t){return(0,n.jsx)(ne.Z,{name:"timer_".concat(t.id),label:(0,n.jsx)(S.Z,{title:"\u5B9A\u65F6\u5668".concat(t.name),children:(0,n.jsx)(a.Z.Text,{style:{width:"135px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:"\u5B9A\u65F6\u5668".concat(t.name)})}),initialValue:t.eventdatetime?new Date(t.eventdatetime):void 0,labelCol:{style:{width:"148px",marginRight:"-1px"}}},t.id)})]})]})]})},i=D;function Be(){var Se=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},j=Se.actionRef,H=useState(!1),ae=_slicedToArray(H,2),J=ae[0],d=ae[1],W=useState(null),I=_slicedToArray(W,2),L=I[0],V=I[1],ve=useState({custom_fields:[]}),se=_slicedToArray(ve,2),me=se[0],oe=se[1],M=useRef(null),ge=message.useMessage(),Q=_slicedToArray(ge,2),o=Q[0],z=Q[1],ie=useOpt(triggerTask,void 0,"POST",j,o),ue=ie.runOpt,X=ie.loading,$=useRequest(function(T){return getFlowVersionList({filter_map:{id:T}})},{manual:!0,onSuccess:function(c){if(c!=null&&c[0]&&L){var x=c[0];V(_objectSpread(_objectSpread(_objectSpread({},L),x),{},{id:x.id,originalId:L.id}))}},onError:function(){message.error("\u83B7\u53D6\u6D41\u7A0B\u7248\u672C\u5931\u8D25")}}),Y=$.run,pe=$.loading,q=useRequest(function(T){return fetchFlowFormConfig({flow_id:T})},{manual:!0,onSuccess:function(c){var x;oe((x=c==null?void 0:c.form_config)!==null&&x!==void 0?x:[])}}),Z=q.run,ee=q.loading,he=function(c){V(c),d(!0),c.flow_version_id&&Y(c.flow_version_id),setTimeout(function(){Z(c.id)},50)},Te=function(){d(!1),V(null),oe({custom_fields:[]})};return{open:J,setOpen:d,record:L,argsFormRef:M,fieldRecords:me,openTriggerTask:he,closeTriggerTask:Te,runTriggerTask:ue,contextHolder:z,loading:X||pe||ee}}var Ae=null}}]);
