"use strict";(self.webpackChunkf2=self.webpackChunkf2||[]).push([[3655],{65074:function(We,le,t){var ie=t(98037),f=t(75271),ge=t(23989),S=t(17002),ue=function(P,pe){return f.createElement(S.Z,(0,ie.Z)((0,ie.Z)({},P),{},{ref:pe,icon:ge.Z}))},Z=f.forwardRef(ue);le.Z=Z},9489:function(We,le,t){var ie=t(48305),f=t.n(ie),ge=t(44725),S=t(75271),ue=t(52676),Z=function(P){var pe=P.children,p=P.modalRender,be=(0,S.useState)(!1),oe=f()(be,2),me=oe[0],he=oe[1],V=(0,S.useState)(!1),ee=f()(V,2),J=ee[0],ne=ee[1],se=ge.Z.useForm(),Ae=f()(se,1),De=Ae[0];return(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsx)("span",{onClick:function(){he(!0),ne(!0)},children:pe}),me&&p&&function(){var de=p(function(){ne(!1),setTimeout(function(){he(!1)},300)},De);return S.cloneElement(de,{open:J})}()]})};le.Z=Z},74245:function(We,le,t){var ie=t(86432),f=t(88230),ge=t(75271),S=t(52676),ue=(0,f.kc)(function(){return{popoverContent:{".ant-popover-inner":{padding:4}},menuItem:{padding:"5px 12px",cursor:"pointer",transition:"all 0.2s",borderRadius:4,"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}},childrenContainer:{cursor:"pointer"}}}),Z=function(P){var pe=P.children,p=P.items,be=P.placement,oe=be===void 0?"bottom":be,me=P.trigger,he=me===void 0?"click":me,V=ue(),ee=V.styles;return(0,S.jsx)(ie.Z,{trigger:he,placement:oe,zIndex:10,arrow:!1,overlayClassName:ee.popoverContent,content:p.map(function(J){return(0,S.jsx)("div",{className:ee.menuItem,children:J.label},J.key)}),children:(0,S.jsx)("span",{className:ee.childrenContainer,children:pe})})};le.Z=(0,ge.memo)(Z)},24980:function(We,le,t){t.r(le),t.d(le,{default:function(){return mt}});var ie=t(26068),f=t.n(ie),ge=t(15558),S=t.n(ge),ue=t(90228),Z=t.n(ue),ke=t(87999),P=t.n(ke),pe=t(48305),p=t.n(pe),be=t(67254),oe=t(19048),me=t(64412),he=t(65074),V=t(54388),ee=t(87300),J=t(28061),ne=t(67870),se=t(80921),Ae=t(84249),De=t(60793),de=t(41901),$e=t(81912),qe=t(44152),pn=t(82187),mn=t.n(pn),F=t(75271),hn=t(82901),e=t(52676),An=function(n){var a,u=n.menuProps,r=n.placement;return u!=null&&(a=u.items)!==null&&a!==void 0&&a.length?(0,e.jsx)(qe.Z,{menu:u,getPopupContainer:function(m){return m.parentElement},placement:r,children:(0,e.jsx)(de.ZP,{children:(0,e.jsxs)(ne.Z,{children:["\u6279\u91CF\u64CD\u4F5C",(0,e.jsx)(he.Z,{})]})})}):null},xn=An,Be=t(9489),He=t(84338),en=t(50876),Ve={tag:"Jw6c5T6ktsofVxYvX02y"},En=function(n){var a=n.value,u=n.max;return(0,e.jsxs)(e.Fragment,{children:[a.slice(0,u).map(function(r,i){return(0,e.jsx)(He.Z,{className:Ve.tag,title:r,children:r},i)}),u&&a.length>u&&(0,e.jsx)(en.Z,{color:"#ffffff",title:(0,e.jsx)(e.Fragment,{children:a.slice(u).map(function(r,i){return(0,e.jsx)(He.Z,{className:Ve.tag,children:r},i)})}),children:(0,e.jsx)(He.Z,{className:Ve.tag,children:"..."})})]})},Fn=En,we=t(98037),Cn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM142.4 642.1L298.7 519a8.84 8.84 0 000-13.9L142.4 381.9c-5.8-4.6-14.4-.5-14.4 6.9v246.3a8.9 8.9 0 0014.4 7z"}}]},name:"menu-unfold",theme:"outlined"},jn=Cn,nn=t(17002),bn=function(n,a){return F.createElement(nn.Z,(0,we.Z)((0,we.Z)({},n),{},{ref:a,icon:jn}))},yn=F.forwardRef(bn),tn=yn,Sn=t(29551),In=t(90328),On=t(20877),Dn=t(2115),Bn=t(18871),Tn=t(16751),un=t(56633),Zn=function(n){var a=n.bizId,u=n.data,r=(0,F.useState)(),i=p()(r,2),m=i[0],A=i[1],h=(0,un.oR)(function(o){return{projectId:o.project.projectId,projectCode:o.project.projectCode}}),b=h.projectId,c=h.projectCode,C=(0,Bn.Z)(function(o){return Tn.Z.getAgentUsageInfo({project_id:b,biz_id:a,agent_id:o},{showErrorMessage:!1,showSuccessMessage:!1})},{manual:!0,onSuccess:function(w){A(w.usage_detail)},onError:function(){}}),g=C.run,k=C.loading;return(0,e.jsx)(en.Z,{placement:"left",overlayStyle:{minWidth:450},overlayInnerStyle:{maxHeight:550,overflowY:"auto"},title:(0,e.jsx)(se.Z,{vertical:!0,gap:10,children:(0,e.jsxs)(e.Fragment,{children:[(u==null?void 0:u.work_status)==="offline"&&(0,e.jsx)("div",{children:"\u79BB\u7EBF: \u6784\u5EFA\u673A\u5904\u4E8E\u79BB\u7EBF\u72B6\u6001, \u8BF7\u8054\u7CFB\u5E73\u53F0\u7BA1\u7406\u5458\u6062\u590D"}),(u==null?void 0:u.work_status)!=="offline"&&u!==null&&u!==void 0&&u.run_tasks&&Object.keys(u.run_tasks).length>0?Object.values(u.run_tasks).map(function(o,w){return(0,e.jsx)("div",{children:o.desc.split(`
`).map(function(N,M){return(0,e.jsx)("div",{children:N},M)})},w)}):(u==null?void 0:u.work_status)!=="offline"&&(0,e.jsx)("div",{children:"\u5F53\u524D\u6784\u5EFA\u673A\u65E0\u6267\u884C\u4E2D\u4EFB\u52A1"})]})}),children:(0,e.jsx)(Dn.Z,{style:{color:"rgba(0,0,0,0.45)"}})})},Mn=Zn,ye={container:"JvgBuF0FhqQbATqIY_WS",list:"NvtxR5FspwF1FvKs78YN",title:"IpL0R2Fxm3M_dU1UXwUO","reset-btn":"_JIHNmIHWPYxkG_fZUJ4",resetBtn:"_JIHNmIHWPYxkG_fZUJ4",circle:"HJtrJZ2vTdQBrDXT3wDM",collapsed:"kg1ksT7W6w2oA5zTB8P0"},ht=[{dataIndex:"agent_name",title:"\u522B\u540D"},{dataIndex:"ip",title:"IP"},{dataIndex:"status",title:"\u72B6\u6001"},{dataIndex:"ip",title:"\u7248\u672C"},{dataIndex:"labels",title:"\u5206\u7EC4"},{dataIndex:"workspace",title:"\u5DE5\u4F5C\u76EE\u5F55"},{dataIndex:"hostname",title:"\u4E3B\u673A\u540D"},{dataIndex:"agent_id",title:"ID"}],an=function(n,a,u){return console.log("v",n),console.log("r",a),(0,e.jsxs)(ne.Z,{children:[(0,e.jsx)("div",{className:ye.circle,style:{backgroundColor:{free:"var(--success-color)",busy:"var(--warning-color)",lock:"var(--danger-color)"}[n]||"#bfbfbf"}}),n==="free"&&"\u7A7A\u95F2",n==="busy"&&"\u5FD9\u788C",n==="offline"&&"\u79BB\u7EBF",n==="lock"&&"\u5360\u7528",n==="maintain"&&"\u7EF4\u62A4",(u==null?void 0:u.showTip)&&(0,e.jsx)(Mn,{bizId:u==null?void 0:u.bizId,data:a})]})},W=t(23261);function Pn(s){return(0,W.dT)("/api/job/v1/task/agent/tree/",s)}function kn(s,n){return(0,W.S_)("/api/job/v1/task/agent/tree/",n)}var wn=function(n){return(0,W.dT)("/api/job/v1/task/agent/label/dropdown_selection/",n)};function Rn(s,n){return(0,W.S_)("/api/job/v1/task/agent/label/dropdown_selection/",n)}function _n(){return(0,W.S_)("/api/job/v1/task/agent/label/","PATCH")}var Ln=function(n){return(0,W.dT)("/api/job/v1/task/agent/list/",n)};function zn(s){return(0,W.dT)("/api/job/v2/task/agent/label/agent/",s)}function At(s){var n={label_id:34,label:"\u6743\u91CD\u6781\u5927\u6570\u636E\u5E93\u5927\u5BB6\u90FD\u53F8\u673A\u5FEB\u9012",label_uuid:"l-i2rRKwd2PkzrmTGtr9rTiX",sort:0,scheduler_type:"weighted",agents_info:{lnlinux:99,lntest:99,lnwin_531:0}};return new Promise(function(a){setTimeout(function(){a({data:n,code:0,msg:"success"})},500)})}function Je(s,n){return(0,W.S_)("/api/job/v1/task/agent/label/",n)}function Ye(s,n){return(0,W.S_)("/api/job/v1/agent/set-property/",n)}function Nn(s,n){return(0,W.S_)("/api/job/v1/task/agent/lock/",n)}function Gn(s,n){return(0,W.S_)("/api/agent/v1/manager/agent/upgrade",n)}function Un(s){return(0,W.B2)("/api/job/v2/task/agent/label/detail/",s)}var Kn=t(53649),Se=t.n(Kn),Wn=t(88230),rn,ln,on,sn,dn,cn,$n=(0,Wn.kc)(function(s){var n=s.css;return{container:n(rn||(rn=Se()([`
    display: flex;
    position: relative;
    margin: -20px;
    height: calc(100% + 40px);
    width: 100%;

    .SplitPane .Pane.Pane2 {
      width: 0;
    }
  `]))),list:n(ln||(ln=Se()([`
    height: 60px;
    padding: 14px 20px;
  `]))),title:n(on||(on=Se()([`
    font-size: 16px;
    font-weight: bold;
  `]))),resetBtn:n(sn||(sn=Se()([`
    display: inline-flex;
    width: 50px;
    justify-content: center;
    align-items: center;
    height: 32px;
    gap: 2px;
    cursor: pointer;
    color: #333333;
    font-size: 14px;
    &:hover {
      color: #005afa;
    }
  `]))),circle:n(dn||(dn=Se()([`
    width: 12px;
    height: 12px;
    border-radius: 50%;
  `]))),collapsed:n(cn||(cn=Se()([`
    .SplitPane {
      .Pane {
        width: 100% !important;
        &.Pane1 {
          display: none;
        }
      }
      .Resizer {
        display: none;
      }
    }
  `])))}}),Hn=$n,Vn=function(n){var a=Hn(),u=a.styles,r=n.onCancel,i=n.bizId,m=n.agentIdList,A=n.onOK,h=n.open,b=(0,F.useState)(""),c=p()(b,2),C=c[0],g=c[1],k=(0,V.useRequest)(function(){return Ln({biz_id:Number(i)})},{ready:!!i,refreshDeps:[i]}),o=k.data,w=(0,F.useState)([]),N=p()(w,2),M=N[0],X=N[1],I=(0,F.useMemo)(function(){return C?o==null?void 0:o.filter(function(R){return["alias","ip","version","workspace","hostname","agent_id"].some(function(y){return R[y].toLowerCase().indexOf(C.toLowerCase())>-1})}):o},[o,C]);return(0,e.jsxs)(J.Z,{open:h,title:"\u6DFB\u52A0\u6784\u5EFA\u673A",onCancel:function(){r()},width:1e3,okButtonProps:{disabled:M.length===0},onOk:function(){A(M)},children:[(0,e.jsx)(On.Z,{message:"\u6784\u5EFA\u673A\u9700\u8981\u5148\u6CE8\u518C\u5230\u5BF9\u5E94\u4E1A\u52A1\u4E0B\uFF0C\u6784\u5EFA\u673A\u5B89\u88C5\u8BF4\u660E\u67E5\u770B",type:"info",showIcon:!0,style:{marginBottom:10}}),(0,e.jsxs)(se.Z,{style:{marginBottom:10},children:[(0,e.jsx)(Ae.Z,{style:{width:200},value:C,onChange:function(y){g(y.target.value)},suffix:(0,e.jsx)(oe.Z,{style:{color:"#918f8f"}}),placeholder:"\u6A21\u7CCA\u641C\u7D22\u6784\u5EFA\u673A"}),(0,e.jsxs)("div",{className:u.resetBtn,onClick:function(){g("")},style:{marginLeft:6},children:[(0,e.jsx)(me.Z,{}),"\u91CD\u7F6E"]})]}),(0,e.jsx)($e.Z,{dataSource:I,rowKey:"agent_id",scroll:{x:800},columns:[{dataIndex:"alias",title:"\u522B\u540D",width:120,ellipsis:!0,render:function(y){return y||"-"}},{dataIndex:"ip",title:"IP",width:120,ellipsis:!0},{dataIndex:"work_status",title:"\u72B6\u6001",render:function(y,$){return an(y,$)},width:100,ellipsis:!0},{dataIndex:"version",title:"\u7248\u672C",width:100,ellipsis:!0},{dataIndex:"workspace",title:"\u5DE5\u4F5C\u76EE\u5F55",width:120,ellipsis:!0},{dataIndex:"hostname",title:"\u4E3B\u673A\u540D",width:120,ellipsis:!0},{dataIndex:"agent_id",title:"ID",width:120,ellipsis:!0},{dataIndex:"operation",title:"\u64CD\u4F5C",render:function(y,$){return m.includes($.agent_id)?(0,e.jsx)(de.ZP,{disabled:!0,children:"\u5DF2\u6DFB\u52A0"}):M.includes($.agent_id)?(0,e.jsx)(de.ZP,{onClick:function(){X(M.filter(function(ce){return ce!==$.agent_id}))},children:"\u53D6\u6D88\u6DFB\u52A0"}):(0,e.jsx)(de.ZP,{type:"primary",ghost:!0,onClick:function(){X([].concat(S()(M),[$.agent_id]))},children:"\u6DFB\u52A0"})}}]})]})},Jn=Vn,te=t(44725),Yn=function(n){var a=n.onCancel,u=n.onOk,r=n.initialValues,i=n.open,m=te.Z.useForm(),A=p()(m,1),h=A[0];return(0,e.jsx)(J.Z,{open:i,title:"\u7F16\u8F91\u6784\u5EFA\u673A",onCancel:function(){a()},onOk:P()(Z()().mark(function b(){var c;return Z()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,h.validateFields();case 2:c=g.sent,u(c.name);case 4:case"end":return g.stop()}},b)})),children:(0,e.jsx)(te.Z,{form:h,style:{marginTop:20},labelCol:{span:6},initialValues:r,children:(0,e.jsx)(te.Z.Item,{name:"name",label:"\u522B\u540D",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6784\u5EFA\u673A\u7EC4\u540D\u79F0"},{max:100,message:"\u6700\u591A100\u5B57\u7B26"}],children:(0,e.jsx)(Ae.Z,{placeholder:"\u8BF7\u8F93\u5165\u6784\u5EFA\u673A\u7EC4\u540D\u79F0",onKeyDown:function(c){["ArrowLeft","ArrowRight","Home","End"].includes(c.key)&&c.stopPropagation()}})})})})},Xn=Yn,Qn=t(53475),qn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 000 13.8z"}}]},name:"menu-fold",theme:"outlined"},et=qn,nt=function(n,a){return F.createElement(nn.Z,(0,we.Z)((0,we.Z)({},n),{},{ref:a,icon:et}))},tt=F.forwardRef(nt),ut=tt,at=t(44037),rt=t(32699),Te=t.n(rt),lt=t(74245),it=t(25080),Y=t(78474),ot=function(n){var a=n.onCancel,u=n.initialValues,r=n.bizId,i=n.agentUuid,m=n.agentId,A=n.refresh,h=n.open,b=m,c=te.Z.useForm(),C=p()(c,1),g=C[0],k=te.Z.useWatch("scheduler_type",g),o=(0,F.useState)([]),w=p()(o,2),N=w[0],M=w[1],X=(0,V.useRequest)(function(){return Un({biz_id:Number(r),label_id:Number(m)})},{ready:!!b&&!!m,formatResult:function(D){return D.data||[]},onSuccess:function(D){g.setFieldsValue({label:D.label,scheduler_type:D.scheduler_type})}}),I=X.data,R=(0,Y.j)(Je,"create","POST",void 0,void 0),y=R.runOpt,$=(0,Y.j)(Je,"update","PUT",void 0,void 0),xe=$.runOpt;(0,F.useEffect)(function(){var l;M((I==null||(l=I.agents)===null||l===void 0?void 0:l.map(function(D){var H;return f()(f()({},D),{},{weight:I==null||(H=I.agents_info)===null||H===void 0?void 0:H[D.agent_id]})}))||[]),console.log(I)},[I]);var ce=function(){g.validateFields().then(function(){var D=P()(Z()().mark(function H(ae){var G;return Z()().wrap(function(q){for(;;)switch(q.prev=q.next){case 0:if(b){q.next=5;break}return q.next=3,y(f()(f()({},ae),{},{biz_id:Number(r)}));case 3:q.next=8;break;case 5:return G=Object.fromEntries(N.map(function(Ee){return[Ee.agent_id,Ee.weight]})),q.next=8,xe(f()(f()({},ae),{},{biz_id:Number(r),label_id:m,agents_info:G}));case 8:A(),a();case 10:case"end":return q.stop()}},H)}));return function(H){return D.apply(this,arguments)}}())};return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(J.Z,{open:h,title:u?"\u7F16\u8F91\u6784\u5EFA\u673A\u7EC4":"\u65B0\u5EFA\u6784\u5EFA\u673A\u7EC4",onCancel:function(){a()},onOk:ce,children:(0,e.jsxs)(te.Z,{form:g,style:{marginTop:20},labelCol:{span:6},children:[(0,e.jsx)(te.Z.Item,{name:"label",label:"\u6784\u5EFA\u673A\u7EC4\u540D",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6784\u5EFA\u673A\u7EC4\u540D\u79F0"},{max:100,message:"\u6700\u591A100\u5B57\u7B26"}],children:(0,e.jsx)(Ae.Z,{placeholder:"\u8BF7\u8F93\u5165\u6784\u5EFA\u673A\u7EC4\u540D\u79F0"})}),(0,e.jsx)(te.Z.Item,{name:"scheduler_type",label:"\u8C03\u5EA6\u89C4\u5219",initialValue:"round_robin",tooltip:{placement:"bottom",overlayInnerStyle:{minWidth:500},title:(0,e.jsxs)("span",{children:["\u968F\u673A\u8C03\u5EA6 - \u968F\u673A\u8C03\u5EA6\u53EF\u7528\u6784\u5EFA\u673A",(0,e.jsx)("br",{}),"\u52A0\u6743\u8C03\u5EA6 - \u6839\u636E\u6784\u5EFA\u673A\u7684\u6743\u91CD\u9009\u62E9\u6784\u5EFA\u673A\uFF0C\u4E0D\u53EF\u7528\u7684\u6784\u5EFA\u673A\u4E0D\u53C2\u4E0E\u6743\u91CD\u8BA1\u7B97",(0,e.jsx)("br",{}),"\u793A\u4F8B\uFF1A\u67095\u53F0\u6784\u5EFA\u673A\uFF0C\u6743\u91CD\u5206\u522B\u4E3A1\u30012\u30013\u30014\u30015\uFF0C\u6B64\u65F6\u52A0\u6743\u4E3A4\u30015\u7684\u6784\u5EFA\u673A\u79BB\u7EBF\u4E0D\u53EF\u7528\uFF0C\u5219\u5206\u914D\u52301\u7684\u6BD4\u4F8B\u4E3A1/(1+2+3)=1/6\uFF0C\u5206\u914D\u52302\u7684\u6BD4\u4F8B\u4E3A2/(1+2+3)=1/3\uFF0C\u5206\u914D\u52303\u7684\u6BD4\u4F8B\u4E3A3/(1+2+3)=1/2"]})},children:(0,e.jsx)(De.Z,{options:[{label:"\u968F\u673A\u8C03\u5EA6",value:"round_robin"},{label:"\u52A0\u6743\u8C03\u5EA6",value:"weighted"}]})}),k==="weighted"&&b&&(0,e.jsx)($e.Z,{dataSource:N,columns:[{dataIndex:"alias",title:"\u522B\u540D",render:function(D){return D||"-"}},{dataIndex:"ip",title:"IP"},{dataIndex:"weight",title:"\u6743\u91CD",render:function(D,H){return(0,e.jsx)(it.Z,{style:{width:120},min:0,value:D,onChange:function(G){M(N.map(function(Q){return Q.agent_id===H.agent_id?f()(f()({},Q),{},{weight:G}):Q}))}})}}]})]})})})},vn=ot,st=function(n){var a=n.onCancel,u=n.selectedBiz,r=n.refresh,i=n.defaultOrder,m=n.onOrderChange,A=n.open,h=(0,F.useState)(i),b=p()(h,2),c=b[0],C=b[1],g=ee.ZP.useMessage(),k=p()(g,2),o=k[0],w=k[1],N=(0,Y.j)(Rn,"update","PUT",void 0,o,function(){}),M=N.runOpt;return(0,e.jsxs)(J.Z,{open:A,title:"\u6784\u5EFA\u673A\u7EC4\u6392\u5E8F",onCancel:a,onOk:function(){c&&M({order_by:["sort","label"].includes(c)?c:"create_time",biz_id:Number(u),order:["sort","label"].includes(c)?"ascend":c.split("_")[1]}).then(function(){r(),a(),m(c)})},children:[w,(0,e.jsx)(te.Z,{style:{marginTop:20},children:(0,e.jsx)(te.Z.Item,{label:"\u6392\u5E8F\u89C4\u5219",tooltip:"\u652F\u6301\u8BBE\u7F6E\u6784\u5EFA\u673A\u7EC4\u6392\u5E8F\u89C4\u5219\uFF0C\u9009\u62E9\u81EA\u5B9A\u4E49\u53EF\u62D6\u52A8\u6392\u5E8F\u6784\u5EFA\u673A\u7EC4",children:(0,e.jsx)(De.Z,{value:c,onChange:function(I){C(I)},options:[{label:"\u81EA\u5B9A\u4E49",value:"sort"},{label:"\u9996\u5B57\u6BCD\u6392\u5E8F",value:"label"},{label:"\u521B\u5EFA\u65F6\u95F4\u4ECE\u8FD1\u5230\u8FDC",value:"time_descend"},{label:"\u521B\u5EFA\u65F6\u95F4\u4ECE\u8FDC\u5230\u8FD1",value:"time_ascend"}]})})})]})},dt=st,Re={container:"ybnncKK8rfUmes5GLw_t",title:"IQufVDbvGUQOnRnscstk","tree-title":"TXjYYfx5backsWRcJG8y",treeTitle:"TXjYYfx5backsWRcJG8y","collapse-icon":"wMZJu2lT5scs3W2pnUtf",collapseIcon:"wMZJu2lT5scs3W2pnUtf"},fn=function(n,a){for(var u=n,r=1;r<a.length;r++){var i;u=u[a[r]],r!==a.length-1&&(u=((i=u)===null||i===void 0?void 0:i.children)||[])}return u},gn=function(n){return(0,e.jsx)("div",{onClick:function(u){u.stopPropagation()},children:(0,e.jsx)(lt.Z,{items:n,trigger:"hover",children:(0,e.jsx)("div",{children:(0,e.jsx)(Qn.Z,{})})})})},ct=function(n){var a,u=n.collapsed,r=n.onCollapseChange,i=n.bizId,m=n.refreshAgentGroupTree,A=n.agentGroupId,h=n.agentGroupTree,b=n.onAgentGroupIdChange,c=(0,V.useModel)("@@initialState"),C=c.initialState,g=(a=C==null?void 0:C.currentBizId)!==null&&a!==void 0?a:"",k=ee.ZP.useMessage(),o=p()(k,2),w=o[0],N=o[1],M=(0,un.oR)(function(x){return{projectId:x.project.projectId}}),X=M.projectId,I=(0,F.useState)(""),R=p()(I,2),y=R[0],$=R[1],xe=(0,F.useState)([]),ce=p()(xe,2),l=ce[0],D=ce[1],H=(0,F.useState)(""),ae=p()(H,2),G=ae[0],Q=ae[1],q=G==="sort",Ee=(0,Y.j)(_n,"update","PATCH",void 0,w,function(){m()}),Fe=Ee.runOpt,_e=(0,Y.j)(Je,"delete","DELETE",void 0,w,function(){m()}),Le=_e.runOpt;(0,V.useRequest)(function(){return wn({biz_id:Number(g)})},{ready:!!i,refreshDeps:[i],onSuccess:function(v){v.length>0&&(v[0].order_by==="sort"||v[0].order_by==="label"?Q(v[0].order_by):v[0].order_by==="create_time"&&Q(v[0].order==="ascend"?"time_ascend":"time_descend"))}}),(0,F.useEffect)(function(){D((h==null?void 0:h.map(function(x){return f()(f()({},x),{},{title:x.title,key:x.label_id,label_uuids:x.label_uuid})}))||[])},[h]);var _=function(v){return[{title:(0,e.jsxs)(se.Z,{justify:"space-between",className:Re.treeTitle,children:[(0,e.jsx)("span",{children:"\u5168\u90E8\u6784\u5EFA\u673A"}),gn([{key:"add",label:(0,e.jsx)(Be.Z,{modalRender:function(L){return(0,e.jsx)(vn,{onCancel:L,bizId:i,refresh:m})},children:"\u65B0\u5EFA\u6784\u5EFA\u673A\u7EC4"})},{key:"sort",label:(0,e.jsx)(Be.Z,{modalRender:function(L){return(0,e.jsx)(dt,{defaultOrder:G,onOrderChange:Q,onCancel:L,projectId:X,refresh:m,selectedBiz:i})},children:"\u6784\u5EFA\u673A\u7EC4\u6392\u5E8F"})}])]}),key:"all",children:(v==null?void 0:v.map(function(E){return{title:(0,e.jsxs)(se.Z,{justify:"space-between",style:{width:"100%"},children:[(E==null?void 0:E.title)||"",gn([{key:"edit",label:(0,e.jsx)(Be.Z,{modalRender:function(z){return(0,e.jsx)(vn,{onCancel:z,initialValues:{name:E.title},bizId:i,agentId:"".concat(E.key),agentUuid:E.label_uuid,refresh:m})},children:"\u7F16\u8F91\u6784\u5EFA\u673A\u7EC4"})},{key:"sort",label:(0,e.jsx)("span",{onClick:function(){J.Z.confirm({title:"\u5220\u9664\u6784\u5EFA\u673A\u7EC4",content:"\u786E\u8BA4\u5220\u9664\u5206\u7EC4\u3010".concat(E.title,"\u3011\uFF1F\u5220\u9664\u64CD\u4F5C\u4E0D\u53EF\u6062\u590D"),onOk:function(){Le({biz_id:Number(i),label_id:Number(E.key)})}})},children:"\u5220\u9664\u6784\u5EFA\u673A\u7EC4"})}])]}),key:"".concat(E.key),isLeaf:!0}}))||[]}]},ve=(0,F.useMemo)(function(){return l?l.map(function(x){return f()(f()({},x),{},{title:x.title,key:x.label_id})}).filter(function(x){return y===""?!0:x.title.toLowerCase().indexOf(y.toLowerCase())>-1}):[]},[y,l]),Xe=function(v){var E,L,z=v.dragNode.pos.split("-").map(Number),fe=v.node.pos.split("-").map(Number),ze=v.dropPosition-fe[fe.length-1];console.log("\u539F\u59CB\uFF1A",z,fe,v.dropToGap,ze);var U=S()(fe);if(fe.length===2)U.length>=z.length&&U>z&&(U[z.length-1]=Math.max(U[z.length-1]-1,0)),U.push(0);else if(ze!==-1){var Ze=S()(z),Me=S()(fe),Qe=Ze.pop(),Ne=Me.pop();if(Ze.join("-")===Me.join("-")&&Ne<Qe||Ze.join("-")!==Me.join("-")){var Pe=U.pop();U.push(Pe+1)}}console.log("\u4FEE\u6B63",z,U);var Ie=[{title:"all",key:"all",children:S()(l)}],Ge=fn(Ie,z.slice(0,-1)),j=(Ge.children||Ge).splice(z[z.length-1],1)[0],d=fn(Ie,U.slice(0,-1)),O=(E=d.children||d)===null||E===void 0||(L=E.splice)===null||L===void 0?void 0:L.call(E,U[U.length-1],0,j);O||(d.children=[j]),Fe({biz_id:Number(i),label_list:Ie[0].children.map(function(B,K){return{id:B.key,sort:K}})}),D(Ie[0].children)};return(0,e.jsxs)("div",{className:Re.container,children:[N,(0,e.jsx)("div",{className:Re.title,children:(0,e.jsxs)(se.Z,{children:[(0,e.jsx)("span",{className:Re.collapseIcon,onClick:function(){return r(!u)},children:u?(0,e.jsx)(tn,{}):(0,e.jsx)(ut,{})}),(0,e.jsx)("span",{style:{fontSize:16,marginRight:16,lineHeight:"32px"},children:"\u6784\u5EFA\u673A\u7EC4"}),(0,e.jsx)(Ae.Z,{allowClear:!0,placeholder:"\u8BF7\u8F93\u5165\u6784\u5EFA\u673A\u7EC4\u540D",style:{flex:1},suffix:(0,e.jsx)(oe.Z,{style:{color:"#918f8f"}}),onChange:function(v){$(v.target.value)}})]})}),(0,e.jsx)(at.Z,{style:{height:"calc(100vh - 190px)",overflowY:"auto"},draggable:function(v){return q&&v.key!=="all"},allowDrop:function(v){var E=v.dropPosition,L=v.dropNode;return!0},defaultExpandAll:!0,selectedKeys:A?[A]:["all"],onSelect:function(v){var E=v.map(function(L){return L==="all"?"":L});Te().isEmpty(E)||Te().isEqual(E,[A])||b("".concat(E[0]))},treeData:_(ve),expandedKeys:["all"],onDrop:Xe})]})},vt=ct,ft=t(37904),gt=function(){var n=(0,ft.Z)({agentGroupId:"",tenantid:"",tenant:""}),a=p()(n,2),u=a[0],r=u.agentGroupId,i=u.tenantid,m=a[1],A=(0,V.useRequest)(function(){return Pn({biz_id:Number(i)})},{ready:!!i,refreshDeps:[i],formatResult:function(k){var o;return(o=k.data)===null||o===void 0||(o=o[0])===null||o===void 0?void 0:o.children}}),h=A.data,b=A.refresh,c=(0,F.useMemo)(function(){return h==null?void 0:h.find(function(g){return"".concat(g.label_id)===r})},[h,r]),C=function(k){m(function(o){return{agentGroupId:k}})};return{agentGroupTree:h,agentGroupId:r,refreshAgentGroupTree:b,selectedAgentGroup:c,setAgentGroupId:C}},pt=function(){var n,a=(0,V.useModel)("@@initialState"),u=a.initialState,r=(n=u==null?void 0:u.currentBizId)!==null&&n!==void 0?n:"",i=ee.ZP.useMessage(),m=p()(i,2),A=m[0],h=m[1],b=(0,F.useState)(!1),c=p()(b,2),C=c[0],g=c[1],k=(0,In.Z)("build-machine-management-drag-size"),o=p()(k,2),w=o[0],N=o[1],M=(0,F.useState)([]),X=p()(M,2),I=X[0],R=X[1],y=gt(),$=y.agentGroupTree,xe=y.agentGroupId,ce=y.refreshAgentGroupTree,l=y.selectedAgentGroup,D=y.setAgentGroupId,H=(0,F.useState)(""),ae=p()(H,2),G=ae[0],Q=ae[1],q=(0,F.useState)([]),Ee=p()(q,2),Fe=Ee[0],_e=Ee[1],Le=(0,V.useRequest)(function(){return zn({biz_id:Number(r),label_uuid_list:l==null?void 0:l.label_uuid})},{ready:!!r,refreshDeps:[r,l==null?void 0:l.label_uuid],formatResult:function(d){return d.data||[]}}),_=Le.data,ve=Le.refresh,Xe=(0,Y.j)(kn,"update","POST",void 0,A,function(){ve()}),x=Xe.runOpt,v=(0,Y.j)(Ye,"update","PUT",void 0,A,function(){ve()}),E=v.runOpt,L=(0,Y.j)(Ye,"update","POST",void 0,A,function(){ve()}),z=L.runOpt,fe=(0,Y.j)(Ye,"update","POST",void 0,A,function(){ve()}),ze=fe.runOpt,U=(0,Y.j)(Nn,"update","PUT",void 0,A,function(){ve()}),Ze=U.runOpt,Me=(0,Y.j)(Gn,"update","POST",void 0,A,function(){ve()}),Qe=Me.runOpt,Ne=[{label:"\u8282\u70B9\u89E3\u9501",key:"unlock"},{label:"\u8282\u70B9\u7EF4\u62A4",key:"maintain"},{label:"\u8282\u70B9\u6062\u590D",key:"free"},{label:"\u5347\u7EA7\u7248\u672C",key:"update"}],Pe=function(d,O,B){var K=B.slice(0,3).map(function(Ce){return"\u3010".concat(Ce.alias,"\u3011")}).join("\u3001"),Oe={remove:"\u786E\u8BA4\u4ECE\u5206\u7EC4\u3010".concat(l==null?void 0:l.title,"\u3011\u79FB\u9664\u6784\u5EFA\u673A").concat(K,"\uFF1F"),unlock:"\u786E\u8BA4\u89E3\u9501\u8282\u70B9".concat(K,"\uFF1F\u5C06\u5360\u7528\u72B6\u6001\u7684\u6784\u5EFA\u673A\u8BBE\u7F6E\u4E3A\u7A7A\u95F2"),maintain:"\u786E\u8BA4\u7EF4\u62A4\u8282\u70B9".concat(K,"\uFF1F\u5C06\u6784\u5EFA\u673A\u7684\u72B6\u6001\u8BBE\u7F6E\u4E3A\u7EF4\u62A4\uFF0C\u4E0D\u5F71\u54CD\u6B63\u5728\u6267\u884C\u7684\u4EFB\u52A1\uFF0C\u7EF4\u62A4\u65F6\u4E0D\u53EF\u8C03\u5EA6\u6267\u884C\u65B0\u4EFB\u52A1"),free:"\u786E\u8BA4\u6062\u590D\u8282\u70B9".concat(K,"\uFF1F\u53D6\u6D88\u6784\u5EFA\u673A\u7684\u7EF4\u62A4\u72B6\u6001"),update:"\u786E\u8BA4\u5347\u7EA7\u8282\u70B9".concat(K,"\uFF1F\u5347\u7EA7\u7248\u672C\u53EF\u80FD\u5F71\u54CD\u4EFB\u52A1\u6267\u884C\uFF0C\u8BF7\u6CE8\u610F\u65E0\u4EFB\u52A1\u65F6\u5347\u7EA7")};J.Z.confirm({title:O,content:Oe[d],onOk:function(){var Ce=P()(Z()().mark(function Ue(){return Z()().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(d!=="remove"){T.next=5;break}return T.next=3,x({biz_id:Number(r),agent_list:Te().xorBy(_,B,"agent_id").map(function(re){return re.agent_id}),label_id:l==null?void 0:l.label_id});case 3:T.next=23;break;case 5:if(d!=="unlock"){T.next=10;break}return T.next=8,Ze({agent_list:B.map(function(re){return re.agent_id})});case 8:T.next=23;break;case 10:if(d!=="maintain"){T.next=15;break}return T.next=13,z({agent_list:B.map(function(re){return re.agent_id}),work_status:"maintain"});case 13:T.next=23;break;case 15:if(d!=="free"){T.next=20;break}return T.next=18,ze({agent_list:B.map(function(re){return re.agent_id}),work_status:null});case 18:T.next=23;break;case 20:if(d!=="update"){T.next=23;break}return T.next=23,Qe(B.map(function(re){return{agent_id:re.agent_id}}));case 23:case"end":return T.stop()}},Ue)}));function je(){return Ce.apply(this,arguments)}return je}()})},Ie=(0,F.useMemo)(function(){return _?!G&&Te().isEmpty(Fe)?_:_==null?void 0:_.filter(function(j){return G&&!["alias","ip","workspace","hostname","agent_id","version"].some(function(d){return j[d].toLowerCase().indexOf(G.toLowerCase())>-1})?!1:Te().isEmpty(Fe)?!0:Fe.includes(j.work_status)}):[]},[_,G,Fe]),Ge={onChange:function(d,O){R(O)}};return(0,e.jsxs)(be.Z,{children:[h,(0,e.jsx)("div",{className:mn()(ye.container,C&&ye.collapsed),children:(0,e.jsxs)(hn.Z,{split:"vertical",minSize:300,maxSize:500,onDragFinished:N,size:w,children:[(0,e.jsx)(vt,{collapsed:C,onCollapseChange:g,bizId:r,refreshAgentGroupTree:ce,agentGroupTree:$,agentGroupId:xe,onAgentGroupIdChange:D}),r&&(0,e.jsxs)("div",{className:ye.list,children:[(0,e.jsxs)(ne.Z,{className:ye.title,children:[C&&(0,e.jsx)(tn,{onClick:function(){g(!1)}}),"\u3010",(l==null?void 0:l.title)||"\u5168\u90E8","\u3011\u6784\u5EFA\u673A\u5217\u8868"]}),(0,e.jsxs)(se.Z,{justify:"space-between",style:{marginTop:16},children:[(0,e.jsxs)(ne.Z,{children:[(0,e.jsx)(Ae.Z,{style:{width:200},suffix:(0,e.jsx)(oe.Z,{style:{color:"#918f8f"}}),placeholder:"\u6A21\u7CCA\u641C\u7D22\u6784\u5EFA\u673A",value:G,onChange:function(d){Q(d.target.value)},allowClear:!0}),(0,e.jsx)(De.Z,{value:Fe,onChange:function(d,O){_e(d)},style:{width:350},allowClear:!0,mode:"multiple",options:[{label:"\u7A7A\u95F2",value:"free"},{label:"\u5FD9\u788C",value:"busy"},{label:"\u5360\u7528",value:"lock"},{label:"\u7EF4\u62A4",value:"maintain"},{label:"\u79BB\u7EBF",value:"offline"}],placeholder:"\u72B6\u6001"}),(0,e.jsxs)("div",{className:ye.resetBtn,onClick:function(){_e([]),Q("")},children:[(0,e.jsx)(me.Z,{}),"\u91CD\u7F6E"]})]}),(0,e.jsxs)(ne.Z,{children:[(0,e.jsx)(xn,{menuProps:{items:[].concat(S()(l?[{label:"\u79FB\u9664\u6784\u5EFA\u673A",key:"remove"}]:[]),Ne).map(function(j){return f()(f()({},j),{},{label:(0,e.jsx)("span",{onClick:function(){I.length!==0&&Pe(j.key,j.label,I)},children:j.label}),disabled:I.length===0,title:I.length===0?"\u8BF7\u9009\u4E2D\u9700\u8981\u64CD\u4F5C\u7684\u6784\u5EFA\u673A":void 0})})}}),(0,e.jsx)(Be.Z,{modalRender:function(d){return(0,e.jsx)(Jn,{onCancel:d,bizId:r,agentIdList:(_==null?void 0:_.map(function(O){return O.agent_id}))||[],onOK:function(){var O=P()(Z()().mark(function B(K){var Oe;return Z()().wrap(function(je){for(;;)switch(je.prev=je.next){case 0:Oe=[].concat(S()((_==null?void 0:_.map(function(Ue){return Ue.agent_id}))||[]),S()(K)),x({biz_id:Number(r),agent_list:Oe,label_id:l==null?void 0:l.label_id}),d();case 3:case"end":return je.stop()}},B)}));return function(B){return O.apply(this,arguments)}}()})},children:(0,e.jsx)(de.ZP,{type:"primary",disabled:!l,children:"\u6DFB\u52A0\u6784\u5EFA\u673A"})})]})]}),(0,e.jsx)($e.Z,{style:{marginTop:20},dataSource:Ie,rowKey:"agent_id",rowSelection:Ge,scroll:{x:1100,y:"calc(100vh - 300px)"},columns:[{dataIndex:"alias",title:"\u522B\u540D",width:160},{dataIndex:"ip",title:"IP",width:140},{dataIndex:"work_status",title:"\u72B6\u6001",width:120,render:function(d,O){return an(d,O,{showTip:!0,bizId:r})}},{dataIndex:"version",title:"\u7248\u672C",width:140},{dataIndex:"labels",title:"\u5206\u7EC4",width:220,render:function(d){return d?(0,e.jsx)(Fn,{value:d||[],max:3}):"-"}},{dataIndex:"workspace",title:"\u5DE5\u4F5C\u76EE\u5F55",width:180,ellipsis:!0},{dataIndex:"hostname",title:"\u4E3B\u673A\u540D",width:240,ellipsis:!0},{dataIndex:"agent_id",title:"ID",width:180,ellipsis:!0},{dataIndex:"operation",title:"\u64CD\u4F5C",fixed:"right",width:160,render:function(d,O){return(0,e.jsxs)(ne.Z,{children:[l&&(0,e.jsxs)("a",{onClick:function(){Pe("remove","\u79FB\u9664\u6784\u5EFA\u673A",[O])},style:{color:"#FF4D4F"},children:[(0,e.jsx)(Sn.Z,{}),"\u79FB\u9664"]}),(0,e.jsx)(qe.Z,{menu:{items:[{label:(0,e.jsx)(Be.Z,{modalRender:function(K){return(0,e.jsx)(Xn,{initialValues:{name:O.alias},onCancel:K,onOk:function(){var Oe=P()(Z()().mark(function Ce(je){return Z()().wrap(function(Ke){for(;;)switch(Ke.prev=Ke.next){case 0:E({agent_id:O.agent_id,alias:je,agent_list:[O.agent_id],work_status:O.work_status}),K();case 2:case"end":return Ke.stop()}},Ce)}));return function(Ce){return Oe.apply(this,arguments)}}()})},children:"\u7F16\u8F91\u6784\u5EFA\u673A"}),key:"edit"}].concat(S()(Ne.map(function(B){return f()(f()({},B),{},{label:(0,e.jsx)("span",{onClick:function(){Pe(B.key,B.label,[O])},children:B.label})})})))},children:(0,e.jsx)("a",{children:(0,e.jsxs)(ne.Z,{children:["\u66F4\u591A",(0,e.jsx)(he.Z,{})]})})})]})}}]})]})]})})]})},mt=pt}}]);
