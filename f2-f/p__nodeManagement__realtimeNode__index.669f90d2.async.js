"use strict";(self.webpackChunkf2=self.webpackChunkf2||[]).push([[1842],{67254:function(ne,O,n){var y=n(26068),o=n.n(y),Z=n(67825),h=n.n(Z),s=n(53649),d=n.n(s),m=n(99503),f=n(77777),v=n(88230),M=n(75271),g=n(52676),P=["children","extra","ghost","title"],D,E,F=(0,v.kc)(function(S){var p=S.css;return{pageContainer:{"& .ant-page-header-heading":p(D||(D=d()([`
      margin-bottom: -50px;
    `]))),"& .ant-page-header-heading-extra":p(E||(E=d()([`
      position: absolute;
      top: 17px;
      right: 20px;
    `])))}}}),A=function(p){var j=p.children,R=p.extra,C=R===void 0?(0,g.jsx)(m.er,{}):R,w=p.ghost,x=w===void 0?!1:w,V=p.title,G=V===void 0?!1:V,te=h()(p,P),k=F(),B=k.styles;return(0,g.jsx)(f._z,o()(o()({ghost:x,extra:C,className:B.pageContainer,title:G},te),{},{children:j}))};O.Z=A},78474:function(ne,O,n){n.d(O,{j:function(){return Z},t:function(){return h}});var y=n(54388),o=n(87300);function Z(s,d,m,f,v,M){var g=v!=null?v:o.ZP,P=(0,y.useRequest)(s(d,m),{manual:!0,onSuccess:function(A){if(A.code!==0?g.error(A.msg):g.success(A.msg),M)M();else{var S;f==null||(S=f.current)===null||S===void 0||S.reload(!1)}},onError:function(){g.error("\u64CD\u4F5C\u5931\u8D25")}}),D=P.run,E=P.loading;return{runOpt:D,loading:E}}function h(s){var d=s.optMethod,m=s.optType,f=s.method,v=s.actionRef,M=s.messageApi,g=s.onSuccessCallback,P=s.showSuccessMessage,D=P===void 0?!0:P,E=M!=null?M:o.ZP,F=(0,y.useRequest)(d(m,f),{manual:!0,onSuccess:function(j){var R=typeof j.msg=="string"?j.msg:JSON.stringify(j.msg);if(j.code!==0)E.error(R);else if(g)g(j);else{var C;D&&E.success(R),v==null||(C=v.current)===null||C===void 0||C.reload(!1)}},onError:function(){E.error("\u64CD\u4F5C\u5931\u8D25")}}),A=F.run,S=F.loading;return{runOpt:A,loading:S}}},30168:function(ne,O,n){n.d(O,{OV:function(){return o}});var y=n(60164),o=function(s,d){var m=(0,y.ac)({minWidth:d||1700}),f=m?s.wide:s.small;return{isWideScreen:m,width:f}},Z=function(s){var d=useMediaQuery({minWidth:1700}),m=useMediaQuery({maxWidth:1699});return d?{type:"wide",width:s.wide}:m?{type:"small",width:s.small}:{type:"small",width:s.small}};O.ZP=o},53472:function(ne,O,n){n.r(O),n.d(O,{default:function(){return Oe}});var y=n(90228),o=n.n(y),Z=n(87999),h=n.n(Z),s=n(48305),d=n.n(s),m=n(99503),f=n(67254),v=n(78474),M=n(30168),g=n(76576),P=n(19048),D=n(64412),E=n(13381),F=n(29200),A=n(90254),S=n(58032),p=n(54388),j=n(37665),R=n(87300),C=n(84338),w=n(50876),x=n(41901),V=n(20877),G=n(67870),te=n(84249),k=n(64085),B=n(75271),pe=n(84297),me=n(82715),r=n(52676),he=function(c){var z=c.open,re=c.title,l=c.record,H=c.onOpenChange,J=c.onFinish;return(0,r.jsx)(pe.Y,{title:re,open:z,onOpenChange:H,autoFocusFirstInput:!0,modalProps:{destroyOnClose:!0,maskClosable:!1,width:600},layout:"horizontal",labelCol:{span:6},onFinish:function(){var ue=h()(o()().mark(function W(ae){var _,Y,X,$;return o()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,X={agent_list:[(_=l==null?void 0:l.agent_id)!==null&&_!==void 0?_:""],agent_id:(Y=l==null?void 0:l.agent_id)!==null&&Y!==void 0?Y:"",work_status:l==null?void 0:l.work_status,group_name:l==null?void 0:l.group_name,alias:ae.alias},i.next=4,J(X);case 4:if($=i.sent,!$){i.next=8;break}return R.ZP.success("Agent\u4FE1\u606F\u66F4\u65B0\u6210\u529F"),i.abrupt("return",!0);case 8:return i.abrupt("return",!1);case 11:return i.prev=11,i.t0=i.catch(0),console.error("\u66F4\u65B0Agent\u4FE1\u606F\u5931\u8D25:",i.t0),i.abrupt("return",!1);case 15:case"end":return i.stop()}},W,null,[[0,11]])}));return function(W){return ue.apply(this,arguments)}}(),submitter:{searchConfig:{submitText:"\u63D0\u4EA4",resetText:"\u53D6\u6D88"}},children:(l==null?void 0:l.agent_id)&&(0,r.jsx)(me.Z,{name:"alias",label:"\u522B\u540D",placeholder:"\u8BF7\u8F93\u5165\u8282\u70B9\u522B\u540D",initialValue:l.alias,fieldProps:{maxLength:25}})})},fe=he,Q=n(23261);function ge(I){return(0,Q.eg)("/api/job/v1/task/agent/list/",I)}function Ee(I,c){return(0,Q.S_)("/api/job/v1/task/agent/lock/",c)}function se(I,c){return(0,Q.S_)("/api/job/v1/agent/set-property/",c)}function Se(I,c){return(0,Q.S_)("/api/job/v1/agent/set-property/",c)}var Ce=function(){var c,z,re=(0,B.useRef)(),l=(0,B.useState)(""),H=d()(l,2),J=H[0],ue=H[1],W=(0,j.Z)(J,{wait:300}),ae=(0,p.useSearchParams)(),_=d()(ae,1),Y=_[0],X=(0,B.useState)([]),$=d()(X,2),b=$[0],i=$[1],Me=R.ZP.useMessage(),oe=d()(Me,2),T=oe[0],Pe=oe[1],Ae=(0,p.useModel)("@@initialState"),L=Ae.initialState,q=(c=L==null?void 0:L.currentBizId)!==null&&c!==void 0?c:"",je=(z=L==null?void 0:L.currentBizName)!==null&&z!==void 0?z:"\u6240\u6709\u9879\u76EE",ie=(0,p.useRequest)(function(){return q?ge({biz_id:q})({current:1,pageSize:1e3,searchValue:""}):Promise.resolve({data:[]})},{manual:!0,formatResult:function(e){return(e==null?void 0:e.data)||[]}}),ee=ie.data,U=ie.run,Be=(0,B.useMemo)(function(){return ee?W?ee.filter(function(u){return["agent_id","alias","hostname","ip","workspace","version","biz_id"].some(function(e){var a;return(a=u[e])===null||a===void 0?void 0:a.toString().toLowerCase().includes(W.toLowerCase())})}):ee:[]},[ee,W]),ye=(0,B.useState)(!1),le=d()(ye,2),De=le[0],de=le[1],Fe=(0,B.useState)({title:"\u7F16\u8F91Agent\u4FE1\u606F"}),ce=d()(Fe,2),ve=ce[0],Re=ce[1];(0,B.useEffect)(function(){q&&U()},[q]);var be=(0,v.t)({optMethod:Ee,optType:"unlock",method:"PUT",actionRef:void 0,messageApi:T,onSuccessCallback:function(e){(e==null?void 0:e.code)===0&&e!==null&&e!==void 0&&e.msg&&(T.success(e==null?void 0:e.msg),U())}}),Te=be.runOpt,xe=(0,v.t)({optMethod:se,optType:"maintain",method:"POST",actionRef:void 0,messageApi:T,onSuccessCallback:function(e){(e==null?void 0:e.code)===0&&e!==null&&e!==void 0&&e.msg&&(T.success(e==null?void 0:e.msg),U())}}),Ze=xe.runOpt,Ie=(0,v.t)({optMethod:se,optType:"recover",method:"POST",actionRef:void 0,messageApi:T,onSuccessCallback:function(e){(e==null?void 0:e.code)===0&&e!==null&&e!==void 0&&e.msg&&(T.success(e==null?void 0:e.msg),U())}}),We=Ie.runOpt,Le=(0,v.t)({optMethod:Se,optType:"edit",method:"PUT",actionRef:void 0,messageApi:T,onSuccessCallback:function(e){(e==null?void 0:e.code)===0&&e!==null&&e!==void 0&&e.msg&&(T.success(e==null?void 0:e.msg),U())}}),Ue=Le.runOpt,Ke=function(){var u=h()(o()().mark(function e(){var a;return o()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,a={agent_list:b.map(function(N){return N.agent_id})},t.next=4,Te(a);case 4:i([]),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.error("\u6279\u91CF\u89E3\u9501\u5931\u8D25:",t.t0);case 10:case"end":return t.stop()}},e,null,[[0,7]])}));return function(){return u.apply(this,arguments)}}(),we=function(){var u=h()(o()().mark(function e(){var a;return o()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,a={agent_list:b.map(function(N){return N.agent_id}),work_status:"maintain"},t.next=4,Ze(a);case 4:i([]),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.error("\u6279\u91CF\u7EF4\u62A4\u5931\u8D25:",t.t0);case 10:case"end":return t.stop()}},e,null,[[0,7]])}));return function(){return u.apply(this,arguments)}}(),ke=function(){var u=h()(o()().mark(function e(){var a;return o()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,a={agent_list:b.map(function(N){return N.agent_id}),work_status:null},t.next=4,We(a);case 4:i([]),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.error("\u6279\u91CF\u6062\u590D\u5931\u8D25:",t.t0);case 10:case"end":return t.stop()}},e,null,[[0,7]])}));return function(){return u.apply(this,arguments)}}(),ze=function(e){Re({title:"\u7F16\u8F91Agent\u4FE1\u606F - ".concat(e.agent_id),record:e}),de(!0)},_e=function(){var u=h()(o()().mark(function e(a){return o()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Ue(a);case 3:return t.abrupt("return",!0);case 6:return t.prev=6,t.t0=t.catch(0),console.error("\u7F16\u8F91Agent\u5931\u8D25:",t.t0),t.abrupt("return",!1);case 10:case"end":return t.stop()}},e,null,[[0,6]])}));return function(a){return u.apply(this,arguments)}}(),$e=function(e){switch(e){case"free":return(0,r.jsx)(C.Z,{color:"blue",children:"\u7A7A\u95F2"});case"busy":return(0,r.jsx)(C.Z,{color:"magenta",children:"\u7E41\u5FD9"});case"maintain":return(0,r.jsx)(C.Z,{color:"red",children:"\u7EF4\u62A4"});default:return(0,r.jsx)(C.Z,{color:"volcano",children:e})}},Ne=[{title:"Agent ID",dataIndex:"agent_id",width:200,fixed:"left"},{title:"\u4E1A\u52A1",dataIndex:"biz_id",width:130},{title:"\u522B\u540D",dataIndex:"alias",width:150},{title:"\u4E3B\u673A\u540D",dataIndex:"hostname",width:180},{title:"IP",dataIndex:"ip",width:180},{title:"\u5DE5\u4F5C\u76EE\u5F55",dataIndex:"workspace",width:200},{title:"\u7248\u672C",dataIndex:"version",width:150},{title:"\u72B6\u6001",dataIndex:"work_status",width:100,align:"center",render:function(e,a){return $e(a.work_status||"free")}},{title:"\u64CD\u4F5C",dataIndex:"option",valueType:"option",width:(0,M.OV)({small:100,wide:80}).width,fixed:"right",render:function(e,a){return[(0,r.jsx)(w.Z,{title:"\u7F16\u8F91",children:(0,r.jsx)(x.ZP,{type:"link",icon:(0,r.jsx)(g.Z,{}),onClick:function(){return ze(a)}})},"edit")]}}];return(0,r.jsxs)(f.Z,{header:{title:"Agent\u5217\u8868"},extra:(0,r.jsx)(m.er,{}),children:[Pe,(0,r.jsx)(V.Z,{type:"info",showIcon:!0,message:"".concat(je),description:"\u57FA\u4E8E\u7F13\u5B58\u6570\u636E\uFF0C\u5B9E\u65F6\u5C55\u793A Agent \u5217\u8868\uFF0C\u5FEB\u901F\u611F\u77E5\u5E76\u66F4\u65B0\u72B6\u6001\u3002",style:{marginBottom:16}}),(0,r.jsx)(A.Z,{actionRef:re,dataSource:Be,rowKey:"agent_id",search:!1,columns:Ne,scroll:{x:1100},rowSelection:{selectedRowKeys:b.map(function(u){return u.agent_id}),onChange:function(e,a){i(a)}},tableAlertRender:function(e){var a=e.selectedRowKeys,K=e.onCleanSelected;return(0,r.jsx)(G.Z,{size:24,children:(0,r.jsxs)("span",{children:["\u5DF2\u9009 ",a.length," \u9879",(0,r.jsx)("a",{style:{marginInlineStart:8},onClick:K,children:"\u53D6\u6D88\u9009\u62E9"})]})})},pagination:{defaultPageSize:15,showSizeChanger:!0,pageSizeOptions:["10","15","20","50","100"]},options:!1,toolbar:{search:(0,r.jsx)(te.Z,{prefix:(0,r.jsx)(P.Z,{}),style:{width:300},placeholder:"\u8F93\u5165\u5173\u952E\u5B57\u641C\u7D22",maxLength:80,allowClear:!0,value:J,onChange:function(e){return ue(e.target.value)}}),actions:[(0,r.jsx)(w.Z,{title:"\u5237\u65B0",children:(0,r.jsx)(x.ZP,{type:"text",icon:(0,r.jsx)(D.Z,{}),onClick:function(){return U()}})},"refresh")]},tableAlertOptionRender:function(){return(b==null?void 0:b.length)>0&&(0,r.jsxs)(G.Z,{children:[(0,r.jsx)(k.Z,{title:"\u6279\u91CF\u89E3\u9501\u8282\u70B9",description:"\u786E\u8BA4\u8981\u89E3\u9501\u9009\u4E2D\u7684\u8282\u70B9\u5417\uFF1F",onConfirm:Ke,children:(0,r.jsx)(x.ZP,{style:{backgroundColor:"#fa8c16",borderColor:"#fa8c16",color:"#fff"},icon:(0,r.jsx)(E.Z,{}),children:"\u8282\u70B9\u89E3\u9501"})}),(0,r.jsx)(k.Z,{title:"\u6279\u91CF\u7EF4\u62A4\u8282\u70B9",description:"\u786E\u8BA4\u8981\u5C06\u9009\u4E2D\u7684\u8282\u70B9\u8BBE\u4E3A\u7EF4\u62A4\u72B6\u6001\u5417\uFF1F",onConfirm:we,children:(0,r.jsx)(x.ZP,{style:{backgroundColor:"#fa8c16",borderColor:"#fa8c16",color:"#fff"},icon:(0,r.jsx)(F.Z,{}),children:"\u8282\u70B9\u7EF4\u62A4"})}),(0,r.jsx)(k.Z,{title:"\u6279\u91CF\u6062\u590D\u8282\u70B9",description:"\u786E\u8BA4\u8981\u6062\u590D\u9009\u4E2D\u7684\u8282\u70B9\u5417\uFF1F",onConfirm:ke,children:(0,r.jsx)(x.ZP,{style:{backgroundColor:"#fa8c16",borderColor:"#fa8c16",color:"#fff"},icon:(0,r.jsx)(S.Z,{theme:"outline"}),children:"\u8282\u70B9\u6062\u590D"})})]})}}),(0,r.jsx)(fe,{open:De,title:ve.title,record:ve.record,onOpenChange:de,onFinish:_e})]})},Oe=Ce}}]);
