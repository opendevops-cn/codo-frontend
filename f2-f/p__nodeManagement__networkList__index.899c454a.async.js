"use strict";(self.webpackChunkf2=self.webpackChunkf2||[]).push([[5198],{57491:function($,h,e){var _=e(98037),l=e(75271),T=e(19579),O=e(17002),a=function(v,c){return l.createElement(O.Z,(0,_.Z)((0,_.Z)({},v),{},{ref:c,icon:T.Z}))},r=l.forwardRef(a);h.Z=r},67254:function($,h,e){var _=e(26068),l=e.n(_),T=e(67825),O=e.n(T),a=e(53649),r=e.n(a),g=e(99503),v=e(77777),c=e(88230),y=e(75271),S=e(52676),b=["children","extra","ghost","title"],w,P,x=(0,c.kc)(function(C){var E=C.css;return{pageContainer:{"& .ant-page-header-heading":E(w||(w=r()([`
      margin-bottom: -50px;
    `]))),"& .ant-page-header-heading-extra":E(P||(P=r()([`
      position: absolute;
      top: 17px;
      right: 20px;
    `])))}}}),A=function(E){var F=E.children,M=E.extra,Z=M===void 0?(0,S.jsx)(g.er,{}):M,N=E.ghost,ee=N===void 0?!1:N,z=E.title,o=z===void 0?!1:z,te=O()(E,b),k=x(),ne=k.styles;return(0,S.jsx)(v._z,l()(l()({ghost:ee,extra:Z,className:ne.pageContainer,title:o},te),{},{children:F}))};h.Z=A},78474:function($,h,e){e.d(h,{j:function(){return T},t:function(){return O}});var _=e(54388),l=e(87300);function T(a,r,g,v,c,y){var S=c!=null?c:l.ZP,b=(0,_.useRequest)(a(r,g),{manual:!0,onSuccess:function(A){if(A.code!==0?S.error(A.msg):S.success(A.msg),y)y();else{var C;v==null||(C=v.current)===null||C===void 0||C.reload(!1)}},onError:function(){S.error("\u64CD\u4F5C\u5931\u8D25")}}),w=b.run,P=b.loading;return{runOpt:w,loading:P}}function O(a){var r=a.optMethod,g=a.optType,v=a.method,c=a.actionRef,y=a.messageApi,S=a.onSuccessCallback,b=a.showSuccessMessage,w=b===void 0?!0:b,P=y!=null?y:l.ZP,x=(0,_.useRequest)(r(g,v),{manual:!0,onSuccess:function(F){var M=typeof F.msg=="string"?F.msg:JSON.stringify(F.msg);if(F.code!==0)P.error(M);else if(S)S(F);else{var Z;w&&P.success(M),c==null||(Z=c.current)===null||Z===void 0||Z.reload(!1)}},onError:function(){P.error("\u64CD\u4F5C\u5931\u8D25")}}),A=x.run,C=x.loading;return{runOpt:A,loading:C}}},30168:function($,h,e){e.d(h,{OV:function(){return l}});var _=e(60164),l=function(a,r){var g=(0,_.ac)({minWidth:r||1700}),v=g?a.wide:a.small;return{isWideScreen:g,width:v}},T=function(a){var r=useMediaQuery({minWidth:1700}),g=useMediaQuery({maxWidth:1699});return r?{type:"wide",width:a.wide}:g?{type:"small",width:a.small}:{type:"small",width:a.small}};h.ZP=l},61101:function($,h,e){e.d(h,{T0:function(){return fe},Tk:function(){return H},US:function(){return he},qI:function(){return ae},x$:function(){return M}});var _=e(90228),l=e.n(_),T=e(87999),O=e.n(T),a=e(23261),r=e(54388);function g(){return commonGetListForTable("/api/job/v1/flow/design/draft/")}function v(t){return c.apply(this,arguments)}function c(){return c=_asyncToGenerator(_regeneratorRuntime().mark(function t(s){return _regeneratorRuntime().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return R.abrupt("return",commonGetList("/api/job/v1/flow/design/draft/",s));case 1:case"end":return R.stop()}},t)})),c.apply(this,arguments)}function y(t){return commonGetObj("/api/job/v1/flow/design/draft/",{id:t})}function S(t,s){return t==="clone"?commonOperationApi("/api/job/v1/flow/dict/clone/",s):commonOperationApi("/api/job/v1/flow/dict/manage/",s)}function b(t,s){return commonOperationApi("/api/job/v1/flow/dict/status/",s)}function w(){return commonGetList("/api/job/v1/executive/script/list/",{page:1,limit:310})}function P(){return commonGetList("/api/job/v1/executive/api/list/",{page:1,limit:310})}function x(){return commonGetList("/api/job/v1/flow/design/version/prod/",{})}function A(t,s){return commonOperationApi("/api/job/v1/flow/design/version/",s)}function C(){return commonGetList("/api/job/v1/executive/cloudnativetask/list/",{page:1,limit:310})}function E(t){return commonGetList("/api/job/v1/task/cnt_agent/list/",t)}function F(t){return commonGetListForTable2("/api/job/v1/flow/dict/perm/",t)}function M(t){return(0,a.N1)("/api/agent/v1/node-manager/agent/list-agent",t)}function Z(){return commonGetList2("/api/job/v1/flow/dict/list/",{page_number:1,page_size:310})}function N(t){var s=new FormData;return s.append("file",t),request("/api/job/v1/flow/dict/excel-template/",{method:"POST",data:s,requestType:"form"})}function ee(t,s){return commonOperationApi("/api/job/v1/flow/dict/datasource/preview/",s)}function z(t,s){return commonOperationApi("/api/job/v1/flow/dict/datasource/refresh/",s)}function o(t){return commonGetObj("/api/job/v1/flow/dict/manage/",t)}function te(t){return commonGetList("/api/job/v1/flow/dict/schema/",t)}function k(t,s){return commonOperationApi("/api/job/v1/flow/dict/perm/",s)}function ne(t){return commonGetObj("/api/job/v1/flow/dict/options/",t)}function ae(t){return(0,a.S_)("/api/job/v1/agent/install/","POST")}function fe(){return(0,a.B2)("/api/agent/v1/node-manager/agent/proxy-ids")}function H(t,s){return(0,a.S_)("/api/agent/v1/node-manager/agent/install-plugin",s)}function he(t,s){return(0,a.S_)("/api/agent/v1/node-manager/agent/upgrade",s)}},58326:function($,h,e){e.r(h),e.d(h,{default:function(){return Ze}});var _=e(90228),l=e.n(_),T=e(87999),O=e.n(T),a=e(48305),r=e.n(a),g=e(99503),v=e(67254),c=e(78474),y=e(30168),S=e(57491),b=e(19048),w=e(65496),P=e(90254),x=e(54388),A=e(37665),C=e(87300),E=e(50876),F=e(64085),M=e(41901),Z=e(67870),N=e(84249),ee=e(20877),z=e(1774),o=e(75271),te=e(335),k=e.n(te),ne=e(14443),ae=e(82715),fe=e(61487),H=e(66130),he=e(61101),t=e(52676),s=function(f){var D=f.open,_e=f.title,re=f.onOpenChange,Q=f.onFinish,ue=(0,o.useState)([]),J=r()(ue,2),Ee=J[0],De=J[1],Oe=(0,o.useState)([]),se=r()(Oe,2),oe=se[0],ie=se[1],Se=(0,o.useState)(!1),le=r()(Se,2),X=le[0],G=le[1],Pe=(0,o.useState)(!1),de=r()(Pe,2),Y=de[0],Ae=de[1],ce=(0,o.useState)(""),pe=r()(ce,2),Ce=pe[0],je=pe[1],be=(0,o.useState)(""),me=r()(be,2),Te=me[0],ye=me[1],q=(0,A.Z)(Ce,{wait:300}),ge=(0,A.Z)(Te,{wait:300}),u=(0,o.useCallback)(O()(l()().mark(function j(){var d,I,W,K,i,B,ve,L=arguments;return l()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return d=L.length>0&&L[0]!==void 0?L[0]:"",I=L.length>1?L[1]:void 0,W=I==="source"?G:Ae,K=I==="source"?De:ie,m.prev=4,W(!0),i=(0,he.x$)({page:1,page_size:310,search:d}),m.next=9,i({current:1,pageSize:310});case 9:B=m.sent,B.success&&B.data&&(ve=B.data.map(function(V){return{label:"".concat(V.agent_id," (").concat(V.ip,")"),value:V.agent_id}}),K(ve),console.log("".concat(I,"Agent\u6570\u636E\u52A0\u8F7D\u5B8C\u6210:"),{dataLength:B.data.length,search:d})),m.next=16;break;case 13:m.prev=13,m.t0=m.catch(4),console.error("\u52A0\u8F7DAgent\u6570\u636E\u5931\u8D25:",m.t0);case 16:return m.prev=16,W(!1),m.finish(16);case 19:case"end":return m.stop()}},j,null,[[4,13,16,19]])})),[]),n=(0,o.useCallback)(function(j){je(j)},[]),p=(0,o.useCallback)(function(j){ye(j)},[]);return(0,o.useEffect)(function(){D&&u(q,"source")},[q,D,u]),(0,o.useEffect)(function(){D&&u(ge,"target")},[ge,D,u]),(0,o.useEffect)(function(){D&&(u("","source"),u("","target"))},[D,u]),(0,t.jsxs)(ne.a,{title:_e,open:D,width:700,onOpenChange:re,autoFocusFirstInput:!0,drawerProps:{destroyOnClose:!0,maskClosable:!1},layout:"horizontal",labelCol:{span:5},initialValues:{white_ip_list:[]},onFinish:function(){var j=O()(l()().mark(function d(I){var W;return l()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,Q(I);case 3:if(W=i.sent,!W){i.next=7;break}return C.ZP.success("\u7EC4\u7F51\u4EFB\u52A1\u521B\u5EFA\u6210\u529F"),i.abrupt("return",!0);case 7:return i.abrupt("return",!1);case 10:return i.prev=10,i.t0=i.catch(0),console.error("\u521B\u5EFA\u7EC4\u7F51\u4EFB\u52A1\u5931\u8D25:",i.t0),i.abrupt("return",!1);case 14:case"end":return i.stop()}},d,null,[[0,10]])}));return function(d){return j.apply(this,arguments)}}(),submitter:{searchConfig:{submitText:"\u786E\u5B9A",resetText:"\u53D6\u6D88"}},children:[(0,t.jsx)(ae.Z,{name:"service_name",label:"\u670D\u52A1\u540D",placeholder:"\u8BF7\u8F93\u5165\u670D\u52A1\u540D",rules:[{required:!0,message:"\u670D\u52A1\u540D\u4E0D\u80FD\u4E3A\u7A7A"},{max:50,message:"\u670D\u52A1\u540D\u4E0D\u80FD\u8D85\u8FC750\u4E2A\u5B57\u7B26"}],fieldProps:{maxLength:50}}),(0,t.jsx)(fe.Z,{name:"src_agent_port",label:"\u6E90Agent\u7AEF\u53E3",placeholder:"\u8BF7\u8F93\u5165\u7AEF\u53E3\u53F7",rules:[{required:!0,message:"\u6E90Agent\u5F00\u653E\u7AEF\u53E3\u4E0D\u80FD\u4E3A\u7A7A"},{type:"number",min:1,max:65535,message:"\u7AEF\u53E3\u53F7\u5FC5\u987B\u57281-65535\u4E4B\u95F4"}],fieldProps:{precision:0,min:1,max:65535}}),(0,t.jsx)(H.Z,{name:"src_agent_id",label:"\u6E90Agent",placeholder:"\u8BF7\u9009\u62E9\u6E90Agent",options:Ee,rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u6E90Agent"}],fieldProps:{showSearch:!0,loading:X,onSearch:n,filterOption:!1,notFoundContent:X?"\u52A0\u8F7D\u4E2D...":"\u6682\u65E0\u6570\u636E"}}),(0,t.jsx)(H.Z,{name:"dst_agent_id",label:"\u76EE\u6807Agent",placeholder:"\u8BF7\u9009\u62E9\u76EE\u6807Agent",options:oe,rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u76EE\u6807Agent"}],fieldProps:{showSearch:!0,loading:Y,onSearch:p,filterOption:!1,notFoundContent:Y?"\u52A0\u8F7D\u4E2D...":"\u6682\u65E0\u6570\u636E"}}),(0,t.jsx)(ae.Z,{name:"dst_service_addr",label:"\u76EE\u6807\u5730\u5740",placeholder:"\u8BF7\u8F93\u5165\u76EE\u6807\u5730\u5740",rules:[{required:!0,message:"\u76EE\u6807\u5730\u5740\u4E0D\u80FD\u4E3A\u7A7A"},{pattern:/^(\d{1,3}\.){3}\d{1,3}:\d{1,5}$/,message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u5730\u5740\u683C\u5F0F\uFF0C\u5982\uFF1A192.168.1.200:8080"}],fieldProps:{maxLength:30}}),(0,t.jsx)(H.Z,{name:"white_ip_list",label:"\u767D\u540D\u5355IP\u5217\u8868",placeholder:"\u8BF7\u8F93\u5165\u6216\u9009\u62E9IP\u5730\u5740",mode:"tags",rules:[{required:!0,message:"\u767D\u540D\u5355IP\u5217\u8868\u4E0D\u80FD\u4E3A\u7A7A"},{validator:function(d,I){if(!I||I.length===0)return Promise.resolve();var W=/^(\d{1,3}\.){3}\d{1,3}$/,K=k()(I),i;try{for(K.s();!(i=K.n()).done;){var B=i.value;if(!W.test(B))return Promise.reject(new Error("IP\u5730\u5740\u683C\u5F0F\u4E0D\u6B63\u786E: ".concat(B)));var ve=B.split("."),L=k()(ve),Fe;try{for(L.s();!(Fe=L.n()).done;){var m=Fe.value,V=parseInt(m,10);if(V<0||V>255)return Promise.reject(new Error("IP\u5730\u5740\u8303\u56F4\u4E0D\u6B63\u786E: ".concat(B)))}}catch(Me){L.e(Me)}finally{L.f()}}}catch(Me){K.e(Me)}finally{K.f()}return Promise.resolve()}}],fieldProps:{tokenSeparators:[","," ",`
`],placeholder:"\u8F93\u5165IP\u5730\u5740\u540E\u6309\u56DE\u8F66\u6DFB\u52A0\uFF0C\u5982\uFF1A192.168.1.100"}})]})},Ie=s,R=e(23261);function Be(U){return(0,R.nZ)("/api/agent/v1/node-manager/mesh/list",U)}function Le(U){return(0,R.nZ)("/api/agent/v1/node-manager/mesh/history-list",U)}function we(U,f){return(0,R.S_)("/api/agent/v1/node-manager/mesh/register",f)}function xe(U,f){return(0,R.S_)("/api/agent/v1/node-manager/mesh/deregister",f)}var Re=function(){var f=(0,o.useRef)(),D=(0,o.useRef)(),_e=(0,o.useState)(""),re=r()(_e,2),Q=re[0],ue=re[1],J=(0,A.Z)(Q,{wait:300}),Ee=(0,x.useSearchParams)(),De=r()(Ee,1),Oe=De[0],se=C.ZP.useMessage(),oe=r()(se,2),ie=oe[0],Se=oe[1],le=(0,o.useState)("current"),X=r()(le,2),G=X[0],Pe=X[1],de=(0,o.useState)(!1),Y=r()(de,2),Ae=Y[0],ce=Y[1],pe=(0,c.t)({optMethod:xe,optType:"deregister",method:"POST",messageApi:ie,showSuccessMessage:!1,onSuccessCallback:function(){var n,p;(n=f.current)===null||n===void 0||n.reload(!1),(p=D.current)===null||p===void 0||p.reload(!1)}}),Ce=pe.runOpt,je=(0,c.t)({optMethod:we,optType:"create",method:"POST",messageApi:ie,showSuccessMessage:!1,onSuccessCallback:function(){var n,p;(n=f.current)===null||n===void 0||n.reload(!1),(p=D.current)===null||p===void 0||p.reload(!1)}}),be=je.runOpt;(0,o.useEffect)(function(){var u,n;(u=f.current)===null||u===void 0||u.reload(),(n=D.current)===null||n===void 0||n.reload()},[Oe]),(0,o.useEffect)(function(){if(G==="current"){var u;(u=f.current)===null||u===void 0||u.reload()}else{var n;(n=D.current)===null||n===void 0||n.reload()}},[G]);var me=function(){ce(!0)},Te=function(){var u=O()(l()().mark(function n(p){return l()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.prev=0,d.next=3,be(p);case 3:return d.abrupt("return",!0);case 6:return d.prev=6,d.t0=d.catch(0),console.error("\u521B\u5EFA\u7EC4\u7F51\u4EFB\u52A1\u5931\u8D25:",d.t0),d.abrupt("return",!1);case 10:case"end":return d.stop()}},n,null,[[0,6]])}));return function(p){return u.apply(this,arguments)}}(),ye=function(n){var p={service_id:n.id};Ce(p)},q=[{title:"\u670D\u52A1\u540D",dataIndex:"service_name",width:150,fixed:"left"},{title:"\u4E0A\u8F66\u5730\u5740",dataIndex:"src_addr",width:160},{title:"\u6E90Agent ID",dataIndex:"src_agent_id",width:120},{title:"\u76EE\u6807Agent ID",dataIndex:"dst_agent_id",width:120},{title:"\u76EE\u6807\u5730\u5740",dataIndex:"dst_addr",width:160},{title:"\u5FC3\u8DF3\u65F6\u95F4",dataIndex:"heartbeat_at",width:160,valueType:"dateTime"},{title:"\u521B\u5EFA\u4EBA",dataIndex:"creator",width:120},{title:"\u64CD\u4F5C",dataIndex:"option",valueType:"option",width:(0,y.OV)({small:100,wide:80}).width,fixed:"right",render:function(n,p){return[(0,t.jsx)(E.Z,{title:"\u5220\u9664",children:(0,t.jsx)(F.Z,{title:"\u6CE8\u9500\u7F51\u683C\u670D\u52A1",description:"\u786E\u8BA4\u8981\u6CE8\u9500\u8FD9\u4E2A\u7F51\u683C\u670D\u52A1\u5417\uFF1F",onConfirm:function(){return ye(p)},children:(0,t.jsx)(M.ZP,{type:"link",danger:!0,icon:(0,t.jsx)(S.Z,{})})})},"delete")]}}],ge=[{key:"current",label:"\u7EC4\u7F51\u5217\u8868",children:(0,t.jsx)(P.Z,{actionRef:f,params:{searchValue:J,tab:G},rowKey:"id",search:!1,request:Be(),columns:q,scroll:{x:1e3},tableAlertRender:function(n){var p=n.selectedRowKeys,j=n.onCleanSelected;return(0,t.jsx)(Z.Z,{size:24,children:(0,t.jsxs)("span",{children:["\u5DF2\u9009 ",p.length," \u9879",(0,t.jsx)("a",{style:{marginInlineStart:8},onClick:j,children:"\u53D6\u6D88\u9009\u62E9"})]})})},pagination:{defaultPageSize:10,showSizeChanger:!0},toolbar:{search:(0,t.jsx)(N.Z,{prefix:(0,t.jsx)(b.Z,{}),style:{width:400},placeholder:"\u8BF7\u8F93\u5165\u670D\u52A1\u540D\u3001\u6E90Agent ID\u6216\u76EE\u6807Agent ID\u641C\u7D22",allowClear:!0,value:Q,onChange:function(n){return ue(n.target.value)}})}})},{key:"history",label:"\u5386\u53F2\u7EC4\u7F51",children:(0,t.jsx)(P.Z,{actionRef:D,params:{searchValue:J,tab:G},rowKey:"id",search:!1,request:Le(),columns:q,scroll:{x:1e3},pagination:{defaultPageSize:10,showSizeChanger:!0},toolbar:{search:(0,t.jsx)(N.Z,{prefix:(0,t.jsx)(b.Z,{}),style:{width:400},placeholder:"\u8BF7\u8F93\u5165\u670D\u52A1\u540D\u3001\u6E90Agent ID\u6216\u76EE\u6807Agent ID\u641C\u7D22",allowClear:!0,value:Q,onChange:function(n){return ue(n.target.value)}})}})}];return(0,t.jsxs)(v.Z,{extra:(0,t.jsx)(g.er,{disabled:!0}),children:[Se,(0,t.jsx)(ee.Z,{type:"info",showIcon:!0,message:"\u901A\u8FC7\u6253\u6D1E\u6280\u672F\uFF0C\u652F\u6301\u4E0D\u540C\u5C40\u57DF\u7F51\u4E4B\u95F4\u7684\u70B9\u5BF9\u70B9\u901A\u4FE1\uFF0C\u63D0\u4F9B 4 \u5C42\u548C 7 \u5C42\u76F4\u8FDE\u80FD\u529B\u3002",style:{marginBottom:16}}),(0,t.jsx)(z.Z,{activeKey:G,onChange:Pe,items:ge,tabBarExtraContent:{right:(0,t.jsx)(M.ZP,{type:"primary",icon:(0,t.jsx)(w.Z,{}),onClick:me,children:"\u65B0\u5EFA\u7EC4\u7F51\u4EFB\u52A1"})}}),(0,t.jsx)(Ie,{open:Ae,title:"\u65B0\u5EFA\u7EC4\u7F51\u4EFB\u52A1",onOpenChange:ce,onFinish:Te})]})},Ze=Re}}]);
