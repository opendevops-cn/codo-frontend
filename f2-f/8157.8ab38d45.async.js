"use strict";(self.webpackChunkf2=self.webpackChunkf2||[]).push([[8157],{17931:function(Y,M,e){var C=e(98037),P=e(58006),l=e(75271),y=e(76272),m=e(34832),p=e(52676),E=["fieldProps","proFieldProps"],h="dateTime",g=l.forwardRef(function(u,_){var B=u.fieldProps,c=u.proFieldProps,D=(0,P.Z)(u,E),o=(0,l.useContext)(y.Z);return(0,p.jsx)(m.Z,(0,C.Z)({ref:_,fieldProps:(0,C.Z)({getPopupContainer:o.getPopupContainer},B),valueType:h,proFieldProps:c,filedConfig:{valueType:h,customLightMode:!0}},D))});M.Z=g},67254:function(Y,M,e){var C=e(26068),P=e.n(C),l=e(67825),y=e.n(l),m=e(53649),p=e.n(m),E=e(99503),h=e(77777),g=e(88230),u=e(75271),_=e(52676),B=["children","extra","ghost","title"],c,D,o=(0,g.kc)(function(j){var F=j.css;return{pageContainer:{"& .ant-page-header-heading":F(c||(c=p()([`
      margin-bottom: -50px;
    `]))),"& .ant-page-header-heading-extra":F(D||(D=p()([`
      position: absolute;
      top: 17px;
      right: 20px;
    `])))}}}),R=function(F){var A=F.children,Z=F.extra,L=Z===void 0?(0,_.jsx)(E.er,{}):Z,V=F.ghost,z=V===void 0?!1:V,v=F.title,N=v===void 0?!1:v,w=y()(F,B),n=o(),G=n.styles;return(0,_.jsx)(h._z,P()(P()({ghost:z,extra:L,className:G.pageContainer,title:N},w),{},{children:A}))};M.Z=R},78474:function(Y,M,e){e.d(M,{j:function(){return l},t:function(){return y}});var C=e(54388),P=e(87300);function l(m,p,E,h,g,u){var _=g!=null?g:P.ZP,B=(0,C.useRequest)(m(p,E),{manual:!0,onSuccess:function(R){if(R.code!==0?_.error(R.msg):_.success(R.msg),u)u();else{var j;h==null||(j=h.current)===null||j===void 0||j.reload(!1)}},onError:function(){_.error("\u64CD\u4F5C\u5931\u8D25")}}),c=B.run,D=B.loading;return{runOpt:c,loading:D}}function y(m){var p=m.optMethod,E=m.optType,h=m.method,g=m.actionRef,u=m.messageApi,_=m.onSuccessCallback,B=m.showSuccessMessage,c=B===void 0?!0:B,D=u!=null?u:P.ZP,o=(0,C.useRequest)(p(E,h),{manual:!0,onSuccess:function(A){var Z=typeof A.msg=="string"?A.msg:JSON.stringify(A.msg);if(A.code!==0)D.error(Z);else if(_)_(A);else{var L;c&&D.success(Z),g==null||(L=g.current)===null||L===void 0||L.reload(!1)}},onError:function(){D.error("\u64CD\u4F5C\u5931\u8D25")}}),R=o.run,j=o.loading;return{runOpt:R,loading:j}}},89268:function(Y,M,e){e.d(M,{H:function(){return C},Q:function(){return P}});var C=function(l){return l.current="current",l.upcoming="upcoming",l.related="related",l.created="created",l.history="history",l}({}),P=function(l){return l.Queued="\u6392\u961F\u4E2D",l.Processing="\u5904\u7406\u4E2D",l.Success="\u6210\u529F",l.Failed="\u5931\u8D25",l.Terminated="\u7EC8\u6B62",l}({})},78157:function(Y,M,e){e.d(M,{Z:function(){return Ue}});var C=e(90228),P=e.n(C),l=e(87999),y=e.n(l),m=e(26068),p=e.n(m),E=e(15558),h=e.n(E),g=e(48305),u=e.n(g),_=e(99503),B=e(67254),c=e(76244),D=e(78474),o=e(89268),R=e(19048),j=e(84297),F=e(17931),A=e(90254),Z=e(57883),L=e(98037),V=e(58006),z=e(95702),v=e(75271),N=e(76272),w=e(34832),n=e(52676),G=["fieldProps","proFieldProps"],ae="dateRange",Re=v.forwardRef(function(T,I){var S=T.fieldProps,i=T.proFieldProps,x=(0,V.Z)(T,G),b=(0,v.useContext)(N.Z);return(0,n.jsx)(w.Z,(0,L.Z)({ref:I,fieldProps:(0,L.Z)({getPopupContainer:b.getPopupContainer},S),valueType:ae,proFieldProps:i,filedConfig:{valueType:ae,customLightMode:!0,lightFilterLabelFormatter:function(ee){return(0,z.c)(ee,(S==null?void 0:S.format)||"YYYY-MM-DD")}}},x))}),Ae=Re,J=e(54388),Te=e(27201),Ie=e(37665),Le=e(87300),X=e(38902),k=e(64085),ue=e(67870),Ze=e(84249),oe=e(41901),be=e(16483),f=e.n(be),q=e(23261);function Ke(T){return(0,q.Jl)("/api/job/v1/flow/".concat(T,"/list/"))}function $(T,I){return T==="batch"?(0,q.S_)("/api/job/v1/flow/current/list/pro/",I):(0,q.S_)("/api/job/v1/flow/current/list/",I)}var We=[{label:"\u6700\u8FD17\u5929",value:[f()().add(-7,"d"),f()()]},{label:"\u6700\u8FD114\u5929",value:[f()().add(-14,"d"),f()()]},{label:"\u6700\u8FD130\u5929",value:[f()().add(-30,"d"),f()()]},{label:"\u6700\u8FD190\u5929",value:[f()().add(-90,"d"),f()()]}],se=function(I){var S=f()(),i=f()().add(-7,"d");if(I)switch(I){case"7d":i=f()().add(-6,"d");break;case"30d":i=f()().add(-29,"d");break;case"6m":i=f()().add(-6,"month");break;case"1y":i=f()().add(-1,"year");break;default:i=f()().add(-6,"d")}return[i,S]},Ye=function(I){var S,i=I.orderType,x=(0,v.useRef)(),b=(0,J.useLocation)(),le=(0,J.useSearchParams)(),ee=u()(le,1),He=ee[0],Ve=(0,v.useState)(),ie=u()(Ve,2),de=ie[0],te=ie[1],$e=(0,v.useState)([]),ce=u()($e,2),ve=ce[0],fe=ce[1],Qe=(0,v.useState)([]),me=u()(Qe,2),pe=me[0],ge=me[1],W=(S=b.state)===null||S===void 0?void 0:S.dateRange;(0,v.useEffect)(function(){var r;if(console.log("dateRange",W),(r=b.state)!==null&&r!==void 0&&r.filter){var a,t,s,d=(a=(t=b.state)===null||t===void 0?void 0:t.filter)!==null&&a!==void 0?a:"";i===o.H.history?(te({flow_run_state:d}),ge([d])):d==="ExecutionError"&&(te({order_state:c.iF.ExecutionError}),fe([c.iF.ExecutionError])),(s=x.current)===null||s===void 0||s.reload()}},[b.state,i]);var ze=(0,Te.Z)(function(){var r;(r=x.current)===null||r===void 0||r.reload()},5e3),Ne=function(a){switch(a){case o.H.current:return"orderList";case o.H.upcoming:return"upcoming";case o.H.related:return"related";case o.H.created:return"myCreate";case o.H.history:return"historyOrderList";default:return"orderList"}},we=(0,v.useState)(function(){var r,a=((r=b.state)===null||r===void 0?void 0:r.fromDetail)===!0,t=sessionStorage.getItem("orderList_".concat(i,"_page"));return a&&t?parseInt(t,10):(sessionStorage.setItem("orderList_".concat(i,"_page"),"1"),1)}),he=u()(we,2),re=he[0],Ge=he[1],Je=(0,v.useState)([]),Ce=u()(Je,2),K=Ce[0],U=Ce[1],Xe=(0,v.useState)(""),_e=u()(Xe,2),De=_e[0],ke=_e[1],qe=(0,Ie.Z)(De,{wait:300}),et=Le.ZP.useMessage(),Pe=u()(et,2),Q=Pe[0],tt=Pe[1],rt=(0,v.useState)(function(){return W?se(W):[f()().add(-7,"d"),f()().add(1,"d")]}),Ee=u()(rt,2),ne=Ee[0],xe=Ee[1],nt=(0,v.useState)([ne[0].format("YYYY-MM-DD"),ne[1].format("YYYY-MM-DD")]),Fe=u()(nt,2),Oe=Fe[0],Me=Fe[1];(0,v.useEffect)(function(){sessionStorage.setItem("orderList_".concat(i,"_page"),re.toString())},[re,i]),(0,v.useEffect)(function(){if(W){var r,a=se(W),t=u()(a,2),s=t[0],d=t[1];xe([s,d]),Me([s.format("YYYY-MM-DD"),d.format("YYYY-MM-DD")]),(r=x.current)===null||r===void 0||r.reload()}},[W]),(0,v.useEffect)(function(){return function(){ze()}},[]),(0,v.useEffect)(function(){var r;(r=x.current)===null||r===void 0||r.reload()},[He]);var Be=(0,D.j)($,"normal","PATCH",x,Q),at=Be.runOpt,ut=Be.loading,je=(0,D.j)($,"normal","PATCH",x,Q),ot=je.runOpt,vt=je.loading,Se=(0,D.j)($,"batch","PUT",x,Q),st=Se.runOpt,lt=Se.loading,ye=(0,D.j)($,"batch","PATCH",x,Q),it=ye.runOpt,dt=ye.loading,ct=[{title:"\u8BA2\u5355ID",dataIndex:"id",width:80,fixed:"left"},{title:"\u8BA2\u5355\u540D\u79F0",dataIndex:"order_name",width:250,fixed:"left",render:function(a,t){return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(X.Z.Link,{onClick:function(){J.history.push("/orderCenter/".concat(Ne(i),"/").concat(t.id))},children:a})})}},{title:"\u7C7B\u578B",dataIndex:"order_type",width:100},{title:"\u8FDB\u5EA6",dataIndex:"order_step",width:100,ellipsis:!0},p()(p()({title:"\u72B6\u6001",dataIndex:"order_state",width:100},i===o.H.current&&{filters:[{text:"\u5168\u90E8",value:"all"},{text:"\u65B0\u5EFA",value:c.iF.New},{text:"\u7B49\u5F85",value:c.iF.Waiting},{text:"\u5904\u7406\u4E2D",value:c.iF.InProgress},{text:"\u5B8C\u6210",value:c.iF.Completed},{text:"\u6267\u884C\u9519\u8BEF",value:c.iF.ExecutionError},{text:"\u624B\u5DE5\u5904\u7406",value:c.iF.ManualProcessing},{text:"\u5B9A\u65F6",value:c.iF.Scheduled},{text:"\u6392\u961F",value:c.iF.Queued},{text:"\u6761\u4EF6\u9519\u8BEF",value:c.iF.ConditionError}],filterMultiple:!1,filteredValue:ve.length?ve:null}),{},{render:function(a){return(0,n.jsx)(_.Nj,{status:a,statusType:"order_state"})}})].concat(h()(i===o.H.history?[{title:"\u8BA2\u5355\u72B6\u6001",dataIndex:"flow_run_state",width:100,filters:[{text:"\u5168\u90E8",value:"all"},{text:"\u6392\u961F\u4E2D",value:o.Q.Queued},{text:"\u5904\u7406\u4E2D",value:o.Q.Processing},{text:"\u6210\u529F",value:o.Q.Success},{text:"\u5931\u8D25",value:o.Q.Failed},{text:"\u7EC8\u6B62",value:o.Q.Terminated}],filterMultiple:!1,filteredValue:pe.length?pe:null,render:function(a){return(0,n.jsx)(_.Nj,{status:a,statusType:"flow_run_state"})}}]:[]),[{title:"\u521B\u5EFA\u4EBA",dataIndex:"creator",width:200,ellipsis:!0},{title:"\u5F00\u59CB\u65F6\u95F4",dataIndex:"flow_begin_time",width:200},i===o.H.history?{title:"\u7ED3\u675F\u65F6\u95F4",dataIndex:"flow_end_time",width:200}:{title:"\u521B\u5EFA\u65F6\u95F4",dataIndex:"create_time",width:200},{title:"\u64CD\u4F5C",dataIndex:"option",valueType:"option",width:120,fixed:"right",render:function(a,t){return[(0,n.jsx)(j.Y,{width:600,title:"\u514B\u9686\u8BA2\u5355\u2014".concat(t.order_name),layout:"horizontal",trigger:(0,n.jsx)(X.Z.Link,{children:"\u514B\u9686"}),initialValues:{start_time:f()().format("YYYY-MM-DD HH:mm:ss")},autoFocusFirstInput:!0,modalProps:{destroyOnClose:!0,onCancel:function(){return console.log("run")}},submitTimeout:2e3,onFinish:function(){var s=y()(P()().mark(function d(O){return P()().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:return H.next=2,ot({flow_run_id:t.id,do_type:"clone",start_time:O.start_time});case 2:return H.abrupt("return",!0);case 3:case"end":return H.stop()}},d)}));return function(d){return s.apply(this,arguments)}}(),children:(0,n.jsx)(F.Z,{name:"start_time",label:"\u6267\u884C\u65F6\u95F4",tooltip:"\u6267\u884C\u65F6\u95F4\u4E0D\u80FD\u65E9\u4E8E\u5F53\u524D\u65F6\u95F4",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u6267\u884C\u65F6\u95F4"}],fieldProps:{disabledDate:function(d){return d&&d<f()()}}})},"clone")].concat(h()(i===o.H.history?[]:[(0,n.jsx)(k.Z,{title:"\u7EC8\u6B62\u6D41\u7A0B",description:(0,n.jsxs)(n.Fragment,{children:["\u786E\u5B9A\u8981\u7EC8\u6B62\u300A",t.order_name,"\u300B\u7684\u6D41\u7A0B\u5355\uFF0C\u8BF7\u8C28\u614E\u64CD\u4F5C\uFF01",(0,n.jsx)("br",{}),"\u7EC8\u6B62\u8BA2\u5355\u5E76\u4E0D\u4F1A\u4E2D\u6B62\u6B63\u5728\u8FD0\u884C\u7684\u4EFB\u52A1\uFF0C\u5982\u679C\u9700\u8981\u4E2D\u6B62\u6B63\u5728\u8FD0\u884C\u7684\u8282\u70B9\u8BF7\u64CD\u4F5C\u6D41\u7A0B\u8282\u70B9"]}),onConfirm:function(){at({flow_run_id:t.id,do_type:"stop"}).then(function(){var d,O;(d=x.current)===null||d===void 0||(O=d.clearSelected)===null||O===void 0||O.call(d),U([])})},okButtonProps:{loading:ut},children:(0,n.jsx)(X.Z.Link,{type:"danger",children:"\u7ED3\u5355"})},"stop")]))}}]);return(0,n.jsxs)(B.Z,{ghost:!1,extra:(0,n.jsx)(_.er,{}),children:[tt,(0,n.jsx)(A.Z,{actionRef:x,params:p()({searchValue:qe,start_date:Oe[0],end_date:Oe[1]},de&&{filter_map:de}),rowKey:"id",search:!1,request:Ke(i),columns:ct,scroll:{x:1100},rowSelection:{selectedRowKeys:K.map(function(r){return r.id}),onChange:function(a,t){U(t)},preserveSelectedRowKeys:!1},loading:!1,tableAlertRender:K.length>0?function(r){var a=r.selectedRowKeys,t=r.onCleanSelected;return(0,n.jsx)(ue.Z,{size:24,children:(0,n.jsxs)("span",{children:["\u5DF2\u9009 ",a.length," \u9879",(0,n.jsx)("a",{style:{marginInlineStart:8},onClick:function(){U([]),t()},children:"\u53D6\u6D88\u9009\u62E9"})]})})}:!1,pagination:{defaultPageSize:10,showSizeChanger:!0,current:re,onChange:function(a){return Ge(a)}},toolbar:{search:(0,n.jsx)(Ze.Z,{prefix:(0,n.jsx)(R.Z,{}),style:{width:400},placeholder:"\u8BF7\u8F93\u5165\u8BA2\u5355ID\u3001\u8BA2\u5355\u540D\u79F0\u3001\u7C7B\u578B\u3001\u8FDB\u5EA6\u641C\u7D22",allowClear:!0,value:De,onChange:function(a){return ke(a.target.value)}}),filter:i===o.H.history&&(0,n.jsx)(Z.M,{children:(0,n.jsx)(Ae,{name:"startdate",label:"\u8BA2\u5355\u65E5\u671F",initialValue:ne,fieldProps:{presets:We,autoFocus:!1,onChange:function(a,t){a&&(xe([a[0],a[1]]),Me(t))}}})})},tableAlertOptionRender:function(){return(K==null?void 0:K.length)>0&&(0,n.jsxs)(ue.Z,{children:[(0,n.jsx)(k.Z,{title:"\u6279\u91CF\u91CD\u8BD5",description:"\u786E\u5B9A\u8981\u6279\u91CF\u91CD\u8BD5\u6D41\u7A0B\u5355\uFF0C\u8BF7\u8C28\u614E\u64CD\u4F5C\uFF01",onConfirm:function(){st({run_flow_list:K.map(function(t){return String(t.id)}),do_type:"retry"}).then(function(){var t,s;(t=x.current)===null||t===void 0||(s=t.clearSelected)===null||s===void 0||s.call(t),U([])})},okButtonProps:{loading:lt},children:(0,n.jsx)(oe.ZP,{type:"primary",children:"\u6279\u91CF\u91CD\u8BD5"})},"batchRetry"),(0,n.jsx)(k.Z,{title:"\u6279\u91CF\u7ED3\u5355",description:(0,n.jsxs)(n.Fragment,{children:["\u786E\u5B9A\u8981\u6279\u91CF\u91CD\u8BD5\u6D41\u7A0B\u5355\uFF0C\u8BF7\u8C28\u614E\u64CD\u4F5C\uFF01",(0,n.jsx)("br",{}),"\u7EC8\u6B62\u8BA2\u5355\u5E76\u4E0D\u4F1A\u4E2D\u6B62\u6B63\u5728\u8FD0\u884C\u7684\u4EFB\u52A1\uFF0C\u5982\u679C\u9700\u8981\u4E2D\u6B62\u6B63\u5728\u8FD0\u884C\u7684\u8282\u70B9\u8BF7\u64CD\u4F5C\u6D41\u7A0B\u8282\u70B9"]}),onConfirm:function(){it({run_flow_list:K.map(function(t){return String(t.id)}),do_type:"stop"}).then(function(){var t,s;(t=x.current)===null||t===void 0||(s=t.clearSelected)===null||s===void 0||s.call(t),U([])})},okButtonProps:{loading:dt},children:(0,n.jsx)(oe.ZP,{type:"primary",danger:!0,children:"\u6279\u91CF\u7ED3\u5355"})},"batchStop")]})},onChange:function(a,t){var s,d;fe(t.order_state||[]),ge(t.flow_run_state||[]);var O={};(s=t.order_state)!==null&&s!==void 0&&s[0]&&(t.order_state[0]==="all"?delete O.order_state:O.order_state=t.order_state[0]),(d=t.flow_run_state)!==null&&d!==void 0&&d[0]&&(t.flow_run_state[0]==="all"?delete O.flow_run_state:O.flow_run_state=t.flow_run_state[0]),te(Object.keys(O).length>0?O:void 0)}})]})},Ue=Ye},27201:function(Y,M,e){var C=e(75271),P=e(72170),l=e(48915),y=function(m,p,E){E===void 0&&(E={});var h=(0,P.Z)(m),g=(0,C.useRef)(null),u=(0,C.useCallback)(function(){g.current&&clearInterval(g.current)},[]);return(0,C.useEffect)(function(){if(!(!(0,l.hj)(p)||p<0))return E.immediate&&h(),g.current=setInterval(h,p),u},[p,E.immediate]),u};M.Z=y}}]);
