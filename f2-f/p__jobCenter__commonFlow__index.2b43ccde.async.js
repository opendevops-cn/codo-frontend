"use strict";(self.webpackChunkf2=self.webpackChunkf2||[]).push([[5699],{56247:function(_e,ee,e){var re=e(98037),h=e(58006),ae=e(75271),s=e(34832),O=e(52676),Y=["fieldProps","proFieldProps"],M=function(y,L){var U=y.fieldProps,ie=y.proFieldProps,A=(0,h.Z)(y,Y);return(0,O.jsx)(s.Z,(0,re.Z)({ref:L,valueType:"textarea",fieldProps:U,proFieldProps:ie},A))};ee.Z=ae.forwardRef(M)},9489:function(_e,ee,e){var re=e(48305),h=e.n(re),ae=e(44725),s=e(75271),O=e(52676),Y=function(S){var y=S.children,L=S.modalRender,U=(0,s.useState)(!1),ie=h()(U,2),A=ie[0],k=ie[1],oe=(0,s.useState)(!1),i=h()(oe,2),w=i[0],we=i[1],Be=ae.Z.useForm(),Me=h()(Be,1),De=Me[0];return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("span",{onClick:function(){k(!0),we(!0)},children:y}),A&&L&&function(){var he=L(function(){we(!1),setTimeout(function(){k(!1)},300)},De);return s.cloneElement(he,{open:w})}()]})};ee.Z=Y},74245:function(_e,ee,e){var re=e(86432),h=e(88230),ae=e(75271),s=e(52676),O=(0,h.kc)(function(){return{popoverContent:{".ant-popover-inner":{padding:4}},menuItem:{padding:"5px 12px",cursor:"pointer",transition:"all 0.2s",borderRadius:4,"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}},childrenContainer:{cursor:"pointer"}}}),Y=function(S){var y=S.children,L=S.items,U=S.placement,ie=U===void 0?"bottom":U,A=S.trigger,k=A===void 0?"click":A,oe=O(),i=oe.styles;return(0,s.jsx)(re.Z,{trigger:k,placement:ie,zIndex:10,arrow:!1,overlayClassName:i.popoverContent,content:L.map(function(w){return(0,s.jsx)("div",{className:i.menuItem,children:w.label},w.key)}),children:(0,s.jsx)("span",{className:i.childrenContainer,children:y})})};ee.Z=(0,ae.memo)(Y)},69331:function(_e,ee,e){e.r(ee),e.d(ee,{default:function(){return Bt}});var re=e(26068),h=e.n(re),ae=e(48305),s=e.n(ae),O=e(67254),Y=e(19048),M=e(54388),S=e(87300),y=e(80921),L=e(38902),U=e(50876),ie=e(67870),A=e(84249),k=e(82187),oe=e.n(k),i=e(75271),w=e(82901),we=e(99503),Be=e(30168),Me=e(41578),De=e(31662),he=e(84286),me=e(90254),le=e(90328),ce=e(37665),j=e(15558),ve=e.n(j),Qe=e(90228),Ne=e.n(Qe),dt=e(87999),it=e.n(dt),ct=e(53475),ot=e(28061),vt=e(44037),ft=e(9489),mt=e(74245),Ye=e(44725),gt=e(60793),n=e(52676),pt=function(t){var l=t.onCancel,a=t.refresh,g=t.defaultOrder,P=t.onOrderChange,R=t.open,v=(0,i.useState)(g),_=s()(v,2),T=_[0],X=_[1];return(0,n.jsx)(ot.Z,{open:R,title:"\u6807\u7B7E\u6392\u5E8F",onCancel:l,onOk:function(){a(T),l(),P(T)},children:(0,n.jsx)(Ye.Z,{style:{marginTop:20},children:(0,n.jsx)(Ye.Z.Item,{label:"\u6392\u5E8F\u89C4\u5219",tooltip:"\u652F\u6301\u8BBE\u7F6E\u6784\u5EFA\u673A\u7EC4\u6392\u5E8F\u89C4\u5219\uFF0C\u9009\u62E9\u81EA\u5B9A\u4E49\u53EF\u62D6\u52A8\u6392\u5E8F\u6784\u5EFA\u673A\u7EC4",children:(0,n.jsx)(gt.Z,{value:T,onChange:function(G){X(G)},options:[{label:"\u81EA\u5B9A\u4E49",value:"sort"},{label:"\u9996\u5B57\u6BCD\u6392\u5E8F",value:"label"},{label:"\u521B\u5EFA\u65F6\u95F4\u4ECE\u8FD1\u5230\u8FDC",value:"time_descend"},{label:"\u521B\u5EFA\u65F6\u95F4\u4ECE\u8FDC\u5230\u8FD1",value:"time_ascend"}]})})})})},ht=pt,Ke=e(78474),Fe=e(23261);function Mt(d){return commonGetList("/api/job/v1/task/agent/tree/",d)}function Rt(d,t){return commonOperationApi("/api/job/v1/task/agent/tree/",t)}var zt=function(t){return commonGetList("/api/job/v1/task/agent/label/dropdown_selection/",t)};function Zt(d,t){return commonOperationApi("/api/job/v1/task/agent/label/dropdown_selection/",t)}function Vt(){return commonOperationApi("/api/job/v1/task/agent/label/","PATCH")}function St(){return(0,Fe.S_)("/api/job/v1/flow/common_flow/tag/set_sort/","POST")}var Nt=function(t){return commonGetList("/api/job/v1/task/agent/list/",t)};function Kt(d){return commonGetList("/api/job/v2/task/agent/label/agent/",d)}function Wt(d){var t={label_id:34,label:"\u6743\u91CD\u6781\u5927\u6570\u636E\u5E93\u5927\u5BB6\u90FD\u53F8\u673A\u5FEB\u9012",label_uuid:"l-i2rRKwd2PkzrmTGtr9rTiX",sort:0,scheduler_type:"weighted",agents_info:{lnlinux:99,lntest:99,lnwin_531:0}};return new Promise(function(l){setTimeout(function(){l({data:t,code:0,msg:"success"})},500)})}function Je(d,t){return(0,Fe.S_)("/api/job/v1/flow/common_flow/tag/manage/",t)}function $t(d,t){return commonOperationApi("/api/job/v1/agent/set-property/",t)}function Ut(d,t){return commonOperationApi("/api/job/v1/task/agent/lock/",t)}function kt(d,t){return commonOperationApi("/api/agent/v1/manager/agent/upgrade",t)}function Xt(d){return commonGetObj("/api/job/v2/task/agent/label/detail/",d)}function xt(d){return(0,Fe.W8)("/api/job/v1/flow/common_flow/tag/list/",d)}function Ct(d){return(0,Fe.eg)("/api/job/v1/flow/common_flow/design_draft/list/",d)}function wt(d){return(0,Fe.W8)("/api/job/v1/flow/common_flow/design_draft/list/",d)}function jt(d){return(0,Fe.W8)("/api/job/v1/flow/common_flow/flow-design/list/",d)}var Gt=e(16751),Ht=e(56633),Qt=function(t){var l=t.bizId,a=t.data,g=useState(),P=_slicedToArray(g,2),R=P[0],v=P[1],_=useStore(function(b){return{projectId:b.project.projectId,projectCode:b.project.projectCode}}),T=_.projectId,X=_.projectCode,z=useRequest(function(b){return Api.getAgentUsageInfo({project_id:T,biz_id:l,agent_id:b},{showErrorMessage:!1,showSuccessMessage:!1})},{manual:!0,onSuccess:function(te){v(te.usage_detail)},onError:function(){}}),G=z.run,H=z.loading;return _jsx(Tooltip,{placement:"left",overlayStyle:{minWidth:450},overlayInnerStyle:{maxHeight:550,overflowY:"auto"},title:_jsx(Flex,{vertical:!0,gap:10,children:_jsxs(_Fragment,{children:[(a==null?void 0:a.work_status)==="offline"&&_jsx("div",{children:"\u79BB\u7EBF: \u6784\u5EFA\u673A\u5904\u4E8E\u79BB\u7EBF\u72B6\u6001, \u8BF7\u8054\u7CFB\u5E73\u53F0\u7BA1\u7406\u5458\u6062\u590D"}),(a==null?void 0:a.work_status)!=="offline"&&a!==null&&a!==void 0&&a.run_tasks&&Object.keys(a.run_tasks).length>0?Object.values(a.run_tasks).map(function(b,te){return _jsx("div",{children:b.desc.split(`
`).map(function(J,D){return _jsx("div",{children:J},D)})},te)}):(a==null?void 0:a.work_status)!=="offline"&&_jsx("div",{children:"\u5F53\u524D\u6784\u5EFA\u673A\u65E0\u6267\u884C\u4E2D\u4EFB\u52A1"})]})}),children:_jsx(QuestionCircleOutlined,{style:{color:"rgba(0,0,0,0.45)"}})})},Yt=null,We={container:"Xg1ZVu4Pj8gZLNGM2tB2",ellipsisText:"zZGe2rgJuUkVXtd92zdL",list:"QvHS8VYxAEo7ZDmTw1pE",title:"C9o0HAMQuzE4n5CC6IsM","reset-btn":"V2wkVGQzXIHBjF0WspME",resetBtn:"V2wkVGQzXIHBjF0WspME",circle:"d9epkIJlH3kz4oqBTTtH",collapsed:"YsLFPvNNkdsaA17bAdai"},Jt=[{dataIndex:"agent_name",title:"\u522B\u540D"},{dataIndex:"ip",title:"IP"},{dataIndex:"status",title:"\u72B6\u6001"},{dataIndex:"ip",title:"\u7248\u672C"},{dataIndex:"labels",title:"\u5206\u7EC4"},{dataIndex:"workspace",title:"\u5DE5\u4F5C\u76EE\u5F55"},{dataIndex:"hostname",title:"\u4E3B\u673A\u540D"},{dataIndex:"agent_id",title:"ID"}],qt=function(t,l,a){return console.log("v",t),console.log("r",l),_jsxs(Space,{children:[_jsx("div",{className:styles.circle,style:{backgroundColor:{free:"var(--success-color)",busy:"var(--warning-color)",lock:"var(--danger-color)"}[t]||"#bfbfbf"}}),t==="free"&&"\u7A7A\u95F2",t==="busy"&&"\u5FD9\u788C",t==="offline"&&"\u79BB\u7EBF",t==="lock"&&"\u5360\u7528",t==="maintain"&&"\u7EF4\u62A4",(a==null?void 0:a.showTip)&&_jsx(StatusTip,{bizId:a==null?void 0:a.bizId,data:l})]})},lt=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"sort",l={sort:{order_type:"custom"},label:{order_by:"name",order:"ascend",order_type:"normal"},time_descend:{order_by:"create_time",order:"descend",order_type:"normal"},time_ascend:{order_by:"create_time",order:"ascend",order_type:"normal"}};return l[t]||l.sort},yt=e(14443),Et=e(82715),Tt=e(56247),bt=e(66130),Dt=e(40506),Ft=function(t){var l,a,g,P,R=t.drawerData,v=t.formData,_=t.onVisibleChange,T=t.onSubmit,X=Ye.Z.useForm(),z=s()(X,1),G=z[0],H=(0,i.useState)([]),b=s()(H,2),te=b[0],J=b[1],D=(0,i.useState)(""),Q=s()(D,2),Z=Q[0],se=Q[1],V=(0,ce.Z)(Z,{wait:300}),Re=(0,M.useModel)("@@initialState"),fe=Re.initialState,Se=(0,i.useState)([]),ge=s()(Se,2),ne=ge[0],pe=ge[1],xe=(fe==null||(l=fe.bizListData)===null||l===void 0||(l=l.data)===null||l===void 0?void 0:l.filter(function(o){return o.biz_id!=="500"}))||[],N=(a=fe==null?void 0:fe.currentBizId)!==null&&a!==void 0?a:"",Ie=(v==null||(g=v.biz_ids)===null||g===void 0?void 0:g.length)>0?v==null?void 0:v.biz_ids.map(function(o){return String(o)}):xe.map(function(o){return String(o.biz_id)}),Oe=(0,i.useState)([]),je=s()(Oe,2),ze=je[0],ue=je[1],Le=(v==null||(P=v.flow_ids)===null||P===void 0?void 0:P.length)>0?v==null?void 0:v.flow_ids.map(function(o){return String(o)}):void 0,ye=(0,M.useRequest)(function(){return wt({page_number:1,page_size:1e3,filter_map:{tenantid:Ie,id:Le||[null]}})},{manual:!0,formatResult:function(c){return c.data.items}}),Ee=ye.run,Te=[{title:"ID",dataIndex:"id",width:40},{title:"\u540D\u79F0",dataIndex:"flow_name",width:220,sorter:function(c,C){return c.flow_name.localeCompare(C.flow_name)},render:function(c){return(0,n.jsx)(L.Z.Text,{children:c})}},{title:"\u53D1\u5E03ID",dataIndex:"flow_version_id",width:40},{title:"\u7C7B\u578B",dataIndex:"flow_type",width:60,sorter:function(c,C){return c.flow_type.localeCompare(C.flow_type)}},{title:"\u4E1A\u52A1",dataIndex:"resource_group",width:100,filters:xe.map(function(o){return{text:o.biz_cn_name,value:o.biz_id}}),filterMode:"menu",defaultFilteredValue:Ie,filterResetToDefaultFilteredValue:!0},{title:"\u66F4\u65B0\u4EBA",dataIndex:"reviser",width:80,sorter:function(c,C){return c.reviser.localeCompare(C.reviser)}},{title:"\u66F4\u65B0\u65F6\u95F4",dataIndex:"update_time",width:120}];(0,i.useEffect)(function(){if(R.show)if(v){var o;G.setFieldsValue(v),v.flow_ids&&Ee().then(function(c){var C=c||[];J(C.map(function(E){return String(E.id)})),pe(C)}),((o=v.biz_ids)===null||o===void 0?void 0:o.length)>0?ue(v.biz_ids.map(function(c){return String(c)})):ue([N])}else G.resetFields(),J([]),pe([]),se(""),ue(xe.map(function(c){return String(c.biz_id)}))},[R.show,v]),(0,i.useEffect)(function(){R.show&&G.setFieldValue("flow_ids",ne.map(function(o){return String(o.id)}))},[ne,R.show]);var Ze=function(){var o=it()(Ne()().mark(function c(C){var E;return Ne()().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:return K.prev=0,E=h()(h()({},C),{},{id:v==null?void 0:v.id,biz_ids:ne.map(function(B){return B.tenantid})}),T(E,R.action),K.abrupt("return",!0);case 6:return K.prev=6,K.t0=K.catch(0),K.abrupt("return",!1);case 9:case"end":return K.stop()}},c,null,[[0,6]])}));return function(C){return o.apply(this,arguments)}}();return(0,n.jsxs)(yt.a,{title:R.title,width:"80%",form:G,open:R.show,layout:"horizontal",labelCol:{flex:"120px"},onOpenChange:_,onFinish:Ze,drawerProps:{maskClosable:!1,destroyOnClose:!0},children:[(0,n.jsx)(Et.Z,{name:"name",label:"\u6807\u7B7E\u540D\u79F0",rules:[{required:!0,message:"\u6807\u7B7E\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"}],fieldProps:{maxLength:12}}),(0,n.jsx)(Tt.Z,{name:"description",label:"\u5907\u6CE8",rules:[{required:!0,message:"\u5907\u6CE8\u4E0D\u80FD\u4E3A\u7A7A"}],fieldProps:{rows:3,maxLength:128,placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8"}}),(0,n.jsx)(bt.Z,{name:"flow_ids",label:"\u6D41\u7A0B\u9009\u62E9",mode:"multiple",fieldProps:{open:!1,options:ne.map(function(o){return{label:o.flow_name,value:String(o.id)}}),placeholder:"\u8BF7\u5728\u8868\u683C\u4E2D\u9009\u62E9\u6D41\u7A0B",onChange:function(c){var C=ne.filter(function(E){return c.includes(String(E.id))});pe(C),J(c)}}}),(0,n.jsx)(Dt.Z,{}),(0,n.jsx)(me.Z,{rowKey:function(c){return String(c.id)},columns:Te,params:{searchValue:V},request:Ct({filter_map:{tenantid:ze}}),onChange:function(c,C){var E=C.resource_group;ue(E!=null&&E.length?E:[])},search:!1,rowSelection:{selectedRowKeys:te,preserveSelectedRowKeys:!0,onChange:function(c,C){var E=c.map(function(B){return String(B)});J(E);var de=ve()(ne),K=te.filter(function(B){return!E.includes(B)});K.forEach(function(B){var Ce=de.findIndex(function(Ae){return String(Ae.id)===B});Ce!==-1&&de.splice(Ce,1)}),C.forEach(function(B){B&&B.id&&!de.find(function(Ce){return String(Ce.id)===String(B.id)})&&de.push(B)}),pe(de)}},pagination:{defaultPageSize:10,showSizeChanger:!0},options:!1,toolbar:{title:(0,n.jsx)(y.Z,{align:"center",gap:"middle",children:(0,n.jsx)(A.Z,{prefix:(0,n.jsx)(Y.Z,{}),style:{width:350},placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0\u3001\u8BF4\u660E\u3001\u7C7B\u578B\u3001\u4E1A\u52A1\u6216\u66F4\u65B0\u4EBA\u641C\u7D22",allowClear:!0,value:Z,onChange:function(c){return se(c.target.value)}})})}})]})},It=Ft,qe={container:"tokllxAylicHYPhy3Zgb",title:"gMschMN_oMVajUC4wFGk","tree-title":"K9Lwy6YaMNsTg82tpmeU",treeTitle:"K9Lwy6YaMNsTg82tpmeU","collapse-icon":"_Mt8xoL2bHQxIzSQY35_",collapseIcon:"_Mt8xoL2bHQxIzSQY35_"},st=function(t,l){for(var a=t,g=1;g<l.length;g++){var P;a=a[l[g]],g!==l.length-1&&(a=((P=a)===null||P===void 0?void 0:P.children)||[])}return a},ut=function(t){return(0,n.jsx)("div",{onClick:function(a){a.stopPropagation()},children:(0,n.jsx)(mt.Z,{items:t,trigger:"hover",children:(0,n.jsx)("div",{children:(0,n.jsx)(ct.Z,{})})})})},Ot=function(t){var l,a=t.collapsed,g=t.onCollapseChange,P=t.bizId,R=t.refreshTagList,v=t.runTagList,_=t.tagList,T=t.tagId,X=t.onTagIdChange,z=t.runFlowList,G=(0,M.useModel)("@@initialState"),H=G.initialState,b=(l=H==null?void 0:H.currentBizId)!==null&&l!==void 0?l:"",te=S.ZP.useMessage(),J=s()(te,2),D=J[0],Q=J[1],Z=(0,i.useState)(""),se=s()(Z,2),V=se[0],Re=se[1],fe=(0,i.useState)([]),Se=s()(fe,2),ge=Se[0],ne=Se[1],pe=(0,le.Z)("tag_order_type",{defaultValue:"sort"}),xe=s()(pe,2),N=xe[0],Ie=xe[1],Oe=(0,i.useState)(!1),je=s()(Oe,2),ze=je[0],ue=je[1],Le=(0,i.useState)(null),ye=s()(Le,2),Ee=ye[0],Te=ye[1],Ze=N==="sort",o=function(){var p=it()(Ne()().mark(function f(m){var W;return Ne()().wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return W=m||N||"sort",q.next=3,v(lt(W));case 3:z();case 4:case"end":return q.stop()}},f)}));return function(m){return p.apply(this,arguments)}}(),c=(0,Ke.j)(St,"update","POST",void 0,D,function(){o(N||"sort")}),C=c.runOpt,E=(0,Ke.j)(Je,"create","POST",void 0,D,function(){o(N||"sort")}),de=E.runOpt,K=(0,Ke.j)(Je,"update","PUT",void 0,D,function(){o(N||"sort")}),B=K.runOpt,Ce=(0,Ke.j)(Je,"delete","DELETE",void 0,D,function(){o(N||"sort")}),Ae=Ce.runOpt;(0,i.useEffect)(function(){ne((_==null?void 0:_.map(function(p){return h()(h()({},p),{},{title:p.name,key:p.id,label_uuids:p.id})}))||[])},[_]);var et=function(f){return[{title:(0,n.jsxs)(y.Z,{justify:"space-between",className:qe.treeTitle,children:[(0,n.jsx)("span",{children:"\u5168\u90E8\u6D41\u7A0B"}),ut([{key:"add",label:(0,n.jsx)("div",{onClick:function(){Te(null),ue(!0)},children:"\u65B0\u5EFA\u6807\u7B7E"})},{key:"sort",label:(0,n.jsx)(ft.Z,{modalRender:function(W){return(0,n.jsx)(ht,{defaultOrder:N!=null?N:"sort",onOrderChange:Ie,onCancel:W,refresh:o})},children:"\u6807\u7B7E\u6392\u5E8F"})}])]}),key:"all",children:(f==null?void 0:f.map(function(m){return{title:(0,n.jsxs)(y.Z,{justify:"space-between",style:{width:"100%"},children:[(m==null?void 0:m.title)||"",ut([{key:"edit",label:(0,n.jsx)("span",{onClick:function(){Te(m),ue(!0)},children:"\u7F16\u8F91\u6807\u7B7E"})},{key:"sort",label:(0,n.jsx)("span",{onClick:function(){ot.Z.confirm({title:"\u5220\u9664\u6807\u7B7E",content:"\u786E\u8BA4\u5220\u9664\u6807\u7B7E\u3010".concat(m.title,"\u3011\uFF1F\u5220\u9664\u64CD\u4F5C\u4E0D\u53EF\u6062\u590D"),onOk:function(){Ae({id:Number(m.key)})}})},children:"\u5220\u9664\u6807\u7B7E"})}])]}),key:"".concat(m.key),isLeaf:!0}}))||[]}]},$e=(0,i.useMemo)(function(){return ge?ge.map(function(p){return h()(h()({},p),{},{title:p.title,key:p.key})}).filter(function(p){return V===""?!0:(p==null?void 0:p.title).toLowerCase().indexOf(V.toLowerCase())>-1}):[]},[V,ge]),tt=function(f){var m,W,F=f.dragNode.pos.split("-").map(Number),q=f.node.pos.split("-").map(Number),ke=f.dropPosition-q[q.length-1];console.log("\u539F\u59CB\uFF1A",F,q,f.dropToGap,ke);var $=ve()(q);if(q.length===2)$.length>=F.length&&$>F&&($[F.length-1]=Math.max($[F.length-1]-1,0)),$.push(0);else if(ke!==-1){var I=ve()(F),Ve=ve()(q),nt=I.pop(),rt=Ve.pop();if(I.join("-")===Ve.join("-")&&rt<nt||I.join("-")!==Ve.join("-")){var at=$.pop();$.push(at+1)}}console.log("\u4FEE\u6B63",F,$);var Pe=[{title:"all",key:"all",children:ve()(ge)}],Xe=st(Pe,F.slice(0,-1)),r=(Xe.children||Xe).splice(F[F.length-1],1)[0],u=st(Pe,$.slice(0,-1)),x=(m=u.children||u)===null||m===void 0||(W=m.splice)===null||W===void 0?void 0:W.call(m,$[$.length-1],0,r);x||(u.children=[r]),C({ids:Pe[0].children.map(function(be,Ge){return Number(be.key)})}),ne(Pe[0].children)},Ue=function(f,m){console.log("values",f,m),m==="post"?de(f):m==="put"&&B(f)};return(0,n.jsxs)("div",{className:qe.container,children:[Q,(0,n.jsx)("div",{className:qe.title,children:(0,n.jsx)(y.Z,{children:(0,n.jsx)(A.Z,{allowClear:!0,placeholder:"\u641C\u7D22\u6807\u7B7E",style:{flex:1},suffix:(0,n.jsx)(Y.Z,{style:{color:"#918f8f"}}),onChange:function(f){Re(f.target.value)}})})}),(0,n.jsx)(vt.Z,{style:{height:"calc(100vh - 190px)",overflowY:"auto"},draggable:function(f){return Ze&&f.key!=="all"},allowDrop:function(f){var m=f.dropPosition,W=f.dropNode;return!0},defaultExpandAll:!0,multiple:!0,selectedKeys:T!=null&&T.length&&T[0]!==""?T:["all"],onSelect:function(f,m){if(m.node.key==="all")X([""]);else{var W=f.filter(function(F){return F!=="all"});X(W)}},treeData:et($e),expandedKeys:["all"],onDrop:tt}),(0,n.jsx)(It,{drawerData:{show:ze,title:Ee?"\u7F16\u8F91\u5E38\u7528\u6D41\u7A0B\u6807\u7B7E":"\u65B0\u589E\u5E38\u7528\u6D41\u7A0B\u6807\u7B7E",action:Ee?"put":"post"},formData:Ee,onVisibleChange:function(f){ue(f)},onSubmit:Ue})]})},Lt=Ot,At=e(37904),Pt=function(){var t=(0,At.Z)({tagId:"",tenantid:"",tenant:""}),l=s()(t,2),a=l[0],g=a.tagId,P=a.tenantid,R=l[1],v=(0,le.Z)("tag_order_type",{defaultValue:"sort"}),_=s()(v,1),T=_[0],X=(0,i.useMemo)(function(){return g?g.split(","):[]},[g]),z=(0,M.useRequest)(function(Q){return xt(h()(h()({page_number:1,page_size:1e3},lt(T)),Q))},{formatResult:function(Z){var se;return Z==null||(se=Z.data)===null||se===void 0?void 0:se.items}}),G=z.data,H=G===void 0?[]:G,b=z.refresh,te=z.run,J=(0,i.useMemo)(function(){return H==null?void 0:H.filter(function(Q){return X.includes("".concat(Q.id))})},[H,X]),D=function(Z){R({tagId:Z.join(",")})};return{tagList:H,tagId:X,refreshTagList:b,runTagList:te,selectedTags:J,setTagId:D}},_t=function(){var t,l,a=(0,M.useModel)("@@initialState"),g=a.initialState,P=(t=g==null?void 0:g.currentBizId)!==null&&t!==void 0?t:"",R=S.ZP.useMessage(),v=s()(R,2),_=v[1],T=(0,i.useState)(!1),X=s()(T,2),z=X[0],G=X[1],H=(0,le.Z)("build-machine-management-drag-size"),b=s()(H,2),te=b[0],J=b[1],D=Pt(),Q=D.tagList,Z=D.tagId,se=D.refreshTagList,V=D.selectedTags,Re=D.setTagId,fe=D.runTagList,Se=(0,i.useRef)(),ge=(0,i.useState)(""),ne=s()(ge,2),pe=ne[0],xe=ne[1],N=(0,ce.Z)(pe,{wait:300}),Ie=(0,i.useState)(!1),Oe=s()(Ie,2),je=Oe[0],ze=Oe[1],ue=(0,i.useRef)(null),Le=(0,i.useState)(!1),ye=s()(Le,2),Ee=ye[0],Te=ye[1],Ze=(0,i.useState)(""),o=s()(Ze,2),c=o[0],C=o[1],E=(0,i.useState)("1"),de=s()(E,2),K=de[0],B=de[1],Ce=(0,i.useState)(!1),Ae=s()(Ce,2),et=Ae[0],$e=Ae[1],tt=(0,i.useState)(null),Ue=s()(tt,2),p=Ue[0],f=Ue[1],m=(0,M.useRequest)(function(r,u){return(0,he.lZ)({filter_map:{id:r}},{tenantid:u.biz_id,tenant:u.biz_name})},{manual:!0,onSuccess:function(u){if(u!=null&&u[0]){var x=u[0];C(x.flow_xml),B(x.flow_xml_version)}},onError:function(){S.ZP.error("\u83B7\u53D6\u6D41\u7A0B\u7248\u672C\u5931\u8D25")}}),W=m.run;(0,i.useEffect)(function(){var r=ue.current;r&&ze(r.scrollWidth>r.clientWidth)},[V]);var F=(g==null||(l=g.bizListData)===null||l===void 0||(l=l.data)===null||l===void 0?void 0:l.filter(function(r){return r.biz_id!=="500"}))||[],q=(0,Be.OV)({small:100,wide:90}),ke=q.width,$=(0,M.useRequest)(function(){return jt({tag_ids:JSON.stringify(Z.length>0?Z.map(function(r){return Number(r)}):Q.map(function(r){return Number(r.id)})),biz_ids:JSON.stringify(F.map(function(r){return Number(r.biz_id)}))})},{refreshDeps:[Z,JSON.stringify(Q.map(function(r){return r.id})),JSON.stringify(F.map(function(r){return r.biz_id}))]}),I=$.data,Ve=$.loading,nt=$.run,rt=(0,i.useMemo)(function(){return I!=null&&I.items?I.items.filter(function(r){var u,x,be,Ge;if(!N)return!0;var He=N.toLowerCase();return((u=r.name)===null||u===void 0?void 0:u.toLowerCase().includes(He))||((x=r.description)===null||x===void 0?void 0:x.toLowerCase().includes(He))||((be=r.biz_name)===null||be===void 0?void 0:be.toLowerCase().includes(He))||((Ge=r.update_by)===null||Ge===void 0?void 0:Ge.toLowerCase().includes(He))}):[]},[I==null?void 0:I.items,N]),at=(0,i.useMemo)(function(){var r,u=(I==null||(r=I.items)===null||r===void 0?void 0:r.map(function(x){return x.biz_name}))||[];return Array.from(new Set(u))},[I==null?void 0:I.items]),Pe=function(u){f(h()(h()({},u),{},{flow_name:u.name,flow_version_id:u.flow_version_id})),Te(!0)},Xe=[{title:"ID",dataIndex:"id",fixed:"left",width:40},{title:"\u540D\u79F0",dataIndex:"name",width:150,fixed:"left",render:function(u,x){return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(y.Z,{vertical:!0,gap:1,children:[(0,n.jsx)(L.Z.Text,{children:u}),(0,n.jsx)(U.Z,{title:x.description,placement:"topLeft",children:(0,n.jsx)(L.Z.Text,{className:We.ellipsisText,type:"secondary",style:{cursor:"pointer"},children:x.description})})]})})}},{title:"\u4E1A\u52A1",dataIndex:"biz_name",width:100,filters:at.map(function(r){return{text:r,value:r}}),onFilter:function(u,x){return x.biz_name===u}},{title:"\u6807\u7B7E",dataIndex:"tag_names",width:120,render:function(u,x){return(0,n.jsx)(we.lx,{tags:x.tag_names,lineClamp:1})}},{title:"\u66F4\u65B0\u4EBA",dataIndex:"update_by",width:80},{title:"\u66F4\u65B0\u65F6\u95F4",dataIndex:"update_time",width:120},{title:"\u64CD\u4F5C",dataIndex:"option",valueType:"option",width:ke,fixed:"right",render:function(u,x){return[(0,n.jsx)(L.Z.Link,{onClick:function(){return Pe(x)},disabled:!x.flow_version_id,children:"\u89E6\u53D1\u4EFB\u52A1"},"triggerTask"),(0,n.jsx)(L.Z.Link,{onClick:function(){$e(!0),W(x.flow_version_id,x)},disabled:!x.flow_version_id,children:"\u9884\u89C8"},"export")]}}];return(0,n.jsxs)(O.Z,{extra:(0,n.jsx)(we.er,{disabled:!0}),children:[_,(0,n.jsx)("div",{className:oe()(We.container,z&&We.collapsed),children:(0,n.jsxs)(w.Z,{split:"vertical",minSize:300,maxSize:500,onDragFinished:J,size:te,children:[(0,n.jsx)(Lt,{collapsed:z,onCollapseChange:G,bizId:P,refreshTagList:se,runTagList:fe,tagList:Q,tagId:Z,onTagIdChange:Re,runFlowList:nt}),(0,n.jsxs)("div",{children:[(0,n.jsx)(ie.Z,{className:We.title,children:(0,n.jsx)(U.Z,{title:je?(V==null?void 0:V.length)>0?V.map(function(r){return r.name}).join("\u3001"):"\u5168\u90E8":"",children:(0,n.jsxs)("span",{style:{display:"flex",alignItems:"center"},children:[(0,n.jsx)("span",{children:"\u3010"}),(0,n.jsx)("span",{ref:ue,style:{maxWidth:600,display:"inline-block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:(V==null?void 0:V.length)>0?V.map(function(r){return r.name}).join("\u3001"):"\u5168\u90E8"}),(0,n.jsx)("span",{children:"\u3011\u6D41\u7A0B"})]})})}),(0,n.jsx)(me.Z,{actionRef:Se,rowKey:"id",search:!1,loading:Ve,dataSource:rt,size:"small",columns:Xe,scroll:{x:1100,y:"calc(100vh - 330px)"},pagination:{defaultPageSize:10,showSizeChanger:!0},cardProps:{bodyStyle:{padding:"0 20px 0"}},toolbar:{search:(0,n.jsx)(A.Z,{prefix:(0,n.jsx)(Y.Z,{}),style:{width:400},placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0\u3001\u8BF4\u660E\u3001\u7C7B\u578B\u3001\u4E1A\u52A1\u6216\u66F4\u65B0\u4EBA\u641C\u7D22",allowClear:!0,value:pe,onChange:function(u){return xe(u.target.value)}})}})]})]})}),(0,n.jsx)(Me.K,{actionRef:Se,record:p,open:Ee,onOpenChange:Te,onSuccess:function(){var u;(u=Se.current)===null||u===void 0||u.reload()}}),(0,n.jsx)(De.Z,{open:et,onClose:function(){$e(!1),C("")},currentFlowXml:c,currentFlowXmlVersion:K})]})},Bt=_t},60594:function(_e,ee,e){e.d(ee,{Z:function(){return U}});var re=e(90228),h=e.n(re),ae=e(87999),s=e.n(ae),O=e(59906),Y=e(54306),M=e(77899),S=e(75271),y=e(52676),L=function(A){var k=A.flowXml,oe=A.flow_xml_version,i=(0,S.useRef)(null),w=(0,S.useRef)(null),we=oe==="1"?O.g:Y.g,Be=function(){if(w.current){var me=w.current.get("canvas"),le=w.current.get("elementRegistry").getAll();le.forEach(function(ce){var j=ce.businessObject.id,ve=ce.businessObject.$attrs,Qe=ce.businessObject.$type;ve.run_state&&Qe in M.iL&&me.addMarker(j,"highlight-"+ve.run_state)})}},Me=function(){if(w.current){var me=w.current.get("eventBus");me.on("element.click",function(le){var ce=le.element.businessObject.$type,j=le.element.businessObject.id,ve=w.current.get("elementRegistry").get(j).businessObject.sourceRef;ce in M.H2&&console.log("Element clicked:",{eleType:ce,eleID:j,parentNode:ve})})}},De=function(){var he=s()(h()().mark(function me(le){return h()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(w.current){j.next=2;break}return j.abrupt("return");case 2:return j.prev=2,j.next=5,w.current.importXML(le);case 5:w.current.get("canvas").zoom(.9),Be(),window.screen.availWidth<1599&&w.current.get("canvas").zoom(.7),Me(),j.next=14;break;case 11:j.prev=11,j.t0=j.catch(2),console.error("Error importing XML:",j.t0);case 14:case"end":return j.stop()}},me,null,[[2,11]])}));return function(le){return he.apply(this,arguments)}}();return(0,S.useEffect)(function(){if(i.current)return w.current=new we({container:i.current}),k&&De(k),function(){w.current&&w.current.destroy()}},[]),(0,S.useEffect)(function(){k&&De(k)},[k]),(0,y.jsx)("div",{className:"containers-v".concat(oe),style:{width:"100%",height:"calc(100vh - 225px)",overflow:"auto",background:"white",backgroundImage:"linear-gradient(90deg, rgba(220, 220, 220, 0.5) 6%, transparent 0), linear-gradient(rgba(192, 192, 192, 0.5) 6%, transparent 0)",backgroundSize:"12px 12px",WebkitTapHighlightColor:"rgba(255, 255, 255, 0)"},children:(0,y.jsx)("div",{ref:i,className:"showcanvas",style:{width:"100%",height:"100%"}})})},U=L},31662:function(_e,ee,e){var re=e(60594),h=e(49657),ae=e(41901),s=e(75271),O=e(52676),Y=function(S){var y=S.open,L=S.onClose,U=S.title,ie=U===void 0?"\u67E5\u770B\u6D41\u7A0B\u56FE":U,A=S.currentFlowXml,k=S.currentFlowXmlVersion,oe=function(){L()};return(0,O.jsx)(h.Z,{title:ie,width:"75%",style:{minWidth:"1200px"},open:y,onClose:oe,destroyOnClose:!0,footer:(0,O.jsx)("div",{style:{textAlign:"right"},children:(0,O.jsx)(ae.ZP,{type:"primary",onClick:oe,children:"\u786E\u5B9A"})}),children:A&&(0,O.jsx)(re.Z,{flowXml:A,flow_xml_version:k})})};ee.Z=Y}}]);
