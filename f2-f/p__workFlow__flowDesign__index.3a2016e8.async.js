"use strict";(self.webpackChunkf2=self.webpackChunkf2||[]).push([[9801],{38419:function(De,F,e){var z=e(90228),y=e.n(z),U=e(87999),c=e.n(U),V=e(99503),g=e(84297),W=e(41901),f=e(75271),O=e(52676),P=function(v){var D=v.changeFlowDesign,N=v.selectedRowsState,B=v.modalTitle,G=B===void 0?"\u6279\u91CF\u66F4\u6539\u4E1A\u52A1":B,S=v.buttonText,H=S===void 0?"\u6279\u91CF\u66F4\u6539\u4E1A\u52A1":S,R=v.buttonType,I=R===void 0?"primary":R,u=v.onSuccess,Y=v.trigger,A=v.selectListKey,J=A===void 0?"select_list":A;return(0,O.jsx)(g.Y,{width:400,title:G,layout:"horizontal",trigger:Y||(0,O.jsx)(W.ZP,{type:I,children:H}),autoFocusFirstInput:!0,modalProps:{destroyOnClose:!0,onCancel:function(){return console.log("run")}},submitTimeout:2e3,onFinish:function(){var Z=c()(y()().mark(function L(Q){var T;return y()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return T={tenantid:Q.tenantid},T[J]=N.map(function(k){return String(k.id)}),C.next=4,D(T);case 4:return u==null||u(),C.abrupt("return",!0);case 6:case"end":return C.stop()}},L)}));return function(L){return Z.apply(this,arguments)}}(),children:(0,O.jsx)(V.er,{syncUrlParams:!1,showDefaultValue:!1,label:"\u6D41\u7A0B\u6240\u5C5E\u7684\u4E1A\u52A1"})},"clone")};F.Z=P},17477:function(De,F,e){e.r(F),e.d(F,{default:function(){return Re}});var z=e(26068),y=e.n(z),U=e(90228),c=e.n(U),V=e(87999),g=e.n(V),W=e(48305),f=e.n(W),O=e(53649),P=e.n(O),ne=e(38419),v=e(67254),D=e(78474),N=e(30168),B=e(41578),G=e(23261),S=e(54388),H=e(19048),R=e(65496),I=e(98037),u=e(75271),Y={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM653.3 424.6l52.2 52.2a8.01 8.01 0 01-4.7 13.6l-179.4 21c-5.1.6-9.5-3.7-8.9-8.9l21-179.4c.8-6.6 8.9-9.4 13.6-4.7l52.4 52.4 256.2-256.2c3.1-3.1 8.2-3.1 11.3 0l42.4 42.4c3.1 3.1 3.1 8.2 0 11.3L653.3 424.6z"}}]},name:"import",theme:"outlined"},A=Y,J=e(17002),Z=function(h,i){return u.createElement(J.Z,(0,I.Z)((0,I.Z)({},h),{},{ref:i,icon:A}))},L=u.forwardRef(Z),Q=L,T=e(84297),X=e(82715),C=e(90254),k=e(66130),Te=e(37665),E=e(87300),we=e(80921),w=e(38902),q=e(50876),ae=e(79474),xe=e(64085),ye=e(67870),Oe=e(84249),Ee=e(41901),je=e(30955),Fe=e(88230),x=e(84286),n=e(52676),re,le,Pe=(0,Fe.kc)(function(M){var h=M.css,i=M.token;return{ellipsisText:h(re||(re=P()([`
    overflow: hidden;
    text-overflow: ellipsis;
    display: inline-block;
    white-space: nowrap;
  `]))),pageContainer:{"& .ant-page-header-heading-extra":h(le||(le=P()([`
      position: absolute;
      top: 17px;
      right: 44px;
    `])))},settingItem:{marginBlock:0,marginInline:4,color:i.colorIconHover,fontSize:i.fontSizeLG,cursor:"pointer","> span":{display:"block",width:"100%",height:"100%"},"&:hover":{color:i.colorPrimary}}}}),Be=function(){var h,i=(0,u.useRef)(),Ie=Pe(),se=Ie.styles,_=(0,u.useRef)(),Ae=(0,u.useState)([]),oe=f()(Ae,2),Ze=oe[0],Le=oe[1],Me=(0,u.useState)([]),ue=f()(Me,2),b=ue[0],be=ue[1],$e=(0,u.useState)(""),ie=f()($e,2),de=ie[0],Ke=ie[1],ze=(0,Te.Z)(de,{wait:300}),Ue=(0,S.useSearchParams)(),Ve=f()(Ue,1),We=Ve[0],Ne=(0,S.useModel)("@@initialState"),ee=Ne.initialState,Ge=(h=ee==null?void 0:ee.currentBizId)!==null&&h!==void 0?h:"",j=Ge==="500",He=E.ZP.useMessage(),ce=f()(He,2),$=ce[0],Ye=ce[1],Je=(0,u.useState)(""),fe=f()(Je,2),Qe=fe[0],Xe=fe[1],ke=(0,u.useState)(),ve=f()(ke,2),qe=ve[0],_e=ve[1],et=(0,u.useState)(!1),me=f()(et,2),tt=me[0],pe=me[1],nt=(0,u.useState)(null),he=f()(nt,2),at=he[0],rt=he[1],lt=(0,D.j)(x.xE,"clone","POST",i,$),ge=lt.runOpt,st=(0,D.j)(x.xE,"change","PATCH",i,$),ot=st.runOpt,Se=(0,D.j)(x.xE,"delete","DELETE",i,$),ut=Se.runOpt,it=Se.loading,dt=(0,D.j)(x.xE,"upload","POST",i,$),ct=dt.runOpt,ft=function(){var l=g()(c()().mark(function a(){var t,s,r;return c()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,(0,x.g9)({is_template:"yes"});case 3:s=o.sent,r=(s==null||(t=s.data)===null||t===void 0?void 0:t.map(function(d){return{label:d.flow_name,value:d.id}}))||[],Le(r),r.length>0&&_.current&&setTimeout(function(){var d;(d=_.current)===null||d===void 0||d.setFieldsValue({flowTemplate:r[0].value})},0),o.next=12;break;case 9:o.prev=9,o.t0=o.catch(0),console.error("\u52A0\u8F7D\u6D41\u7A0B\u6A21\u677F\u5931\u8D25:",o.t0);case 12:case"end":return o.stop()}},a,null,[[0,9]])}));return function(){return l.apply(this,arguments)}}(),vt=function(a){rt(a),pe(!0)},mt={name:"file",customRequest:function(){var l=g()(c()().mark(function t(s){var r,m,o;return c()().wrap(function(te){for(;;)switch(te.prev=te.next){case 0:r=s.file,m=s.onError;try{o=new FileReader,o.readAsText(r),o.onload=g()(c()().mark(function K(){var Ce;return c()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return Ce=o.result,p.prev=1,p.next=4,ct({import_data:Ce});case 4:p.next=9;break;case 6:p.prev=6,p.t0=p.catch(1),E.ZP.error("".concat(r.name," file upload failed"));case 9:case"end":return p.stop()}},K,null,[[1,6]])})),o.onerror=function(K){E.ZP.error("".concat(r.name," file read failed")),m==null||m(K)}}catch(K){E.ZP.error("".concat(r.name," file upload failed"))}case 2:case"end":return te.stop()}},t)}));function a(t){return l.apply(this,arguments)}return a}(),showUploadList:!1},pt=(0,N.ZP)({small:160,wide:120}),ht=pt.width;(0,u.useEffect)(function(){var l;(l=i.current)===null||l===void 0||l.reload()},[We]);var gt=[{title:"ID",dataIndex:"id",fixed:"left",width:40,sorter:!0},{title:"\u540D\u79F0",dataIndex:"flow_name",width:220,sorter:function(a,t){return a.flow_name.localeCompare(t.flow_name)},fixed:"left",render:function(a,t){return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(we.Z,{vertical:!0,gap:1,onClick:function(){j||S.history.push("/workFlow/flowDesign/".concat(t.flow_name))},children:[(0,n.jsx)(w.Z.Link,{disabled:j,children:a}),(0,n.jsx)(q.Z,{title:t.details,placement:"topLeft",children:(0,n.jsx)(w.Z.Text,{className:se.ellipsisText,type:"secondary",style:{cursor:"pointer"},children:t.details})})]})})}},{title:"\u53D1\u5E03ID",dataIndex:"flow_version_id",fixed:"left",width:60},{title:"\u7C7B\u578B",dataIndex:"flow_type",width:60,sorter:function(a,t){return a.flow_type.localeCompare(t.flow_type)}},{title:"\u5168\u5C40\u8282\u70B9",dataIndex:"is_global_node",width:80,render:function(a){return a==="yes"?(0,n.jsx)(ae.Z,{status:"success",text:"\u542F\u7528"}):(0,n.jsx)(ae.Z,{status:"error",text:"\u7981\u7528"})}},{title:"\u4E1A\u52A1",dataIndex:"resource_group",width:100},{title:"\u66F4\u65B0\u4EBA",dataIndex:"reviser",width:80,sorter:function(a,t){return a.reviser.localeCompare(t.reviser)}},{title:"\u66F4\u65B0\u65F6\u95F4",dataIndex:"update_time",width:120},{title:"\u64CD\u4F5C",dataIndex:"option",valueType:"option",width:ht,fixed:"right",render:function(a,t){return[(0,n.jsx)(q.Z,{title:t.flow_version_id?"":"\u8BF7\u5148\u53D1\u5E03\u6D41\u7A0B",children:(0,n.jsx)(w.Z.Link,{onClick:function(){return vt(t)},disabled:!t.flow_version_id,children:"\u89E6\u53D1\u4EFB\u52A1"})},"triggerTask"),(0,n.jsx)(T.Y,{width:600,title:"\u514B\u9686\u6D41\u7A0B\u2014".concat(t.flow_name),layout:"horizontal",trigger:(0,n.jsx)(w.Z.Link,{disabled:j,children:"\u514B\u9686"}),autoFocusFirstInput:!0,modalProps:{destroyOnClose:!0,onCancel:function(){return console.log("run")}},submitTimeout:2e3,onFinish:function(){var s=g()(c()().mark(function r(m){return c()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,ge({flow_name:m.flow_name,id:t.id});case 2:return d.abrupt("return",!0);case 3:case"end":return d.stop()}},r)}));return function(r){return s.apply(this,arguments)}}(),children:(0,n.jsx)(X.Z,{name:"flow_name",label:"\u6D41\u7A0B\u540D\u79F0",tooltip:"\u6D41\u7A0B\u540D\u79F0\u662F\u552F\u4E00\u503C\uFF0C\u4E0D\u80FD\u91CD\u590D",rules:[{required:!0,message:"\u65B0\u6D41\u7A0B\u7684\u540D\u5B57\u4E0D\u80FD\u4E3A\u7A7A!"}],fieldProps:{maxLength:75}})},"clone"),(0,n.jsx)(w.Z.Link,{onClick:function(){var r=t.flow_name+".json";(0,G.uf)(t,r)},children:"\u5BFC\u51FA"},"export"),(0,n.jsx)(xe.Z,{title:"\u5220\u9664\u6D41\u7A0B\u6A21\u677F",description:(0,n.jsxs)(n.Fragment,{children:["\u5220\u9664\u6D41\u7A0B\u6A21\u677F\u300A",t.flow_name,"\u300B\u4E4B\u540E\u65E0\u6CD5\u627E\u56DE\uFF0C\u8BF7\u8C28\u614E\u64CD\u4F5C\uFF01"]}),onConfirm:function(){ut({id:t.id})},okButtonProps:{loading:it},children:(0,n.jsx)(w.Z.Link,{type:"danger",children:"\u5220\u9664"})},"stop")]}}];return(0,n.jsxs)(v.Z,{ghost:!1,children:[Ye,(0,n.jsx)(C.Z,{actionRef:i,params:{searchValue:ze,order_by:Qe,order:qe},rowKey:"id",search:!1,request:(0,x.M0)(),columns:gt,onChange:function(a,t,s){var r=s.field,m=s.order;Xe(r),_e(m)},scroll:{x:1100},rowSelection:{onChange:function(a,t){be(t)}},tableAlertRender:function(a){var t=a.selectedRowKeys,s=a.onCleanSelected;return(0,n.jsx)(ye.Z,{size:24,children:(0,n.jsxs)("span",{children:["\u5DF2\u9009 ",t.length," \u9879",(0,n.jsx)("a",{style:{marginInlineStart:8},onClick:s,children:"\u53D6\u6D88\u9009\u62E9"})]})})},pagination:{defaultPageSize:10,showSizeChanger:!0},toolbar:{search:(0,n.jsx)(Oe.Z,{prefix:(0,n.jsx)(H.Z,{}),style:{width:400},placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0\u3001\u8BF4\u660E\u3001\u7C7B\u578B\u6216\u4E1A\u52A1\u641C\u7D22",allowClear:!0,value:de,onChange:function(a){return Ke(a.target.value)}}),actions:[(0,n.jsxs)(T.Y,{title:"\u521B\u5EFA\u6D41\u7A0B",formRef:_,trigger:(0,n.jsx)(Ee.ZP,{type:"primary",icon:(0,n.jsx)(R.Z,{}),disabled:j,children:"\u521B\u5EFA\u6D41\u7A0B"},"addFlowTemplate"),onVisibleChange:function(a){a&&ft()},onFinish:function(){var l=g()(c()().mark(function a(t){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,ge({flow_name:t.flowName,id:t.flowTemplate});case 3:return S.history.push("/workFlow/flowDesign/".concat(t.flowName)),r.abrupt("return",!0);case 7:r.prev=7,r.t0=r.catch(0),console.error("\u6DFB\u52A0\u5931\u8D25:",r.t0),E.ZP.error("\u6DFB\u52A0\u5931\u8D25");case 11:return r.abrupt("return",!1);case 12:case"end":return r.stop()}},a,null,[[0,7]])}));return function(a){return l.apply(this,arguments)}}(),children:[(0,n.jsx)(X.Z,{name:"flowName",label:"\u6D41\u7A0B\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6D41\u7A0B\u540D\u79F0"}],fieldProps:{maxLength:75}}),(0,n.jsx)(k.Z,{name:"flowTemplate",label:"\u6D41\u7A0B\u6A21\u677F",options:Ze,rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u6D41\u7A0B\u6A21\u677F"}],fieldProps:{showSearch:!0}})]},"addFlowTemplate"),(0,u.createElement)(je.Z,y()(y()({},mt),{},{key:"upload",className:se.settingItem}),(0,n.jsx)(q.Z,{title:"\u5BFC\u5165\u6A21\u677F",children:(0,n.jsx)("span",{children:(0,n.jsx)(Q,{disabled:j})})}))]},tableAlertOptionRender:function(a){var t=a.onCleanSelected;return(b==null?void 0:b.length)>0&&(0,n.jsx)(ne.Z,{changeFlowDesign:ot,selectedRowsState:b,onSuccess:function(){t()}})}}),(0,n.jsx)(B.K,{actionRef:i,record:at,open:tt,onOpenChange:pe,onSuccess:function(){var a;(a=i.current)===null||a===void 0||a.reload()}})]})},Re=Be}}]);
