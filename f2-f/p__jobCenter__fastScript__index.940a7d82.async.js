"use strict";(self.webpackChunkf2=self.webpackChunkf2||[]).push([[2047],{61487:function(W,M,u){var c=u(98037),o=u(58006),g=u(75271),E=u(34832),l=u(52676),P=["fieldProps","min","proFieldProps","max"],y=function(r,h){var T=r.fieldProps,f=r.min,v=r.proFieldProps,x=r.max,O=(0,o.Z)(r,P);return(0,l.jsx)(E.Z,(0,c.Z)({valueType:"digit",fieldProps:(0,c.Z)({min:f,max:x},T),ref:h,filedConfig:{defaultProps:{width:"100%"}},proFieldProps:v},O))},D=g.forwardRef(y);M.Z=D},82715:function(W,M,u){var c=u(99459),o=u(98037),g=u(58006),E=u(18542),l=u(44725),P=u(86432),y=u(71770),D=u(75271),m=u(34832),r=u(52676),h=["fieldProps","proFieldProps"],T=["fieldProps","proFieldProps"],f="text",v=function(t){var e=t.fieldProps,i=t.proFieldProps,B=(0,g.Z)(t,h);return(0,r.jsx)(m.Z,(0,o.Z)({valueType:f,fieldProps:e,filedConfig:{valueType:f},proFieldProps:i},B))},x=function(t){var e=(0,E.Z)(t.open||!1,{value:t.open,onChange:t.onOpenChange}),i=(0,c.Z)(e,2),B=i[0],I=i[1];return(0,r.jsx)(l.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(U){var j,R=U.getFieldValue(t.name||[]);return(0,r.jsx)(P.Z,(0,o.Z)((0,o.Z)({getPopupContainer:function(C){return C&&C.parentNode?C.parentNode:C},onOpenChange:function(C){return I(C)},content:(0,r.jsxs)("div",{style:{padding:"4px 0"},children:[(j=t.statusRender)===null||j===void 0?void 0:j.call(t,R),t.strengthText?(0,r.jsx)("div",{style:{marginTop:10},children:(0,r.jsx)("span",{children:t.strengthText})}):null]}),overlayStyle:{width:240},placement:"rightTop"},t.popoverProps),{},{open:B,children:t.children}))}})},O=function(t){var e=t.fieldProps,i=t.proFieldProps,B=(0,g.Z)(t,T),I=(0,D.useState)(!1),S=(0,c.Z)(I,2),U=S[0],j=S[1];return e!=null&&e.statusRender&&B.name?(0,r.jsx)(x,{name:B.name,statusRender:e==null?void 0:e.statusRender,popoverProps:e==null?void 0:e.popoverProps,strengthText:e==null?void 0:e.strengthText,open:U,onOpenChange:j,children:(0,r.jsx)("div",{children:(0,r.jsx)(m.Z,(0,o.Z)({valueType:"password",fieldProps:(0,o.Z)((0,o.Z)({},(0,y.Z)(e,["statusRender","popoverProps","strengthText"])),{},{onBlur:function(L){var C;e==null||(C=e.onBlur)===null||C===void 0||C.call(e,L),j(!1)},onClick:function(L){var C;e==null||(C=e.onClick)===null||C===void 0||C.call(e,L),j(!0)}}),proFieldProps:i,filedConfig:{valueType:f}},B))})}):(0,r.jsx)(m.Z,(0,o.Z)({valueType:"password",fieldProps:e,proFieldProps:i,filedConfig:{valueType:f}},B))},A=v;A.Password=O,A.displayName="ProFormComponent",M.Z=A},67254:function(W,M,u){var c=u(26068),o=u.n(c),g=u(67825),E=u.n(g),l=u(53649),P=u.n(l),y=u(99503),D=u(77777),m=u(88230),r=u(75271),h=u(52676),T=["children","extra","ghost","title"],f,v,x=(0,m.kc)(function(A){var F=A.css;return{pageContainer:{"& .ant-page-header-heading":F(f||(f=P()([`
      margin-bottom: -50px;
    `]))),"& .ant-page-header-heading-extra":F(v||(v=P()([`
      position: absolute;
      top: 17px;
      right: 20px;
    `])))}}}),O=function(F){var t=F.children,e=F.extra,i=e===void 0?(0,h.jsx)(y.er,{}):e,B=F.ghost,I=B===void 0?!1:B,S=F.title,U=S===void 0?!1:S,j=E()(F,T),R=x(),L=R.styles;return(0,h.jsx)(D._z,o()(o()({ghost:I,extra:i,className:L.pageContainer,title:U},j),{},{children:t}))};M.Z=O},78474:function(W,M,u){u.d(M,{j:function(){return g},t:function(){return E}});var c=u(54388),o=u(87300);function g(l,P,y,D,m,r){var h=m!=null?m:o.ZP,T=(0,c.useRequest)(l(P,y),{manual:!0,onSuccess:function(O){if(O.code!==0?h.error(O.msg):h.success(O.msg),r)r();else{var A;D==null||(A=D.current)===null||A===void 0||A.reload(!1)}},onError:function(){h.error("\u64CD\u4F5C\u5931\u8D25")}}),f=T.run,v=T.loading;return{runOpt:f,loading:v}}function E(l){var P=l.optMethod,y=l.optType,D=l.method,m=l.actionRef,r=l.messageApi,h=l.onSuccessCallback,T=l.showSuccessMessage,f=T===void 0?!0:T,v=r!=null?r:o.ZP,x=(0,c.useRequest)(P(y,D),{manual:!0,onSuccess:function(t){var e=typeof t.msg=="string"?t.msg:JSON.stringify(t.msg);if(t.code!==0)v.error(e);else if(h)h(t);else{var i;f&&v.success(e),m==null||(i=m.current)===null||i===void 0||i.reload(!1)}},onError:function(){v.error("\u64CD\u4F5C\u5931\u8D25")}}),O=x.run,A=x.loading;return{runOpt:O,loading:A}}},92382:function(W,M,u){u.r(M);var c=u(26068),o=u.n(c),g=u(90228),E=u.n(g),l=u(87999),P=u.n(l),y=u(48305),D=u.n(y),m=u(99503),r=u(67254),h=u(80696),T=u(78474),f=u(36903),v=u(41891),x=u(59050),O=u(82715),A=u(54805),F=u(66130),t=u(14201),e=u(61487),i=u(54388),B=u(87300),I=u(38902),S=u(20877),U=u(67870),j=u(41901),R=u(44725),L=u(95104),C=u(65825),J=u(58578),Y=u(75271),V=u(4778),n=u(52676),tu=[{label:"Shell",value:"sh"},{label:"Python",value:"python"},{label:"GO",value:"go"},{label:"Lua",value:"lua"},{label:"Perl",value:"perl"},{label:"PHP",value:"php"},{label:"JavaScript",value:"javascript"},{label:"TypeScript",value:"typescript"}],ru=function(){var N,z,ou=v.A.useForm(),su=D()(ou,1),K=su[0],_u=(0,i.useModel)("@@initialState"),Z=_u.initialState,G=(N=Z==null?void 0:Z.currentBizId)!==null&&N!==void 0?N:"",Q=G==="500",au=(z=Z==null?void 0:Z.currentBizName)!==null&&z!==void 0?z:"\u6240\u6709\u9879\u76EE",lu=B.ZP.useMessage(),X=D()(lu,2),w=X[0],iu=X[1],du=(0,Y.useState)(function(){return{}}),k=D()(du,2),q=k[0],pu=k[1],cu=(0,Y.useRef)(),$=new Date,H={name:"\u5FEB\u901F\u6267\u884C\u811A\u672C-".concat($.getFullYear()).concat($.getMonth()+1).concat($.getDate()).concat($.getHours()).concat($.getMinutes()).concat($.getSeconds()),source:"fromHandle",exec_name:"${script_path}",node_type:"agent",script_type:"sh",script_info:`#! /bin/bash 
set -o pipefail 
echo 'hello world'`,time_out:1800},Eu=(0,i.useRequest)(function(){return(0,V.mL)()},{refreshDeps:[G],onSuccess:function(){K.setFieldsValue({script_id:void 0,script_type:H.script_type,exec_name:H.exec_name,script_info:H.script_info,script_params:void 0,time_out:H.time_out,voucher_info:void 0})}}),uu=Eu.data,eu=uu===void 0?[]:uu,mu=(0,i.useRequest)(function(){return(0,V.pj)()},{refreshDeps:[G],onSuccess:function(s){console.log(s)}}),nu=mu.data,vu=nu===void 0?[]:nu,Fu=(0,T.t)({optMethod:V.C1,optType:void 0,method:"POST",actionRef:cu,messageApi:w,onSuccessCallback:function(){B.ZP.success((0,n.jsxs)("span",{children:["\u4EFB\u52A1\u89E6\u53D1\u6210\u529F\uFF01\u53EF\u5728"," ",(0,n.jsx)(I.Z.Link,{onClick:function(){return i.history.push("/orderCenter/orderList")},children:"\u5DE5\u4F5C\u53F0"})," ","\u4E2D\u67E5\u770B\u4EFB\u52A1\u6267\u884C\u60C5\u51B5"]}))},showSuccessMessage:!1}),Cu=Fu.runOpt,Pu=function(){var d=P()(E()().mark(function s(p){var _;return E()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(p){a.next=2;break}return a.abrupt("return");case 2:if(_=eu.find(function(fu){return fu.id===p}),_){a.next=6;break}return w.error("\u6CA1\u627E\u5230\u76F8\u5173\u7684\u811A\u672C\u6570\u636E"),a.abrupt("return");case 6:K.setFieldsValue({script_type:_.script_type,exec_name:_.exec_name,script_info:_.script_info,script_params:_.script_params,time_out:_.time_out,voucher_info:_.voucher_info});case 7:case"end":return a.stop()}},s)}));return function(p){return d.apply(this,arguments)}}(),Du=function(s){var p,_,b,a=o()(o()({},s),{},{node_type:((p=s.dynamic_group)===null||p===void 0?void 0:p.length)>0?"dynamic_group":"static_hosts",static_hosts:((_=s.dynamic_group)===null||_===void 0?void 0:_.length)>0?[]:s.static_hosts,dynamic_group:((b=s.dynamic_group)===null||b===void 0?void 0:b.length)>0?s.dynamic_group:[]});pu(a)},hu=function(){var d=P()(E()().mark(function s(p){var _;return E()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,_=o()(o()({},p),q),a.next=4,Cu(_);case 4:a.next=9;break;case 6:a.prev=6,a.t0=a.catch(0),console.log(a.t0);case 9:case"end":return a.stop()}},s,null,[[0,6]])}));return function(p){return d.apply(this,arguments)}}();return(0,n.jsxs)(r.Z,{children:[iu,(0,n.jsx)(S.Z,{type:"info",showIcon:!0,message:"".concat(au),description:"\u5FEB\u901F\u6267\u884C\u6279\u91CF\u811A\u672C\uFF0C\u624B\u52A8\u5F55\u5165\u7684\u8D85\u65F6\u65F6\u95F4\u4E3A1800\u79D2\uFF0C\u811A\u672C\u5E93\u5219\u4F7F\u7528\u811A\u672C\u5E93\u7684\u8D85\u65F6\u65F6\u95F4\uFF0C\u81EA\u52A8\u7ED3\u5355\u65F6\u95F4\u4E3A1\u5929\u3002",style:{marginBottom:16}}),(0,n.jsx)(x.Z,{children:(0,n.jsxs)(v.A,{layout:"horizontal",labelCol:{flex:"120px"},form:K,initialValues:H,onFinish:hu,disabled:Q,submitter:{render:function(s){return(0,n.jsxs)(U.Z,{style:{marginTop:16,marginLeft:120},children:[(0,n.jsx)(j.ZP,{type:"primary",onClick:function(){var _;return(_=s.form)===null||_===void 0?void 0:_.submit()},children:"\u5FEB\u901F\u6267\u884C"}),(0,n.jsx)(j.ZP,{onClick:function(){return window.open("/f2/orderCenter/myCreate","_blank")},children:"\u67E5\u770B\u4EFB\u52A1"})]})}},children:[(0,n.jsx)(O.Z,{name:"name",label:"\u4EFB\u52A1\u540D\u79F0",placeholder:"\u9ED8\u8BA4\u4E3A\u5F53\u524D\u6D41\u7A0B\u6240\u5C5E\u4E1A\u52A1...",rules:[{required:!0,message:"\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"}],fieldProps:{autoFocus:!1}}),(0,n.jsx)(h.Z,{drawerData:{show:!0},formData:q,onChange:Du,onHostSelect:function(){},onClear:function(){K.setFieldsValue({static_hosts:[]})},labelCol:{flex:"120px"},required:!0}),(0,n.jsx)(A.Z.Group,{name:"source",label:"\u811A\u672C\u6765\u6E90",options:[{label:"\u624B\u5DE5\u5F55\u5165",value:"fromHandle"},{label:"\u811A\u672C\u5E93",value:"fromSystem"}]}),(0,n.jsx)(v.A.Item,{noStyle:!0,shouldUpdate:function(s,p){return s.source!==p.source},children:function(s){var p=s.getFieldValue,_=p("source");return _==="fromSystem"?(0,n.jsx)(F.Z,{name:"script_id",label:"\u9009\u62E9\u811A\u672C",showSearch:!0,options:eu.map(function(b){return{label:b.script_name,value:b.id}}),onChange:Pu}):null}}),(0,n.jsx)(O.Z,{name:"exec_name",label:"\u6267\u884C\u547D\u4EE4",tooltip:(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{children:"\u5982\u679C\u6267\u884C\u672C\u5730\u811A\u672C\u76F4\u63A5\u8F93\u5165\u547D\u4EE4\uFF0C\u4F8B\u5982\uFF1Apython3 /home/xxx.py \u3002"}),(0,n.jsxs)("p",{children:["\u5982\u679C\u6267\u884C\u5F55\u5165\u7684\u811A\u672C\u5185\u5BB9\u8BF7\u7528 $","${script_path}","\u4EE3\u66FF\u811A\u672C\u540D\uFF0C\u4F8B\u5982\uFF1A$","${script_path}"," \uFF0C windows\u7CFB\u7EDF\u9700\u8981\u6307\u5B9A\u89E3\u91CA\u5668\uFF0C\u4F8B\u5982\uFF1Apython $","${script_path}"," ","\u3002"]})]})}),(0,n.jsxs)(R.Z.Item,{label:"\u811A\u672C\u5185\u5BB9",required:!0,children:[(0,n.jsx)(R.Z.Item,{name:"script_type",noStyle:!0,children:(0,n.jsx)(L.ZP.Group,{optionType:"button",options:tu})}),(0,n.jsx)(t.Z,{name:["script_type"],children:function(s){var p=s.script_type;return(0,n.jsx)(R.Z.Item,{name:"script_info",rules:[{required:!0,message:"\u811A\u672C\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A"}],style:{marginTop:16},children:(0,n.jsx)(m.ML,{height:"300px",showFullScreenButton:!0,value:K.getFieldValue("script_info"),language:f.JH[p]||"plaintext",theme:"vs-dark",onChange:function(b){return K.setFieldValue("script_info",b)},options:{readOnly:Q}})})}})]}),(0,n.jsxs)(C.Z,{gutter:16,children:[(0,n.jsx)(J.Z,{span:18,children:(0,n.jsx)(O.Z,{name:"script_params",label:"\u811A\u672C\u53C2\u6570",placeholder:"\u811A\u672C\u7684\u547D\u4EE4\u884C\u53C2\u6570..."})}),(0,n.jsx)(J.Z,{span:6,children:(0,n.jsx)(e.Z,{name:"time_out",label:"\u8D85\u65F6\u65F6\u95F4",fieldProps:{min:20,max:18e7,maxLength:5}})})]}),(0,n.jsx)(F.Z,{name:"voucher_info",label:"\u9009\u62E9\u51ED\u8BC1",mode:"multiple",fieldProps:{maxLength:250,showSearch:!0},options:vu.map(function(d){return{label:d.v_key,value:"".concat(d.tenantid,"___").concat(d.v_key,"___").concat(d.v_type)}})})]})})]})};M.default=ru},4778:function(W,M,u){u.d(M,{C1:function(){return E},mL:function(){return o},pj:function(){return g}});var c=u(23261);function o(){return(0,c.dT)("/api/job/v1/executive/script/",{page:1,limit:310})}function g(){return(0,c.dT)("/api/job/v1/meta/voucher/",{page_number:1,page_size:310})}function E(l,P){return(0,c.S_)("/api/job/v1/fast/script/",P)}},36903:function(W,M,u){u.d(M,{H0:function(){return E},JH:function(){return g},zB:function(){return o}});var c="cli_a270b45f63b9100b",o={free:"\u7A7A\u95F2",busy:"\u7E41\u5FD9",lock:"\u9501\u5B9A",offline:"\u79BB\u7EBF",maintain:"\u7EF4\u62A4"},g={python:"python",sh:"shell",go:"go",lua:"lua",perl:"perl",php:"php",javascript:"javascript",typescript:"typescript"},E=`
require:
  fields:
    - "field_1"
  vouchers:
    - "voucher1"
# [\u53EF\u9009] pod \u7684\u8D44\u6E90\u9650\u5236
# \u7528\u6237\u53EF\u4EE5\u9009\u62E9\u5728\u4EFB\u52A1\u7EA7\u6307\u5B9A\u8D44\u6E90\u9700\u6C42\uFF0C\u800C\u4E0D\u662F\u5728\u6BCF\u4E2A Step \u4E0A\u6307\u5B9A\u8D44\u6E90\u9700\u6C42\u3002\u5982\u679C\u7528\u6237\u6307\u5B9A\u4E86\u4EFB\u52A1\u7EA7\u8D44\u6E90\u8981\u6C42\uFF0C
# \u5B83\u5C06\u786E\u4FDD kubelet \u53EA\u4E3A\u6267\u884C Task \u7684 Steps \u4FDD\u7559\u8BE5\u6570\u91CF\u7684\u8D44\u6E90\u3002\u5982\u679C\u7528\u6237\u6307\u5B9A\u4E86\u4EFB\u52A1\u7EA7\u8D44\u6E90\u9650\u5236\uFF0C\u5219\u4EFB\u4F55 Step \u90FD\u4E0D\u80FD\u4F7F\u7528\u8D85\u8FC7\u8BE5\u6570\u91CF\u7684\u8D44\u6E90\u3002
computeResources:
  requests:
    memory: "64Mi" # \u7533\u8BF7 512 MB \u7684\u5185\u5B58
    cpu: "30m" # \u7533\u8BF7 1 Core \u7684 CPU
  limits:
    memory: "64Mi" # \u7533\u8BF7 512 MB \u7684\u5185\u5B58
    cpu: "30m" # \u7533\u8BF7 1 Core \u7684 CPU
# [\u5FC5\u9009] \u4EFB\u52A1\u5B9A\u4E49
taskSpec:
  # [\u5FC5\u9009] \u4EFB\u52A1\u5C55\u793A\u540D\u79F0
  displayName: "cc-test"
  # [\u53EF\u9009] \u63CF\u8FF0
  description: "\u8FD9\u662F\u4E00\u4EFD\u63CF\u8FF0"
  # [\u5FC5\u9009] \u4EFB\u52A1\u6B65\u9AA4\u5B9A\u4E49
  # \u4EFB\u52A1\u6709\u4E24\u79CD\u6A21\u5F0F(\u53EA\u80FD\u9009\u5176\u4E00)
  # - script \u6A21\u5F0F:
  # - command \u6A21\u5F0F:
  steps:
    # [\u5FC5\u9009] \u6B65\u9AA4\u540D\u79F0
    - name: "hello world"
      # [\u53EF\u9009] \u5F53 step \u51FA\u9519\u65F6\u7684\u5904\u7406\u65B9\u5F0F
      # [ continue | stopAndFail  | waitUntilTimeout ]
      onError: waitUntilTimeout
      # [\u53EF\u9009] \u8D85\u65F6\u65F6\u95F4(\u9ED8\u8BA460\u5206\u949F)
      # \u6301\u7EED\u65F6\u95F4\u5B57\u7B26\u4E32\u662F\u53EF\u80FD\u6709\u7B26\u53F7\u7684\u5341\u8FDB\u5236\u6570\u5B57\u5E8F\u5217\uFF0C\u6BCF\u4E2A\u5341\u8FDB\u5236\u6570\u5B57\u90FD\u5E26\u6709\u53EF\u9009\u7684\u5206\u6570\u548C\u5355\u4F4D\u540E\u7F00\uFF0C
      # \u4F8B\u5982\u201C300ms\u201D\u3001\u201C-1.5h\u201D\u6216\u201C2h45m\u201D\u3002\u6709\u6548\u7684\u65F6\u95F4\u5355\u4F4D\u4E3A\u201Cns\u201D\u3001\u201Cus\u201D\uFF08\u6216\u201C\u03BCs\u201D\uFF09\u3001\u201Cms\u201D\u3001\u201Cs\u201D\u3001\u201Cm\u201D\u3001\u201Ch\u201D\u3002
      timeout: "200s"
      # [\u5FC5\u9009] \u4EFB\u52A1\u8FD0\u884C\u6240\u5904\u7684\u955C\u50CF
      image: "harbor.123u.com/public/rocky9.1-python3:latest"
      # [\u5FC5\u9009] \u8FD0\u884C\u7684\u811A\u672C(\u4E0E command \u4E8C\u9009\u4E00)
      script: |
        #!/bin/sh
        set -euo pipefail
        echo hello world

`}}]);
