"use strict";(self.webpackChunkn2=self.webpackChunkn2||[]).push([[157],{29209:function(Ge,le,r){var fe=r(26068),b=r.n(fe),be=r(67825),f=r.n(be),S=r(53649),D=r.n(S),te=r(77821),F=r(91041),M=r(22501),w=r(75271),R=r(52676),z=["children","extra","ghost","title"],G,L,X=(0,M.kc)(function(x){var P=x.css;return{pageContainer:{"& .ant-page-header-heading":P(G||(G=D()([`
      margin-bottom: -50px;
    `]))),"& .ant-page-header-heading-extra":P(L||(L=D()([`
      position: absolute;
      top: 17px;
      right: 20px;
    `])))}}}),H=function(P){var I=P.children,ue=P.extra,m=ue===void 0?(0,R.jsx)(te.er,{}):ue,je=P.ghost,pe=je===void 0?!1:je,N=P.title,Oe=N===void 0?!1:N,Ze=f()(P,z),Pe=X(),ke=Pe.styles;return(0,R.jsx)(F._z,b()(b()({ghost:pe,extra:m,className:ke.pageContainer,title:Oe},Ze),{},{children:I}))};le.Z=H},29547:function(Ge,le,r){r.d(le,{t:function(){return f}});var fe=r(17534),b=r(27494);function be(S,D,te,F,M,w){var R=M!=null?M:message,z=useRequest(S(D,te),{manual:!0,onSuccess:function(H){if(H.code!==0?R.error(H.msg):R.success(H.msg),w)w();else{var x;F==null||(x=F.current)===null||x===void 0||x.reload(!1)}},onError:function(){R.error("\u64CD\u4F5C\u5931\u8D25")}}),G=z.run,L=z.loading;return{runOpt:G,loading:L}}function f(S){var D=S.optMethod,te=S.optType,F=S.method,M=S.actionRef,w=S.messageApi,R=S.onSuccessCallback,z=S.showSuccessMessage,G=z===void 0?!0:z,L=w!=null?w:b.ZP,X=(0,fe.useRequest)(D(te,F),{manual:!0,onSuccess:function(I){var ue=typeof I.msg=="string"?I.msg:JSON.stringify(I.msg);if(I.code!==0)L.error(ue);else if(R)R(I);else{var m;G&&L.success(ue),M==null||(m=M.current)===null||m===void 0||m.reload(!1)}},onError:function(){L.error("\u64CD\u4F5C\u5931\u8D25")}}),H=X.run,x=X.loading;return{runOpt:H,loading:x}}},21196:function(Ge,le,r){r.r(le),r.d(le,{default:function(){return pt}});var fe=r(90228),b=r.n(fe),be=r(26068),f=r.n(be),S=r(87999),D=r.n(S),te=r(48305),F=r.n(te),M=r(29209),w=r(29547),R=r(92672),z=r(40873),G=r(17534),L=r(81517),X=r(27494),H=r(42499),x=r(2673),P=r(38204),I=r(49734),ue=r(60286),m=r(75271),je=r(82092),pe=r.n(je),N=r(67700);function Oe(_){return(0,N.Mb)("/api/noc/v1/channel",_)}function Ze(_){return(0,N.Hs)("/api/noc/v1/channel/".concat(_))}function Pe(_,y){return(0,N.S_)("/api/noc/v1/channel",y)}function ke(_){var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"POST";return(0,N.S_)("/api/noc/v1/channel",y)}function et(_){var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"PUT";return(0,N.S_)("/api/noc/v1/channel",y)}function tt(_){return(0,N.Zi)("/api/noc/v1/user",_)}function ut(_){return(0,N.Zi)("/api/noc/v1/template",_)}var He=r(80248),Y=r(4057),se=r(29038),Je=r(22058),Qe=r(56890),Xe=r(69938),nt=r(67621),Me=r(67466),xe=r(30673),rt=r(19165),at=r(84711),lt=r(97140),e=r(52676),st=[{label:"\u5929\u67A2",value:"tianshu"},{label:"Prometheus",value:"prometheus"},{label:"Grafana",value:"grafana"},{label:"Webhook",value:"webhook"}],ot=[{label:"\u9ED8\u8BA4\u60C5\u666F",value:"AlertCallbackModeNone"},{label:"\u5F3A\u8C03\u540C\u610F",value:"AlertCallbackModeIsApprove"},{label:"\u5F3A\u8C03\u62D2\u7EDD",value:"AlertCallbackModeIsReject"}],Ye=[{label:"\u81F4\u547D",value:"fatal"},{label:"\u4E25\u91CD",value:"error"},{label:"\u8B66\u544A",value:"warn"}],it=[{label:"\u98DE\u4E66\u673A\u5668\u4EBA",value:"fs"},{label:"\u98DE\u4E66\u5E94\u7528",value:"fsapp"},{label:"\u9489\u9489\u673A\u5668\u4EBA",value:"dd"},{label:"\u4F01\u4E1A\u5FAE\u4FE1\u673A\u5668\u4EBA",value:"wx"},{label:"\u4F01\u4E1A\u5FAE\u4FE1\u5E94\u7528",value:"wxapp"},{label:"\u9489\u9489\u5E94\u7528",value:"ddapp"},{label:"\u90AE\u4EF6",value:"email"},{label:"\u963F\u91CC\u4E91\u77ED\u4FE1",value:"alydx"},{label:"\u963F\u91CC\u4E91\u7535\u8BDD",value:"alydh"}],qe=[{title:"\u901A\u9053\u914D\u7F6E",description:"\u914D\u7F6E\u901A\u9053\u57FA\u672C\u4FE1\u606F"},{title:"\u56FA\u5B9A\u6A21\u677F",description:"\u914D\u7F6E\u56FA\u5B9A\u901A\u77E5\u6A21\u677F"},{title:"\u81EA\u5B9A\u4E49\u6A21\u677F\uFF08\u9009\u586B\uFF09",description:"\u914D\u7F6E\u81EA\u5B9A\u4E49\u901A\u77E5\u6A21\u677F"}],we=function(y){var W=y.value,oe=W===void 0?[]:W,q=y.fieldName,J=q===void 0?"alert_webhooks":q;return(0,e.jsxs)("div",{style:{marginTop:24},children:[(0,e.jsx)(Me.Z.Text,{strong:!0,style:{marginBottom:16,display:"block"},children:"\u56DE\u8C03\u914D\u7F6E:"}),(0,e.jsx)(He.u,{name:J,initialValue:oe,creatorButtonProps:{creatorButtonText:"\u6DFB\u52A0\u56DE\u8C03\u914D\u7F6E",type:"dashed",block:!0},deleteIconProps:{tooltipText:"\u5220\u9664\u56DE\u8C03\u914D\u7F6E"},itemRender:function(V){var he=V.listDom,ie=V.action;return(0,e.jsx)(xe.Z,{size:"small",style:{marginBottom:16,backgroundColor:"#f8f8f9"},bodyStyle:{padding:16},children:(0,e.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start"},children:[(0,e.jsx)("div",{style:{flex:1,marginRight:16},children:he}),ie]})})},children:(0,e.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"280px 1fr 220px",gap:16},children:[(0,e.jsx)(Y.Z,{name:"alias",label:"\u56DE\u8C03\u540D\u79F0",placeholder:"\u8BF7\u8F93\u5165\u56DE\u8C03\u540D\u79F0"}),(0,e.jsx)(Y.Z,{name:"url",label:"URL",placeholder:"\u8BF7\u8F93\u5165\u56DE\u8C03URL"}),(0,e.jsx)(se.Z,{name:"mode",label:"\u56DE\u8C03\u60C5\u666F",placeholder:"\u8BF7\u9009\u62E9\u56DE\u8C03\u60C5\u666F",options:ot,allowClear:!1,initialValue:"AlertCallbackModeNone"})]})})]})},dt=function(y){var W=y.open,oe=y.onOpenChange,q=y.onSubmit,J=y.record,ve=y.isEdit,V=ve===void 0?!1:ve,he=(0,m.useState)(0),ie=F()(he,2),T=ie[0],ne=ie[1],Re=(0,m.useState)([]),me=F()(Re,2),Ie=me[0],ge=me[1],Ve=(0,m.useState)([]),re=F()(Ve,2),c=re[0],Ee=re[1],Be=(0,m.useState)({}),Fe=F()(Be,2),Se=Fe[0],de=Fe[1],ce=(0,m.useState)(!1),ye=F()(ce,2),Ce=ye[0],ae=ye[1],Ue=(0,m.useState)(""),De=F()(Ue,2),O=De[0],Ae=De[1],g=(0,m.useRef)(),Le=function(a){!g.current||!c.length||(a.use&&Ae(a.use),setTimeout(function(){var u,n=f()({},a);if(a.contact_points&&Array.isArray(a.contact_points)&&a.contact_points.forEach(function(t){if(t.type==="alydh")n.dh_severity=t.severity||[],n.dh_content=t.content||"",n.dh_alert_webhooks=t.alert_webhooks||[];else if(t.type==="fs")if(n.fs_tpl_id=t.tpl_id,n.fs_severity=t.severity||[],n.fs_webhook=t.webhook||"",n.fs_secret=t.secret||"",n.fs_alert_webhooks=t.alert_webhooks||[],t.tpl_id){var l=c.find(function(C){return C.id===t.tpl_id});n.fs_content=l?l.content:t.content||""}else n.fs_content=t.content||""}),a.custom_items&&Array.isArray(a.custom_items)?n.custom_items=a.custom_items.map(function(t){if(t.tpl_id&&c.length>0){var l=c.find(function(C){return C.id===t.tpl_id});return l?f()(f()({},t),{},{tpl_id:t.tpl_id,content:l.content,webhook:t.webhook||"",secret:t.secret||""}):f()(f()({},t),{},{tpl_id:void 0,content:t.content||"",webhook:t.webhook||"",secret:t.secret||""})}return f()(f()({},t),{},{tpl_id:void 0,content:t.content||"",webhook:t.webhook||"",secret:t.secret||""})}):n.custom_items=[],!n.dh_content){var o=c.find(function(t){return t.type==="alydh"&&t.use==="default"});o&&(n.dh_content=o.content)}(u=g.current)===null||u===void 0||u.setFieldsValue(n)},100))},Ne=(0,G.useRequest)(Ze,{manual:!0,onSuccess:function(a){a&&Le(a)},formatResult:function(a){return a.result},onError:function(a){console.error("\u83B7\u53D6\u901A\u9053\u8BE6\u60C5\u5931\u8D25:",a)}}),_e=Ne.run,We=function(){var v=D()(b()().mark(function a(){var u,n,o;return b()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.prev=0,l.next=3,tt({pageNum:1,pageSize:1e4});case 3:u=l.sent,u.code===0&&(o=(u==null||(n=u.result)===null||n===void 0?void 0:n.data)||[],ge(o.map(function(C){return{label:"".concat(C.username,"(").concat(C.nickname,")"),value:C.user_id}}))),l.next=10;break;case 7:l.prev=7,l.t0=l.catch(0),console.error("\u83B7\u53D6\u7528\u6237\u5217\u8868\u5931\u8D25:",l.t0);case 10:case"end":return l.stop()}},a,null,[[0,7]])}));return function(){return v.apply(this,arguments)}}(),Ke=function(){var v=D()(b()().mark(function a(){var u,n,o;return b()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.prev=0,l.next=3,ut({pageNum:1,pageSize:1e4});case 3:u=l.sent,u.code===0&&(o=(u==null||(n=u.result)===null||n===void 0?void 0:n.data)||[],Ee(o)),l.next=10;break;case 7:l.prev=7,l.t0=l.catch(0),console.error("\u83B7\u53D6\u6A21\u677F\u5217\u8868\u5931\u8D25:",l.t0);case 10:case"end":return l.stop()}},a,null,[[0,7]])}));return function(){return v.apply(this,arguments)}}();(0,m.useEffect)(function(){W?(We(),Ke()):(ne(0),de({}))},[W]);var B=function(a){if(a.use&&c.length>0){var u=a.use;Ae(u);var n=c.find(function(o){return o.type==="fs"&&o.use===u})||c.find(function(o){return o.type==="fs"&&o.use==="default"});setTimeout(function(){var o,t,l=((o=g.current)===null||o===void 0?void 0:o.getFieldsValue())||{};(t=g.current)===null||t===void 0||t.setFieldsValue(f()(f()({},l),{},{fs_tpl_id:n==null?void 0:n.id,fs_content:(n==null?void 0:n.content)||""}))},0)}};(0,m.useEffect)(function(){if(W&&c.length>0&&g.current)if(V&&J!==null&&J!==void 0&&J.id)_e(J.id);else{var v=c.find(function(u){return u.type==="alydh"&&u.use==="default"});if(v){var a={dh_content:v.content,dh_severity:["fatal"],custom_items:[]};g.current.setFieldsValue(a)}}},[W,V,J,c,_e]);var Z=function(a){if(!a){var u;(u=g.current)===null||u===void 0||u.resetFields(),ge([]),Ee([]),ne(0),ae(!1),de({}),Ae("")}oe(a)},k=function(){var v=D()(b()().mark(function a(u){var n;return b()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(u!=="back"){t.next=4;break}ne(T-1),t.next=17;break;case 4:return t.prev=4,ae(!0),t.next=8,(n=g.current)===null||n===void 0?void 0:n.validateFields();case 8:ne(T+1),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(4),console.error("\u8868\u5355\u6821\u9A8C\u5931\u8D25:",t.t0);case 14:return t.prev=14,ae(!1),t.finish(14);case 17:case"end":return t.stop()}},a,null,[[4,11,14,17]])}));return function(u){return v.apply(this,arguments)}}(),Q=function(a,u){var n=c.find(function(E){return E.id===a});if(n){var o,t,l=(o=g.current)===null||o===void 0?void 0:o.getFieldsValue(),C=u==="alydh"?"dh_content":"fs_content",A=f()(f()({},l),{},pe()(pe()({},C,n.content),"".concat(u,"_tpl_id"),a));(t=g.current)===null||t===void 0||t.setFieldsValue(A)}},U=function(a){de(function(u){return f()(f()({},u),{},pe()({},a,!u[a]))})},$e=function(a,u){return c.filter(function(n){return n.type!==a?!1:u?[u,"default"].includes(n.use):!0})},Te=function(a,u){var n=u||O;return c.find(function(o){return o.type===a&&o.use===n})||c.find(function(o){return o.type===a&&o.use==="default"})},vt=function(){var v=D()(b()().mark(function a(u){var n,o,t,l;return b()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return ae(!0),A.prev=1,n=f()({},u),n.name&&(n.name=n.name.trim()),o=[],console.log("\u63D0\u4EA4\u65F6\u7684\u6570\u636E:",{\u5F53\u524D\u6B65\u9AA4:T,\u8868\u5355\u6570\u636E:u}),t=Te("alydh"),t&&o.push({type:"alydh",tpl_id:t.id,severity:u.dh_severity||(V?[]:["fatal"]),severity_desc:"\u7535\u8BDD\uFF08\u9002\u7528\u544A\u8B66\u7EA7\u522B\uFF1A\u9ED8\u8BA4\u81F4\u547D\uFF09",content:t.content,show:"no",alert_webhooks:u.dh_alert_webhooks||[],webhook:"",secret:""}),l=Te("fs",u.use),l&&o.push({type:"fs",tpl_id:u.fs_tpl_id||l.id,severity:u.fs_severity||["fatal","error"],severity_desc:"\u98DE\u4E66\u673A\u5668\u4EBA\uFF08\u9002\u7528\u544A\u8B66\u7EA7\u522B\uFF1A\u81F4\u547D + \u4E25\u91CD\uFF09",content:u.fs_content||l.content,show:"no",alert_webhooks:u.fs_alert_webhooks||[],webhook:u.fs_webhook||"",secret:u.fs_secret||""}),n.contact_points=o,u.custom_items&&Array.isArray(u.custom_items)&&(n.custom_items=u.custom_items.filter(function(E){return E.tpl_id&&E.tpl_id!=="undefined"}).map(function(E){return f()(f()({},E),{},{status:1})})),delete n.dh_severity,delete n.dh_content,delete n.dh_alert_webhooks,delete n.fs_tpl_id,delete n.fs_severity,delete n.fs_content,delete n.fs_webhook,delete n.fs_secret,delete n.fs_alert_webhooks,A.next=23,q(n);case 23:return A.abrupt("return",!0);case 24:return A.prev=24,ae(!1),A.finish(24);case 27:case"end":return A.stop()}},a,null,[[1,,24,27]])}));return function(u){return v.apply(this,arguments)}}(),ht=function(){var a,u=(a=g.current)===null||a===void 0?void 0:a.getFieldsValue(),n=(u==null?void 0:u.use)||O,o=Te("alydh"),t=$e("fs",n),l=Te("fs",n);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{style:{display:T===0?"block":"none"},children:[(0,e.jsx)(Je.Z,{children:(0,e.jsx)(I.Z,{showIcon:!0,message:"\u6240\u6709\u544A\u8B66\u4F1A\u9ED8\u8BA4\u901A\u77E5\u76F8\u5173\u4E1A\u52A1\u8FD0\u7EF4\u8D1F\u8D23\u4EBA\uFF0C\u5982\u6709\u914D\u7F6E\u9700\u6C42\u8BF7\u524D\u5F80CMDB\u8FDB\u884C\u64CD\u4F5C\u3002"})}),(0,e.jsx)(se.Z,{name:"use",label:"\u901A\u9053\u7528\u9014",placeholder:"\u8BF7\u9009\u62E9\u901A\u9053\u7528\u9014...",options:st,rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u901A\u9053\u7528\u9014"}]}),(0,e.jsx)(Y.Z,{name:"name",label:"\u901A\u9053\u540D\u79F0",placeholder:"\u8BF7\u8F93\u5165\u901A\u9053\u540D\u79F0...",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u901A\u9053\u540D\u79F0"}],fieldProps:{maxLength:50}}),(0,e.jsx)(se.Z,{name:"user",label:"\u901A\u77E5\u7528\u6237",placeholder:"\u8BF7\u9009\u62E9\u901A\u77E5\u7528\u6237...",mode:"multiple",showSearch:!0,options:Ie,rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u901A\u77E5\u7528\u6237"}]})]}),(0,e.jsxs)("div",{style:{display:T===1?"block":"none"},children:[o&&(0,e.jsxs)("div",{style:{marginBottom:24},children:[(0,e.jsx)(Me.Z.Title,{level:5,children:"\u7535\u8BDD\uFF08\u9002\u7528\u544A\u8B66\u7EA7\u522B\uFF1A\u9ED8\u8BA4\u81F4\u547D\uFF09"}),(0,e.jsx)(Qe.Z.Group,{name:"dh_severity",label:"\u544A\u8B66\u7EA7\u522B",options:Ye,tooltip:"\u7A7A\u5219\u89C6\u4E3A\u4E0D\u4F7F\u7528\u5F53\u524D\u901A\u77E5"}),(0,e.jsxs)(xe.Z,{children:[(0,e.jsx)(Y.Z,{name:"dh_content",label:"",readonly:!0}),(0,e.jsx)(we,{fieldName:"dh_alert_webhooks"})]})]}),t.length>0&&(0,e.jsxs)("div",{style:{marginBottom:24},children:[(0,e.jsx)(Me.Z.Title,{level:5,children:"\u98DE\u4E66\u673A\u5668\u4EBA\uFF08\u9002\u7528\u544A\u8B66\u7EA7\u522B\uFF1A\u81F4\u547D + \u4E25\u91CD\uFF09"}),(0,e.jsxs)(xe.Z,{children:[(0,e.jsxs)(rt.Z,{justify:"space-between",align:"center",style:{marginBottom:16},children:[(0,e.jsx)("span",{children:"\u9009\u62E9\u6A21\u677F"}),(0,e.jsx)(x.ZP,{type:"link",onClick:function(){return U("fs")},children:Se.fs?"\u6536\u8D77\u6A21\u7248\u5185\u5BB9":"\u70B9\u51FB\u67E5\u770B\u6A21\u7248\u5185\u5BB9"})]}),(0,e.jsx)(se.Z,{name:"fs_tpl_id",label:"",placeholder:"\u8BF7\u9009\u62E9\u6A21\u677F...",options:t.map(function(C){return{label:C.name,value:C.id}}),initialValue:l==null?void 0:l.id,fieldProps:{allowClear:!1,onChange:function(A){return Q(A,"fs")}}}),Se.fs&&(0,e.jsx)(Xe.Z,{name:"fs_content",label:"",readonly:!0,initialValue:l==null?void 0:l.content,fieldProps:{rows:10,style:{marginTop:10}}}),(0,e.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,marginTop:16},children:[(0,e.jsx)(Y.Z,{name:"fs_webhook",label:"Webhook",placeholder:"webhook..."}),(0,e.jsx)(Y.Z,{name:"fs_secret",label:"Secret",placeholder:"secret..."})]}),(0,e.jsx)(we,{fieldName:"fs_alert_webhooks"})]})]})]}),(0,e.jsxs)("div",{style:{display:T===2?"block":"none"},children:[(0,e.jsx)(I.Z,{type:"info",showIcon:!0,message:(0,e.jsxs)("span",{children:["\u60A8\u53EF\u4EE5\u9009\u62E9\u901A\u77E5\u6A21\u7248\uFF0C\u82E5\u6CA1\u6709\u60A8\u60F3\u8981\u9009\u62E9\u7684\u901A\u77E5\u6A21\u7248\uFF0C\u4E5F\u53EF\u4EE5\u5355\u51FB"," ",(0,e.jsx)("a",{href:"#",onClick:function(A){return A.preventDefault()},children:"\u521B\u5EFA\u901A\u77E5\u6A21\u7248"}),"\uFF0C\u53BB\u521B\u5EFA\u65B0\u7684\u901A\u77E5\u6A21\u7248"]}),style:{marginBottom:24}}),(0,e.jsx)(He.u,{name:"custom_items",label:"",creatorButtonProps:{creatorButtonText:"\u6DFB\u52A0\u63A5\u5165\u6A21\u677F",type:"dashed",block:!0,style:{marginBottom:16}},deleteIconProps:{tooltipText:"\u5220\u9664"},max:5,itemRender:function(A,E){var ze=A.listDom,ee=A.action,d=E.index;return(0,e.jsx)(xe.Z,{size:"small",style:{marginBottom:16},bodyStyle:{padding:16},title:"\u81EA\u5B9A\u4E49\u6A21\u677F ".concat(d+1),extra:ee,children:ze},d)},children:function(A,E){var ze=function(d){if(!d)return[];var i=[];if(d==="dd"){var h=c.filter(function(s){return s.type==="dd"&&[O,"default"].includes(s.use)});i=h.filter(function(s){return s.use!=="default"})}else if(d==="fs"){var p=c.filter(function(s){return s.type==="fs"&&[O,"default"].includes(s.use)});i=p.filter(function(s){return s.use!=="default"})}else if(d==="fsapp"){var j=c.filter(function(s){return s.type==="fsapp"&&[O,"default"].includes(s.use)});i=j.filter(function(s){return s.use!=="default"})}else if(d==="ddapp"){var K=c.filter(function(s){return s.type==="ddapp"&&[O,"default"].includes(s.use)});i=K.filter(function(s){return s.use!=="default"})}else if(d==="wx"){var $=c.filter(function(s){return s.type==="wx"&&[O,"default"].includes(s.use)});i=$.filter(function(s){return s.use!=="default"})}else if(d==="wxapp"){var gt=c.filter(function(s){return s.type==="wxapp"&&[O,"default"].includes(s.use)});i=gt.filter(function(s){return s.use!=="default"})}else d==="alydx"?i=c.filter(function(s){return s.type==="alydx"&&[O,"default"].includes(s.use)}):d==="alydh"?i=c.filter(function(s){return s.type==="alydh"&&[O,"default"].includes(s.use)}):d==="email"&&(i=c.filter(function(s){return s.type==="email"&&s.use===O}));return i.map(function(s){return{label:s.name,value:s.id}})};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Qe.Z.Group,{name:"severity",label:"\u544A\u8B66\u7EA7\u522B",options:Ye,initialValue:["fatal","error","warn"],tooltip:"\u9ED8\u8BA4\u6240\u6709\u7B49\u7EA7\u90FD\u4F1A\u901A\u77E5\uFF0C\u7A7A\u5219\u89C6\u4E3A\u4E0D\u4F7F\u7528\u5F53\u524D\u901A\u77E5"}),(0,e.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"300px 1fr",gap:16},children:[(0,e.jsx)(se.Z,{name:"type",label:"\u9009\u62E9\u6A21\u7248\u7C7B\u578B",placeholder:"\u8BF7\u9009\u62E9...",options:it,fieldProps:{allowClear:!1,onChange:function(d){var i,h=(i=g.current)===null||i===void 0?void 0:i.getFieldsValue(),p=(h==null?void 0:h.custom_items)||[];if(p[E]){var j,K=p[E].webhook||"",$=p[E].secret||"";p[E]=f()(f()({},p[E]),{},{type:d,tpl_id:void 0,content:"",webhook:K,secret:$}),(j=g.current)===null||j===void 0||j.setFieldsValue({custom_items:p})}}}}),(0,e.jsx)(se.Z,{name:"tpl_id",label:"\u9009\u62E9\u6A21\u7248",placeholder:"\u8BF7\u9009\u62E9...",dependencies:["type"],fieldProps:{onChange:function(d){var i=c.find(function($){return $.id===d});if(i){var h,p=(h=g.current)===null||h===void 0?void 0:h.getFieldsValue(),j=(p==null?void 0:p.custom_items)||[];if(j[E]){var K;j[E]=f()(f()({},j[E]),{},{tpl_id:d,content:i.content}),(K=g.current)===null||K===void 0||K.setFieldsValue({custom_items:j})}}}},request:D()(b()().mark(function ee(){var d,i,h,p,j;return b()().wrap(function($){for(;;)switch($.prev=$.next){case 0:return h=(d=g.current)===null||d===void 0?void 0:d.getFieldsValue(),p=(h==null?void 0:h.custom_items)||[],j=(i=p[E])===null||i===void 0?void 0:i.type,$.abrupt("return",ze(j));case 4:case"end":return $.stop()}},ee)}))})]}),(0,e.jsx)(Xe.Z,{name:"content",label:"\u6A21\u7248\u5185\u5BB9",readonly:!0,fieldProps:{rows:10}}),(0,e.jsx)(Je.Z,{shouldUpdate:function(d,i){var h,p,j=d==null||(h=d.custom_items)===null||h===void 0||(h=h[E])===null||h===void 0?void 0:h.type,K=i==null||(p=i.custom_items)===null||p===void 0||(p=p[E])===null||p===void 0?void 0:p.type;return j!==K},children:function(d){var i,h=d.getFieldsValue,p=h(),j=p==null||(i=p.custom_items)===null||i===void 0||(i=i[E])===null||i===void 0?void 0:i.type;return["fs","dd","wx"].includes(j)?(0,e.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[(0,e.jsx)(Y.Z,{name:"webhook",label:"Webhook",placeholder:"webhook..."}),(0,e.jsx)(Y.Z,{name:"secret",label:"Secret",placeholder:"secret..."})]}):null}}),(0,e.jsx)(we,{fieldName:"alert_webhooks"})]})}})]})]})},mt=function(){return(0,e.jsxs)("div",{style:{display:"flex",gap:8},children:[T!==0&&(0,e.jsx)(x.ZP,{loading:Ce,onClick:function(){return k("back")},children:"\u4E0A\u4E00\u6B65"}),T!==qe.length-1&&(0,e.jsx)(x.ZP,{type:"primary",loading:Ce,onClick:function(){return k("next")},children:"\u4E0B\u4E00\u6B65"}),!(T===0&&!V)&&(0,e.jsx)(x.ZP,{type:"primary",loading:Ce,onClick:function(){var u;return(u=g.current)===null||u===void 0?void 0:u.submit()},children:V?"\u4FDD\u5B58":"\u521B\u5EFA"})]})};return(0,e.jsx)(at.ZP,{children:(0,e.jsxs)(nt.a,{formRef:g,open:W,onOpenChange:Z,title:V?"\u7F16\u8F91\u901A\u77E5\u901A\u9053":"\u521B\u5EFA\u901A\u77E5\u901A\u9053",width:"80%",layout:"horizontal",onFinish:vt,onValuesChange:B,drawerProps:{maskClosable:!1},submitter:{render:function(){return mt()}},children:[(0,e.jsx)("div",{style:{marginBottom:32},children:(0,e.jsx)(lt.Z,{current:T,items:qe})}),ht()]})})},ct=dt,ft=function(){var y=(0,m.useRef)(),W=X.ZP.useMessage(),oe=F()(W,2),q=oe[0],J=oe[1],ve=(0,G.useSearchParams)(),V=F()(ve,1),he=V[0],ie=(0,m.useState)(""),T=F()(ie,2),ne=T[0],Re=T[1],me=(0,L.Z)(ne,{wait:300}),Ie=(0,m.useState)(!1),ge=F()(Ie,2),Ve=ge[0],re=ge[1],c=(0,m.useState)(!1),Ee=F()(c,2),Be=Ee[0],Fe=Ee[1],Se=(0,m.useState)(),de=F()(Se,2),ce=de[0],ye=de[1];(0,m.useEffect)(function(){var B;(B=y.current)===null||B===void 0||B.reload()},[he]);var Ce=(0,w.t)({optMethod:Pe,optType:"delete",method:"DELETE",actionRef:y,messageApi:q}),ae=Ce.runOpt,Ue=(0,w.t)({optMethod:ke,optType:void 0,method:"POST",actionRef:y,messageApi:q}),De=Ue.runOpt,O=(0,w.t)({optMethod:et,optType:void 0,method:"PUT",actionRef:y,messageApi:q}),Ae=O.runOpt,g=(0,m.useMemo)(function(){var B={searchText:me,order:"descend",cache:"no",field:"",filter_map:{}};return B},[me]),Le=function(Z){H.Z.confirm({title:"\u63D0\u9192",content:"\u5220\u9664\u300A".concat(Z.name,"\u300B\u4E4B\u540E\u65E0\u6CD5\u627E\u56DE\uFF0C\u8BF7\u8C28\u614E\u64CD\u4F5C\uFF01"),onOk:function(){ae({ids:[Z.id]})}})},Ne=function(Z){ye(Z),Fe(!0),re(!0)},_e=function(){ye(void 0),Fe(!1),re(!0)},We=function(){var B=D()(b()().mark(function Z(k){return b()().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:if(!(Be&&ce&&ce.id)){U.next=5;break}return U.next=3,Ae(f()(f()({},k),{},{id:ce.id}));case 3:U.next=7;break;case 5:return U.next=7,De(k);case 7:re(!1);case 8:case"end":return U.stop()}},Z)}));return function(k){return B.apply(this,arguments)}}(),Ke=[{title:"\u901A\u9053\u540D\u79F0",dataIndex:"name",width:200,ellipsis:!0,fixed:"left"},{title:"\u66F4\u65B0\u4EBA",dataIndex:"updated_by",width:120},{title:"\u66F4\u65B0\u65F6\u95F4",dataIndex:"updated_at",width:180,valueType:"dateTime"},{title:"\u64CD\u4F5C",dataIndex:"option",valueType:"option",width:120,fixed:"right",render:function(Z,k){return[(0,e.jsx)(x.ZP,{type:"link",size:"small",onClick:function(){return Ne(k)},children:"\u7F16\u8F91"},"edit"),(0,e.jsx)(P.Z,{title:"\u786E\u8BA4\u5220\u9664",description:"\u5220\u9664\u300A".concat(k.name,"\u300B\u4E4B\u540E\u65E0\u6CD5\u627E\u56DE\uFF0C\u8BF7\u8C28\u614E\u64CD\u4F5C\uFF01"),onConfirm:function(){return Le(k)},okText:"\u786E\u8BA4",cancelText:"\u53D6\u6D88",children:(0,e.jsx)(x.ZP,{type:"link",size:"small",danger:!0,children:"\u5220\u9664"})},"delete")]}}];return(0,e.jsxs)(M.Z,{header:{title:"\u901A\u77E5\u901A\u9053"},extra:null,children:[J,(0,e.jsx)(I.Z,{type:"info",showIcon:!0,style:{marginBottom:16},message:"\u901A\u9053\u8BF4\u660E\uFF1A",description:(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{children:"1\u3001\u901A\u8FC7\u8DEF\u7531\u6765\u8C03\u7528\u901A\u77E5\u901A\u9053"}),(0,e.jsx)("p",{children:"2\u3001\u901A\u9053\u5185\u53EF\u4EE5\u63A5\u5165\u591A\u4E2A\u901A\u77E5\u65B9\u5F0F\uFF0C\u65B0\u5EFA\u4F1A\u9ED8\u8BA4\u63D0\u4F9B\u5E38\u7528\u6A21\u677F\uFF0C\u53EF\u4EE5\u6839\u636E\u544A\u8B66\u7EA7\u522B\u8FDB\u884C\u901A\u77E5"}),(0,e.jsx)("p",{children:"3\u3001\u7535\u8BDD\u548C\u77ED\u7EBF\u63A5\u5165\u7684\u6A21\u677F\u4E3A\u56FA\u5B9A\u6A21\u677F\uFF0C\u4E0D\u652F\u6301\u666E\u901A\u7528\u6237\u4FEE\u6539"})]})}),(0,e.jsx)(z.Z,{actionRef:y,params:g,rowKey:"id",search:!1,request:Oe(g),columns:Ke,scroll:{x:1e3},pagination:{defaultPageSize:10,showSizeChanger:!0,pageSizeOptions:["10","15","50","1000"]},toolbar:{search:(0,e.jsx)(ue.Z,{prefix:(0,e.jsx)(R.Z,{}),style:{width:400},placeholder:"\u8F93\u5165\u5173\u952E\u5B57\u641C\u7D22",allowClear:!0,value:ne,onChange:function(Z){return Re(Z.target.value)}}),actions:[(0,e.jsx)(x.ZP,{type:"primary",onClick:_e,children:"\u521B\u5EFA\u901A\u77E5\u901A\u9053"},"create")]},onChange:function(Z,k,Q){if(Q&&!Array.isArray(Q)){var U=Q.field,$e=Q.order;console.log("\u6392\u5E8F\u5B57\u6BB5:",U,"\u6392\u5E8F\u987A\u5E8F:",$e)}}}),(0,e.jsx)(ct,{open:Ve,onOpenChange:re,onSubmit:We,record:ce,isEdit:Be})]})},pt=ft}}]);
