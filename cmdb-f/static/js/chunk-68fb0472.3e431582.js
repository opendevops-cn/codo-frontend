(window["webpackJsonp_cmdb"]=window["webpackJsonp_cmdb"]||[]).push([["chunk-68fb0472"],{"040c":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",[t("Drawer",{attrs:{title:e.modalData.title,width:"800",draggable:"","mask-closable":!1},model:{value:e.modalData.show,callback:function(t){e.$set(e.modalData,"show",t)},expression:"modalData.show"}},[t("Form",{ref:"formValidate",staticStyle:{width:"750px"},attrs:{model:e.formValidate,rules:e.ruleValidate,"label-width":90}},[t("FormItem",{staticStyle:{"padding-top":"10px"},attrs:{label:"分组名称",prop:"dynamic_group_name"}},[t("Input",{attrs:{maxlength:50,placeholder:"请输入分组名称"},model:{value:e.formValidate.dynamic_group_name,callback:function(t){e.$set(e.formValidate,"dynamic_group_name",t)},expression:"formValidate.dynamic_group_name"}})],1),t("FormItem",{attrs:{label:"分组类型",prop:"dynamic_group_type"}},[t("RadioGroup",{on:{"on-change":e.handleChange},model:{value:e.formValidate.dynamic_group_type,callback:function(t){e.$set(e.formValidate,"dynamic_group_type",t)},expression:"formValidate.dynamic_group_type"}},[t("Radio",{attrs:{label:"normal"}},[e._v("通用类型")]),t("Radio",{attrs:{label:"biz"}},[e._v("业务类型")])],1)],1),"normal"===e.formValidate.dynamic_group_type?[t("FormItem",{attrs:{label:"选择业务",prop:"biz_id"}},[t("Select",{attrs:{disabled:"",placeholder:"请选择业务..."},model:{value:e.formValidate.biz_id,callback:function(t){e.$set(e.formValidate,"biz_id",t)},expression:"formValidate.biz_id"}},e._l(e.bizList,(function(e){return t("Option",{key:e.biz_id,attrs:{value:e.biz_id,label:e.biz_cn_name}})})),1)],1),e._l(e.formValidate.dynamic_group_rules,(function(a,i){return[e.formValidate.dynamic_group_rules&&0!==e.formValidate.dynamic_group_rules.length?t("FormItem",{attrs:{label:e._f("testF")(i,i),"label-width":85}},[0==i?t("Alert",{staticStyle:{"min-width":"500px","max-width":"704px","margin-bottom":"8px"},attrs:{"show-icon":""}},[e._v(" 卡片之间关系为或，卡片内的条件关系为且。")]):e._e(),t("Row",{attrs:{gutter:20}},[t("Col",{attrs:{span:"22"}},[a.length>0?t("Card",{staticStyle:{"min-width":"500px","margin-bottom":"0px"},attrs:{"dis-hover":""}},e._l(a,(function(l,r){return l.status?t("FormItem",{key:r+e._uid},[t("div",{staticClass:"alert-con"},[e._v(" "+e._s(r+1)+" - "),t("Select",{staticStyle:{"max-width":"90px"},attrs:{placeholder:"选择名称"},model:{value:l.query_name,callback:function(t){e.$set(l,"query_name",t)},expression:"item.query_name"}},[t("Option",{attrs:{value:"name"}},[e._v("资源名称")]),t("Option",{attrs:{value:"cloud_name"}},[e._v("云厂商")]),t("Option",{attrs:{value:"inner_ip"}},[e._v("内网IP")]),t("Option",{attrs:{value:"region"}},[e._v("地域")]),t("Option",{attrs:{value:"state"}},[e._v("运行状态")])],1),t("Select",{staticStyle:{"margin-right":"1px","margin-left":"1px","max-width":"90px"},attrs:{placeholder:"选择条件"},model:{value:l.query_conditions,callback:function(t){e.$set(l,"query_conditions",t)},expression:"item.query_conditions"}},[t("Option",{attrs:{value:"like"}},[e._v("前缀匹配")]),t("Option",{attrs:{value:"="}},[e._v("等于")]),t("Option",{attrs:{value:"!="}},[e._v("不等于")])],1),t("Input",{staticStyle:{"max-width":"300px"},attrs:{placeholder:""},model:{value:l.query_value,callback:function(t){e.$set(l,"query_value",t)},expression:"item.query_value"}}),t("Button",{staticClass:"rule-btn-add",attrs:{shape:"circle",type:"text",icon:"md-add"},on:{click:function(t){return e.handleAdd(i)}}}),1!==a.length?t("Button",{staticClass:"rule-btn-del",attrs:{shape:"circle",type:"text",icon:"md-close"},on:{click:function(t){return e.handleRemove(i,r)}}}):e._e()],1)]):e._e()})),1):e._e(),e.formValidate.dynamic_group_rules.length>1&&2!=i?t("p",{staticStyle:{"padding-top":"15px"}},[e._v("或")]):e._e()],1),t("Col",{attrs:{span:"2"}},[1!==e.formValidate.dynamic_group_rules.length?t("a",{on:{click:function(t){return t.preventDefault(),e.handleRemoveCard(i)}}},[e._v(" 删除")]):e._e()])],1)],1):e._e()]})),t("Col",{attrs:{span:"19",offset:"4"}},[t("FormItem",{staticStyle:{padding:"0px 0px"},attrs:{"label-width":85}},[t("Row",{attrs:{gutter:10}},[t("Col",{attrs:{span:"12"}},[t("Button",{attrs:{type:"dashed",long:"",icon:"md-add"},on:{click:e.handleAddCard}},[e._v("新增条件")])],1),e.formValidate.dynamic_group_rules?t("Col",{staticStyle:{"margin-left":"0px"},attrs:{span:"11"}},[[e._v("还可以添加"+e._s(3-e.formValidate.dynamic_group_rules.length)+"个条件")]],2):e._e()],1)],1)],1)]:[t("Row",{attrs:{gutter:5}},[t("FormItem",[t("Alert",{attrs:{type:"success","show-icon":"",closable:""}},[e._v(" 根据业务拓扑信息创建动态分组 "),t("template",{slot:"desc"},[t("p",[e._v("下列条件的关系为且 业务为必填项，集群和模块为可以输入多个，以半角逗号或者空格来分隔。")]),t("p",[e._v("当前类型查询条件不支持通配符，全部为精确查询。")])])],2)],1),t("Col",{attrs:{span:"12"}},[t("FormItem",{attrs:{label:"选择业务",prop:"biz_id"}},[t("Select",{attrs:{filterable:"",placeholder:"请选择业务..."},on:{"on-change":e.handleChangeBiz},model:{value:e.formValidate.biz_id,callback:function(t){e.$set(e.formValidate,"biz_id",t)},expression:"formValidate.biz_id"}},e._l(e.bizList,(function(e){return t("Option",{key:e.biz_id,attrs:{value:e.biz_id,label:e.biz_cn_name}})})),1)],1)],1),t("Col",{attrs:{span:"12"}},[t("FormItem",{attrs:{label:"",prop:"env_name"}},[t("Select",{attrs:{filterable:"",placeholder:"请选择环境.."},model:{value:e.formValidate.env_name,callback:function(t){e.$set(e.formValidate,"env_name",t)},expression:"formValidate.env_name"}},e._l(e.envList,(function(e){return t("Option",{key:e,attrs:{value:e,label:e}})})),1)],1)],1),t("Col",{attrs:{span:"24"}},[t("FormItem",{attrs:{label:"集群名称",prop:"region_name"}},[t("Input",{attrs:{maxlength:500,placeholder:"输入集群、区服名称，多个以半角逗号或者空格区分"},model:{value:e.formValidate.region_name,callback:function(t){e.$set(e.formValidate,"region_name",t)},expression:"formValidate.region_name"}})],1)],1),t("Col",{attrs:{span:"24"}},[t("FormItem",{attrs:{label:"模块名称",prop:"module_name"}},[t("Input",{attrs:{maxlength:500,placeholder:"输入模块、服务名称，多个以半角逗号或者空格区分"},model:{value:e.formValidate.module_name,callback:function(t){e.$set(e.formValidate,"module_name",t)},expression:"formValidate.module_name"}})],1)],1)],1)],t("FormItem",{attrs:{label:"备注信息",prop:"dynamic_group_detail"}},[t("Input",{attrs:{type:"textarea",autosize:{minRows:3,maxRows:5},placeholder:"Enter something..."},model:{value:e.formValidate.dynamic_group_detail,callback:function(t){e.$set(e.formValidate,"dynamic_group_detail",t)},expression:"formValidate.dynamic_group_detail"}})],1),t("div",{staticClass:"drawer-footer"},[t("Button",{staticStyle:{"margin-right":"8px"},on:{click:e.handleCancel}},[e._v("取消")]),t("Button",{attrs:{type:"primary"},on:{click:function(t){return e.handleSubmit("formValidate")}}},[e._v("提交")])],1)],2)],1)],1)},l=[],r=(a("14d9"),a("0b12")),n=(a("0e52"),{name:"dynamicGroupEdit",props:{modalData:{type:Object,default:{}},bizList:{type:Object|Array,default:[]}},data(){return{index:1,btnLoading:!1,envList:[],formValidate:{dynamic_group_rules:[[{query_name:"name",query_conditions:"like",query_value:"",index:1,status:1}]]},ruleValidate:{dynamic_group_name:[{required:!0,message:"动态分组名称不能为空",trigger:"blur"}],dynamic_group_type:[{required:!0,message:"请选择动态分组类型",trigger:"change"}],biz_id:[{required:!0,message:"业务类型的业务为必须",trigger:"change"}]}}},filters:{testF(e,t){return 1===t?"条件 B":2===t?"条件 C":0===t?"条件 A":void 0}},methods:{async handleGetEnv(){const e=await Object(r["getBizEnv"])({biz_id:this.formValidate.biz_id});0===e.code?this.envList=e.data.env_list:this.$Message.error(e.msg)},handleCancel(){this.$emit("drawer-close")},handleChange(){"normal"===this.formValidate.dynamic_group_type?this.formValidate.biz_id="504":(this.formValidate.biz_id=null,this.formValidate.env_name=null)},handleChangeBiz(){this.formValidate.env_name=null},handleAdd(e){this.index++,this.formValidate.dynamic_group_rules[e].length>4?this.$Notice.warning({title:"限制提示",desc:"添加指标的个数不能超过五个",duration:5}):this.formValidate.dynamic_group_rules[e].push({index:this.index,query_name:"name",query_conditions:"like",query_value:"",status:1})},handleRemove(e,t){this.formValidate.dynamic_group_rules[e].splice(t,1)},handleRemoveCard(e){this.formValidate.dynamic_group_rules.splice(e,1)},handleAddCard(){this.formValidate.dynamic_group_rules.length>2?this.$Notice.warning({title:"限制提示",desc:"条件组不能超过三个",duration:5}):this.formValidate.dynamic_group_rules.push([{query_name:"name",query_conditions:"like",query_value:"",index:1,status:1}])},async handleSubmit(e){const t=await this.$refs[e].validate();if(t){if("normal"===this.formValidate.dynamic_group_type)for(const e of this.formValidate.dynamic_group_rules)for(const t of e)if(1===t.status&&(""===t.query_value||!t.query_value))return void this.$Notice.warning({title:"查询条件存在空值！"});setTimeout(()=>{this.$emit("save-data",this.formValidate,this.modalData.action)},200)}else this.$Notice.error({title:"表单验证失败"})}},watch:{"formValidate.biz_id":{handler(e,t){e&&e!=t&&this.handleGetEnv()},deep:!0}},mounted(){}}),o=n,d=(a("33a0"),a("2877")),s=Object(d["a"])(o,i,l,!1,null,null,null);t["default"]=s.exports},"33a0":function(e,t,a){"use strict";a("e3de")},e3de:function(e,t,a){}}]);
//# sourceMappingURL=chunk-68fb0472.3e431582.js.map