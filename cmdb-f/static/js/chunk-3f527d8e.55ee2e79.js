(window["webpackJsonp_cmdb"]=window["webpackJsonp_cmdb"]||[]).push([["chunk-3f527d8e","chunk-3d8a8551","chunk-2d0c8c29","chunk-2d0bae4b","chunk-2d0ae8c9"],{"00b3":function(e,t,a){},"092e":function(e,t,a){"use strict";a("00b3")},"0b12":function(e,t,a){"use strict";a.r(t),a.d(t,"postTreeAsset",(function(){return i})),a.d(t,"getTreeAsset",(function(){return s})),a.d(t,"changeTreeAssetStatus",(function(){return l})),a.d(t,"deleteTreeAsset",(function(){return n})),a.d(t,"getRelation",(function(){return o})),a.d(t,"getServiceTreelist",(function(){return d})),a.d(t,"operationTree",(function(){return c})),a.d(t,"getBizEnv",(function(){return u})),a.d(t,"getTreeModule",(function(){return m}));var r=a("be3b");const i=e=>Object(r["default"])({url:"/api/v2/cmdb/tree/asset/",method:"post",data:e}),s=e=>Object(r["default"])({url:"/api/v2/cmdb/tree/asset/",method:"get",params:e}),l=e=>Object(r["default"])({url:"/api/v2/cmdb/tree/asset/",method:"patch",data:e}),n=e=>Object(r["default"])({url:"/api/v2/cmdb/tree/asset/",method:"delete",data:e}),o=e=>Object(r["default"])({url:"/api/v2/cmdb/tree/asset/relation/",method:"get",params:e}),d=e=>Object(r["default"])({url:"/api/v2/cmdb/tree/",method:"get",params:e}),c=(e,t)=>Object(r["default"])({url:"/api/v2/cmdb/tree/",method:t,data:e}),u=e=>Object(r["default"])({url:"/api/v2/cmdb/tree/env/",method:"get",params:e}),m=e=>Object(r["default"])({url:"/api/v2/cmdb/tree/module/",method:"get",params:e})},"282f":function(e,t,a){"use strict";a("aa36")},"38c3":function(e,t,a){"use strict";a.r(t),a.d(t,"preViewPermGroupHost",(function(){return i})),a.d(t,"getPermGrouplist",(function(){return s})),a.d(t,"optPermGroup",(function(){return l}));var r=a("be3b");const i=e=>Object(r["default"])({url:"/api/v2/cmdb/biz/perm_group/preview/",method:"get",params:{exec_uuid:e}}),s=e=>Object(r["default"])({url:"/api/v2/cmdb/biz/perm_group/",method:"get",params:e}),l=(e,t)=>Object(r["default"])({url:"/api/v2/cmdb/biz/perm_group/",data:e,method:t})},"4c0e":function(e,t,a){"use strict";a("e7b5")},"55f9":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[t("Modal",{attrs:{title:"预览主机",width:"950","mask-closable":!1,"footer-hide":!0},model:{value:e.dialog.show,callback:function(t){e.$set(e.dialog,"show",t)},expression:"dialog.show"}},[t("alert",[e._v("一共查询到:"+e._s(e.totalCount)+"条数据")]),t("Input",{staticStyle:{width:"330px",margin:"0px"},attrs:{clearable:"",placeholder:"输入实例ID、主机名、内网IP搜索"},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}},model:{value:e.searchVal,callback:function(t){e.searchVal=t},expression:"searchVal"}}),t("Button",{staticStyle:{margin:"3px"},on:{click:e.handleSearch}},[e._v("搜索")]),t("div",{staticStyle:{"margin-top":"5px"}},[t("Table",{attrs:{stripe:"",border:"",size:"small",columns:e.columns,data:e.tableData}})],1),t("div",{staticStyle:{margin:"10px",overflow:"hidden"}},[t("Page",{attrs:{total:e.totalCount,current:e.pageNum,"page-size":e.pageSize,"show-total":""},on:{"on-change":e.handlerChangePage}})],1)],1)],1)},i=[],s={name:"preViewHost",props:{dialog:{type:Object,default:{}}},data(){return{serverList:[],tableData:[],searchVal:null,pageTotal:0,pageSize:10,pageNum:1,columns:[{title:"实例ID",key:"instance_id",align:"center",sortable:!0},{title:"主机名称",key:"name",align:"center",minWidth:100,sortable:!0},{title:"内网IP",key:"inner_ip",align:"center",width:140,sortable:!0},{title:"外网IP",key:"outer_ip",align:"center",width:140,sortable:!0},{title:"运行状态",key:"state",align:"center",width:135,sortable:!0,render:(e,t)=>{const{row:a}=t,r="运行中"===a.state?"success":"关机"===a.state?"error":"创建中"===a.state?"primary":"error",i="运行中"===a.state?"运行中":"关机"===a.state?"已关机":"创建中"===a.state?"创建中":"Fail";return e("Tag",{props:{type:"dot",color:r}},i)}},{title:"Agent状态",key:"agent_status",align:"center",width:135,sortable:!0,render:(e,t)=>{let a=t.row.agent_status;return e("div","1"==a?[e("Tag",{props:{color:"green",type:"border"}},"在线")]:"2"==a?[e("Tag",{props:{color:"red"}},"离线")]:[e("Tag",{props:{color:"error"}},"未知")])}}]}},watch:{},computed:{totalCount(){return this.serverList.length}},methods:{handlerChangePage(e){this.pageNum=e,this.setCurrentPageData()},setCurrentPageData(){let e=(this.pageNum-1)*this.pageSize,t=this.pageNum*this.pageSize;this.tableData=this.serverList.slice(e,t)},checkExecList(e){return e.instance_id.indexOf(this.searchVal)>=0||e.name.indexOf(this.searchVal)>=0||e.inner_ip.indexOf(this.searchVal)>=0},handleSearch(){this.searchVal?(this.pageNum=1,this.tableData=this.serverList.filter(this.checkExecList)):(this.pageNum=1,this.setCurrentPageData())}}},l=s,n=a("2877"),o=Object(n["a"])(l,r,i,!1,null,null,null);t["default"]=o.exports},aa36:function(e,t,a){},b83f:function(e,t,a){},e7b5:function(e,t,a){},eab3:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[t("Drawer",{attrs:{title:e.modalData.title,width:"800",draggable:"","mask-closable":!1},model:{value:e.modalData.show,callback:function(t){e.$set(e.modalData,"show",t)},expression:"modalData.show"}},[t("Form",{ref:"formValidate",staticStyle:{width:"750px"},attrs:{model:e.formValidate,rules:e.ruleValidate,"label-width":90}},[t("FormItem",{staticStyle:{"padding-top":"10px"},attrs:{label:"分组名称",prop:"perm_group_name"}},[t("Input",{attrs:{maxlength:50,placeholder:"请输入分组名称"},model:{value:e.formValidate.perm_group_name,callback:function(t){e.$set(e.formValidate,"perm_group_name",t)},expression:"formValidate.perm_group_name"}})],1),[t("Row",{attrs:{gutter:5}},[t("FormItem",[t("Alert",{attrs:{type:"success","show-icon":"",closable:""}},[e._v(" 根据业务拓扑信息创建动态分组 "),t("template",{slot:"desc"},[t("p",[e._v(" 下列条件的关系为且 业务为必填项，集群和模块为可以输入多个，以半角逗号或者空格来分隔。 ")]),t("p",[e._v("当前类型查询条件不支持通配符，全部为精确查询。")])])],2)],1),t("Col",{attrs:{span:"12"}},[t("FormItem",{attrs:{label:"选择业务",prop:"biz_id"}},[t("Select",{attrs:{filterable:"",placeholder:"请选择业务..."},on:{"on-select":e.handleChangeBiz},model:{value:e.formValidate.biz_id,callback:function(t){e.$set(e.formValidate,"biz_id",t)},expression:"formValidate.biz_id"}},e._l(e.bizList,(function(e){return t("Option",{key:e.biz_id,attrs:{value:e.biz_id,label:e.biz_cn_name}})})),1)],1)],1),t("Col",{attrs:{span:"12"}},[t("FormItem",{attrs:{label:"",prop:"env_name"}},[t("Select",{attrs:{filterable:"",placeholder:"请选择环境.."},model:{value:e.formValidate.env_name,callback:function(t){e.$set(e.formValidate,"env_name",t)},expression:"formValidate.env_name"}},e._l(e.envList,(function(e){return t("Option",{key:e,attrs:{value:e,label:e}})})),1)],1)],1),t("Col",{attrs:{span:"24"}},[t("FormItem",{attrs:{label:"集群名称",prop:"region_name"}},[t("Input",{attrs:{maxlength:500,placeholder:"输入集群、区服名称，多个以半角逗号或者空格区分"},model:{value:e.formValidate.region_name,callback:function(t){e.$set(e.formValidate,"region_name",t)},expression:"formValidate.region_name"}})],1)],1),t("Col",{attrs:{span:"24"}},[t("FormItem",{attrs:{label:"模块名称",prop:"module_name"}},[t("Input",{attrs:{maxlength:500,placeholder:"输入模块、服务名称，多个以半角逗号或者空格区分"},model:{value:e.formValidate.module_name,callback:function(t){e.$set(e.formValidate,"module_name",t)},expression:"formValidate.module_name"}})],1)],1)],1)],t("FormItem",{attrs:{label:"用户组",prop:"user_group"}},[t("Select",{attrs:{filterable:"",placeholder:"请选择用户组",multiple:""},model:{value:e.formValidate.user_group,callback:function(t){e.$set(e.formValidate,"user_group",t)},expression:"formValidate.user_group"}},e._l(e.roleList,(function(e){return t("Option",{key:e.id,attrs:{value:e.role_name,label:e.role_name}})})),1)],1),t("FormItem",{attrs:{label:"角色类型",prop:"perm_type"}},[t("RadioGroup",{model:{value:e.formValidate.perm_type,callback:function(t){e.$set(e.formValidate,"perm_type",t)},expression:"formValidate.perm_type"}},[t("Radio",{attrs:{label:"dev"}},[e._v("开发")]),t("Radio",{attrs:{label:"ops"}},[e._v("运维")])],1)],1),t("FormItem",{attrs:{label:"资产账户",prop:"jmss_account"}},[t("Select",{attrs:{filterable:"",placeholder:"请选择资产账户",multiple:""},model:{value:e.formValidate.jmss_account,callback:function(t){e.$set(e.formValidate,"jmss_account",t)},expression:"formValidate.jmss_account"}},e._l(e.jmssAccounts,(function(e){return t("Option",{key:e,attrs:{value:e,label:e}})})),1)],1),t("FormItem",{attrs:{label:"备注信息",prop:"perm_group_detail"}},[t("Input",{attrs:{type:"textarea",autosize:{minRows:3,maxRows:5},placeholder:"Enter something..."},model:{value:e.formValidate.perm_group_detail,callback:function(t){e.$set(e.formValidate,"perm_group_detail",t)},expression:"formValidate.perm_group_detail"}})],1),t("div",{staticClass:"drawer-footer"},[t("Button",{staticStyle:{"margin-right":"8px"},on:{click:function(t){return e.handleCancel("formValidate")}}},[e._v("取消")]),t("Button",{attrs:{type:"primary"},on:{click:function(t){return e.handleSubmit("formValidate")}}},[e._v("提交")])],1)],2)],1)],1)},i=[],s=a("0b12"),l=a("30b3"),n={name:"permGroupEdit",props:{modalData:{type:Object,default:{}},bizList:{type:Object|Array,default:[]}},data(){return{index:1,btnLoading:!1,envList:[],roleList:[],regionList:[],jmssAccounts:[],formValidate:{user_group:[],biz_id:null},ruleValidate:{perm_group_name:[{required:!0,message:"权限分组名称不能为空",trigger:"blur"}],perm_type:[{required:!0,message:"请选择角色类型",trigger:"blur"}],user_group:[{required:!0,message:"请选择用户组",trigger:"blur",type:"array"}],jmss_account:[{required:!0,message:"请选择堡垒机资产账户",trigger:"blur",type:"array"}]}}},watch:{"formValidate.biz_id":{handler(e,t){e&&e!==t&&this.handleGetEnv()},deep:!0}},methods:{async handleGetEnv(){const e=await Object(s["getBizEnv"])({biz_id:this.formValidate.biz_id});0===e.code?this.envList=e.data.env_list:this.$Message.error(e.msg)},async handleGetJmssAccounts(){const e=await Object(l["getJmssAccountList"])();0===e.code?this.jmssAccounts=e.data:this.$Message.error(e.msg)},handleCancel(e){this.$refs[e].resetFields(),this.$emit("drawer-close")},handleRoleInfoList(){Object(l["getRoleInfoList"])().then(e=>{0===e.code?this.roleList=e.data:this.$Message.error(""+e.msg)})},handleChange(){this.formValidate.biz_id=null,this.formValidate.env_name=null},handleChangeBiz(){this.formValidate.env_name=null,this.regionList=[],this.envList=[],this.formValidate.region_name=null},async handleSubmit(e){const t=await this.$refs[e].validate();t?setTimeout(()=>{this.$emit("save-data",this.formValidate,this.modalData.action)},200):this.$Notice.error({title:"表单验证失败"})}},mounted(){this.handleRoleInfoList(),this.handleGetJmssAccounts()}},o=n,d=(a("4c0e"),a("2877")),c=Object(d["a"])(o,r,i,!1,null,null,null);t["default"]=c.exports},f2b1:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("Card",{attrs:{"dis-hover":"",bordered:!1}},[t("div",[t("div",[t("div",{staticClass:"search-con search-con-top"},[t("Input",{staticClass:"search-input",attrs:{search:"",maxlength:100,placeholder:"输入关键字全局搜索"},on:{"on-search":e.handleSearch},model:{value:e.initPara.searchVal,callback:function(t){e.$set(e.initPara,"searchVal",t)},expression:"initPara.searchVal"}}),t("Button",{staticStyle:{margin:"3px"},on:{click:function(t){return e.handCreate()}}},[e._v("添加分组")])],1),t("Table",{attrs:{size:"small",columns:e.columns,data:e.tableData},on:{"on-sort-change":e.handleSort}})],1),t("div",{staticStyle:{margin:"10px",overflow:"hidden"}},[t("div",{staticStyle:{float:"left"}},[t("Page",{attrs:{total:e.i.pageTotal,current:e.initPara.page_number,"page-size":e.initPara.page_size,"show-total":"","show-sizer":"","page-size-opts":[15,50,100]},on:{"on-change":e.handlerChangePage,"on-page-size-change":e.handlePageSize}})],1)])]),e.spinShow?t("Spin",{attrs:{size:"large",fix:""}},[t("Icon",{staticClass:"demo-spin-icon-load",attrs:{type:"ios-loading",size:"18"}}),t("div",[e._v("加载中，请稍等一会...")])],1):e._e(),t("preViewHost",{ref:"previewHost",attrs:{dialog:e.dialog}}),t("permGroupEdit",{ref:"dgEdit",attrs:{"modal-data":e.modalData,"biz-list":e.bizList},on:{"drawer-close":e.handleClose,"save-data":e.handleSaveData}})],1)},i=[],s=(a("b83f"),a("38c3")),l=a("30b3"),n=a("55f9"),o=a("eab3"),d={components:{preViewHost:n["default"],permGroupEdit:o["default"]},data(){return{modalData:{show:!1,title:"添加动态分组",id:null,action:"post"},dialog:{show:!1,title:"预览主机"},tableData:[],columns:[{title:"UID",key:"exec_uuid",minWidth:200,maxWidth:300},{title:"分组名称",key:"perm_group_name",align:"center",tooltip:!0,sortable:!0,minWidth:200},{title:"权限类型",key:"perm_type",align:"center",sortable:!0,minWidth:40},{title:"用户组",key:"user_group",align:"center",sortable:!0,minWidth:100},{title:"资产账户",key:"jmss_account",align:"center",sortable:!0,minWidth:100},{title:"业务",key:"biz_id",align:"center",sortable:!0,minWidth:100,render:(e,t)=>{let a=t.row.biz_id;return e("p",this.bizMap[a])}},{title:"修改人",key:"modify_user",align:"center",width:180},{title:"更新时间",key:"update_time",sortable:!0,width:180},{title:"操作",key:"handle",width:180,render:(e,t)=>e("div",[e("a",{style:{marginRight:"10px"},on:{click:()=>{this.handlePreview(t.row)}}},"预览"),e("a",{style:{marginRight:"10px"},on:{click:()=>{this.handleEdit(t.row)}}},"编辑"),e("a",{style:{color:"red",marginRight:"10px"},on:{click:()=>{this.handleDel(t.row)}}},"删除")])}],bizList:[],bizMap:{},initPara:{page_number:1,page_size:15,searchVal:null,order_by:"update_time",order:"descend"},i:{pageTotal:0,tableLoading:!0},initForm:{biz_id:"501",perm_group_name:null,perm_type:"",perm_group_detail:""},spinShow:!1}},methods:{async handleGetData(){const e=await Object(s["getPermGrouplist"])(this.initPara);0==e.code?(this.tableData=e.data,this.i.pageTotal=e.count):this.$Message.error(e.msg),this.i.tableLoading=!1},async handleGetBizList(){const e=await Object(l["getBusinesslist"])();this.bizList=e.data,this.bizList.forEach(e=>{this.bizMap[e.biz_id]=e.biz_cn_name})},handleClose(){this.modalData.show=!1,this.handleGetData()},handCreate(){this.modalData={show:!0,action:"post",title:"添加权限分组"},this.$refs.dgEdit.formValidate=this.initForm},handleEdit(e){this.modalData={show:!0,action:"put",title:"编辑权限分组"},this.$refs.dgEdit.formValidate=this.rowToConfig(e)},rowToConfig(e,t=e.id){return{...e,id:t,user_group:e.user_group.split(","),jmss_account:e.jmss_account.split(",")}},async handleSaveData(e,t){console.info(e,t);const a=await Object(s["optPermGroup"])(e,t);0===a.code?(this.$Notice.success({title:""+a.msg}),this.handleClose()):this.$Notice.error({title:"发生错误",desc:""+a.msg})},handleDel(e){this.$Modal.confirm({title:"确认删除",content:"您确认要删除分组 "+e.perm_group_name+" ?",onOk:()=>{Object(s["optPermGroup"])({id_list:[e.id]},"delete").then(e=>{0===e.code?(this.$Notice.success({title:""+e.msg}),this.handleClose()):this.$Notice.error({title:""+e.msg})})},onCancel:()=>{this.$Message.info("回头是岸~")}})},async handlePreview(e){this.spinShow=!0;try{let t=await Object(s["preViewPermGroupHost"])(e.exec_uuid);if(0!==t.code)return void this.$Message.error(""+t.msg);this.$refs.previewHost.serverList=t.data,this.$refs.previewHost.setCurrentPageData(),this.dialog.show=!0}catch(t){this.$Message.error(t.toString())}finally{this.spinShow=!1}},handleSearch(){this.initPara.page_number=1,this.handleGetData()},handleSort(e,t,a){this.initPara.order="asc"===e.order?"ascend":"descend",this.initPara.order_by=e.key,this.handleGetData()},handlerChangePage(e){this.initPara.page_number=e,this.handleGetData()},handlePageSize(e){this.initPara.page_number=1,this.initPara.page_size=e,this.handleGetData()}},created(){this.handleGetBizList()},mounted(){this.handleGetData()}},c=d,u=(a("282f"),a("092e"),a("2877")),m=Object(u["a"])(c,r,i,!1,null,"79807d1a",null);t["default"]=m.exports}}]);
//# sourceMappingURL=chunk-3f527d8e.55ee2e79.js.map