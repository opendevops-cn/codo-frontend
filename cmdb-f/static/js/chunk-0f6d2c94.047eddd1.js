(window["webpackJsonp_cmdb"]=window["webpackJsonp_cmdb"]||[]).push([["chunk-0f6d2c94","chunk-6e4db0c8","chunk-2d208deb","chunk-2d0d5c4c"],{"13d5":function(e,t,a){"use strict";var n=a("23e7"),s=a("d58f").left,o=a("a640"),l=a("2d00"),r=a("605d"),i=!r&&l>79&&l<83,c=i||!o("reduce");n({target:"Array",proto:!0,forced:c},{reduce:function(e){var t=arguments.length;return s(this,e,t,t>1?arguments[1]:void 0)}})},3261:function(e,t,a){"use strict";a.r(t),a.d(t,"getFeFormInfo",(function(){return n})),a.d(t,"getUniqueStr",(function(){return s})),a.d(t,"getParams",(function(){return o}));a("13d5");const n=(e,t)=>{var a;return{...e,renderTags:Object.entries(e.tags).reduce((e,t)=>{const[a,n]=t;return e+=`${a} | ${n};`,e},""),resTypeRender:null===(a=t.resTypeOptions.find(t=>t.value===e.res_type))||void 0===a?void 0:a.label,cloundAccountRender:`${e.account_id} | ${e.vendor}`,tagsValues:Object.entries(e.tags).map(e=>(t.handleSelectTag({value:e[0]}),{key:e[0],value:e[1]}))}},s=e=>`^${Number(Math.random().toString().substring(2,e)+Date.now()).toString(36)}$`,o=(e,t)=>{const{name:a,account_id:n,vendor:s,cloud_region_id:o,res_type:l,region:r,zone:i,tagsValues:c,content:u,description:d,vpc_id:_,vpc_name:m,subnet_id:p,subnet_name:g}=e;return{name:a,account_id:n,vendor:s,cloud_region_id:o,vpc_id:_,vpc_name:m,subnet_id:p,subnet_name:g,res_type:l,region:r,zone:i,tags:c.reduce((e,t)=>(e[t.key]=t.value,e),{}),content:u,description:d}}},"5e65":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("Modal",{attrs:{title:e.title,loading:e.modalLoading,width:70},on:{"on-ok":e.ok,"on-cancel":e.cancel},model:{value:e.showModal,callback:function(t){e.showModal=t},expression:"showModal"}},[t("div",{staticClass:"modal__content"},[t("Form",{ref:"form",attrs:{model:e.formValues,"label-width":100,rules:e.formRules}},[t("div",{staticClass:"modal__content__section"},[t("div",{staticClass:"modal__content__section__title"},[e._v("基础配置")]),t("div",{staticClass:"modal__content__section__form"},[t("div",{staticClass:"modal__content__section__form__custom"},[t("FormItem",{attrs:{prop:"name",label:"模板名称"}},[t("Input",{attrs:{type:"text",placeholder:"请输入模板名称"},model:{value:e.formValues.name,callback:function(t){e.$set(e.formValues,"name",t)},expression:"formValues.name"}})],1)],1),t("div",{staticClass:"modal__content__section__form__select"},[t("FormItem",{attrs:{prop:"res_type",label:"模板类型"}},[t("Select",{attrs:{type:"text",placeholder:"请选择模板类型"},model:{value:e.formValues.res_type,callback:function(t){e.$set(e.formValues,"res_type",t)},expression:"formValues.res_type"}},e._l(e.resTypeOptions,(function(a){return t("Option",{key:a.value,attrs:{value:a.value}},[e._v(e._s(a.label))])})),1)],1)],1),t("div",{staticClass:"modal__content__section__form__longer"},[t("FormItem",{attrs:{prop:"subnet_id",label:"私有子网"}},[t("Select",{attrs:{filterable:"",placeholder:"请选择私有子网"},on:{"on-change":e.handleInstanceChange},model:{value:e.formValues.subnet_id,callback:function(t){e.$set(e.formValues,"subnet_id",t)},expression:"formValues.subnet_id"}},e._l(e.vswitchOptions,(function(a){return t("Option",{key:a.id,attrs:{value:a.instance_id}},[e._v(e._s(a.label))])})),1)],1)],1),t("div",{staticClass:"modal__content__section__form__longer"},[t("FormItem",{attrs:{prop:"vpc_name",label:"私有网络"}},[t("Input",{attrs:{type:"text",disabled:""},model:{value:e.formValues.vpc_name,callback:function(t){e.$set(e.formValues,"vpc_name",t)},expression:"formValues.vpc_name"}})],1)],1),t("div",{staticClass:"modal__content__section__form__select"},[t("FormItem",{attrs:{prop:"cloud_region_id",label:"云区域"}},[t("Input",{attrs:{type:"text",placeholder:""},model:{value:e.formValues.cloud_region_id,callback:function(t){e.$set(e.formValues,"cloud_region_id",t)},expression:"formValues.cloud_region_id"}})],1)],1),t("div",{staticClass:"modal__content__section__form__select"},[t("FormItem",{attrs:{prop:"cloundAccountRender",label:"云厂商"}},[t("Input",{attrs:{type:"text",disabled:"",placeholder:""},model:{value:e.formValues.cloundAccountRender,callback:function(t){e.$set(e.formValues,"cloundAccountRender",t)},expression:"formValues.cloundAccountRender"}})],1)],1),t("div",{staticClass:"modal__content__section__form__select"},[t("FormItem",{attrs:{prop:"region",label:"地域"}},[t("Input",{attrs:{type:"text",disabled:"",placeholder:""},model:{value:e.formValues.region,callback:function(t){e.$set(e.formValues,"region",t)},expression:"formValues.region"}})],1)],1),t("div",{staticClass:"modal__content__section__form__select"},[t("FormItem",{attrs:{prop:"zone",label:"可用区"}},[t("Input",{attrs:{type:"text",placeholder:""},model:{value:e.formValues.zone,callback:function(t){e.$set(e.formValues,"zone",t)},expression:"formValues.zone"}})],1)],1)]),t("div",{staticClass:"modal__content__section"},[t("div",{staticClass:"modal__content__section__title"},[e._v("TF配置")]),t("div",{staticClass:"modal__content__section__form__longer"},[t("FormItem",{attrs:{prop:"content"}},[t("codo-editor",{key:""+e._uid,attrs:{lang:e.formValues.script_type,read:e.read},model:{value:e.formValues.content,callback:function(t){e.$set(e.formValues,"content",t)},expression:"formValues.content"}})],1)],1)]),t("div",{staticClass:"modal__content__section"},[t("div",{staticClass:"modal__content__section__title"},[e._v("其他设置")]),t("div",{staticClass:"modal__content__section__form"},[t("div",{staticClass:"modal__content__section__form__tags"},[t("div",{staticClass:"modal__content__section__form__tags__label"},[e._v(" 标签 ")]),t("div",{staticClass:"modal__content__section__form__tags__content"},e._l(e.formValues.tagsValues,(function(a,n){return t("div",{key:n,staticClass:"modal__content__section__form__tags__content__line"},[t("FormItem",{attrs:{prop:"tagsValues."+n+".key",rules:{required:!0,message:"标签键不能为空",trigger:"blur"}}},[t("Select",{attrs:{filterable:""},on:{"on-select":e.handleSelectTag},model:{value:a.key,callback:function(t){e.$set(a,"key",t)},expression:"item.key"}},e._l(e.tagKeyOptions,(function(a){return t("Option",{key:a.value,attrs:{value:a.value}},[e._v(e._s(a.label))])})),1)],1),t("FormItem",{attrs:{prop:"tagsValues."+n+".value",rules:{required:!0,message:"标签值不能为空",trigger:"blur"}}},[t("Select",{attrs:{filterable:"",loading:void 0===e.tagValueOptions[a.key],disabled:""===a.key,placeholder:""===a.key?"请先选择标签键":"请选择"},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"item.value"}},e._l(e.tagValueOptions[a.key],(function(a){return t("Option",{key:a.value,attrs:{value:a.value}},[e._v(e._s(a.label))])})),1)],1),n===e.formValues.tagsValues.length-1?t("Icon",{attrs:{size:"20",type:"md-add"},on:{click:e.handleAddTag}}):e._e(),e.formValues.tagsValues.length>1?t("Icon",{attrs:{size:"20",type:"md-close"},on:{click:function(t){return e.handleRemoveTag(n)}}}):e._e()],1)})),0)]),t("div",{staticClass:"modal__content__section__form__longer"},[t("FormItem",{attrs:{prop:"description",label:"备注"}},[t("Input",{attrs:{type:"textarea",placeholder:"请输入备注"},model:{value:e.formValues.description,callback:function(t){e.$set(e.formValues,"description",t)},expression:"formValues.description"}})],1)],1)])])])]),e.buy?t("div",{staticClass:"modal__content__buy"},[t("Form",{ref:"buyForm",attrs:{model:e.buyValues,"label-width":100,rules:e.buyFormRules}},[t("FormItem",{attrs:{prop:"name"}},[t("span",{attrs:{slot:"label"},slot:"label"},[t("span",[e._v("资源名称")]),t("Tooltip",{attrs:{placement:"top-start"}},[t("div",{attrs:{slot:"content"},slot:"content"},[t("div",[e._v(" 示例：业务-厂商-地域-环境-服务+编号(ops-tx-sh-test-etcd01) ")]),t("div",[e._v("全部为英文或者数字，-为分隔符 是关键字不能被占用")])]),t("Icon",{staticStyle:{"margin-left":"5px"},attrs:{type:"ios-help-circle-outline"}})],1)],1),t("Input",{attrs:{type:"text"},model:{value:e.buyValues.name,callback:function(t){e.$set(e.buyValues,"name",t)},expression:"buyValues.name"}})],1),t("FormItem",{attrs:{prop:"count",label:"购买数量"}},[t("InputNumber",{attrs:{max:10,min:1},model:{value:e.buyValues.count,callback:function(t){e.$set(e.buyValues,"count",t)},expression:"buyValues.count"}})],1)],1)],1):e._e()],1)])},s=[],o=(a("14d9"),a("d9e2"),a("30b3")),l=a("a743"),r=a("3261"),i=a("d4f7"),c=a("7063");const u={script_type:"python",content:"",cloud_region_id:"",cloud_region_name:"",account_id:"",name:"",res_type:"",vendor:"",region:"",zone:"",tags:{},tagsValues:[{key:"",value:""}]},d={bandwidth_dis_count:100,bandwidth_dis_count_price:0,bandwidth_original_price:0,dis_count:100,dis_count_price:0,original_price:0};var _={components:{codoEditor:i["default"]},name:"AddTemplateModal",props:{show:{type:Boolean,default:!1},buyRow:{type:Object,default:null}},data(){return{lang:"text",read:!1,imageIdOptions:[],imageIdLoading:!1,bindWidthIdOptions:[],bindWidthIdLoading:!1,title:"创建模板",priceLoading:!1,buy:!1,price:d,specialSplit:"",resTypeOptions:c["resTypeOptions"],dataDiskTypeOptions:c["dataDiskTypeOptions"],systemDiskTypeOptions:c["systemDiskTypeOptions"],instanceChargeTypeOptions:c["instanceChargeTypeOptions"],internetChargeTypeOptions:c["internetChargeTypeOptions"],vswitchOptions:[],securityGroupOptions:[],tagKeyOptions:[],tagValueOptions:{},buyValues:{name:"",count:1},formValues:u,formRules:{name:[{required:!0,message:"模板名称必填",trigger:"blur"}],res_type:[{required:!0,message:"模板类型必选",trigger:"blur"}],subnet_id:[{required:!0,message:"私有子网必选",trigger:"blur"}],cloundAccountRender:[{required:!0,message:"云厂商不能为空",trigger:"blur"}],vpc_name:[{required:!0,message:"私有网络不能为空",trigger:"blur"}],region:[{required:!0,message:"地域不能为空",trigger:"blur"}],zone:[{required:!0,message:"可用区不能为空",trigger:"blur"}],tags:[{required:!0,message:"标签必填",trigger:"blur"}]},showModal:this.show,modalLoading:!0}},computed:{realShow(){return this.show},insTypeParams(){const{account_id:e,vendor:t,res_type:a,region:n,zone:s,instance_type:o,content:l}=this.formValues;return{account_id:e,vendor:t,res_type:a,region:n,zone:s,instance_type:o,content:l}}},watch:{show(e){e&&this.getSettings(),this.showModal=e},insTypeParams:{async handler(e){const{account_id:t,vendor:a,res_type:n,region:s,zone:o,instance_type:l}=e;t&&a&&n&&s&&o&&l&&this.getInsTypeOptions()},deep:!0}},mounted(){this.specialSplit=Object(r["getUniqueStr"])(3)},methods:{async getSettings(){this.getVswitchData(),this.getTagData()},async getVswitchData(){const{data:e}=await Object(l["getVswitch"])();this.vswitchOptions=e.map(e=>({...e,label:`${e.instance_id} | ${e.name} | ${e.cidr_block_v4}`}))},async getTagData(){const{data:e}=await Object(o["getTagList"])();this.tagKeyOptions=e.map(e=>({label:e,value:e}))},async handleSelectTag(e){const{data:t}=await Object(o["getTagList"])({tag_key:e.value});this.$set(this.tagValueOptions,e.value,t.map(e=>({label:e,value:e})))},handleAddTag(){this.formValues.tagsValues.push({key:"",value:""})},handleRemoveTag(e){this.formValues.tagsValues=this.formValues.tagsValues.filter((t,a)=>a!==e)},handleInstanceChange(e){const t=this.vswitchOptions.find(t=>(null===t||void 0===t?void 0:t.instance_id)===e);t&&(this.formValues={...this.formValues,subnet_name:`${t.instance_id} | ${t.name} | ${t.cidr_block_v4}`,vendor:t.cloud_name,account_id:t.account_id,cloundAccountRender:`${t.account_id} | ${t.cloud_name}`,vpc_id:t.vpc_id.replace(/[\r\n]/g,""),vpc_name:`${t.vpc_id} | ${t.vpc_name}`,cloud_region_id:t.cloud_region_id||"",cloudRender:""+t.cloud_region_id,region:t.region,zone:t.zone})},async ok(){this.modalLoading=!1;try{await new Promise((e,t)=>{this.$refs.form.validate(e=>{e||t(new Error("表单校验失败，请检查"))}),this.buy&&this.$refs.buyForm.validate(e=>{e||t(new Error("表单校验失败，请检查"))}),e()});const e=Object(r["getParams"])(this.formValues,this),t=await(this.buy?Object(o["createOrder"])({instance_name:this.buyValues.name,count:this.buyValues.count,image_passwd:"",...e}):Object(o["createOrderTemplate"])({...e}));if(!t)throw new Error("请求错误，请重试");this.$emit("addSuccessCallback"),this.showModal=!1,this.$Message.success(t.msg)}catch(e){this.$Message.error(e.message),this.modalLoading=!1}finally{this.$nextTick(()=>{this.modalLoading=!0})}},cancel(){this.$emit("closeAddModal")}}},m=_,p=(a("765a"),a("2877")),g=Object(p["a"])(m,n,s,!1,null,"3ebe8931",null);t["default"]=g.exports},"605d":function(e,t,a){(function(t){var n=a("c6b6");e.exports="undefined"!=typeof t&&"process"==n(t)}).call(this,a("4362"))},7063:function(e,t,a){"use strict";a.r(t),a.d(t,"resTypeOptions",(function(){return o})),a.d(t,"dataDiskTypeOptions",(function(){return n})),a.d(t,"systemDiskTypeOptions",(function(){return s})),a.d(t,"instanceChargeTypeOptions",(function(){return l})),a.d(t,"internetChargeTypeOptions",(function(){return r}));const n=[{label:"高性能云硬盘",value:"CLOUD_PREMIUM"},{label:"通用型SSD云硬盘",value:"CLOUD_BSSD"},{label:"SSD云硬盘",value:"CLOUD_SSD"},{label:"增强型SSD云硬盘",value:"CLOUD_HSSD"}],s=[{label:"高性能云硬盘",value:"CLOUD_PREMIUM"},{label:"通用型SSD云硬盘",value:"CLOUD_BSSD"},{label:"SSD云硬盘",value:"CLOUD_SSD"},{label:"增强型SSD云硬盘",value:"CLOUD_HSSD"}],o=[{label:"服务器",value:"server"},{label:"LB",value:"LB"}],l=[{label:"包年包月",value:"PREPAID"},{label:"按量计费",value:"POSTPAID_BY_HOUR"}],r=[{label:"带宽包用户",value:"BANDWIDTH_PACKAGE"},{label:"按带宽包年包月计费",value:"BANDWIDTH_PREPAID"},{label:"流量按小时后付费",value:"TRAFFIC_POSTPAID_BY_HOUR"}]},"765a":function(e,t,a){"use strict";a("d0e4")},a640:function(e,t,a){"use strict";var n=a("d039");e.exports=function(e,t){var a=[][e];return!!a&&n((function(){a.call(null,t||function(){return 1},1)}))}},a743:function(e,t,a){"use strict";a.r(t),a.d(t,"getVswitch",(function(){return s})),a.d(t,"optVswitch",(function(){return o}));var n=a("be3b");const s=e=>Object(n["default"])({url:"/api/v2/cmdb/vswitch/",method:"get",params:e}),o=(e,t)=>Object(n["default"])({url:"/api/v2/cmdb/vswitch/",method:t,data:e})},d0e4:function(e,t,a){},d58f:function(e,t,a){var n=a("59ed"),s=a("7b0b"),o=a("44ad"),l=a("07fa"),r=TypeError,i=function(e){return function(t,a,i,c){n(a);var u=s(t),d=o(u),_=l(u),m=e?_-1:0,p=e?-1:1;if(i<2)while(1){if(m in d){c=d[m],m+=p;break}if(m+=p,e?m<0:_<=m)throw r("Reduce of empty array with no initial value")}for(;e?m>=0:_>m;m+=p)m in d&&(c=a(c,d[m],m,u));return c}};e.exports={left:i(!1),right:i(!0)}}}]);
//# sourceMappingURL=chunk-0f6d2c94.047eddd1.js.map