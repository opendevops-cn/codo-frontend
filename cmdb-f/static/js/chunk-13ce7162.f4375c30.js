(window["webpackJsonp_cmdb"]=window["webpackJsonp_cmdb"]||[]).push([["chunk-13ce7162","chunk-4b8ba636","chunk-40fdcc66","chunk-2d0de8d7","chunk-2d0d5fe1","chunk-2d213107"],{"57e4":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("Card",[e("Input",{staticStyle:{width:"300px",margin:"2px"},attrs:{clearable:"",placeholder:"输入关键字模糊搜索"},on:{"on-change":t.handleClear},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.getTableData.apply(null,arguments)}},model:{value:t.searchParams.search_val,callback:function(e){t.$set(t.searchParams,"search_val",e)},expression:"searchParams.search_val"}}),e("Button",{attrs:{type:"default",icon:"ios-search"},on:{click:t.getTableData}},[t._v("搜索")]),e("Button",{staticStyle:{"margin-left":"8px"},attrs:{type:"default",icon:"ios-add"},on:{click:t.handleAdd}},[t._v("添加标签")]),e("Table",{attrs:{columns:t.columns,data:t.tableData}}),e("div",{staticStyle:{margin:"10px",overflow:"hidden"}},[e("div",{staticStyle:{float:"left"}},[e("Page",{attrs:{total:t.pageTotal,current:t.searchParams.page_number,"page-size":t.searchParams.page_size,"page-size-opts":[12,35,50,100],"show-sizer":"","show-total":""},on:{"on-change":t.changePage,"on-page-size-change":t.handlePageSize}})],1)]),e("TagAdd",{attrs:{dialog:t.modalMapAdd,form:t.formValidateAdd},on:{"e-close":function(e){t.modalMapAdd.modalVisible=!1},"e-update":t.getTableData}}),e("TagEdit",{attrs:{dialog:t.modalMapEdit,form:t.formValidateEdit},on:{"e-close":function(e){t.modalMapEdit.modalVisible=!1},"e-update":t.getTableData}})],1)},l=[],s=a("30b3"),r=a("884d"),n=a("e303"),o={components:{TagAdd:r["default"],TagEdit:n["default"]},data(){return{tableData:[],modalMapAdd:{modalVisible:!1,modalTitle:"创建标签"},formValidateAdd:{tags:[{index:1,status:1,tag_key:"",tag_value:""}],tag_detail:""},modalMapEdit:{modalVisible:!1,modalTitle:"编辑/绑定资源"},formValidateEdit:{tag_id:"",tag_key:"",tag_value:""},pageTotal:10,searchParams:{page_number:1,page_size:12},columns:[{title:"ID",key:"id",align:"center",width:80,sortable:!0},{title:"标签键",width:200,key:"tag_key",align:"left",sortable:!0},{title:"标签值",minWidth:200,key:"tag_value",align:"left",sortable:!0},{title:"主机",width:100,align:"center",key:"count",render:(t,e)=>t("div",[t("Tag",{style:{}},e.row.count.server)])},{title:"数据库",width:100,align:"center",key:"count",render:(t,e)=>t("div",[t("Tag",{style:{}},e.row.count.mysql)])},{title:"缓存",width:100,align:"center",key:"count",render:(t,e)=>t("div",[t("Tag",{style:{}},e.row.count.redis)])},{title:"负载均衡",width:100,align:"center",key:"count",render:(t,e)=>t("div",[t("Tag",{},e.row.count.lb)])},{title:"操作",key:"handle",width:200,align:"center",render:(t,e)=>t("div",[t("a",{style:{marginRight:"20px"},on:{click:()=>{this.handleEdit(e.row)}}},"编辑"),t("a",{style:{color:"red"},on:{click:()=>{this.handleDelete(e.row)}}},"删除")])}]}},mounted(){this.getTableData()},methods:{handleViewData(t){const e=`${window.location.origin}/api/v2/cmdb/tag/asset_detail/?tag_key=${t.tag_key}&tag_value=${t.tag_value}`;window.open(e,"_blank")},handleAdd(){this.modalMapAdd.modalVisible=!0},handleEdit(t){this.formValidateEdit={tag_id:t.id,tag_key:t.tag_key,tag_value:t.tag_value},this.modalMapEdit.modalVisible=!0},handleDelete(t){this.$Modal.confirm({title:"二次确认",content:`确定删除(${t.tag_key}:${t.tag_value})？有关联则不能删除。`,onOk:()=>{Object(s["deleteTag"])({tag_id:t.id}).then(t=>{0===t.code?(this.$Notice.success({title:""+t.msg}),this.getTableData()):this.$Notice.error({title:""+t.msg})})},onCancel:()=>{this.$Message.info("回头是岸~")}})},async getTableData(){const{data:t,count:e}=await Object(s["getTag"])(this.searchParams);this.tableData=t,this.pageTotal=e},handleClear(t){""===t.target.value&&(this.tableData=this.value)},handlePageSize(t){this.searchParams.page_size=t,this.getTableData()},changePage(t){this.searchParams.page_number=t,this.getTableData()}}},d=o,c=a("2877"),u=Object(c["a"])(d,i,l,!1,null,null,null);e["default"]=u.exports},"713d":function(t,e,a){"use strict";a.r(e),a.d(e,"getRedisList",(function(){return l})),a.d(e,"optrationRedis",(function(){return s}));var i=a("be3b");const l=t=>Object(i["default"])({url:"/api/v2/cmdb/redis/",method:"get",params:t}),s=(t,e)=>Object(i["default"])({url:"/api/v2/cmdb/redis/",method:e,data:t})},"85ae":function(t,e,a){"use strict";a.r(e),a.d(e,"getMySQLList",(function(){return l})),a.d(e,"optrationMysQL",(function(){return s}));var i=a("be3b");const l=t=>Object(i["default"])({url:"/api/v2/cmdb/mysql/",method:"get",params:t}),s=(t,e)=>Object(i["default"])({url:"/api/v2/cmdb/mysql/",method:e,data:t})},"884d":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("div",[e("Modal",{attrs:{title:t.modalMap.modalTitle,"footer-hide":!0,width:"750"},model:{value:t.modalMap.modalVisible,callback:function(e){t.$set(t.modalMap,"modalVisible",e)},expression:"modalMap.modalVisible"}},[e("Form",{ref:"formValidate",attrs:{model:t.formValidate,"label-width":10,"mask-closable":!1}},[e("FormItem",[e("Row",[e("Col",{attrs:{span:"12"}},[t._v("标签键")]),e("Col",{attrs:{span:"12"}},[t._v("标签值")])],1)],1),t._l(t.formValidate.tags,(function(a,i){return[a.status?e("FormItem",{key:i},[e("Row",[e("Col",{attrs:{span:"10"}},[e("Input",{attrs:{placeholder:"Enter key ..."},model:{value:a.tag_key,callback:function(e){t.$set(a,"tag_key",e)},expression:"item.tag_key"}})],1),e("Col",{attrs:{span:"1",offset:"1"}},[e("span",[t._v(" : ")])]),e("Col",{attrs:{span:"10"}},[e("Input",{attrs:{placeholder:"Enter value ..."},model:{value:a.tag_value,callback:function(e){t.$set(a,"tag_value",e)},expression:"item.tag_value"}})],1),e("Col",{attrs:{span:"1",offset:"1"}},[e("Icon",{attrs:{type:"md-trash"},on:{click:function(e){return t.handleRemove(i)}}})],1)],1)],1):t._e()]})),e("FormItem",[e("Row",[e("Col",{attrs:{span:"18"}},[e("Tooltip",{attrs:{trigger:"hover",placement:"right",content:"批量添加标签,key+vlaue唯一"}},[e("Button",{attrs:{type:"dashed",long:"",icon:"md-add"},on:{click:t.handleAdd}},[t._v("继续添加")])],1)],1)],1)],1),e("FormItem",[e("span",[t._v("备注信息")]),e("Input",{attrs:{type:"textarea",autosize:{minRows:3,maxRows:5},placeholder:"Enter something..."},model:{value:t.formValidate.tag_detail,callback:function(e){t.$set(t.formValidate,"tag_detail",e)},expression:"formValidate.tag_detail"}})],1),e("div",{staticClass:"demo-footer"},[e("Button",{staticStyle:{"margin-right":"8px"},attrs:{type:"primary"},on:{click:function(e){return t.handleSubmit("formValidate")}}},[t._v("提交")]),e("Button",{on:{click:function(e){t.modalMap.modalVisible=!1}}},[t._v("取消")])],1)],2)],1)],1)},l=[],s=(a("14d9"),a("30b3")),r={name:"TagAdd",components:{},props:{form:{default(){return null},type:Object},dialog:{default(){return null},type:Object}},data(){return{modalMap:this.dialog,formValidate:this.form,index:1}},mounted(){},methods:{handleAdd(){this.index+=1,this.index>6?this.$Notice.warning({title:"条件超出最大限制"}):this.formValidate.tags.push({tag_key:"",tag_value:"",index:this.index,status:1})},handleRemove(t){this.index-=1,this.formValidate.tags[t].status=0},async handleSubmit(){const{msg:t}=await Object(s["addTag"])(this.formValidate);this.$Message.info(t),this.$emit("e-close"),this.$emit("e-update")}}},n=r,o=(a("a43e"),a("2877")),d=Object(o["a"])(n,i,l,!1,null,null,null);e["default"]=d.exports},"8d6c":function(t,e,a){},a43e:function(t,e,a){"use strict";a("8d6c")},aaa2:function(t,e,a){"use strict";a.r(e),a.d(e,"getServerList",(function(){return l})),a.d(e,"optServer",(function(){return s})),a.d(e,"optBatchServer",(function(){return r})),a.d(e,"getUserField",(function(){return n})),a.d(e,"optrationUserField",(function(){return o})),a.d(e,"optServerMainAgent",(function(){return d}));var i=a("be3b");const l=t=>Object(i["default"])({url:"/api/v2/cmdb/server/",method:"get",params:t}),s=(t,e)=>Object(i["default"])({url:"/api/v2/cmdb/server/",method:e,data:t}),r=(t,e)=>Object(i["default"])({url:"/api/v2/cmdb/server/batch/",method:e,data:t}),n=t=>Object(i["default"])({url:"/api/v2/cmdb/user_field/",method:"get",params:t}),o=t=>Object(i["default"])({url:"/api/v2/cmdb/user_field/",method:"put",data:t}),d=(t,e)=>Object(i["default"])({url:"/api/v2/cmdb/server/main_agent/",method:e,data:t})},b96f:function(t,e,a){"use strict";a("ff9e")},e303:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("div",[e("Modal",{attrs:{title:t.modalMap.modalTitle,"footer-hide":!0,width:"750"},model:{value:t.modalMap.modalVisible,callback:function(e){t.$set(t.modalMap,"modalVisible",e)},expression:"modalMap.modalVisible"}},[e("Form",{ref:"formValidate",attrs:{model:t.formValidate,"label-width":10,"mask-closable":!1}},[e("FormItem",[e("Steps",{attrs:{current:t.currentStep}},[e("Step",{attrs:{title:"标签信息",icon:"md-pricetags"}}),e("Step",{attrs:{title:"绑定资源",icon:"md-albums"}})],1)],1),0===t.currentStep?[e("FormItem",[e("Row",[e("Col",{attrs:{span:"12"}},[t._v("标签键")]),e("Col",{attrs:{span:"12"}},[t._v("标签值")])],1)],1),e("FormItem",[e("Row",[e("Col",{attrs:{span:"10"}},[e("Input",{attrs:{placeholder:"Enter key ..."},model:{value:t.formValidate.tag_key,callback:function(e){t.$set(t.formValidate,"tag_key",e)},expression:"formValidate.tag_key"}})],1),e("Col",{attrs:{span:"1",offset:"1"}},[e("span",[t._v(" : ")])]),e("Col",{attrs:{span:"10"}},[e("Input",{attrs:{placeholder:"Enter value ..."},model:{value:t.formValidate.tag_value,callback:function(e){t.$set(t.formValidate,"tag_value",e)},expression:"formValidate.tag_value"}})],1)],1)],1)]:t._e(),1===t.currentStep?[e("FormItem",{attrs:{prop:"asset_type"}},[e("span",[t._v("选择类型:")]),e("Select",{attrs:{clearable:""},on:{"on-change":t.getAssetList},model:{value:t.formValidate.asset_type,callback:function(e){t.$set(t.formValidate,"asset_type",e)},expression:"formValidate.asset_type"}},t._l(t.assetTypeList,(function(a){return e("Option",{key:a.value,attrs:{value:a.value}},[t._v(t._s(a.label))])})),1)],1),e("FormItem",{attrs:{prop:"asset_ids"}},[e("span",[t._v("选择资源:")]),e("Select",{attrs:{clearable:"",filterable:"",multiple:""},model:{value:t.formValidate.asset_ids,callback:function(e){t.$set(t.formValidate,"asset_ids",e)},expression:"formValidate.asset_ids"}},t._l(t.assetList,(function(a){return e("Option",{key:a.id,attrs:{value:a.id}},[t._v(t._s(a.name))])})),1)],1),e("FormItem",{attrs:{prop:"tag_detail"}},[e("span",[t._v("备注信息")]),e("Input",{attrs:{type:"textarea",autosize:{minRows:3,maxRows:5},placeholder:"Enter something..."},model:{value:t.formValidate.tag_detail,callback:function(e){t.$set(t.formValidate,"tag_detail",e)},expression:"formValidate.tag_detail"}})],1)]:t._e(),e("div",{staticClass:"codo-footer"},[0===t.currentStep?e("Button",{staticStyle:{"margin-right":"8px"},attrs:{type:"primary"},on:{click:function(e){t.currentStep+=1}}},[t._v("下一步")]):t._e(),1===t.currentStep?e("Button",{staticStyle:{"margin-right":"8px"},on:{click:function(e){t.currentStep-=1}}},[t._v("上一步")]):t._e(),1===t.currentStep?e("Button",{staticStyle:{"margin-right":"8px"},attrs:{type:"primary"},on:{click:function(e){return t.handleSubmit("formValidate")}}},[t._v("提交")]):t._e(),e("Button",{on:{click:function(e){t.modalMap.modalVisible=!1}}},[t._v("取消")])],1)],2)],1)],1)},l=[],s=a("30b3"),r=a("aaa2"),n=a("85ae"),o=a("713d"),d={name:"TagEdit",components:{},props:{form:{default(){return null},type:Object},dialog:{default(){return null},type:Object}},data(){return{assetList:[],assetTypeList:[{value:"server",label:"主机"},{value:"mysql",label:"数据库"},{value:"redis",label:"缓存"}],currentStep:0}},computed:{formValidate(){return this.form},modalMap(){return this.dialog}},mounted(){},methods:{handleNext(){this.currentStep+=1},async getAssetList(){this.assetList=[];const t=this.formValidate.asset_type,{data:e}=await Object(s["getTagAssetID"])({tag_id:this.formValidate.tag_id,asset_type:t});switch(this.formValidate.asset_ids=e,t){case"server":this.getServerList();break;case"mysql":this.getMysqlList();break;case"redis":this.getRedisList();break;default:console.log("default")}},async getServerList(){const{data:t}=await Object(r["getServerList"])({page_size:999999});this.assetList=t},async getMysqlList(){const{data:t}=await Object(n["getMySQLList"])({page_size:999999});this.assetList=t},async getRedisList(){const{data:t}=await Object(o["getRedisList"])({page_size:999999});this.assetList=t},async handleSubmit(){const{msg:t}=await Object(s["patchTag"])(this.formValidate);this.$Message.success(t),this.$emit("e-close"),this.$emit("e-update")}}},c=d,u=(a("b96f"),a("2877")),m=Object(u["a"])(c,i,l,!1,null,null,null);e["default"]=m.exports},ff9e:function(t,e,a){}}]);
//# sourceMappingURL=chunk-13ce7162.f4375c30.js.map