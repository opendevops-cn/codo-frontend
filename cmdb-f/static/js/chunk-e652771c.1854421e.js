(window["webpackJsonp_cmdb"]=window["webpackJsonp_cmdb"]||[]).push([["chunk-e652771c","chunk-2d0a422c","chunk-2d0ae8c9"],{"04c5":function(t,e,a){"use strict";a.r(e),a.d(e,"assetList",(function(){return l})),a.d(e,"columnTypeList",(function(){return i})),a.d(e,"operatorList",(function(){return s}));const l=[{value:"server",label:"服务器"},{value:"mysql",label:"MySQL"},{value:"redis",label:"Redis"},{value:"lb",label:"负载均衡"}],i=[{value:"name",label:"名称"},{value:"cloud_name",label:"厂商"},{value:"account_id",label:"用户"},{value:"region",label:"云区域"},{value:"inner_ip",label:"内网地址(主机)"},{value:"state",label:"运行状态"}],s=[{label:"包含",value:"包含"},{label:"正则",value:"正则"},{label:"等于",value:"=="},{label:"不等于",value:"!="},{label:"开始",value:"开始"},{label:"结束",value:"结束"}]},"0b12":function(t,e,a){"use strict";a.r(e),a.d(e,"postTreeAsset",(function(){return i})),a.d(e,"getTreeAsset",(function(){return s})),a.d(e,"changeTreeAssetStatus",(function(){return r})),a.d(e,"deleteTreeAsset",(function(){return n})),a.d(e,"getRelation",(function(){return o})),a.d(e,"getServiceTreelist",(function(){return c})),a.d(e,"operationTree",(function(){return d})),a.d(e,"getBizEnv",(function(){return u})),a.d(e,"getTreeModule",(function(){return m}));var l=a("be3b");const i=t=>Object(l["default"])({url:"/api/v2/cmdb/tree/asset/",method:"post",data:t}),s=t=>Object(l["default"])({url:"/api/v2/cmdb/tree/asset/",method:"get",params:t}),r=t=>Object(l["default"])({url:"/api/v2/cmdb/tree/asset/",method:"patch",data:t}),n=t=>Object(l["default"])({url:"/api/v2/cmdb/tree/asset/",method:"delete",data:t}),o=t=>Object(l["default"])({url:"/api/v2/cmdb/tree/asset/relation/",method:"get",params:t}),c=t=>Object(l["default"])({url:"/api/v2/cmdb/tree/",method:"get",params:t}),d=(t,e)=>Object(l["default"])({url:"/api/v2/cmdb/tree/",method:e,data:t}),u=t=>Object(l["default"])({url:"/api/v2/cmdb/tree/env/",method:"get",params:t}),m=t=>Object(l["default"])({url:"/api/v2/cmdb/tree/module/",method:"get",params:t})},"15a44":function(t,e,a){"use strict";a.r(e);var l=function(){var t=this,e=t._self._c;return e("Card",{attrs:{bordered:!1,"dis-hover":""}},[e("Form",{ref:"formValidate",attrs:{model:t.formValidate,rules:t.ruleValidate,"label-colon":!0,"label-position":"top"}},[e("Row",[e("Col",{staticStyle:{padding:"15px 5px"},attrs:{span:"21",offset:"2"}},[e("span",{staticStyle:{color:"#464c5b","font-size":"16px","font-weight":"bold"}},[t._v("基础信息")])]),e("Col",{attrs:{span:"13",offset:"4"}},[e("Row",{attrs:{gutter:30}},[e("Col",{attrs:{span:"12"}},[e("FormItem",{attrs:{label:"规则名称",prop:"name"}},[e("Input",{attrs:{maxlength:"80",type:"text",placeholder:"请输入规则名称..."},model:{value:t.formValidate.name,callback:function(e){t.$set(t.formValidate,"name",e)},expression:"formValidate.name"}})],1)],1),e("Col",{attrs:{span:"12"}},[e("FormItem",{attrs:{label:"源类型"}},[e("Select",{staticClass:"rule-select",attrs:{filterable:"",placeholder:"请选择资源类型"},model:{value:t.formValidate.asset_type,callback:function(e){t.$set(t.formValidate,"asset_type",e)},expression:"formValidate.asset_type"}},t._l(t.assetList,(function(t){return e("Option",{key:t.value,attrs:{value:t.value,label:t.label}})})),1)],1)],1)],1),e("FormItem",{attrs:{label:"定时刷新"}},[e("RadioGroup",{attrs:{type:"button"},model:{value:t.formValidate.interval,callback:function(e){t.$set(t.formValidate,"interval",e)},expression:"formValidate.interval"}},[e("Radio",{attrs:{label:"yes",disabled:""}},[t._v("启用")]),e("Radio",{attrs:{label:"no"}},[t._v("禁用")])],1)],1),e("Alert",{attrs:{"show-icon":""}},[e("p",[t._v("挂载到上级会自动挂载到下级, 资源类的应都是挂载到服务或者模块")]),t._v(" 后续会根据不通的资源进行禁用")]),e("FormItem",{attrs:{label:"目标拓扑"}},[e("Cascader",{attrs:{data:t.treeData,"change-on-select":""},model:{value:t.formValidate.des_data,callback:function(e){t.$set(t.formValidate,"des_data",e)},expression:"formValidate.des_data"}})],1)],1),e("Col",{staticStyle:{padding:"15px 5px"},attrs:{span:"21",offset:"2"}},[e("span",{staticStyle:{color:"#464c5b","font-size":"16px","font-weight":"bold"}},[t._v("规则条件")])]),e("Col",{staticStyle:{"padding-right":"20px"},attrs:{span:"19",offset:"4"}},[e("p",{staticStyle:{"padding-bottom":"5px"}},[t._v("下列条件之间的关系为且(and)")]),t._l(t.formValidate.condition_list,(function(a,l){return e("FormItem",{key:l+t._uid},[e("div",{staticClass:"alert-con"},[e("Select",{staticClass:"rule-select",attrs:{filterable:""},model:{value:a.src_type,callback:function(e){t.$set(a,"src_type",e)},expression:"item.src_type"}},t._l(t.columnTypeList,(function(t){return e("Option",{key:t.value,attrs:{value:t.value,label:t.label,placeholder:"类型"}})})),1),e("Select",{staticClass:"rule-select1",attrs:{filterable:""},model:{value:a.src_operator,callback:function(e){t.$set(a,"src_operator",e)},expression:"item.src_operator"}},t._l(t.operatorList,(function(t){return e("Option",{key:t.value,attrs:{value:t.value,label:t.label}})})),1),e("Input",{staticClass:"rule-input1",attrs:{clearable:"",maxlength:90,placeholder:"值"},model:{value:a.src_content,callback:function(e){t.$set(a,"src_content",e)},expression:"item.src_content"}}),e("Button",{staticClass:"rule-btn-add",attrs:{shape:"circle",type:"text",icon:"md-add"},on:{click:function(e){return t.handleAdd(l)}}}),1!==t.mapLen?e("Button",{staticClass:"rule-btn-del",attrs:{shape:"circle",type:"text",icon:"md-close"},on:{click:function(e){return t.handleRemove(l)}}}):t._e()],1)])}))],2),e("Col",{attrs:{span:"19",offset:"4"}},[e("FormItem",{staticStyle:{padding:"0px 0px"}},[e("div",{staticStyle:{"padding-top":"12px"}},[e("Button",{attrs:{type:"primary",loading:t.btnLoading},on:{click:function(e){return t.handleSubmit("formValidate")}}},[t._v("确定")]),e("Button",{staticStyle:{"margin-left":"15px"},attrs:{type:"success",ghost:""},on:{click:t.handlePreview}},[t._v("预览规则")]),e("Button",{staticStyle:{"margin-left":"15px"},on:{click:t.handleCancel}},[t._v("返回")])],1)])],1)],1)],1)],1)},i=[],s=a("04c5"),r=a("0b12"),n={components:{},name:"ruleEdit",props:{formData:{type:Object,default:{}}},data(){return{btnLoading:!1,assetList:s["assetList"],operatorList:s["operatorList"],columnTypeList:s["columnTypeList"],mapLen:null,treeData:[],ruleValidate:{name:[{required:!0,message:"名称不能为空",trigger:"blur"}],status:[{required:!0,message:"不能为空",trigger:"change"}],channel_name:[{required:!0,type:"number",message:"不能为空",trigger:"change"}]}}},filters:{},methods:{handleCancel(){JSON.stringify(this.formValidate)!=JSON.stringify(this.formData)?this.$Modal.confirm({content:"<p>编辑还没有保存，确定要离开？</p>",onOk:()=>{this.$emit("edit-close")},onCancel:()=>{this.$Message.info("回头是岸")}}):this.$emit("edit-close")},async handleGetData(){const t=await Object(r["getServiceTreelist"])();0==t.code?(this.treeData=t.data,this.changeId2(this.treeData,"title","label","value")):this.$Message.error(t.msg)},changeId2(t,e,a,l){null!=t&&t.forEach(t=>{Object.assign(t,{[a]:t[e],[l]:t[e]}),this.changeId2(t.children,e,a,l)})},handleSubmit(t){this.$refs[t].validate(t=>{t?(this.btnLoading=!0,this.formValidate.name=this.formValidate.name.trim(),setTimeout(()=>{this.$emit("save-data",this.formValidate),this.btnLoading=!1},1e3)):this.$Message.error("表单校验不通过!")})},handleAdd(t){let e=Object.keys(this.formValidate.condition_list).length;console.info(typeof e),e>4?this.$Notice.warning({title:"限制提示",desc:"添加规则的个数不能超过五个",duration:5}):(this.formValidate.condition_list[e]={src_type:"name",src_operator:"==",src_content:""},console.info(this.formValidate.condition_list),this.formValidate.condition_list=JSON.parse(JSON.stringify(this.formValidate.condition_list)))},handleRemove(t){delete this.formValidate.condition_list[t],this.formValidate.condition_list=JSON.parse(JSON.stringify(this.formValidate.condition_list))},handlePreview(){this.$Notice.warning({title:"限制提示",desc:"请到列表处, 点击刷新可以预览数据",duration:5})}},watch:{formValidate(t){},"formValidate.condition_list":{handler(t,e){this.mapLen=Object.keys(this.formValidate.condition_list).length,console.log("正在被侦听",this.mapLen)},deep:!0}},computed:{formValidate:function(){return this.formData}},mounted(){this.handleGetData()}},o=n,c=(a("4765"),a("2877")),d=Object(c["a"])(o,l,i,!1,null,"131daf45",null);e["default"]=d.exports},4765:function(t,e,a){"use strict";a("ee92")},ee92:function(t,e,a){}}]);
//# sourceMappingURL=chunk-e652771c.1854421e.js.map