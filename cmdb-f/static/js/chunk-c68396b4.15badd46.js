(window["webpackJsonp_cmdb"]=window["webpackJsonp_cmdb"]||[]).push([["chunk-c68396b4","chunk-2d0c17f4"],{"45fc":function(t,e,a){"use strict";a.r(e),a.d(e,"getVPC",(function(){return r})),a.d(e,"optVPC",(function(){return o}));var s=a("be3b");const r=t=>Object(s["default"])({url:"/api/v2/cmdb/vpc/",method:"get",params:t}),o=(t,e)=>Object(s["default"])({url:"/api/v2/cmdb/vpc/",method:e,data:t})},"78fd":function(t,e,a){},8219:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t._self._c;return e("Card",{attrs:{bordered:!1,"dis-hover":""}},[e("Form",{ref:"formValidate",attrs:{model:t.formValidate,rules:t.ruleValidate,"label-colon":!0,"label-position":"top"}},[e("Row",[e("Col",{attrs:{span:"13",offset:"4"}},[t.formData.id?e("FormItem",{attrs:{label:"云区域名称",prop:"name"}},[e("Input",{attrs:{maxlength:"50",type:"text",disabled:"",placeholder:"请输入规则名称..."},model:{value:t.formValidate.name,callback:function(e){t.$set(t.formValidate,"name",e)},expression:"formValidate.name"}})],1):e("FormItem",{attrs:{label:"云区域名称",prop:"name"}},[e("Input",{attrs:{maxlength:"50",type:"text",placeholder:"请输入规则名称..."},model:{value:t.formValidate.name,callback:function(e){t.$set(t.formValidate,"name",e)},expression:"formValidate.name"}})],1),e("Row",{attrs:{gutter:5}},[e("Col",{attrs:{span:"8"}},[e("FormItem",{attrs:{label:"云区域ID",prop:"cloud_region_id"}},[e("Input",{attrs:{maxlength:"10",type:"text",placeholder:"云区域ID、代理ID..."},model:{value:t.formValidate.cloud_region_id,callback:function(e){t.$set(t.formValidate,"cloud_region_id",e)},expression:"formValidate.cloud_region_id"}})],1)],1),e("Col",{attrs:{span:"8"}},[e("FormItem",{attrs:{label:"代理地址",prop:"proxy_ip"}},[e("Input",{attrs:{maxlength:"100",type:"text",placeholder:"连接代理节点IP地址或域名地址，一般为内网LB或者内网域名"},model:{value:t.formValidate.proxy_ip,callback:function(e){t.$set(t.formValidate,"proxy_ip",e)},expression:"formValidate.proxy_ip"}})],1)],1),e("Col",{attrs:{span:"8"}},[e("FormItem",{attrs:{label:"自动修改AgentID",prop:"auto_update_agent_id"}},[e("Select",{attrs:{placeholder:"请选择"},model:{value:t.formValidate.auto_update_agent_id,callback:function(e){t.$set(t.formValidate,"auto_update_agent_id",e)},expression:"formValidate.auto_update_agent_id"}},[e("Option",{attrs:{value:"yes"}},[t._v("是")]),e("Option",{attrs:{value:"no"}},[t._v("否")])],1)],1)],1)],1),e("Row",{attrs:{gutter:5}},[e("Col",{attrs:{span:"12"}},[e("FormItem",{attrs:{label:"堡垒机组织ID"}},[e("Input",{attrs:{maxlength:"30",type:"text",placeholder:"堡垒机组织ID..."},model:{value:t.formValidate.jms_org_id,callback:function(e){t.$set(t.formValidate,"jms_org_id",e)},expression:"formValidate.jms_org_id"}})],1)],1),e("Col",{attrs:{span:"12"}},[e("FormItem",{attrs:{label:"堡垒机账号模板ID"}},[e("Input",{attrs:{maxlength:"100",type:"text",placeholder:"堡垒机账号模板ID"},model:{value:t.formValidate.jms_account_template,callback:function(e){t.$set(t.formValidate,"jms_account_template",e)},expression:"formValidate.jms_account_template"}})],1)],1)],1)],1),e("Col",{attrs:{span:"13",offset:"4"}},[e("Row",{attrs:{gutter:2}},[e("Col",{attrs:{span:"8"}},[e("FormItem",{attrs:{label:"",prop:"ssh_user"}},[e("Input",{attrs:{maxlength:"25",type:"text",placeholder:"用户名..."},model:{value:t.formValidate.ssh_user,callback:function(e){t.$set(t.formValidate,"ssh_user",e)},expression:"formValidate.ssh_user"}},[e("span",{attrs:{slot:"prepend"},slot:"prepend"},[t._v("ssh")])])],1)],1),e("Col",{attrs:{span:"8"}},[e("FormItem",{attrs:{label:"",prop:"ssh_ip"}},[e("Input",{attrs:{maxlength:"100",type:"text",placeholder:"主机/ip..."},model:{value:t.formValidate.ssh_ip,callback:function(e){t.$set(t.formValidate,"ssh_ip",e)},expression:"formValidate.ssh_ip"}},[e("span",{attrs:{slot:"prepend"},slot:"prepend"},[t._v("@")])])],1)],1),e("Col",{attrs:{span:"8"}},[e("FormItem",{attrs:{label:"",prop:"ssh_port"}},[e("Input",{attrs:{maxlength:"10",type:"text",placeholder:"端口..."},model:{value:t.formValidate.ssh_port,callback:function(e){t.$set(t.formValidate,"ssh_port",e)},expression:"formValidate.ssh_port"}},[e("span",{attrs:{slot:"prepend"},slot:"prepend"},[t._v("-p")])])],1)],1)],1)],1),e("Col",{attrs:{span:"13",offset:"4"}},[t._l(t.formValidate.asset_group_rules,(function(a,s){return[t.formValidate.asset_group_rules&&0!==t.formValidate.asset_group_rules.length?e("FormItem",{attrs:{label:"虚拟局域网"}},[0==s?e("Alert",{staticStyle:{"min-width":"500px","margin-bottom":"8px"},attrs:{"show-icon":""}},[t._v("卡片内的条件关系为且。")]):t._e(),e("Row",{attrs:{gutter:20}},[e("Col",{attrs:{span:"24"}},[a.length>0?e("Card",{staticStyle:{"min-width":"500px","margin-bottom":"0px"},attrs:{"dis-hover":""}},t._l(a,(function(r,o){return r.status?e("FormItem",{key:o+t._uid},[e("div",{staticClass:"alert-con",staticStyle:{"margin-bottom":"10px"}},[t._v(" "+t._s(o+1)+" - "),e("Cascader",{staticStyle:{width:"750px"},attrs:{data:t.vpcOptions},model:{value:r.query_value,callback:function(e){t.$set(r,"query_value",e)},expression:"item.query_value"}}),e("Button",{staticClass:"rule-btn-add",attrs:{shape:"circle",type:"text",icon:"md-add"},on:{click:function(e){return t.handleAddRules(s)}}}),1!==a.length?e("Button",{staticClass:"rule-btn-del",attrs:{shape:"circle",type:"text",icon:"md-close"},on:{click:function(e){return t.handleRemoveRules(s,o)}}}):t._e()],1)]):t._e()})),1):t._e(),t.formValidate.asset_group_rules.length>1&&2!=s?e("p",{staticStyle:{"padding-top":"15px"}},[t._v("或")]):t._e()],1),e("Col",{attrs:{span:"2"}},[1!==t.formValidate.asset_group_rules.length?e("a",{on:{click:function(e){return e.preventDefault(),t.handleRemoveCard(s)}}},[t._v(" 删除")]):t._e()])],1)],1):t._e()]}))],2),e("Col",{attrs:{span:"13",offset:"4"}},[e("FormItem",{attrs:{label:"网域密钥"}},[e("Input",{attrs:{type:"textarea",maxlength:"65500",autosize:{minRows:6,maxRows:15},placeholder:"当前云区域网域私钥..."},model:{value:t.formValidate.ssh_key,callback:function(e){t.$set(t.formValidate,"ssh_key",e)},expression:"formValidate.ssh_key"}})],1)],1),e("Col",{attrs:{span:"13",offset:"4"}},[e("FormItem",{attrs:{label:"网域公钥"}},[e("Input",{attrs:{type:"textarea",maxlength:"65500",autosize:{minRows:3,maxRows:15},placeholder:"当前云区域网域公钥..."},model:{value:t.formValidate.ssh_pub_key,callback:function(e){t.$set(t.formValidate,"ssh_pub_key",e)},expression:"formValidate.ssh_pub_key"}})],1)],1),e("Col",{attrs:{span:"13",offset:"4"}},[e("FormItem",{attrs:{label:"备注信息"}},[e("Input",{attrs:{type:"textarea",maxlength:"65500",autosize:{minRows:2,maxRows:5},placeholder:"备注信息..."},model:{value:t.formValidate.detail,callback:function(e){t.$set(t.formValidate,"detail",e)},expression:"formValidate.detail"}})],1)],1),e("Col",{attrs:{span:"19",offset:"4"}},[e("FormItem",[e("Button",{attrs:{type:"primary",loading:t.btnLoading},on:{click:function(e){return t.handleSubmit("formValidate")}}},[t._v("确定")]),e("Button",{staticStyle:{"margin-left":"15px"},on:{click:t.handleCancel}},[t._v("返回")])],1)],1)],1)],1)],1)},r=[],o=(a("14d9"),a("30b3")),l=a("45fc"),i={components:{},name:"cloudRegionEdit",props:{formData:{type:Object,default:{}}},data(){return{btnLoading:!1,cloudList:[],vpcList:[],vpcOptions:[],vendorMap:{},ruleValidate:{name:[{required:!0,message:"名称不能为空",trigger:"blur"}],cloud_region_id:[{required:!0,message:"不能为空",trigger:"blur"}],ssh_user:[{required:!0,message:"不能为空",trigger:"blur"}],proxy_ip:[{required:!0,message:"不能为空",trigger:"blur"}],detail:[{type:"string",max:300,message:"备注也不能太长吧",trigger:"blur"}],auto_update_agent_id:[{type:"string",max:10,message:"不能为空",trigger:"blur",required:!0}],asset_group_rules:[{type:"array",max:10,message:"不能为空",trigger:"blur",required:!0}]}}},filters:{testF(t,e){return 1===e?"资产 B":2===e?"资产 C":0===e?"资产 A":void 0}},methods:{transformData(t){return t.forEach(t=>{t.cloud_zh_name&&(this.vendorMap[t.cloud_zh_name]||(this.vendorMap[t.cloud_zh_name]={}),this.vendorMap[t.cloud_zh_name][t.region]||(this.vendorMap[t.cloud_zh_name][t.region]=[]),this.vendorMap[t.cloud_zh_name][t.region].push({label:t.vpc_name,value:t.instance_id}))}),Object.keys(this.vendorMap).map(t=>({label:t,value:t,children:Object.keys(this.vendorMap[t]).map(e=>({label:e,value:e,children:this.vendorMap[t][e]}))}))},async getCloudSettingList(){const t=await Object(o["getCloudSettinglist"])();0===t.code?this.cloudList=t.data:this.$message.error(""+t.msg)},getVpcCloudName(t){const e=this.cloudList.find(e=>e.account_id===t);return e?e.name:""},getVpcRegion(t){const e=this.vpcList.find(e=>e.vpc_name===t);return e?e.region:""},async getVpcList(){const t={page_number:1,page_size:300},e=await Object(l["getVPC"])(t);if(0===e.code){this.vpcList=e.data;for(const t of this.vpcList)t.cidr_block_v4&&(t.vpc_name=t.vpc_name+"("+t.cidr_block_v4+")"),t.cloud_zh_name=this.getVpcCloudName(t.account_id);this.vpcOptions=this.transformData(this.vpcList)}else this.$message.error(""+e.msg)},handleAddRules(t){this.index++,this.formValidate.asset_group_rules[t].length>9?this.$Notice.warning({title:"限制提示",desc:"添加指标的个数不能超过十个",duration:10}):this.formValidate.asset_group_rules[t].push({index:this.index,query_name:"vpc",query_conditions:"=",query_value:[],status:1})},handleRemoveRules(t,e){this.formValidate.asset_group_rules[t].splice(e,1)},handleRemoveCard(t){this.formValidate.asset_group_rules.splice(t,1)},handleCancel(){JSON.stringify(this.formValidate)!=JSON.stringify(this.formData)?this.$Modal.confirm({content:"<p>编辑还没有保存，确定要离开？</p>",onOk:()=>{this.$emit("edit-close")},onCancel:()=>{this.$Message.info("回头是岸")}}):this.$emit("edit-close")},handleSubmit(t){this.$refs[t].validate(t=>{if(t){if(this.formValidate.asset_group_rules)for(const t of this.formValidate.asset_group_rules)for(const e of t){if(1===e.status&&Array.isArray(e.query_value)&&e.query_value.length<2)return void this.$Notice.warning({title:"查询条件存在空值！"});if(!e.query_value[e.query_value.length-1])return void this.$Notice.warning({title:"VPC存在空值！"})}this.btnLoading=!0,this.formValidate.name=this.formValidate.name.trim(),setTimeout(()=>{this.$emit("save-data",this.formValidate),this.btnLoading=!1},1e3)}else this.$Message.error("表单校验不通过!")})}},watch:{formValidate(t){}},computed:{formValidate:function(){return this.formData}},mounted(){this.getCloudSettingList(),this.getVpcList()}},n=i,d=(a("b115"),a("2877")),p=Object(d["a"])(n,s,r,!1,null,"280247bb",null);e["default"]=p.exports},b115:function(t,e,a){"use strict";a("78fd")}}]);
//# sourceMappingURL=chunk-c68396b4.15badd46.js.map