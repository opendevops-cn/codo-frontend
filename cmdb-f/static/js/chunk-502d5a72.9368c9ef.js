(window["webpackJsonp_cmdb"]=window["webpackJsonp_cmdb"]||[]).push([["chunk-502d5a72","chunk-5ab71d9c","chunk-5cb3ad88","chunk-852f4c9e","chunk-2d225f8a","chunk-2d0c17f4","chunk-2d0ae8c9"],{"06f7":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("Drawer",{attrs:{title:t.modalData.title,width:"70%",draggable:""},on:{"on-close":t.handleCancel},model:{value:t.modalData.show,callback:function(e){t.$set(t.modalData,"show",e)},expression:"modalData.show"}},[e("div",{staticClass:"search-con search-con-top"},[e("Input",{staticClass:"search-input",attrs:{search:"",placeholder:"输入关键字全局搜索"},on:{"on-search":t.handleSearch},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleSearch.apply(null,arguments)}},model:{value:t.initPara.searchVal,callback:function(e){t.$set(t.initPara,"searchVal",e)},expression:"initPara.searchVal"}})],1),e("Table",{ref:"selection",attrs:{size:"small",columns:t.columns,data:t.tableData},on:{"on-selection-change":t.handleSelect}}),e("div",{staticStyle:{margin:"10px",overflow:"hidden"}},[e("div",{staticStyle:{float:"left"}},[e("Page",{attrs:{total:t.i.pageTotal,current:t.initPara.page_number,"page-size":t.initPara.page_size,"show-total":"","show-sizer":"","page-size-opts":[15,50,100]},on:{"on-change":t.handlerChangePage,"on-page-size-change":t.handlePageSize}})],1)])],1)},s=[],n=(a("14d9"),a("e757")),o={components:{},name:"regionAssetPreview",props:{modalData:{type:Object,default:{}}},data(){return{initPara:{page_number:1,page_size:15,searchVal:null},i:{pageTotal:0,tableLoading:!1},selectList:[],tableData:[],columns:[{type:"selection",key:"selection",width:60,align:"center"},{title:"ID",key:"id",minWidth:100,align:"center"},{title:"资源名",key:"name",minWidth:150,align:"center"},{title:"云厂商",key:"cloud_name",minWidth:150,align:"center"},{title:"地域",key:"region",minWidth:150,align:"center"},{title:"内网IP",key:"inner_ip",minWidth:120,maxWidth:170,align:"center"},{title:"状态",key:"state",minWidth:110,maxWidth:140,align:"center"}]}},methods:{handleCancel(){this.$emit("close")},async handleGetData(){this.initPara=Object.assign(this.initPara,{region_id:this.modalData.region_id});const t=await Object(n["previewCloudRegion"])(this.initPara);0==t.code?(this.tableData=t.data,this.i.pageTotal=t.count):this.$Notice.error({title:""+t.msg})},handleDel(){this.$emit("del",{id_list:this.selectList,region_id:this.modalData.region_id})},handleSelect(t){let e=[];t.forEach(t=>{e.push(t.id)}),this.selectList=e},handleSearch(){this.initPara.page_number=1,this.handleGetData()},handlerChangePage(t){this.initPara.page_number=t,this.handleGetData()},handlePageSize(t){this.initPara.page_number=1,this.initPara.page_size=t,this.handleGetData()}},watch:{},computed:{},mounted(){}},l=o,r=(a("9696"),a("2877")),d=Object(r["a"])(l,i,s,!1,null,"16f6d2f2",null);e["default"]=d.exports},"0b12":function(t,e,a){"use strict";a.r(e),a.d(e,"postTreeAsset",(function(){return s})),a.d(e,"getTreeAsset",(function(){return n})),a.d(e,"changeTreeAssetStatus",(function(){return o})),a.d(e,"deleteTreeAsset",(function(){return l})),a.d(e,"getRelation",(function(){return r})),a.d(e,"getServiceTreelist",(function(){return d})),a.d(e,"operationTree",(function(){return c})),a.d(e,"getBizEnv",(function(){return u})),a.d(e,"getTreeModule",(function(){return h}));var i=a("be3b");const s=t=>Object(i["default"])({url:"/api/v2/cmdb/tree/asset/",method:"post",data:t}),n=t=>Object(i["default"])({url:"/api/v2/cmdb/tree/asset/",method:"get",params:t}),o=t=>Object(i["default"])({url:"/api/v2/cmdb/tree/asset/",method:"patch",data:t}),l=t=>Object(i["default"])({url:"/api/v2/cmdb/tree/asset/",method:"delete",data:t}),r=t=>Object(i["default"])({url:"/api/v2/cmdb/tree/asset/relation/",method:"get",params:t}),d=t=>Object(i["default"])({url:"/api/v2/cmdb/tree/",method:"get",params:t}),c=(t,e)=>Object(i["default"])({url:"/api/v2/cmdb/tree/",method:e,data:t}),u=t=>Object(i["default"])({url:"/api/v2/cmdb/tree/env/",method:"get",params:t}),h=t=>Object(i["default"])({url:"/api/v2/cmdb/tree/module/",method:"get",params:t})},"1ade":function(t,e,a){},"229e":function(t,e,a){"use strict";a("1ade")},"3aae":function(t,e,a){},"45fc":function(t,e,a){"use strict";a.r(e),a.d(e,"getVPC",(function(){return s})),a.d(e,"optVPC",(function(){return n}));var i=a("be3b");const s=t=>Object(i["default"])({url:"/api/v2/cmdb/vpc/",method:"get",params:t}),n=(t,e)=>Object(i["default"])({url:"/api/v2/cmdb/vpc/",method:e,data:t})},5047:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("div",[t.showEdit?e("cloud-region-edit",{attrs:{formData:t.theData},on:{"save-data":t.handleSaveData,"edit-close":t.handleClose}}):e("Card",{attrs:{"dis-hover":"",bordered:!1}},[e("Alert",{attrs:{type:"success","show-icon":""}},[t._v(" 使用说明： "),e("Icon",{attrs:{slot:"icon",type:"ios-bulb-outline"},slot:"icon"}),e("template",{slot:"desc"},[e("p",[t._v("云区域是主机内网的逻辑区域划分，跨云区域之间的主机不可以通过内网直接互相访问，默认主机属于直连区域。")]),e("p",[t._v("云区域关联到主机使用vpc自动添加，同一组云区域vpc不能超十五个，添加后自动修改agent_id 为 内网IP:proxy_id。")]),e("p",[t._v("云区域同步关联的主机到堡垒机，需要指定堡垒机组织【Default组织ID】、网域、账号模板信息，普通、特权账号分别对应开发、运维账号。")]),e("p",[t._v("创建云区域后，需要在云区域节点上部署 agent proxy，并同步云区域信息到节点管理，用于agent自动部署。")]),e("p",[t._v("实例只能存在于一个云区域内")])])],2),e("div",[e("div",{staticClass:"search-con search-con-top"},[e("Input",{staticClass:"search-input",attrs:{search:"",maxlength:50,placeholder:"输入关键字全局搜索"},on:{"on-search":t.handleSearch},model:{value:t.initPara.searchVal,callback:function(e){t.$set(t.initPara,"searchVal",e)},expression:"initPara.searchVal"}}),e("ButtonGroup",{staticClass:"search-btn"},[e("Button",{on:{click:t.handleAdd}},[t._v("添加云区域")]),e("Button",{attrs:{disabled:0===t.selectList.length},on:{click:function(t){}}},[t._v("同步至节点管理")])],1)],1),e("Table",{attrs:{size:"small",columns:t.columns,data:t.tableData,loading:t.i.tableLoading},on:{"on-sort-change":t.handleSort,"on-selection-change":t.handleSelect}}),e("div",{staticStyle:{margin:"10px",overflow:"hidden"}},[e("div",{staticStyle:{float:"left"}},[e("Page",{attrs:{total:t.i.pageTotal,current:t.initPara.page_number,"page-size":t.initPara.page_size,"show-total":"","show-sizer":"","page-size-opts":[15,50,100]},on:{"on-change":t.handlerChangePage,"on-page-size-change":t.handlePageSize}})],1)])],1)],1),t.modalData.name?[e("region-asset",{attrs:{modalData:t.modalData},on:{close:t.handleClose,relevance:t.handleRelevance}})]:t._e(),e("region-asset-preview",{ref:"assetPreview",attrs:{modalData:t.modalPreview},on:{close:t.handleClose,relevance:t.handleRelevance,del:t.handleReDel}})],2)},s=[],n=(a("14d9"),a("e757")),o=a("8219"),l=a("c03a"),r=a("06f7"),d=(a("30b3"),{components:{cloudRegionEdit:o["default"],regionAsset:l["default"],regionAssetPreview:r["default"]},data(){return{modalPreview:{show:!1,title:"预览云区域主机",name:""},modalData:{show:!1,title:"添加主机到当前云区域",id:null,name:"",action:"put"},action:"post",showEdit:!1,selectList:[],cloudList:[],theData:{},initForm:{asset_group_rules:[[{query_name:"vpc",query_conditions:"=",query_value:[],index:1,status:1}]],accounts:[{account_type:"dev",jms_account_template_id:"",index:1,status:1}],auto_update_agent_id:"no"},initPara:{page_number:1,page_size:50,searchVal:null,order_by:"name",order:"ascend"},i:{pageTotal:0,tableLoading:!0},tableData:[],columns:[{type:"selection",key:"selection",width:60,align:"center"},{title:"云区域ID",key:"cloud_region_id",minWidth:110,maxWidth:140,sortable:!0},{title:"云区域名称",key:"name",minWidth:170,maxWidth:300,sortable:!0},{title:"代理IP",key:"proxy_ip",minWidth:130,maxWidth:180,align:"center",sortable:!0},{title:"SSH IP",key:"ssh_ip",minWidth:130,maxWidth:180,align:"center",sortable:!0},{title:"状态",key:"state",minWidth:110,maxWidth:140,align:"center",sortable:!0},{title:"备注",key:"detail",minWidth:200,tooltip:!0},{title:"更新时间",key:"update_time",minWidth:170,maxWidth:210,sortable:!0},{title:"操作",key:"handle",minWidth:230,render:(t,e)=>t("div",[t("a",{style:{marginRight:"10px"},on:{click:()=>{this.handlePreview(e.row)}}},"预览"),t("a",{style:{marginRight:"10px"},on:{click:()=>{this.handleClone(e.row)}}},"克隆"),t("a",{style:{marginRight:"10px"},on:{click:()=>{this.handleEdit(e.row)}}},"编辑"),t("a",{style:{color:"red",marginRight:"10px"},on:{click:()=>{this.handleDel(e.row)}}},"删除")])}]}},methods:{async handleGetData(){const t=await Object(n["getCloudRegion"])(this.initPara);0==t.code?(this.tableData=t.data,this.i.pageTotal=t.count):this.$Message.error(t.msg),this.i.tableLoading=!1},handleClose(){this.showEdit=!1,this.modalData.show=!1,this.modalPreview.show=!1,this.handleGetData(),this.selectList=[]},handleAdd(){this.action="post",this.showEdit=!0,this.theData=Object.assign(this.$options.data().theData,this.initForm)},handleEdit(t){this.action="put",this.showEdit=!0,t.asset_group_rules||(t.asset_group_rules=this.initForm.asset_group_rules),t.accounts||(t.accounts=this.initForm.accounts),this.theData=t},handleClone(t){this.action="post",this.showEdit=!0,delete t.id,t.name=t.name+"-副本",t.asset_group_rules||(t.asset_group_rules=this.initForm.asset_group_rules),this.theData=t},handleSaveData(t){Object(n["optCloudRegion"])(t,this.action).then(t=>{0==t.code?(this.$Notice.success({title:""+t.msg}),this.handleClose()):this.$Notice.error({title:""+t.msg})})},handleDel(t){this.$Modal.confirm({title:"提醒",content:`<p>确认要删除云区域 《${t.name}》 之后无法找回, 请谨慎操作!</p>`,onOk:()=>{Object(n["optCloudRegion"])({id_list:[t.id]},"delete").then(t=>{0===t.code?(this.$Notice.success({title:""+t.msg}),this.handleGetData()):this.$Notice.error({title:""+t.msg})})},onCancel:()=>{this.$Message.info("回头是岸~")}})},handleAddAsset(t){this.modalData.show=!0,this.modalData.name=t.name,this.modalData.id=t.id},async handlePreview(t){this.modalPreview.show=!0,this.modalPreview.region_id=t.id,this.$refs.assetPreview.handleGetData()},async handleRelevance(t){let e=await Object(n["optCloudRegion"])(t,"patch");0===e.code?(this.$Notice.success({title:""+e.msg}),this.handleClose()):this.$Notice.error({title:""+e.msg})},handleReDel(t){this.$Modal.confirm({title:"提醒",content:"<p>确认要解除关联？, 请谨慎操作!</p>",onOk:()=>{Object(n["optCloudRegionPro"])(t,"delete").then(t=>{0===t.code?(this.$Notice.success({title:""+t.msg}),this.$refs.assetPreview.handleGetData()):this.$Notice.error({title:""+t.msg})})},onCancel:()=>{this.$Message.info("回头是岸~")}})},handleSelect(t){let e=[];t.forEach(t=>{e.push(t.id)}),this.selectList=e},handleSearch(){this.initPara.page_number=1,this.handleGetData()},handleSort(t,e,a){this.initPara.order="asc"===t.order?"ascend":"descend",this.initPara.order_by=t.key,this.handleGetData()},handlerChangePage(t){this.initPara.page_number=t,this.handleGetData()},handlePageSize(t){this.initPara.page_number=1,this.initPara.page_size=t,this.handleGetData()}},watch:{},mounted(){this.handleGetData()}}),c=d,u=(a("70ec"),a("2877")),h=Object(u["a"])(c,i,s,!1,null,"49b1a818",null);e["default"]=h.exports},"70ec":function(t,e,a){"use strict";a("b9d5")},8219:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("Card",{attrs:{bordered:!1,"dis-hover":""}},[e("Form",{ref:"formValidate",attrs:{model:t.formValidate,rules:t.ruleValidate,"label-colon":!0,"label-position":"right","label-width":200}},[e("Row",[e("Col",{attrs:{span:"12",offset:"4"}},[e("Divider",[t._v("基础配置")]),t.formData.id?e("FormItem",{attrs:{label:"云区域名称",prop:"name"}},[e("Input",{attrs:{maxlength:"50",type:"text",disabled:"",placeholder:"请输入规则名称..."},model:{value:t.formValidate.name,callback:function(e){t.$set(t.formValidate,"name",e)},expression:"formValidate.name"}})],1):e("FormItem",{attrs:{label:"云区域名称",prop:"name"}},[e("Input",{attrs:{maxlength:"50",type:"text",placeholder:"请输入规则名称..."},model:{value:t.formValidate.name,callback:function(e){t.$set(t.formValidate,"name",e)},expression:"formValidate.name"}})],1),e("FormItem",{attrs:{label:"云区域ID",prop:"cloud_region_id"}},[e("Input",{attrs:{maxlength:"10",type:"text",placeholder:"云区域ID、代理ID..."},model:{value:t.formValidate.cloud_region_id,callback:function(e){t.$set(t.formValidate,"cloud_region_id",e)},expression:"formValidate.cloud_region_id"}})],1),e("FormItem",{attrs:{label:"代理地址",prop:"proxy_ip"}},[e("Input",{attrs:{maxlength:"100",type:"text",placeholder:"连接代理节点IP地址或域名地址，一般为内网LB或者内网域名"},model:{value:t.formValidate.proxy_ip,callback:function(e){t.$set(t.formValidate,"proxy_ip",e)},expression:"formValidate.proxy_ip"}})],1),e("FormItem",{attrs:{label:"SSH",prop:"ssh_user"}},[e("Row",{attrs:{gutter:6}},[e("Col",{attrs:{span:"8"}},[e("Input",{attrs:{maxlength:"25",type:"text",placeholder:"用户名..."},model:{value:t.formValidate.ssh_user,callback:function(e){t.$set(t.formValidate,"ssh_user",e)},expression:"formValidate.ssh_user"}},[e("span",{attrs:{slot:"prepend"},slot:"prepend"},[t._v("ssh")])])],1),e("Col",{attrs:{span:"8"}},[e("Input",{attrs:{maxlength:"100",type:"text",placeholder:"主机/ip..."},model:{value:t.formValidate.ssh_ip,callback:function(e){t.$set(t.formValidate,"ssh_ip",e)},expression:"formValidate.ssh_ip"}},[e("span",{attrs:{slot:"prepend"},slot:"prepend"},[t._v("@")])])],1),e("Col",{attrs:{span:"8"}},[e("Input",{attrs:{maxlength:"10",type:"text",placeholder:"端口..."},model:{value:t.formValidate.ssh_port,callback:function(e){t.$set(t.formValidate,"ssh_port",e)},expression:"formValidate.ssh_port"}},[e("span",{attrs:{slot:"prepend"},slot:"prepend"},[t._v("-p")])])],1)],1)],1),t._l(t.formValidate.asset_group_rules,(function(a,i){return[t.formValidate.asset_group_rules&&0!==t.formValidate.asset_group_rules.length?e("FormItem",{attrs:{label:"关联主机"}},[0===i?e("Alert",{staticStyle:{width:"100%","margin-bottom":"8px"},attrs:{"show-icon":""}},[t._v(" 通过关联vpc把一组vpc下的主机资产划分到云区域，vpc之间的的条件关系为或。 ")]):t._e(),e("Row",{attrs:{gutter:20}},[e("Col",[a.length>0?e("Card",{staticStyle:{"margin-bottom":"0px"},attrs:{"dis-hover":""}},t._l(a,(function(s,n){return s.status?e("FormItem",{key:n+t._uid},[e("div",{staticClass:"alert-con",staticStyle:{"margin-bottom":"10px"}},[e("span",{staticStyle:{"margin-right":"5px","min-width":"30px",display:"inline-block"}},[t._v(" "+t._s(n+1)+" - ")]),e("Cascader",{staticStyle:{width:"700px","margin-left":"10px"},attrs:{data:t.vpcOptions},model:{value:s.query_value,callback:function(e){t.$set(s,"query_value",e)},expression:"item.query_value"}}),e("Button",{staticClass:"rule-btn-add",attrs:{shape:"circle",type:"text",icon:"md-add"},on:{click:function(e){return t.handleAddRules(i)}}}),1!==a.length?e("Button",{staticClass:"rule-btn-del",attrs:{shape:"circle",type:"text",icon:"md-close"},on:{click:function(e){return t.handleRemoveRules(i,n)}}}):t._e()],1)]):t._e()})),1):t._e(),t.formValidate.asset_group_rules.length>1&&2!=i?e("p",{staticStyle:{"padding-top":"15px"}},[t._v("或")]):t._e()],1),e("Col",{attrs:{span:"2"}},[1!==t.formValidate.asset_group_rules.length?e("a",{on:{click:function(e){return e.preventDefault(),t.handleRemoveCard(i)}}},[t._v(" 删除")]):t._e()])],1)],1):t._e()]})),e("FormItem",{staticStyle:{width:"100%"},attrs:{prop:"auto_update_agent_id"},scopedSlots:t._u([{key:"label",fn:function(){return[t._v(" 自动修改AgentID "),e("Tooltip",{attrs:{placement:"top-start","max-width":"400"},scopedSlots:t._u([{key:"content",fn:function(){return[e("p",[t._v("如果选择是：会自动把当前云区域ID通过VPC和主机关联，设置主机AgentID为主机IP:云区域ID")])]},proxy:!0}])},[e("Icon",{attrs:{type:"ios-help-circle-outline"}}),t._v(" : ")],1)]},proxy:!0}])},[e("RadioGroup",{model:{value:t.formValidate.auto_update_agent_id,callback:function(e){t.$set(t.formValidate,"auto_update_agent_id",e)},expression:"formValidate.auto_update_agent_id"}},[e("Radio",{attrs:{label:"yes"}},[t._v("是")]),e("Radio",{attrs:{label:"no"}},[t._v("否")])],1)],1),e("Divider",{attrs:{dashed:""}},[t._v("堡垒机配置")]),e("FormItem",{attrs:{prop:"jms_org_id"},scopedSlots:t._u([{key:"label",fn:function(){return[t._v(" 组织ID "),e("Tooltip",{attrs:{placement:"top-start","max-width":"400"},scopedSlots:t._u([{key:"content",fn:function(){return[e("p",[t._v("关联堡垒机组织，社区版不支持组织管理，只有默认Default组织，企业版支持多组织管理")]),e("p",[t._v("堡垒机查看组织ID方法：堡垒机资产管理--\x3e网域列表--\x3e点击网域查看ID")])]},proxy:!0}])},[e("Icon",{attrs:{type:"ios-help-circle-outline"}}),t._v(" : ")],1)]},proxy:!0}])},[e("Input",{attrs:{maxlength:"100",type:"text",placeholder:"堡垒机组织ID..."},model:{value:t.formValidate.jms_org_id,callback:function(e){t.$set(t.formValidate,"jms_org_id",e)},expression:"formValidate.jms_org_id"}})],1),e("FormItem",{attrs:{prop:"jms_domain_id"},scopedSlots:t._u([{key:"label",fn:function(){return[t._v(" 网域ID "),e("Tooltip",{attrs:{placement:"top-start","max-width":"400"},scopedSlots:t._u([{key:"content",fn:function(){return[e("p",[t._v("关联堡垒机网域，指定云区域下的主机属于哪个网域，理论上一个区域的主机归属于同一个网域")]),e("p",[t._v("堡垒机查看网域ID方法：堡垒机资产管理--\x3e网域列表--\x3e点击网域查看ID")])]},proxy:!0}])},[e("Icon",{attrs:{type:"ios-help-circle-outline"}}),t._v(" : ")],1)]},proxy:!0}])},[e("Input",{attrs:{maxlength:"100",type:"text",placeholder:"堡垒机网域ID..."},model:{value:t.formValidate.jms_domain_id,callback:function(e){t.$set(t.formValidate,"jms_domain_id",e)},expression:"formValidate.jms_domain_id"}})],1),e("FormItem",{attrs:{label:"",prop:"jms_account_template"},scopedSlots:t._u([{key:"label",fn:function(){return[t._v(" 特权账号模版ID "),e("Tooltip",{attrs:{placement:"top-start","max-width":"400"},scopedSlots:t._u([{key:"content",fn:function(){return[e("p",[t._v("关联堡垒机特权账户模板，创建主机时需指定特权账号，用户推送创建非特权账号到服务器")]),e("p",[t._v("堡垒机特权账号模版ID方法：堡垒机账号管理--\x3e账号模板--\x3e点击特权账号查看ID")])]},proxy:!0}])},[e("Icon",{attrs:{type:"ios-help-circle-outline"}}),t._v(" : ")],1)]},proxy:!0}])},[e("Input",{attrs:{maxlength:"100",type:"text",placeholder:"堡垒机特权账户模板ID..."},model:{value:t.formValidate.jms_account_template,callback:function(e){t.$set(t.formValidate,"jms_account_template",e)},expression:"formValidate.jms_account_template"}})],1)],2),e("Col",{attrs:{span:"12",offset:"4"}},[t._l(t.formValidate.accounts,(function(a,i){return[a.status?e("FormItem",{key:i,attrs:{label:"账户模板ID "+(i+1),prop:"accounts."+i+".value"},scopedSlots:t._u([{key:"label",fn:function(){return[t._v(" 账户模板ID "),e("Tooltip",{attrs:{placement:"top-start","max-width":"400"},scopedSlots:t._u([{key:"content",fn:function(){return[e("p",[t._v("关联堡垒机特权账户模板，需指定普通账号模板ID和特权账户模板ID，分别用于创建普通用户和特权账户, 如模板不存在则需在堡垒机创建并录入")]),e("p",[t._v("查看堡垒机账号模版ID方法：堡垒机账号管理--\x3e账号模板--\x3e点击特权查看ID")])]},proxy:!0}],null,!0)},[e("Icon",{attrs:{type:"ios-help-circle-outline"}}),t._v(" : ")],1)]},proxy:!0}],null,!0)},[e("Row",[e("Select",{staticStyle:{"margin-right":"1px","margin-left":"1px","max-width":"100px"},attrs:{placeholder:"选择账户类型"},model:{value:a.account_type,callback:function(e){t.$set(a,"account_type",e)},expression:"item.account_type"}},[e("Option",{attrs:{value:"dev"}},[t._v("普通账户")]),e("Option",{attrs:{value:"ops"}},[t._v("特权账户")])],1),e("Input",{staticStyle:{"max-width":"500px"},attrs:{placeholder:"请输入待创建账号模板ID"},model:{value:a.jms_account_template_id,callback:function(e){t.$set(a,"jms_account_template_id",e)},expression:"item.jms_account_template_id"}}),e("Icon",{staticStyle:{"margin-top":"8px","margin-left":"4px"},attrs:{type:"ios-backspace"},on:{click:function(e){return t.handleRemove(i)}}})],1)],1):t._e()]})),e("FormItem",[e("Row",[e("Col",{attrs:{span:"12"}},[e("Tooltip",{attrs:{trigger:"hover",placement:"top-start",content:"只允许添加两个不同类型的账户"}},[e("Button",{attrs:{type:"dashed",long:"",icon:"md-add"},on:{click:function(e){return t.handleAdd(t.account_type)}}},[t._v("添加账户")])],1)],1)],1)],1)],2),e("Col",{attrs:{span:"12",offset:"4"}},[e("FormItem",{attrs:{label:"网域密钥"}},[e("Input",{attrs:{type:"textarea",maxlength:"65500",autosize:{minRows:6,maxRows:15},placeholder:"当前云区域网域私钥..."},model:{value:t.formValidate.ssh_key,callback:function(e){t.$set(t.formValidate,"ssh_key",e)},expression:"formValidate.ssh_key"}})],1)],1),e("Col",{attrs:{span:"12",offset:"4"}},[e("FormItem",{attrs:{label:"网域公钥"}},[e("Input",{attrs:{type:"textarea",maxlength:"65500",autosize:{minRows:3,maxRows:15},placeholder:"当前云区域网域公钥..."},model:{value:t.formValidate.ssh_pub_key,callback:function(e){t.$set(t.formValidate,"ssh_pub_key",e)},expression:"formValidate.ssh_pub_key"}})],1)],1),e("Col",{attrs:{span:"12",offset:"4"}},[e("FormItem",{attrs:{label:"备注信息"}},[e("Input",{attrs:{type:"textarea",maxlength:"65500",autosize:{minRows:2,maxRows:5},placeholder:"备注信息..."},model:{value:t.formValidate.detail,callback:function(e){t.$set(t.formValidate,"detail",e)},expression:"formValidate.detail"}})],1)],1),e("Col",{attrs:{span:"12",offset:"4"}},[e("FormItem",[e("Button",{attrs:{type:"primary",loading:t.btnLoading},on:{click:function(e){return t.handleSubmit("formValidate")}}},[t._v("确定")]),e("Button",{staticStyle:{"margin-left":"15px"},on:{click:t.handleCancel}},[t._v("返回")])],1)],1)],1)],1)],1)},s=[],n=(a("14d9"),a("30b3")),o=a("45fc"),l={components:{},name:"cloudRegionEdit",props:{formData:{type:Object,default:{}}},data(){return{btnLoading:!1,cloudList:[],index:1,vpcList:[],vpcOptions:[],vendorMap:{},account_type:"dev",ruleValidate:{name:[{required:!0,message:"名称不能为空",trigger:"blur"}],cloud_region_id:[{required:!0,message:"不能为空",trigger:"blur"}],ssh_user:[{required:!0,message:"不能为空",trigger:"blur"}],proxy_ip:[{required:!0,message:"不能为空",trigger:"blur"}],detail:[{type:"string",max:300,message:"备注也不能太长吧",trigger:"blur"}],auto_update_agent_id:[{type:"string",max:10,message:"不能为空",trigger:"blur",required:!0}],asset_group_rules:[{type:"array",max:10,message:"不能为空",trigger:"blur",required:!0}],jms_domain_id:[{message:"不能为空",trigger:"blur",required:!0,max:100}],jms_account_template:[{message:"不能为空",trigger:"blur",required:!0,max:100}],jms_org_id:[{required:!0,message:"组织ID为空",trigger:"blur",max:100}]}}},filters:{testF(t,e){return 1===e?"资产 B":2===e?"资产 C":0===e?"资产 A":void 0}},methods:{handleAdd(){if(this.index++,this.index>2)return this.$Notice.warning({title:"条件超出最大限制"}),void this.index--;this.formValidate.accounts.push({account_type:"dev",jms_account_template_id:"",index:this.index,status:1})},handleRemove(t){this.index--,this.formValidate.accounts.splice(t,1)},transformData(t){return t.forEach(t=>{t.cloud_zh_name&&(this.vendorMap[t.cloud_zh_name]||(this.vendorMap[t.cloud_zh_name]={}),this.vendorMap[t.cloud_zh_name][t.region]||(this.vendorMap[t.cloud_zh_name][t.region]=[]),this.vendorMap[t.cloud_zh_name][t.region].push({label:t.vpc_name,value:t.instance_id}))}),Object.keys(this.vendorMap).map(t=>({label:t,value:t,children:Object.keys(this.vendorMap[t]).map(e=>({label:e,value:e,children:this.vendorMap[t][e]}))}))},async getCloudSettingList(){const t=await Object(n["getCloudSettinglist"])();0===t.code?this.cloudList=t.data:this.$message.error(""+t.msg)},getVpcCloudName(t){const e=this.cloudList.find(e=>e.account_id===t);return e?e.name:""},getVpcRegion(t){const e=this.vpcList.find(e=>e.vpc_name===t);return e?e.region:""},async getVpcList(){const t={page_number:1,page_size:300},e=await Object(o["getVPC"])(t);if(0===e.code){this.vpcList=e.data;for(const t of this.vpcList)t.cidr_block_v4&&(t.vpc_name=t.vpc_name+"("+t.cidr_block_v4+")"),t.cloud_zh_name=this.getVpcCloudName(t.account_id);this.vpcOptions=this.transformData(this.vpcList)}else this.$message.error(""+e.msg)},handleAddRules(t){this.index++,this.formValidate.asset_group_rules[t].length>14?this.$Notice.warning({title:"限制提示",desc:"添加指标的个数不能超过十五个",duration:10}):this.formValidate.asset_group_rules[t].push({index:this.index,query_name:"vpc",query_conditions:"=",query_value:[],status:1})},handleRemoveRules(t,e){this.formValidate.asset_group_rules[t].splice(e,1)},handleRemoveCard(t){this.formValidate.asset_group_rules.splice(t,1)},handleCancel(){JSON.stringify(this.formValidate)!=JSON.stringify(this.formData)?this.$Modal.confirm({content:"<p>编辑还没有保存，确定要离开？</p>",onOk:()=>{this.$emit("edit-close")},onCancel:()=>{this.$Message.info("回头是岸")}}):this.$emit("edit-close")},handleSubmit(t){this.$refs[t].validate(t=>{if(t){const t=new Set;let e=!1;if(this.formValidate.accounts)for(const a of this.formValidate.accounts){if(1===a.status&&(""===a.jms_account_template_id||!a.jms_account_template_id))return void this.$Notice.warning({title:"账号模板ID存在空值！"});if(t.has(a.account_type)){e=!0;break}t.add(a.account_type)}if(e)return void this.$Notice.warning({title:"账号类型重复，请检查！"});if(this.formValidate.asset_group_rules)for(const a of this.formValidate.asset_group_rules)for(const t of a){if(1===t.status&&Array.isArray(t.query_value)&&t.query_value.length<2)return void this.$Notice.warning({title:"查询条件存在空值！"});if(!t.query_value[t.query_value.length-1])return void this.$Notice.warning({title:"VPC存在空值！"})}this.btnLoading=!0,this.formValidate.name=this.formValidate.name.trim(),setTimeout(()=>{this.$emit("save-data",this.formValidate),this.btnLoading=!1},1e3)}else this.$Message.error("表单校验不通过!")})}},watch:{formValidate(t){}},computed:{formValidate:function(){return this.formData}},mounted(){this.getCloudSettingList(),this.getVpcList()}},r=l,d=(a("b1dd"),a("2877")),c=Object(d["a"])(r,i,s,!1,null,"7d182a3d",null);e["default"]=c.exports},9696:function(t,e,a){"use strict";a("3aae")},b1dd:function(t,e,a){"use strict";a("bcd4")},b793:function(t,e,a){},b9d5:function(t,e,a){},bcd4:function(t,e,a){},c03a:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("Drawer",{attrs:{title:t.modalData.title,styles:t.styles,width:"70%",draggable:"","mask-closable":!1},on:{"on-close":t.handleCancel},model:{value:t.modalData.show,callback:function(e){t.$set(t.modalData,"show",e)},expression:"modalData.show"}},[e("div",{staticClass:"search-con search-con-top"},[e("div",{staticClass:"search-col"},[e("b",[t._v("选择主机:")])]),e("Cascader",{staticClass:"search-input",attrs:{data:t.treeData,"change-on-select":"",placeholder:"通过拓扑选择主机"},on:{"on-change":t.handleChange},model:{value:t.topoList,callback:function(e){t.topoList=e},expression:"topoList"}})],1),e("Table",{attrs:{size:"small",columns:t.columns,data:t.tableData}}),e("div",{staticStyle:{margin:"10px",overflow:"hidden"}},[e("div",{staticStyle:{float:"left"}},[e("Page",{attrs:{total:t.i.pageTotal,current:t.initPara.page_number,"page-size":t.initPara.page_size,"show-total":"","show-sizer":"","page-size-opts":[15,50,100]},on:{"on-change":t.handlerChangePage,"on-page-size-change":t.handlePageSize}})],1)]),e("div",{staticClass:"drawer-footer"},[e("Button",{staticStyle:{"margin-right":"8px"},on:{click:t.handleCancel}},[t._v("取消")]),e("Button",{staticStyle:{"margin-right":"8px"},attrs:{type:"warning"},on:{click:function(e){return t.handleSubmit()}}},[t._v("关联")])],1)],1)},s=[],n=a("0b12"),o={components:{},name:"regionAsset",props:{modalData:{type:Object,default:{}}},data(){return{topoList:[],params:{},treeData:[],initPara:{page_number:1,page_size:15,searchVal:null},i:{pageTotal:0,tableLoading:!1},tableData:[],columns:[{title:"环境",key:"env_name",width:100,align:"center"},{title:"集群",key:"region_name",minWidth:120,maxWidth:150,align:"center"},{title:"模块",key:"module_name",minWidth:120,maxWidth:170,align:"center"},{title:"资源名",key:"name",minWidth:150,align:"center"},{title:"内网IP",key:"inner_ip",minWidth:120,maxWidth:170,align:"center"},{title:"状态",key:"state",minWidth:110,maxWidth:140,align:"center"}],styles:{height:"calc(100% - 55px)",overflow:"auto",paddingBottom:"53px",position:"static"}}},methods:{handleCancel(){this.$emit("close")},async handleGetData(){const t=await Object(n["getServiceTreelist"])();0==t.code?(this.treeData=t.data,this.changeId2(this.treeData,"title","label","value")):this.$Notice.error({title:""+t.msg})},async handleGetAssetData(){this.params=Object.assign(this.params,this.initPara);const t=await Object(n["getTreeAsset"])(this.params);0==t.code?(this.tableData=t.data,this.i.pageTotal=t.count):this.$Notice.error({title:""+t.msg})},changeId2(t,e,a,i){null!=t&&t.forEach(t=>{Object.assign(t,{[a]:t[e],[i]:t[e]}),this.changeId2(t.children,e,a,i)})},handleChange(t){this.params={asset_type:"server"},t.length>=1&&(this.params["biz_cn"]=t[0]),t.length>=2&&(this.params["env_name"]=t[1]),t.length>=3&&(this.params["region_name"]=t[2]),4==t.length&&(this.params["module_name"]=t[3]),this.handleGetAssetData()},handleSubmit(){this.$emit("relevance",{id:this.modalData.id,topoParams:this.params})},handlerChangePage(t){this.initPara.page_number=t,this.handleGetAssetData()},handlePageSize(t){this.initPara.page_number=1,this.initPara.page_size=t,this.handleGetAssetData()}},watch:{},computed:{},mounted(){this.handleGetData()}},l=o,r=(a("d9d8"),a("229e"),a("2877")),d=Object(r["a"])(l,i,s,!1,null,"7ced1199",null);e["default"]=d.exports},d9d8:function(t,e,a){"use strict";a("b793")},e757:function(t,e,a){"use strict";a.r(e),a.d(e,"previewCloudRegion",(function(){return s})),a.d(e,"optCloudRegionPro",(function(){return n})),a.d(e,"getCloudRegion",(function(){return o})),a.d(e,"optCloudRegion",(function(){return l}));var i=a("be3b");const s=t=>Object(i["default"])({url:"/api/v2/cmdb/cloud_region/preview/",method:"get",params:t}),n=(t,e)=>Object(i["default"])({url:"/api/v2/cmdb/cloud_region/pro/",data:t,method:e}),o=t=>Object(i["default"])({url:"/api/v2/cmdb/cloud_region/",method:"get",params:t}),l=(t,e)=>Object(i["default"])({url:"/api/v2/cmdb/cloud_region/",data:t,method:e})}}]);
//# sourceMappingURL=chunk-502d5a72.9368c9ef.js.map