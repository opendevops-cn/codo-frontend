(window["webpackJsonp_cmdb"]=window["webpackJsonp_cmdb"]||[]).push([["chunk-a5da55ca","chunk-2d0c8c03"],{"55e2":function(e,t,a){"use strict";a.r(t),a.d(t,"getSecurityGroup",(function(){return i})),a.d(t,"optSecurityGroup",(function(){return o})),a.d(t,"getSecurityGroupRefs",(function(){return l}));var s=a("be3b");const i=e=>Object(s["default"])({url:"/api/v2/cmdb/security_group/",method:"get",params:e}),o=(e,t)=>Object(s["default"])({url:"/api/v2/cmdb/security_group/",method:t,data:e}),l=e=>Object(s["default"])({url:"/api/v2/cmdb/security_group/refs/",method:"get",params:e})},"6a12":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("Modal",{attrs:{title:e.title,loading:e.modalLoading,width:70},on:{"on-ok":e.ok,"on-cancel":e.cancel},model:{value:e.showModal,callback:function(t){e.showModal=t},expression:"showModal"}},[t("div",{staticClass:"modal__content"},[t("Form",{ref:"form",attrs:{model:e.formValues,"label-width":100,rules:e.formRules}},[t("div",{staticClass:"modal__content__section"},[t("div",{staticClass:"modal__content__section__title"},[e._v("基础配置")]),t("div",{staticClass:"modal__content__section__form"},[t("div",{staticClass:"modal__content__section__form__custom"},[t("FormItem",{attrs:{prop:"name",label:"模板名称"}},[t("Input",{attrs:{type:"text",placeholder:"请输入模板名称"},model:{value:e.formValues.name,callback:function(t){e.$set(e.formValues,"name",t)},expression:"formValues.name"}})],1)],1),t("div",{staticClass:"modal__content__section__form__select"},[t("FormItem",{attrs:{prop:"res_type",label:"模板类型"}},[t("Select",{attrs:{type:"text",placeholder:"请选择模板类型"},model:{value:e.formValues.res_type,callback:function(t){e.$set(e.formValues,"res_type",t)},expression:"formValues.res_type"}},e._l(e.resTypeOptions,(function(a){return t("Option",{key:a.value,attrs:{value:a.value}},[e._v(e._s(a.label))])})),1)],1)],1),t("div",{staticClass:"modal__content__section__form__longer"},[t("FormItem",{attrs:{prop:"subnet_id",label:"私有子网"}},[t("Select",{attrs:{filterable:"",placeholder:"请选择私有子网"},on:{"on-change":e.handleInstanceChange},model:{value:e.formValues.subnet_id,callback:function(t){e.$set(e.formValues,"subnet_id",t)},expression:"formValues.subnet_id"}},e._l(e.vswitchOptions,(function(a){return t("Option",{key:a.id,attrs:{value:a.instance_id}},[e._v(e._s(a.label))])})),1)],1)],1),t("div",{staticClass:"modal__content__section__form__longer"},[t("FormItem",{attrs:{prop:"vpc_name",label:"私有网络"}},[t("Input",{attrs:{type:"text",disabled:""},model:{value:e.formValues.vpc_name,callback:function(t){e.$set(e.formValues,"vpc_name",t)},expression:"formValues.vpc_name"}})],1)],1),t("div",{staticClass:"modal__content__section__form__select"},[t("FormItem",{attrs:{prop:"cloud_region_id",label:"云区域"}},[t("Input",{attrs:{type:"text",disabled:"",placeholder:""},model:{value:e.formValues.cloud_region_id,callback:function(t){e.$set(e.formValues,"cloud_region_id",t)},expression:"formValues.cloud_region_id"}})],1)],1),t("div",{staticClass:"modal__content__section__form__select"},[t("FormItem",{attrs:{prop:"cloundAccountRender",label:"云厂商"}},[t("Input",{attrs:{type:"text",disabled:"",placeholder:""},model:{value:e.formValues.cloundAccountRender,callback:function(t){e.$set(e.formValues,"cloundAccountRender",t)},expression:"formValues.cloundAccountRender"}})],1)],1),t("div",{staticClass:"modal__content__section__form__select"},[t("FormItem",{attrs:{prop:"region",label:"地域"}},[t("Input",{attrs:{type:"text",disabled:"",placeholder:""},model:{value:e.formValues.region,callback:function(t){e.$set(e.formValues,"region",t)},expression:"formValues.region"}})],1)],1),t("div",{staticClass:"modal__content__section__form__select"},[t("FormItem",{attrs:{prop:"zone",label:"可用区"}},[t("Input",{attrs:{type:"text",disabled:"",placeholder:""},model:{value:e.formValues.zone,callback:function(t){e.$set(e.formValues,"zone",t)},expression:"formValues.zone"}})],1)],1)]),t("div",{staticClass:"modal__content__section"},[t("div",{staticClass:"modal__content__section__title"},[e._v("实例配置")]),t("div",{staticClass:"modal__content__section__form"},[t("div",{staticClass:"modal__content__section__form__custom"},[t("FormItem",{attrs:{prop:"image_id",label:"镜像"}},[t("Select",{attrs:{disabled:!e.formValues.subnet_id,filterable:"",clearable:"",placeholder:e.formValues.subnet_id?"请搜索":"请先选择私有子网",loading:e.imageIdLoading},model:{value:e.formValues.image_id,callback:function(t){e.$set(e.formValues,"image_id",t)},expression:"formValues.image_id"}},e._l(e.imageIdOptions,(function(a,s){return t("Option",{key:s,attrs:{value:a.value}},[e._v(e._s(a.label))])})),1)],1)],1),t("div",{staticClass:"modal__content__section__form__custom"},[t("FormItem",{attrs:{prop:"instance_charge_type",label:"实例计费模式"}},[t("Select",{attrs:{placeholder:"请选择"},model:{value:e.formValues.instance_charge_type,callback:function(t){e.$set(e.formValues,"instance_charge_type",t)},expression:"formValues.instance_charge_type"}},e._l(e.instanceChargeTypeOptions,(function(a){return t("Option",{key:a.value,attrs:{value:a.value}},[e._v(e._s(a.label))])})),1)],1)],1),t("div",{staticClass:"modal__content__section__form__int"},[t("div",{staticClass:"modal__content__section__form__special"},[t("div",{staticClass:"modal__content__section__form__special__label"},[t("span",[e._v("实例配置")]),t("Tooltip",{attrs:{placement:"top-start"}},[t("div",{attrs:{slot:"content"},slot:"content"},[t("div",[e._v("填写基础配置及实例类型后自动查询回填")])]),t("Icon",{staticStyle:{"margin-left":"5px"},attrs:{type:"ios-help-circle-outline"}})],1)],1),t("FormItem",{attrs:{prop:"cpu"}},[t("Input",{attrs:{type:"number",placeholder:"CPU",disabled:""},model:{value:e.formValues.cpu,callback:function(t){e.$set(e.formValues,"cpu",t)},expression:"formValues.cpu"}}),t("span",{staticClass:"modal__content__section__form__special__unit"},[e._v("核")])],1),t("FormItem",{attrs:{prop:"memory"}},[t("Input",{attrs:{type:"number",placeholder:"内存",disabled:""},model:{value:e.formValues.memory,callback:function(t){e.$set(e.formValues,"memory",t)},expression:"formValues.memory"}}),t("span",{staticClass:"modal__content__section__form__special__unit"},[e._v("GB")])],1)],1)]),t("div",{staticClass:"modal__content__section__form__custom"},[t("FormItem",{attrs:{prop:"instance_type",label:"实例类型"}},[t("Input",{attrs:{type:"text",placeholder:"请输入实例类型"},model:{value:e.formValues.instance_type,callback:function(t){e.$set(e.formValues,"instance_type",t)},expression:"formValues.instance_type"}})],1)],1),t("div",{staticClass:"modal__content__section__form__custom"},[t("FormItem",{attrs:{prop:"system_disk_type",label:"系统盘类型"}},[t("Select",{attrs:{placeholder:"请选择"},model:{value:e.formValues.system_disk_type,callback:function(t){e.$set(e.formValues,"system_disk_type",t)},expression:"formValues.system_disk_type"}},e._l(e.systemDiskTypeOptions,(function(a){return t("Option",{key:a.value,attrs:{value:a.value}},[e._v(e._s(a.label))])})),1)],1)],1),t("div",{staticClass:"modal__content__section__form__int"},[t("FormItem",{attrs:{prop:"system_disk_size",label:"系统盘大小"}},[t("Input",{attrs:{type:"number",placeholder:"请输入"},model:{value:e.formValues.system_disk_size,callback:function(t){e.$set(e.formValues,"system_disk_size",t)},expression:"formValues.system_disk_size"}},[t("div",{staticClass:"modal__content__section__form__int__unit",attrs:{slot:"suffix"},slot:"suffix"},[e._v(" GB ")])])],1)],1),t("div",{staticClass:"modal__content__section__form__custom"},[t("FormItem",{attrs:{prop:"data_disk_type",label:"数据盘类型"}},[t("Select",{attrs:{placeholder:"请选择"},model:{value:e.formValues.data_disk_type,callback:function(t){e.$set(e.formValues,"data_disk_type",t)},expression:"formValues.data_disk_type"}},e._l(e.dataDiskTypeOptions,(function(a){return t("Option",{key:a.value,attrs:{value:a.value}},[e._v(e._s(a.label))])})),1)],1)],1),t("div",{staticClass:"modal__content__section__form__int"},[t("FormItem",{attrs:{prop:"data_disk_size",label:"数据盘大小"}},[t("Input",{attrs:{type:"number",placeholder:"请输入"},model:{value:e.formValues.data_disk_size,callback:function(t){e.$set(e.formValues,"data_disk_size",t)},expression:"formValues.data_disk_size"}},[t("div",{staticClass:"modal__content__section__form__int__unit",attrs:{slot:"suffix"},slot:"suffix"},[e._v(" GB ")])])],1)],1),t("div",{staticClass:"modal__content__section__form__custom"},[t("FormItem",{attrs:{prop:"inner_ip",label:"指定私有IP"}},[t("Input",{attrs:{type:"text",placeholder:"请输入"},model:{value:e.formValues.inner_ip,callback:function(t){e.$set(e.formValues,"inner_ip",t)},expression:"formValues.inner_ip"}})],1)],1),t("div",{staticClass:"modal__content__section__form__custom"},[t("FormItem",{attrs:{prop:"is_eip",label:"开通弹性公网"}},[t("RadioGroup",{attrs:{type:"button"},model:{value:e.formValues.is_eip,callback:function(t){e.$set(e.formValues,"is_eip",t)},expression:"formValues.is_eip"}},[t("Radio",{attrs:{label:"0"}},[e._v("否")]),t("Radio",{attrs:{label:"1"}},[e._v("是")])],1)],1)],1),"1"==e.formValues.is_eip?[t("div",{staticClass:"modal__content__section__form__custom"},[t("FormItem",{attrs:{prop:"internet_charge_type",label:"网络计费模式"}},[t("Select",{attrs:{placeholder:"请选择"},model:{value:e.formValues.internet_charge_type,callback:function(t){e.$set(e.formValues,"internet_charge_type",t)},expression:"formValues.internet_charge_type"}},e._l(e.internetChargeTypeOptions,(function(a){return t("Option",{key:a.value,attrs:{value:a.value}},[e._v(e._s(a.label))])})),1)],1)],1),t("div",{staticClass:"modal__content__section__form__limit"},[t("div",{staticClass:"modal__content__section__form__limit__special"},[t("div",{staticClass:"modal__content__section__form__limit__special__label"},[e._v(" 带宽限制 ")]),t("FormItem",{staticClass:"modal__content__section__form__limit__special__slider",attrs:{prop:"max_flow_out"}},[t("Slider",{attrs:{max:2e3,"tip-format":e.tipFormat,marks:e.commonNums},model:{value:e.formValues.max_flow_out,callback:function(t){e.$set(e.formValues,"max_flow_out",t)},expression:"formValues.max_flow_out"}})],1),t("FormItem",{staticClass:"modal__content__section__form__limit__special__input",attrs:{prop:"max_flow_out"}},[t("InputNumber",{attrs:{max:2e3,min:1},model:{value:e.formValues.max_flow_out,callback:function(t){e.$set(e.formValues,"max_flow_out",t)},expression:"formValues.max_flow_out"}}),t("span",{staticClass:"modal__content__section__form__limit__special__unit"},[e._v("Mbps")])],1)],1)]),"BANDWIDTH_PACKAGE"==e.formValues.internet_charge_type?[t("div",{staticClass:"modal__content__section__form__custom"},[t("FormItem",{attrs:{prop:"bandwidth_pkg_id",label:"带宽包"}},[t("Select",{attrs:{disabled:!e.formValues.subnet_id,filterable:"",clearable:"",placeholder:e.formValues.subnet_id?"请搜索":"请先选择私有子网",loading:e.bindWidthIdLoading},model:{value:e.formValues.bandwidth_pkg_id,callback:function(t){e.$set(e.formValues,"bandwidth_pkg_id",t)},expression:"formValues.bandwidth_pkg_id"}},e._l(e.bindWidthIdOptions,(function(a,s){return t("Option",{key:s,attrs:{value:a.value}},[e._v(e._s(a.label))])})),1)],1)],1)]:e._e()]:e._e(),t("div",{staticClass:"modal__content__section__form__longer"},[t("FormItem",{attrs:{prop:"securityGroupsValues",label:"安全组"}},[t("Select",{attrs:{placeholder:e.formValues.subnet_id?"请搜索":"请先选择私有子网",filterable:"",disabled:!e.formValues.subnet_id,multiple:""},model:{value:e.formValues.securityGroupsValues,callback:function(t){e.$set(e.formValues,"securityGroupsValues",t)},expression:"formValues.securityGroupsValues"}},e._l(e.securityGroupOptions,(function(a){return t("Option",{key:a.value,attrs:{value:a.value}},[e._v(e._s(a.label))])})),1)],1)],1)],2)]),t("div",{staticClass:"modal__content__section"},[t("div",{staticClass:"modal__content__section__title"},[e._v("其他设置")]),t("div",{staticClass:"modal__content__section__form"},[t("div",{staticClass:"modal__content__section__form__tags"},[t("div",{staticClass:"modal__content__section__form__tags__label"},[e._v(" 标签 ")]),t("div",{staticClass:"modal__content__section__form__tags__content"},e._l(e.formValues.tagsValues,(function(a,s){return t("div",{key:s,staticClass:"modal__content__section__form__tags__content__line"},[t("FormItem",{attrs:{prop:"tagsValues."+s+".key",rules:{required:!0,message:"标签键不能为空",trigger:"blur"}}},[t("Select",{attrs:{filterable:""},on:{"on-select":e.handleSelectTag},model:{value:a.key,callback:function(t){e.$set(a,"key",t)},expression:"item.key"}},e._l(e.tagKeyOptions,(function(a){return t("Option",{key:a.value,attrs:{value:a.value}},[e._v(e._s(a.label))])})),1)],1),t("FormItem",{attrs:{prop:"tagsValues."+s+".value",rules:{required:!0,message:"标签值不能为空",trigger:"blur"}}},[t("Select",{attrs:{filterable:"",loading:void 0===e.tagValueOptions[a.key],disabled:""===a.key,placeholder:""===a.key?"请先选择标签键":"请选择"},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"item.value"}},e._l(e.tagValueOptions[a.key],(function(a){return t("Option",{key:a.value,attrs:{value:a.value}},[e._v(e._s(a.label))])})),1)],1),s===e.formValues.tagsValues.length-1?t("Icon",{attrs:{size:"20",type:"md-add"},on:{click:e.handleAddTag}}):e._e(),e.formValues.tagsValues.length>1?t("Icon",{attrs:{size:"20",type:"md-close"},on:{click:function(t){return e.handleRemoveTag(s)}}}):e._e()],1)})),0)]),t("div",{staticClass:"modal__content__section__form__longer"},[t("FormItem",{attrs:{prop:"description",label:"备注"}},[t("Input",{attrs:{type:"textarea",placeholder:"请输入备注"},model:{value:e.formValues.description,callback:function(t){e.$set(e.formValues,"description",t)},expression:"formValues.description"}})],1)],1)])])])]),e.buy?t("div",{staticClass:"modal__content__buy"},[t("Form",{ref:"buyForm",attrs:{model:e.buyValues,"label-width":100,rules:e.buyFormRules}},[t("FormItem",{attrs:{prop:"name"}},[t("span",{attrs:{slot:"label"},slot:"label"},[t("span",[e._v("资源名称")]),t("Tooltip",{attrs:{placement:"top-start"}},[t("div",{attrs:{slot:"content"},slot:"content"},[t("div",[e._v(" 示例：业务-厂商-地域-环境-服务+编号(ops-tx-sh-test-etcd01) ")]),t("div",[e._v("全部为英文或者数字，-为分隔符 是关键字不能被占用")])]),t("Icon",{staticStyle:{"margin-left":"5px"},attrs:{type:"ios-help-circle-outline"}})],1)],1),t("Input",{attrs:{type:"text"},model:{value:e.buyValues.name,callback:function(t){e.$set(e.buyValues,"name",t)},expression:"buyValues.name"}})],1),t("FormItem",{attrs:{prop:"count",label:"购买数量"}},[t("InputNumber",{attrs:{max:10,min:1},model:{value:e.buyValues.count,callback:function(t){e.$set(e.buyValues,"count",t)},expression:"buyValues.count"}})],1)],1),t("div",{staticClass:"modal__content__buy__price"},[t("Tooltip",{attrs:{placement:"top","max-width":1e3}},[t("div",{staticClass:"popup__price",attrs:{slot:"content"},slot:"content"},[t("div",{staticClass:"popup__price__header"},[t("div",{staticClass:"popup__price__header__label"},[e._v("计费项")]),t("div",{staticClass:"popup__price__header__value"},[e._v("价格")])]),t("div",{staticClass:"popup__price__item"},[t("div",{staticClass:"popup__price__item__label"},[e._v("实例")]),t("div",{staticClass:"popup__price__item__value"},[t("div",{staticClass:"popup__price__item__value__final"},[e._v(" ￥"+e._s(e.price.dis_count_price)+" ")]),100!==e.price.dis_count?t("div",{staticClass:"popup__price__item__value__discount"},[e._v(" "+e._s(e.price.dis_count/10)+"折 ")]):e._e(),100!==e.price.dis_count?t("div",{staticClass:"popup__price__item__value__original"},[e._v(" ￥"+e._s(e.price.original_price)+" ")]):e._e()])]),t("div",{staticClass:"popup__price__item"},[t("div",{staticClass:"popup__price__item__label"},[e._v("带宽")]),t("div",{staticClass:"popup__price__item__value"},[t("div",{staticClass:"popup__price__item__value__final"},[e._v(" ￥"+e._s(e.price.bandwidth_dis_count_price)+" ")]),100!==e.price.bandwidth_dis_count?t("div",{staticClass:"popup__price__item__value__discount"},[e._v(" "+e._s(e.price.bandwidth_dis_count/10)+"折 ")]):e._e(),100!==e.price.bandwidth_dis_count?t("div",{staticClass:"popup__price__item__value__original"},[e._v(" ￥"+e._s(e.price.bandwidth_original_price)+" ")]):e._e()])])]),t("div",{staticClass:"modal__content__buy__price__label"},[e._v("配置费用")])]),e.priceLoading?t("div",{staticClass:"modal__content__buy__price__loading"},[t("Icon",{attrs:{type:"ios-loading"}})],1):t("div",{staticClass:"modal__content__buy__price__value"},[e._v(" ￥"+e._s((e.price.bandwidth_dis_count_price+e.price.dis_count_price).toFixed(2))+" ")])],1)],1):e._e()],1)])},i=[],o=(a("d9e2"),a("14d9"),a("2ef0")),l=a("30b3"),n=a("a743"),r=a("55e2"),_=a("3261"),c=a("7063");const u={cloud_region_id:"",cloud_region_name:"",account_id:"",name:"",res_type:"",vendor:"",region:"",zone:"",image_id:"",image_name:"",cpu:"",memory:"",instance_type:"",system_disk_size:"",system_disk_type:"",security_groups:{},securityGroupsValues:[],tags:{},tagsValues:[{key:"",value:""}],vpc_id:"",vpc_name:"",subnet_id:"",subnet_name:"",max_flow_out:1,image_passwd:"",instance_charge_type:"",internet_charge_type:"",description:"",is_eip:"",inner_ip:"",bandwidth_pkg_id:"",data_disk_type:"",data_disk_size:"",cloundAccountRender:""},d=300,m=1e3,p=1e3,f={bandwidth_dis_count:100,bandwidth_dis_count_price:0,bandwidth_original_price:0,dis_count:100,dis_count_price:0,original_price:0};var g={name:"AddTemplateModal",props:{show:{type:Boolean,default:!1},buyRow:{type:Object,default:null}},data(){return{imageIdOptions:[],imageIdLoading:!1,bindWidthIdOptions:[],bindWidthIdLoading:!1,commonNums:{1:{label:this.$createElement("div",{on:{click:()=>{this.$nextTick(()=>{setTimeout(()=>{this.$set(this.formValues,"max_flow_out",1)},0)})}}},"1")},200:{label:this.$createElement("div",{on:{click:()=>{this.$nextTick(()=>{setTimeout(()=>{this.$set(this.formValues,"max_flow_out",200)},0)})}}},"200")},500:{label:this.$createElement("div",{on:{click:()=>{this.$nextTick(()=>{setTimeout(()=>{this.$set(this.formValues,"max_flow_out",500)},0)})}}},"500")}},title:"创建资源模板字段页面",priceLoading:!1,buy:!1,price:f,specialSplit:"",resTypeOptions:c["resTypeOptions"],dataDiskTypeOptions:c["dataDiskTypeOptions"],systemDiskTypeOptions:c["systemDiskTypeOptions"],instanceChargeTypeOptions:c["instanceChargeTypeOptions"],internetChargeTypeOptions:c["internetChargeTypeOptions"],vswitchOptions:[],securityGroupOptions:[],tagKeyOptions:[],tagValueOptions:{},buyValues:{name:"",count:1},buyFormRules:{name:[{required:!0,validator:(e,t,a)=>{""===t?a(new Error("资源名称必填")):/^([a-zA-Z0-9]+-){4}[a-zA-Z0-9]+$/.test(t)?a():a(new Error("资源名称格式错误，请检查"))},trigger:"blur"}],count:[{required:!0,validator:(e,t,a)=>{!t||t<1?a(new Error("资源数量须大于等于1")):a()},trigger:"blur"}]},formValues:u,formRules:{name:[{required:!0,message:"模板名称必填",trigger:"blur"}],res_type:[{required:!0,message:"模板类型必选",trigger:"blur"}],subnet_id:[{required:!0,message:"私有子网必选",trigger:"blur"}],cloud_region_id:[{required:!0,message:"云区域不能为空",trigger:"blur"}],cloundAccountRender:[{required:!0,message:"云厂商不能为空",trigger:"blur"}],vpc_name:[{required:!0,message:"私有网络不能为空",trigger:"blur"}],region:[{required:!0,message:"地域不能为空",trigger:"blur"}],zone:[{required:!0,message:"可用区不能为空",trigger:"blur"}],image_id:[{required:!0,message:"镜像必填",trigger:"blur"}],instance_charge_type:[{required:!0,message:"实例计费模式必填",trigger:"blur"}],cpu:[{required:!0,validator:(e,t,a)=>{t?a():a(new Error("cpu必填"))},trigger:"blur"}],memory:[{required:!0,validator:(e,t,a)=>{t?a():a(new Error("内存必填"))},trigger:"blur"}],instance_type:[{required:!0,message:"实例类型必填",trigger:"blur"}],system_disk_type:[{required:!0,message:"系统盘类型必填",trigger:"blur"}],system_disk_size:[{required:!0,validator:(e,t,a)=>{t?a():a(new Error("系统盘大小必填"))},trigger:"blur"}],internet_charge_type:[{required:!0,message:"网络计费模式必填",trigger:"blur"}],max_flow_out:[{required:!0,validator:(e,t,a)=>{t?a():a(new Error("带宽限制必填"))},trigger:"blur"}],securityGroupsValues:[{required:!0,validator:(e,t,a)=>{t&&0!==t.length?a():a(new Error("安全组必填"))},trigger:"blur"}],tags:[{required:!0,message:"标签必填",trigger:"blur"}]},showModal:this.show,modalLoading:!0}},computed:{realShow(){return this.show},insTypeParams(){const{account_id:e,vendor:t,res_type:a,region:s,zone:i,instance_type:o}=this.formValues;return{account_id:e,vendor:t,res_type:a,region:s,zone:i,instance_type:o}}},watch:{show(e){e&&this.getSettings(),this.showModal=e},buyRow(e){e?(this.title="购买资源",this.formValues=Object(_["getFeFormInfo"])(e,this),this.$nextTick(()=>{this.buy=!0,this.getSecurityGroupData({filter_map:{region:this.formValues.region,cloud_name:this.formValues.vendor}}),this.getImageIdOptions({filter_map:{region:this.formValues.region,cloud_name:this.formValues.vendor}}),this.getBindWidthPkgIdOptions({filter_map:{region:this.formValues.region,cloud_name:this.formValues.vendor}})})):(this.title="创建资源模板字段页面",this.buy=!1,this.formValues=u)},formValues:{async handler(){this.buy&&this.onFormValiDate()},deep:!0},"buyValues.count":{async handler(){this.onFormValiDate()},deep:!0},insTypeParams:{async handler(e){const{account_id:t,vendor:a,res_type:s,region:i,zone:o,instance_type:l}=e;t&&a&&s&&i&&o&&l&&this.getInsTypeOptions()},deep:!0}},mounted(){this.specialSplit=Object(_["getUniqueStr"])(3)},methods:{getInsTypeOptions:Object(o["debounce"])((async function(){try{const{account_id:e,vendor:t,res_type:a,region:s,zone:i,instance_type:o}=this.formValues,{data:n}=await Object(l["getInsType"])({account_id:e,vendor:t,res_type:a,region:s,zone:i,instance_type:o});this.formValues.cpu=n.cpu,this.formValues.memory=n.memory}catch(e){this.formValues.cpu="",this.formValues.memory=""}}),p),getImageIdOptions:Object(o["debounce"])((async function(e){try{this.imageIdLoading=!0;const{data:t}=await Object(l["getImageIds"])(e);this.imageIdOptions=t.map(e=>({label:`${e.instance_id} | ${e.name} | ${e.os_name}`,value:e.instance_id}))}catch(t){this.imageIdOptions=[]}finally{this.imageIdLoading=!1}}),d),getBindWidthPkgIdOptions:Object(o["debounce"])((async function(){try{this.bindWidthIdLoading=!0;const{account_id:e,vendor:t,res_type:a,region:s}=this.formValues,{data:i}=await Object(l["getBindWidthPkgIds"])({account_id:e,vendor:t,res_type:a,region:s});this.bindWidthIdOptions=i.map(e=>({label:`${e.id} | ${e.name}`,value:e.id}))}catch(e){this.bindWidthIdOptions=[]}finally{this.bindWidthIdLoading=!1}}),m),tipFormat(e){return e+"Mbps"},onFormValiDate:Object(o["debounce"])((async function(){try{await this.validateBeforGetPrice();const e=Object(_["getParams"])(this.formValues,this);this.priceLoading=!0;const{data:t}=await Object(l["getPrice"])({count:this.buyValues.count,...e});this.price=t}catch(e){this.price=f}finally{this.priceLoading=!1}}),500),async validateBeforGetPrice(){const e=await new Promise((e,t)=>{this.$refs.form.validate(a=>{a&&this.$refs.buyForm.validateField("count",t=>{t||e()}),t(new Error("表单校验失败，请检查"))})});return e},async getSettings(){this.getVswitchData(),this.getTagData()},async getVswitchData(){const{data:e}=await Object(n["getVswitch"])();this.vswitchOptions=e.map(e=>({...e,label:`${e.instance_id} | ${e.name} | ${e.cidr_block_v4}`}))},async getSecurityGroupData(e){const{data:t}=await Object(r["getSecurityGroup"])(e);this.securityGroupOptions=t.map(e=>({...e,label:`${e.instance_id} | ${e.security_group_name}`,value:`${e.instance_id}${this.specialSplit}${e.security_group_name}`}))},async getTagData(){const{data:e}=await Object(l["getTagList"])();this.tagKeyOptions=e.map(e=>({label:e,value:e}))},async handleSelectTag(e){const{data:t}=await Object(l["getTagList"])({tag_key:e.value});this.$set(this.tagValueOptions,e.value,t.map(e=>({label:e,value:e})))},handleAddTag(){this.formValues.tagsValues.push({key:"",value:""})},handleRemoveTag(e){this.formValues.tagsValues=this.formValues.tagsValues.filter((t,a)=>a!==e)},handleInstanceChange(e){const t=this.vswitchOptions.find(t=>(null===t||void 0===t?void 0:t.instance_id)===e);t&&(this.formValues={...this.formValues,subnet_name:`${t.instance_id} | ${t.name} | ${t.cidr_block_v4}`,vendor:t.cloud_name,account_id:t.account_id,cloundAccountRender:`${t.account_id} | ${t.cloud_name}`,vpc_id:t.vpc_id,vpc_name:`${t.vpc_id} | ${t.vpc_name}`,cloud_region_id:t.cloud_region_id,cloudRender:""+t.cloud_region_id,region:t.region,zone:t.zone},this.getSecurityGroupData({filter_map:{region:t.region,cloud_name:t.cloud_name}}),this.getImageIdOptions({filter_map:{region:t.region,cloud_name:t.cloud_name}}),this.getBindWidthPkgIdOptions({filter_map:{region:t.region,cloud_name:t.cloud_name}}))},async ok(){try{await new Promise((e,t)=>{this.$refs.form.validate(e=>{e||t(new Error("表单校验失败，请检查"))}),this.buy&&this.$refs.buyForm.validate(e=>{e||t(new Error("表单校验失败，请检查"))}),e()});const e=Object(_["getParams"])(this.formValues,this),t=await(this.buy?Object(l["createOrder"])({instance_name:this.buyValues.name,count:this.buyValues.count,image_passwd:"",...e}):Object(l["createOrderTemplate"])({...e}));if(!t)throw new Error("请求错误，请重试");this.$emit("addSuccessCallback"),this.showModal=!1,this.$Message.success(t.msg)}catch(e){this.$Message.error(e.message),this.modalLoading=!1}finally{this.$nextTick(()=>{this.modalLoading=!0})}},cancel(){this.$emit("closeAddModal")}}},v=g,b=(a("8c9f"),a("2877")),h=Object(b["a"])(v,s,i,!1,null,"84c6fd0e",null);t["default"]=h.exports},"8c9f":function(e,t,a){"use strict";a("eb12")},eb12:function(e,t,a){}}]);
//# sourceMappingURL=chunk-a5da55ca.f093b0b8.js.map