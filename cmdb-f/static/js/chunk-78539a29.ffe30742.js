(window["webpackJsonp_cmdb"]=window["webpackJsonp_cmdb"]||[]).push([["chunk-78539a29"],{"4d12":function(e,a,t){},5272:function(e,a,t){"use strict";t("4d12")},"8d8e":function(e,a,t){"use strict";t.r(a);var s=function(){var e=this,a=e._self._c;return a("div",[a("div",{staticClass:"template__header"},[a("div",{staticClass:"template__header__search"},[a("Input",{staticClass:"template__header__search__input",attrs:{placeholder:"请输入搜索内容"},model:{value:e.searchParams.searchVal,callback:function(a){e.$set(e.searchParams,"searchVal",a)},expression:"searchParams.searchVal"}}),a("Button",{staticClass:"template__header__search__button",on:{click:e.getTableData}},[e._v("搜索")])],1),a("Button",{attrs:{type:"primary"},on:{click:e.handleAddddTemplate}},[e._v("创建模板")])],1),a("Table",{ref:"selection",attrs:{stripe:"",size:"small",loading:e.tableLoading,columns:e.columns,data:e.tableData}}),a("div",{staticStyle:{display:"flex","justify-content":"flex-end","margin-top":"10px",overflow:"hidden"}},[a("Page",{attrs:{total:e.pageTotal,current:e.searchParams.page_number,"page-size":e.searchParams.page_size,"page-size-opts":[12,35,50,100],"show-sizer":"","show-total":""},on:{"on-change":e.changePage,"on-page-size-change":e.handlePageSize}})],1),a("Modal",{attrs:{title:"克隆模板",loading:e.cloneModalLoading,width:60},on:{"on-ok":e.colneModalOk,"on-cancel":e.cloneModalCancel},model:{value:e.showCloneModal,callback:function(a){e.showCloneModal=a},expression:"showCloneModal"}},[a("div",{staticClass:"clone-modal__content"},[a("Form",{ref:"form",attrs:{model:e.cloneFormValues}},[a("FormItem",{attrs:{prop:"name",label:"模板名称","label-width":100,rules:{required:!0,message:"模板名称必填",trigger:"change"}}},[a("Input",{model:{value:e.cloneFormValues.name,callback:function(a){e.$set(e.cloneFormValues,"name",a)},expression:"cloneFormValues.name"}})],1)],1)],1)]),a("Modal",{attrs:{title:"删除模板",loading:e.deleteModalLoading},on:{"on-ok":e.deleteModalOk,"on-cancel":e.deleteModalCancel},model:{value:e.showDeleteModal,callback:function(a){e.showDeleteModal=a},expression:"showDeleteModal"}},[e._v(" 确认删除模板吗？ ")]),a("AddTemplateModal",{attrs:{show:e.showModal,buyRow:e.buyRow},on:{closeAddModal:e.closeAddModal,addSuccessCallback:e.addSuccessCallback}}),a("EditTemplate",{attrs:{show:e.showDrawer,row:e.curRow},on:{closeDrawer:e.closeDrawer,editSuccessCallback:e.editSuccessCallback}})],1)},o=[],l=(t("d9e2"),t("30b3")),i=t("5e65"),d=t("fec9"),n={components:{AddTemplateModal:i["default"],EditTemplate:d["default"]},data(){return{buyRow:null,pageTotal:0,showDrawer:!1,showDeleteModal:!1,deleteModalLoading:!0,curRow:{},showModal:!1,showCloneModal:!1,cloneModalLoading:!0,tableLoading:!1,cloneFormValues:{name:""},columns:[{title:"资源ID",key:"id",width:100},{title:"模板名称",key:"name",minWidth:160,render:(e,a)=>e("div",[e("div",{style:{color:"#2d8cf0",cursor:"pointer"},on:{click:()=>{this.showDrawer=!0,this.curRow=a.row}}},a.row.name)])},{title:"子网信息",key:"subnet_name",width:280},{title:"模板类型",key:"res_type_alias",width:120},{title:"云厂商",key:"vendor_alias",width:120},{title:"更新时间",key:"update_time",width:160},{title:"最后一次使用时间",key:"last_time",width:160},{title:"操作",render:(e,a)=>e("div",[e("Button",{props:{type:"text",size:"small"},style:{color:"#2d8cf0"},on:{click:()=>{this.showModal=!0,this.buyRow=a.row}}},"购买"),e("Button",{props:{type:"text",size:"small"},style:{color:"#2d8cf0"},on:{click:()=>{this.cloneFormValues.name=a.row.name+"-克隆",this.curRow=a.row,this.showCloneModal=!0}}},"克隆"),e("Button",{props:{type:"text",size:"small"},style:{color:"#ed4014"},on:{click:()=>{this.curRow=a.row,this.showDeleteModal=!0}}},"删除")]),width:200}],tableData:[],searchParams:{page_number:1,page_size:12,order_by:"id",order:"descend",searchVal:""}}},mounted(){this.getTableData()},methods:{handleAddddTemplate(){this.buyRow=null,this.showModal=!0},editSuccessCallback(){this.showDrawer=!1,this.getTableData()},closeDrawer(){this.showDrawer=!1},async deleteModalOk(){try{const{id:e}=this.curRow,a=await Object(l["deleteOrderTemplate"])({id_list:[e]});if(!a)throw new Error("请求错误，请重试");this.showDeleteModal=!1,this.$Message.success(a.msg),this.getTableData()}catch(e){this.$Message.error(e.message),this.deleteModalLoading=!1}finally{this.$nextTick(()=>{this.deleteModalLoading=!0})}},deleteModalCancel(){this.showDeleteModal=!1},addSuccessCallback(){this.showModal=!1,this.getTableData()},closeAddModal(){this.showModal=!1},cloneModalCancel(){this.showCloneModal=!1},async colneModalOk(){try{await new Promise((e,a)=>{this.$refs.form.validate(t=>{t||a(new Error("表单校验失败，请检查")),e()})});const{account_id:e,vendor:a,cloud_region_id:t,res_type:s,region:o,zone:i,image_id:d,cpu:n,memory:r,instance_type:c,system_disk_size:h,system_disk_type:m,security_groups:u,tags:w,vpc_id:_,vpc_name:p,subnet_id:g,subnet_name:b,max_flow_out:y,instance_charge_type:M,internet_charge_type:k,data_disk:f,description:D}=this.curRow,v=await Object(l["createOrderTemplate"])({name:this.cloneFormValues.name,account_id:e,vendor:a,cloud_region_id:t,res_type:s,region:o,zone:i,image_id:d,cpu:n,memory:r,instance_type:c,system_disk_size:h,system_disk_type:m,security_groups:u,tags:w,vpc_id:_,vpc_name:p,subnet_id:g,subnet_name:b,max_flow_out:y,instance_charge_type:M,internet_charge_type:k,data_disk:f,description:D});if(!v)throw new Error("请求错误，请重试");this.showCloneModal=!1,this.$Message.success(v.msg),this.getTableData()}catch(e){this.$Message.error(e.message),this.cloneModalLoading=!1}finally{this.$nextTick(()=>{this.cloneModalLoading=!0})}},async getTableData(){try{this.tableLoading=!0;const{data:e,count:a}=await Object(l["getOrderTemplateList"])(this.searchParams);this.pageTotal=a,this.tableData=e}catch(e){this.$Message.error(e.message)}finally{this.tableLoading=!1}},handleShowModal(e){this.showModal=e},handlePageSize(e){this.searchParams.page_size=e,this.getTableData()},changePage(e){this.searchParams.page_number=e,this.getTableData()}}},r=n,c=(t("5272"),t("2877")),h=Object(c["a"])(r,s,o,!1,null,"7c8f1cfe",null);a["default"]=h.exports}}]);
//# sourceMappingURL=chunk-78539a29.ffe30742.js.map