(window["webpackJsonp_cmdb"]=window["webpackJsonp_cmdb"]||[]).push([["chunk-cfaaec66","chunk-5ab71d9c","chunk-c68396b4","chunk-852f4c9e","chunk-2d225f8a","chunk-2d0c17f4","chunk-2d0ae8c9"],{"06f7":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("Drawer",{attrs:{title:e.modalData.title,width:"70%",draggable:""},on:{"on-close":e.handleCancel},model:{value:e.modalData.show,callback:function(t){e.$set(e.modalData,"show",t)},expression:"modalData.show"}},[t("div",{staticClass:"search-con search-con-top"},[t("Input",{staticClass:"search-input",attrs:{search:"",placeholder:"输入关键字全局搜索"},on:{"on-search":e.handleSearch},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}},model:{value:e.initPara.searchVal,callback:function(t){e.$set(e.initPara,"searchVal",t)},expression:"initPara.searchVal"}})],1),t("Table",{ref:"selection",attrs:{size:"small",columns:e.columns,data:e.tableData},on:{"on-selection-change":e.handleSelect}}),t("div",{staticStyle:{margin:"10px",overflow:"hidden"}},[t("div",{staticStyle:{float:"left"}},[t("Page",{attrs:{total:e.i.pageTotal,current:e.initPara.page_number,"page-size":e.initPara.page_size,"show-total":"","show-sizer":"","page-size-opts":[15,50,100]},on:{"on-change":e.handlerChangePage,"on-page-size-change":e.handlePageSize}})],1)])],1)},s=[],n=(a("14d9"),a("e757")),l={components:{},name:"regionAssetPreview",props:{modalData:{type:Object,default:{}}},data(){return{initPara:{page_number:1,page_size:15,searchVal:null},i:{pageTotal:0,tableLoading:!1},selectList:[],tableData:[],columns:[{type:"selection",key:"selection",width:60,align:"center"},{title:"ID",key:"id",minWidth:100,align:"center"},{title:"资源名",key:"name",minWidth:150,align:"center"},{title:"云厂商",key:"cloud_name",minWidth:150,align:"center"},{title:"地域",key:"region",minWidth:150,align:"center"},{title:"内网IP",key:"inner_ip",minWidth:120,maxWidth:170,align:"center"},{title:"状态",key:"state",minWidth:110,maxWidth:140,align:"center"}]}},methods:{handleCancel(){this.$emit("close")},async handleGetData(){this.initPara=Object.assign(this.initPara,{region_id:this.modalData.region_id});const e=await Object(n["previewCloudRegion"])(this.initPara);0==e.code?(this.tableData=e.data,this.i.pageTotal=e.count):this.$Notice.error({title:""+e.msg})},handleDel(){this.$emit("del",{id_list:this.selectList,region_id:this.modalData.region_id})},handleSelect(e){let t=[];e.forEach(e=>{t.push(e.id)}),this.selectList=t},handleSearch(){this.initPara.page_number=1,this.handleGetData()},handlerChangePage(e){this.initPara.page_number=e,this.handleGetData()},handlePageSize(e){this.initPara.page_number=1,this.initPara.page_size=e,this.handleGetData()}},watch:{},computed:{},mounted(){}},o=l,r=(a("9696"),a("2877")),d=Object(r["a"])(o,i,s,!1,null,"16f6d2f2",null);t["default"]=d.exports},"0b12":function(e,t,a){"use strict";a.r(t),a.d(t,"postTreeAsset",(function(){return s})),a.d(t,"getTreeAsset",(function(){return n})),a.d(t,"changeTreeAssetStatus",(function(){return l})),a.d(t,"deleteTreeAsset",(function(){return o})),a.d(t,"getRelation",(function(){return r})),a.d(t,"getServiceTreelist",(function(){return d})),a.d(t,"operationTree",(function(){return c})),a.d(t,"getBizEnv",(function(){return h})),a.d(t,"getTreeModule",(function(){return u}));var i=a("be3b");const s=e=>Object(i["default"])({url:"/api/v2/cmdb/tree/asset/",method:"post",data:e}),n=e=>Object(i["default"])({url:"/api/v2/cmdb/tree/asset/",method:"get",params:e}),l=e=>Object(i["default"])({url:"/api/v2/cmdb/tree/asset/",method:"patch",data:e}),o=e=>Object(i["default"])({url:"/api/v2/cmdb/tree/asset/",method:"delete",data:e}),r=e=>Object(i["default"])({url:"/api/v2/cmdb/tree/asset/relation/",method:"get",params:e}),d=e=>Object(i["default"])({url:"/api/v2/cmdb/tree/",method:"get",params:e}),c=(e,t)=>Object(i["default"])({url:"/api/v2/cmdb/tree/",method:t,data:e}),h=e=>Object(i["default"])({url:"/api/v2/cmdb/tree/env/",method:"get",params:e}),u=e=>Object(i["default"])({url:"/api/v2/cmdb/tree/module/",method:"get",params:e})},"1ade":function(e,t,a){},"229e":function(e,t,a){"use strict";a("1ade")},"2b84":function(e,t,a){"use strict";a("9735")},"3aae":function(e,t,a){},"45fc":function(e,t,a){"use strict";a.r(t),a.d(t,"getVPC",(function(){return s})),a.d(t,"optVPC",(function(){return n}));var i=a("be3b");const s=e=>Object(i["default"])({url:"/api/v2/cmdb/vpc/",method:"get",params:e}),n=(e,t)=>Object(i["default"])({url:"/api/v2/cmdb/vpc/",method:t,data:e})},5047:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",[e.showEdit?t("cloud-region-edit",{attrs:{formData:e.theData},on:{"save-data":e.handleSaveData,"edit-close":e.handleClose}}):t("Card",{attrs:{"dis-hover":"",bordered:!1}},[t("Alert",{attrs:{type:"success","show-icon":""}},[e._v(" 使用说明： "),t("Icon",{attrs:{slot:"icon",type:"ios-bulb-outline"},slot:"icon"}),t("template",{slot:"desc"},[t("p",[e._v("云区域是主机内网的逻辑区域划分，跨云区域之间的主机不可以通过内网直接互相访问，默认主机属于直连区域。")]),t("p",[e._v("云区域关联到主机使用vpc自动添加，同一组云区域vpc不能超十个，添加后自动修改agent_id 为 内网IP:proxy_id。")]),t("p",[e._v("创建云区域后，需要在云区域节点上部署 agent proxy，并同步云区域信息到节点管理，用于agent自动部署。")]),t("p",[e._v("实例只能存在于一个云区域内")])])],2),t("div",[t("div",{staticClass:"search-con search-con-top"},[t("Input",{staticClass:"search-input",attrs:{search:"",maxlength:50,placeholder:"输入关键字全局搜索"},on:{"on-search":e.handleSearch},model:{value:e.initPara.searchVal,callback:function(t){e.$set(e.initPara,"searchVal",t)},expression:"initPara.searchVal"}}),t("ButtonGroup",{staticClass:"search-btn"},[t("Button",{on:{click:e.handleAdd}},[e._v("添加云区域")]),t("Button",{attrs:{disabled:0===e.selectList.length},on:{click:function(e){}}},[e._v("同步至节点管理")])],1)],1),t("Table",{attrs:{size:"small",columns:e.columns,data:e.tableData,loading:e.i.tableLoading},on:{"on-sort-change":e.handleSort,"on-selection-change":e.handleSelect}}),t("div",{staticStyle:{margin:"10px",overflow:"hidden"}},[t("div",{staticStyle:{float:"left"}},[t("Page",{attrs:{total:e.i.pageTotal,current:e.initPara.page_number,"page-size":e.initPara.page_size,"show-total":"","show-sizer":"","page-size-opts":[15,50,100]},on:{"on-change":e.handlerChangePage,"on-page-size-change":e.handlePageSize}})],1)])],1)],1),e.modalData.name?[t("region-asset",{attrs:{modalData:e.modalData},on:{close:e.handleClose,relevance:e.handleRelevance}})]:e._e(),t("region-asset-preview",{ref:"assetPreview",attrs:{modalData:e.modalPreview},on:{close:e.handleClose,relevance:e.handleRelevance,del:e.handleReDel}})],2)},s=[],n=(a("14d9"),a("e757")),l=a("8219"),o=a("c03a"),r=a("06f7"),d=(a("30b3"),{components:{cloudRegionEdit:l["default"],regionAsset:o["default"],regionAssetPreview:r["default"]},data(){return{modalPreview:{show:!1,title:"预览云区域主机",name:""},modalData:{show:!1,title:"添加主机到当前云区域",id:null,name:"",action:"put"},action:"post",showEdit:!1,selectList:[],cloudList:[],theData:{},initForm:{asset_group_rules:[[{query_name:"vpc",query_conditions:"=",query_value:[],index:1,status:1}]]},initPara:{page_number:1,page_size:50,searchVal:null,order_by:"name",order:"ascend"},i:{pageTotal:0,tableLoading:!0},tableData:[],columns:[{type:"selection",key:"selection",width:60,align:"center"},{title:"云区域ID",key:"cloud_region_id",minWidth:110,maxWidth:140,sortable:!0},{title:"云区域名称",key:"name",minWidth:170,maxWidth:300,sortable:!0},{title:"代理IP",key:"proxy_ip",minWidth:130,maxWidth:180,align:"center",sortable:!0},{title:"SSH IP",key:"ssh_ip",minWidth:130,maxWidth:180,align:"center",sortable:!0},{title:"状态",key:"state",minWidth:110,maxWidth:140,align:"center",sortable:!0},{title:"备注",key:"detail",minWidth:200,tooltip:!0},{title:"更新时间",key:"update_time",minWidth:170,maxWidth:210,sortable:!0},{title:"操作",key:"handle",minWidth:230,render:(e,t)=>e("div",[e("a",{style:{marginRight:"10px"},on:{click:()=>{this.handlePreview(t.row)}}},"预览"),e("a",{style:{marginRight:"10px"},on:{click:()=>{this.handleClone(t.row)}}},"克隆"),e("a",{style:{marginRight:"10px"},on:{click:()=>{this.handleEdit(t.row)}}},"编辑"),e("a",{style:{color:"red",marginRight:"10px"},on:{click:()=>{this.handleDel(t.row)}}},"删除")])}]}},methods:{async handleGetData(){const e=await Object(n["getCloudRegion"])(this.initPara);0==e.code?(this.tableData=e.data,this.i.pageTotal=e.count):this.$Message.error(e.msg),this.i.tableLoading=!1},handleClose(){this.showEdit=!1,this.modalData.show=!1,this.modalPreview.show=!1,this.handleGetData(),this.selectList=[]},handleAdd(){this.action="post",this.showEdit=!0,this.theData=Object.assign(this.$options.data().theData,this.initForm)},handleEdit(e){this.action="put",this.showEdit=!0,e.asset_group_rules||(e.asset_group_rules=this.initForm.asset_group_rules),this.theData=e},handleClone(e){this.action="post",this.showEdit=!0,delete e.id,e.name=e.name+"-副本",e.asset_group_rules||(e.asset_group_rules=this.initForm.asset_group_rules),this.theData=e},handleSaveData(e){Object(n["optCloudRegion"])(e,this.action).then(e=>{0==e.code?(this.$Notice.success({title:""+e.msg}),this.handleClose()):this.$Notice.error({title:""+e.msg})})},handleDel(e){this.$Modal.confirm({title:"提醒",content:`<p>确认要删除云区域 《${e.name}》 之后无法找回, 请谨慎操作!</p>`,onOk:()=>{Object(n["optCloudRegion"])({id_list:[e.id]},"delete").then(e=>{0===e.code?(this.$Notice.success({title:""+e.msg}),this.handleGetData()):this.$Notice.error({title:""+e.msg})})},onCancel:()=>{this.$Message.info("回头是岸~")}})},handleAddAsset(e){this.modalData.show=!0,this.modalData.name=e.name,this.modalData.id=e.id},async handlePreview(e){this.modalPreview.show=!0,this.modalPreview.region_id=e.id,this.$refs.assetPreview.handleGetData()},async handleRelevance(e){let t=await Object(n["optCloudRegion"])(e,"patch");0===t.code?(this.$Notice.success({title:""+t.msg}),this.handleClose()):this.$Notice.error({title:""+t.msg})},handleReDel(e){this.$Modal.confirm({title:"提醒",content:"<p>确认要解除关联？, 请谨慎操作!</p>",onOk:()=>{Object(n["optCloudRegionPro"])(e,"delete").then(e=>{0===e.code?(this.$Notice.success({title:""+e.msg}),this.$refs.assetPreview.handleGetData()):this.$Notice.error({title:""+e.msg})})},onCancel:()=>{this.$Message.info("回头是岸~")}})},handleSelect(e){let t=[];e.forEach(e=>{t.push(e.id)}),this.selectList=t},handleSearch(){this.initPara.page_number=1,this.handleGetData()},handleSort(e,t,a){this.initPara.order="asc"===e.order?"ascend":"descend",this.initPara.order_by=e.key,this.handleGetData()},handlerChangePage(e){this.initPara.page_number=e,this.handleGetData()},handlePageSize(e){this.initPara.page_number=1,this.initPara.page_size=e,this.handleGetData()}},watch:{},mounted(){this.handleGetData()}}),c=d,h=(a("2b84"),a("2877")),u=Object(h["a"])(c,i,s,!1,null,"26368839",null);t["default"]=u.exports},"78fd":function(e,t,a){},8219:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("Card",{attrs:{bordered:!1,"dis-hover":""}},[t("Form",{ref:"formValidate",attrs:{model:e.formValidate,rules:e.ruleValidate,"label-colon":!0,"label-position":"top"}},[t("Row",[t("Col",{attrs:{span:"13",offset:"4"}},[e.formData.id?t("FormItem",{attrs:{label:"云区域名称",prop:"name"}},[t("Input",{attrs:{maxlength:"50",type:"text",disabled:"",placeholder:"请输入规则名称..."},model:{value:e.formValidate.name,callback:function(t){e.$set(e.formValidate,"name",t)},expression:"formValidate.name"}})],1):t("FormItem",{attrs:{label:"云区域名称",prop:"name"}},[t("Input",{attrs:{maxlength:"50",type:"text",placeholder:"请输入规则名称..."},model:{value:e.formValidate.name,callback:function(t){e.$set(e.formValidate,"name",t)},expression:"formValidate.name"}})],1),t("Row",{attrs:{gutter:5}},[t("Col",{attrs:{span:"8"}},[t("FormItem",{attrs:{label:"云区域ID",prop:"cloud_region_id"}},[t("Input",{attrs:{maxlength:"10",type:"text",placeholder:"云区域ID、代理ID..."},model:{value:e.formValidate.cloud_region_id,callback:function(t){e.$set(e.formValidate,"cloud_region_id",t)},expression:"formValidate.cloud_region_id"}})],1)],1),t("Col",{attrs:{span:"8"}},[t("FormItem",{attrs:{label:"代理地址",prop:"proxy_ip"}},[t("Input",{attrs:{maxlength:"100",type:"text",placeholder:"连接代理节点IP地址或域名地址，一般为内网LB或者内网域名"},model:{value:e.formValidate.proxy_ip,callback:function(t){e.$set(e.formValidate,"proxy_ip",t)},expression:"formValidate.proxy_ip"}})],1)],1),t("Col",{attrs:{span:"8"}},[t("FormItem",{attrs:{label:"自动修改AgentID",prop:"auto_update_agent_id"}},[t("Select",{attrs:{placeholder:"请选择"},model:{value:e.formValidate.auto_update_agent_id,callback:function(t){e.$set(e.formValidate,"auto_update_agent_id",t)},expression:"formValidate.auto_update_agent_id"}},[t("Option",{attrs:{value:"yes"}},[e._v("是")]),t("Option",{attrs:{value:"no"}},[e._v("否")])],1)],1)],1)],1),t("Row",{attrs:{gutter:5}},[t("Col",{attrs:{span:"12"}},[t("FormItem",{attrs:{label:"堡垒机组织ID"}},[t("Input",{attrs:{maxlength:"30",type:"text",placeholder:"堡垒机组织ID..."},model:{value:e.formValidate.jms_org_id,callback:function(t){e.$set(e.formValidate,"jms_org_id",t)},expression:"formValidate.jms_org_id"}})],1)],1),t("Col",{attrs:{span:"12"}},[t("FormItem",{attrs:{label:"堡垒机账号模板ID"}},[t("Input",{attrs:{maxlength:"100",type:"text",placeholder:"堡垒机账号模板ID"},model:{value:e.formValidate.jms_account_template,callback:function(t){e.$set(e.formValidate,"jms_account_template",t)},expression:"formValidate.jms_account_template"}})],1)],1)],1)],1),t("Col",{attrs:{span:"13",offset:"4"}},[t("Row",{attrs:{gutter:2}},[t("Col",{attrs:{span:"8"}},[t("FormItem",{attrs:{label:"",prop:"ssh_user"}},[t("Input",{attrs:{maxlength:"25",type:"text",placeholder:"用户名..."},model:{value:e.formValidate.ssh_user,callback:function(t){e.$set(e.formValidate,"ssh_user",t)},expression:"formValidate.ssh_user"}},[t("span",{attrs:{slot:"prepend"},slot:"prepend"},[e._v("ssh")])])],1)],1),t("Col",{attrs:{span:"8"}},[t("FormItem",{attrs:{label:"",prop:"ssh_ip"}},[t("Input",{attrs:{maxlength:"100",type:"text",placeholder:"主机/ip..."},model:{value:e.formValidate.ssh_ip,callback:function(t){e.$set(e.formValidate,"ssh_ip",t)},expression:"formValidate.ssh_ip"}},[t("span",{attrs:{slot:"prepend"},slot:"prepend"},[e._v("@")])])],1)],1),t("Col",{attrs:{span:"8"}},[t("FormItem",{attrs:{label:"",prop:"ssh_port"}},[t("Input",{attrs:{maxlength:"10",type:"text",placeholder:"端口..."},model:{value:e.formValidate.ssh_port,callback:function(t){e.$set(e.formValidate,"ssh_port",t)},expression:"formValidate.ssh_port"}},[t("span",{attrs:{slot:"prepend"},slot:"prepend"},[e._v("-p")])])],1)],1)],1)],1),t("Col",{attrs:{span:"13",offset:"4"}},[e._l(e.formValidate.asset_group_rules,(function(a,i){return[e.formValidate.asset_group_rules&&0!==e.formValidate.asset_group_rules.length?t("FormItem",{attrs:{label:"虚拟局域网"}},[0==i?t("Alert",{staticStyle:{"min-width":"500px","margin-bottom":"8px"},attrs:{"show-icon":""}},[e._v("卡片内的条件关系为且。")]):e._e(),t("Row",{attrs:{gutter:20}},[t("Col",{attrs:{span:"24"}},[a.length>0?t("Card",{staticStyle:{"min-width":"500px","margin-bottom":"0px"},attrs:{"dis-hover":""}},e._l(a,(function(s,n){return s.status?t("FormItem",{key:n+e._uid},[t("div",{staticClass:"alert-con",staticStyle:{"margin-bottom":"10px"}},[e._v(" "+e._s(n+1)+" - "),t("Cascader",{staticStyle:{width:"750px"},attrs:{data:e.vpcOptions},model:{value:s.query_value,callback:function(t){e.$set(s,"query_value",t)},expression:"item.query_value"}}),t("Button",{staticClass:"rule-btn-add",attrs:{shape:"circle",type:"text",icon:"md-add"},on:{click:function(t){return e.handleAddRules(i)}}}),1!==a.length?t("Button",{staticClass:"rule-btn-del",attrs:{shape:"circle",type:"text",icon:"md-close"},on:{click:function(t){return e.handleRemoveRules(i,n)}}}):e._e()],1)]):e._e()})),1):e._e(),e.formValidate.asset_group_rules.length>1&&2!=i?t("p",{staticStyle:{"padding-top":"15px"}},[e._v("或")]):e._e()],1),t("Col",{attrs:{span:"2"}},[1!==e.formValidate.asset_group_rules.length?t("a",{on:{click:function(t){return t.preventDefault(),e.handleRemoveCard(i)}}},[e._v(" 删除")]):e._e()])],1)],1):e._e()]}))],2),t("Col",{attrs:{span:"13",offset:"4"}},[t("FormItem",{attrs:{label:"网域密钥"}},[t("Input",{attrs:{type:"textarea",maxlength:"65500",autosize:{minRows:6,maxRows:15},placeholder:"当前云区域网域私钥..."},model:{value:e.formValidate.ssh_key,callback:function(t){e.$set(e.formValidate,"ssh_key",t)},expression:"formValidate.ssh_key"}})],1)],1),t("Col",{attrs:{span:"13",offset:"4"}},[t("FormItem",{attrs:{label:"网域公钥"}},[t("Input",{attrs:{type:"textarea",maxlength:"65500",autosize:{minRows:3,maxRows:15},placeholder:"当前云区域网域公钥..."},model:{value:e.formValidate.ssh_pub_key,callback:function(t){e.$set(e.formValidate,"ssh_pub_key",t)},expression:"formValidate.ssh_pub_key"}})],1)],1),t("Col",{attrs:{span:"13",offset:"4"}},[t("FormItem",{attrs:{label:"备注信息"}},[t("Input",{attrs:{type:"textarea",maxlength:"65500",autosize:{minRows:2,maxRows:5},placeholder:"备注信息..."},model:{value:e.formValidate.detail,callback:function(t){e.$set(e.formValidate,"detail",t)},expression:"formValidate.detail"}})],1)],1),t("Col",{attrs:{span:"19",offset:"4"}},[t("FormItem",[t("Button",{attrs:{type:"primary",loading:e.btnLoading},on:{click:function(t){return e.handleSubmit("formValidate")}}},[e._v("确定")]),t("Button",{staticStyle:{"margin-left":"15px"},on:{click:e.handleCancel}},[e._v("返回")])],1)],1)],1)],1)],1)},s=[],n=(a("14d9"),a("30b3")),l=a("45fc"),o={components:{},name:"cloudRegionEdit",props:{formData:{type:Object,default:{}}},data(){return{btnLoading:!1,cloudList:[],vpcList:[],vpcOptions:[],vendorMap:{},ruleValidate:{name:[{required:!0,message:"名称不能为空",trigger:"blur"}],cloud_region_id:[{required:!0,message:"不能为空",trigger:"blur"}],ssh_user:[{required:!0,message:"不能为空",trigger:"blur"}],proxy_ip:[{required:!0,message:"不能为空",trigger:"blur"}],detail:[{type:"string",max:300,message:"备注也不能太长吧",trigger:"blur"}],auto_update_agent_id:[{type:"string",max:10,message:"不能为空",trigger:"blur",required:!0}],asset_group_rules:[{type:"array",max:10,message:"不能为空",trigger:"blur",required:!0}]}}},filters:{testF(e,t){return 1===t?"资产 B":2===t?"资产 C":0===t?"资产 A":void 0}},methods:{transformData(e){return e.forEach(e=>{e.cloud_zh_name&&(this.vendorMap[e.cloud_zh_name]||(this.vendorMap[e.cloud_zh_name]={}),this.vendorMap[e.cloud_zh_name][e.region]||(this.vendorMap[e.cloud_zh_name][e.region]=[]),this.vendorMap[e.cloud_zh_name][e.region].push({label:e.vpc_name,value:e.instance_id}))}),Object.keys(this.vendorMap).map(e=>({label:e,value:e,children:Object.keys(this.vendorMap[e]).map(t=>({label:t,value:t,children:this.vendorMap[e][t]}))}))},async getCloudSettingList(){const e=await Object(n["getCloudSettinglist"])();0===e.code?this.cloudList=e.data:this.$message.error(""+e.msg)},getVpcCloudName(e){const t=this.cloudList.find(t=>t.account_id===e);return t?t.name:""},getVpcRegion(e){const t=this.vpcList.find(t=>t.vpc_name===e);return t?t.region:""},async getVpcList(){const e={page_number:1,page_size:300},t=await Object(l["getVPC"])(e);if(0===t.code){this.vpcList=t.data;for(const e of this.vpcList)e.cidr_block_v4&&(e.vpc_name=e.vpc_name+"("+e.cidr_block_v4+")"),e.cloud_zh_name=this.getVpcCloudName(e.account_id);this.vpcOptions=this.transformData(this.vpcList)}else this.$message.error(""+t.msg)},handleAddRules(e){this.index++,this.formValidate.asset_group_rules[e].length>9?this.$Notice.warning({title:"限制提示",desc:"添加指标的个数不能超过十个",duration:10}):this.formValidate.asset_group_rules[e].push({index:this.index,query_name:"vpc",query_conditions:"=",query_value:[],status:1})},handleRemoveRules(e,t){this.formValidate.asset_group_rules[e].splice(t,1)},handleRemoveCard(e){this.formValidate.asset_group_rules.splice(e,1)},handleCancel(){JSON.stringify(this.formValidate)!=JSON.stringify(this.formData)?this.$Modal.confirm({content:"<p>编辑还没有保存，确定要离开？</p>",onOk:()=>{this.$emit("edit-close")},onCancel:()=>{this.$Message.info("回头是岸")}}):this.$emit("edit-close")},handleSubmit(e){this.$refs[e].validate(e=>{if(e){if(this.formValidate.asset_group_rules)for(const e of this.formValidate.asset_group_rules)for(const t of e){if(1===t.status&&Array.isArray(t.query_value)&&t.query_value.length<2)return void this.$Notice.warning({title:"查询条件存在空值！"});if(!t.query_value[t.query_value.length-1])return void this.$Notice.warning({title:"VPC存在空值！"})}this.btnLoading=!0,this.formValidate.name=this.formValidate.name.trim(),setTimeout(()=>{this.$emit("save-data",this.formValidate),this.btnLoading=!1},1e3)}else this.$Message.error("表单校验不通过!")})}},watch:{formValidate(e){}},computed:{formValidate:function(){return this.formData}},mounted(){this.getCloudSettingList(),this.getVpcList()}},r=o,d=(a("b115"),a("2877")),c=Object(d["a"])(r,i,s,!1,null,"280247bb",null);t["default"]=c.exports},9696:function(e,t,a){"use strict";a("3aae")},9735:function(e,t,a){},b115:function(e,t,a){"use strict";a("78fd")},b793:function(e,t,a){},c03a:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("Drawer",{attrs:{title:e.modalData.title,styles:e.styles,width:"70%",draggable:"","mask-closable":!1},on:{"on-close":e.handleCancel},model:{value:e.modalData.show,callback:function(t){e.$set(e.modalData,"show",t)},expression:"modalData.show"}},[t("div",{staticClass:"search-con search-con-top"},[t("div",{staticClass:"search-col"},[t("b",[e._v("选择主机:")])]),t("Cascader",{staticClass:"search-input",attrs:{data:e.treeData,"change-on-select":"",placeholder:"通过拓扑选择主机"},on:{"on-change":e.handleChange},model:{value:e.topoList,callback:function(t){e.topoList=t},expression:"topoList"}})],1),t("Table",{attrs:{size:"small",columns:e.columns,data:e.tableData}}),t("div",{staticStyle:{margin:"10px",overflow:"hidden"}},[t("div",{staticStyle:{float:"left"}},[t("Page",{attrs:{total:e.i.pageTotal,current:e.initPara.page_number,"page-size":e.initPara.page_size,"show-total":"","show-sizer":"","page-size-opts":[15,50,100]},on:{"on-change":e.handlerChangePage,"on-page-size-change":e.handlePageSize}})],1)]),t("div",{staticClass:"drawer-footer"},[t("Button",{staticStyle:{"margin-right":"8px"},on:{click:e.handleCancel}},[e._v("取消")]),t("Button",{staticStyle:{"margin-right":"8px"},attrs:{type:"warning"},on:{click:function(t){return e.handleSubmit()}}},[e._v("关联")])],1)],1)},s=[],n=a("0b12"),l={components:{},name:"regionAsset",props:{modalData:{type:Object,default:{}}},data(){return{topoList:[],params:{},treeData:[],initPara:{page_number:1,page_size:15,searchVal:null},i:{pageTotal:0,tableLoading:!1},tableData:[],columns:[{title:"环境",key:"env_name",width:100,align:"center"},{title:"集群",key:"region_name",minWidth:120,maxWidth:150,align:"center"},{title:"模块",key:"module_name",minWidth:120,maxWidth:170,align:"center"},{title:"资源名",key:"name",minWidth:150,align:"center"},{title:"内网IP",key:"inner_ip",minWidth:120,maxWidth:170,align:"center"},{title:"状态",key:"state",minWidth:110,maxWidth:140,align:"center"}],styles:{height:"calc(100% - 55px)",overflow:"auto",paddingBottom:"53px",position:"static"}}},methods:{handleCancel(){this.$emit("close")},async handleGetData(){const e=await Object(n["getServiceTreelist"])();0==e.code?(this.treeData=e.data,this.changeId2(this.treeData,"title","label","value")):this.$Notice.error({title:""+e.msg})},async handleGetAssetData(){this.params=Object.assign(this.params,this.initPara);const e=await Object(n["getTreeAsset"])(this.params);0==e.code?(this.tableData=e.data,this.i.pageTotal=e.count):this.$Notice.error({title:""+e.msg})},changeId2(e,t,a,i){null!=e&&e.forEach(e=>{Object.assign(e,{[a]:e[t],[i]:e[t]}),this.changeId2(e.children,t,a,i)})},handleChange(e){this.params={asset_type:"server"},e.length>=1&&(this.params["biz_cn"]=e[0]),e.length>=2&&(this.params["env_name"]=e[1]),e.length>=3&&(this.params["region_name"]=e[2]),4==e.length&&(this.params["module_name"]=e[3]),this.handleGetAssetData()},handleSubmit(){this.$emit("relevance",{id:this.modalData.id,topoParams:this.params})},handlerChangePage(e){this.initPara.page_number=e,this.handleGetAssetData()},handlePageSize(e){this.initPara.page_number=1,this.initPara.page_size=e,this.handleGetAssetData()}},watch:{},computed:{},mounted(){this.handleGetData()}},o=l,r=(a("d9d8"),a("229e"),a("2877")),d=Object(r["a"])(o,i,s,!1,null,"7ced1199",null);t["default"]=d.exports},d9d8:function(e,t,a){"use strict";a("b793")},e757:function(e,t,a){"use strict";a.r(t),a.d(t,"previewCloudRegion",(function(){return s})),a.d(t,"optCloudRegionPro",(function(){return n})),a.d(t,"getCloudRegion",(function(){return l})),a.d(t,"optCloudRegion",(function(){return o}));var i=a("be3b");const s=e=>Object(i["default"])({url:"/api/v2/cmdb/cloud_region/preview/",method:"get",params:e}),n=(e,t)=>Object(i["default"])({url:"/api/v2/cmdb/cloud_region/pro/",data:e,method:t}),l=e=>Object(i["default"])({url:"/api/v2/cmdb/cloud_region/",method:"get",params:e}),o=(e,t)=>Object(i["default"])({url:"/api/v2/cmdb/cloud_region/",data:e,method:t})}}]);
//# sourceMappingURL=chunk-cfaaec66.0ad15de5.js.map