(window["webpackJsonp_cmdb"]=window["webpackJsonp_cmdb"]||[]).push([["chunk-27a74ccb","chunk-6a3ffeb8","chunk-ed78b5d4","chunk-2d0c42de","chunk-2d2250dc","chunk-2d0c8c03","chunk-2d213107"],{"3a71":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[t("Drawer",{attrs:{"before-close":e.handleClose,title:e.modalData.title,width:"50%",draggable:"","mask-closable":!1,"footer-hide":!0},on:{"on-close":e.handleCancel},model:{value:e.modalData.show,callback:function(t){e.$set(e.modalData,"show",t)},expression:"modalData.show"}},[t("Form",{ref:"formValidate",attrs:{model:e.formValidate,rules:e.ruleValidate,"label-width":100}},[t("FormItem",{attrs:{label:"实例名称",prop:"name"}},[t("Input",{attrs:{maxlength:120,placeholder:"请输入实例名称"},model:{value:e.formValidate.name,callback:function(t){e.$set(e.formValidate,"name",t)},expression:"formValidate.name"}})],1),t("FormItem",{attrs:{label:"厂商信息",prop:"cloud_name"}},[t("Input",{attrs:{maxlength:120,placeholder:"请输入厂商名称"},model:{value:e.formValidate.cloud_name,callback:function(t){e.$set(e.formValidate,"cloud_name",t)},expression:"formValidate.cloud_name"}})],1),t("FormItem",{attrs:{label:"内网IP",prop:"inner_ip"}},[t("Input",{attrs:{maxlength:120,placeholder:"请输入内网IP"},model:{value:e.formValidate.inner_ip,callback:function(t){e.$set(e.formValidate,"inner_ip",t)},expression:"formValidate.inner_ip"}})],1),t("FormItem",{attrs:{label:"外网IP",prop:"outer_ip"}},[t("Input",{attrs:{maxlength:120,placeholder:"请输入"},model:{value:e.formValidate.outer_ip,callback:function(t){e.$set(e.formValidate,"outer_ip",t)},expression:"formValidate.outer_ip"}})],1),t("FormItem",{attrs:{label:"实例ID",prop:"instance_id"}},[t("Input",{attrs:{maxlength:120,placeholder:"请输入实例ID，如果不填则随机生成"},model:{value:e.formValidate.instance_id,callback:function(t){e.$set(e.formValidate,"instance_id",t)},expression:"formValidate.instance_id"}})],1),t("FormItem",{attrs:{label:"Agent ID",prop:"agent_id"}},[t("Input",{attrs:{maxlength:120,placeholder:"请输入，如果不填默认"},model:{value:e.formValidate.instance_id,callback:function(t){e.$set(e.formValidate,"instance_id",t)},expression:"formValidate.instance_id"}})],1),t("FormItem",{attrs:{label:"扩展字段"}},[t("vue-json-editor",{attrs:{"show-btns":!1,mode:"code",lang:"zh"},on:{"json-change":e.onJsonChange,"json-save":e.onJsonSave,"has-error":e.onError},model:{value:e.formValidate.ext_info,callback:function(t){e.$set(e.formValidate,"ext_info",t)},expression:"formValidate.ext_info"}})],1),t("FormItem",[t("Button",{attrs:{type:"primary"},on:{click:function(t){return e.handleSubmit("formValidate",!1)}}},[e._v("保存")]),t("Button",{staticStyle:{"margin-left":"8px"},on:{click:function(t){return e.handleSubmit("formValidate",!0)}}},[e._v("保存并继续")]),t("Button",{staticStyle:{"margin-left":"8px"},on:{click:function(t){return e.handleReset("formValidate")}}},[e._v("重置")])],1)],1)],1)],1)},s=[],i=a("45a3"),l={name:"serverAdd",components:{vueJsonEditor:i["a"]},props:{modalData:{type:Object,default:{}}},data(){return{btnLoading:!1,ruleValidate:{name:[{required:!0,message:"名称不能为空",trigger:"blur"}],cloud_name:[{required:!0,message:"名称不能为空",trigger:"blur"}],inner_ip:[{required:!0,message:"内网IP不能为空",trigger:"blur"}]},formValidate:{cloud_name:"qcloud",ext_info:{cpu:4,zone:"ap-shanghai-5",state:"运行中",memory:8,region:"ap-shanghai",vpc_id:"vpc-66666666666",os_name:"CentOS 7.5 64位",inner_ip:"",outer_ip:"",data_disk:100,charge_type:"包年包月",instance_id:"",system_disk:50,network_type:"vpc",instance_type:"TS4.LARGE8",security_group_ids:[],instance_create_time:"2093-04-23T18:40:53Z",instance_expired_time:"2093-07-23T18:40:53Z"}}}},methods:{handleCancel(){this.$emit("drawer-close")},handleClose(){this.$emit("drawer-close")},handleSubmit(e,t){this.$refs[e].validate(e=>{e?(this.btnLoading=!0,setTimeout(()=>{this.$emit("save-data",this.formValidate,this.modalData.action,t),this.btnLoading=!1},1e3)):this.$Message.error("表单校验不通过!")})},onJsonChange(e){console.log("更改了--\x3e",e),this.jsonErrFlag=!1},onJsonSave(e){console.log("保存了---\x3e",e)},onError(e){console.log("报错了---\x3e",e),this.jsonErrFlag=!0}},watch:{},computed:{},mounted(){}},n=l,o=a("2877"),d=Object(o["a"])(n,r,s,!1,null,null,null);t["default"]=d.exports},4702:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[t("Card",{attrs:{"dis-hover":"",bordered:!1}},[t("Alert",{attrs:{"show-icon":""}},[e._v(" 已选择 "),t("span",[e._v(e._s(e.selectList.length))]),e._v(" 项 "),t("a",{staticStyle:{"margin-left":"10px"},on:{click:e.clearSelectAll}},[e._v("清空已选")])]),t("div",[t("Input",{staticStyle:{width:"300px",margin:"2px"},attrs:{search:"",placeholder:"输入关键字全局搜索"},on:{"on-search":e.handleSearch},model:{value:e.searchParams.searchVal,callback:function(t){e.$set(e.searchParams,"searchVal",t)},expression:"searchParams.searchVal"}}),t("Button",{staticStyle:{margin:"3px"},on:{click:e.handleAdd}},[e._v("添加")]),t("span",{staticStyle:{"margin-left":"20px"}},[e._v("一键筛选：")]),t("ButtonGroup",["is_normal"===e.searchParams.search_filter?t("Button",{attrs:{type:"primary"},on:{click:function(t){return e.handlefilter("is_normal")}}},[e._v("未过期")]):t("Button",{on:{click:function(t){return e.handlefilter("is_normal")}}},[e._v("未过期")]),"is_expired"===e.searchParams.search_filter?t("Button",{attrs:{type:"primary"},on:{click:function(t){return e.handlefilter("is_expired")}}},[e._v("已过期")]):t("Button",{on:{click:function(t){return e.handlefilter("is_expired")}}},[e._v("已过期")]),"is_showdown"===e.searchParams.search_filter?t("Button",{attrs:{type:"primary"},on:{click:function(t){return e.handlefilter("is_showdown")}}},[e._v("已关机")]):t("Button",{on:{click:function(t){return e.handlefilter("is_showdown")}}},[e._v("已关机")])],1),0!==e.selectList.length?[t("Button",{staticStyle:{"margin-left":"5px"},on:{click:e.handleShowEditAddr}},[e._v("业务出口")]),t("Button",{staticStyle:{margin:"5px"},attrs:{type:"error"},on:{click:e.handleDelete}},[e._v("一键删除")]),t("Button",{staticClass:"search-btn",attrs:{type:"primary"},on:{click:function(t){return e.exportData(2)}}},[t("Icon",{attrs:{type:"ios-download-outline"}}),e._v("导出数据 ")],1)]:[t("Button",{staticStyle:{"margin-left":"5px"},attrs:{type:"primary",disabled:""},on:{click:e.handleShowEditAddr}},[e._v("业务出口")]),t("Button",{staticStyle:{margin:"5px"},attrs:{type:"error",disabled:""}},[e._v("一键删除")]),t("Button",{staticClass:"search-btn",attrs:{type:"primary",disabled:""}},[t("Icon",{attrs:{type:"ios-download-outline"}}),e._v("导出数据 ")],1)],t("div",{staticStyle:{float:"right"}},[t("Button",{on:{click:function(t){return e.handerSettingShow()}}},[t("Icon",{attrs:{type:"ios-settings"}}),e._v("字段配置 ")],1)],1)],2),e.serverData?t("div",[t("serverDetail",{attrs:{"modal-data":e.modalData,"server-data":e.serverData}})],1):e._e(),t("div",{staticStyle:{"margin-top":"5px"}},[t("Table",{ref:"selection",attrs:{stripe:"",size:"small",columns:e.tableColumns2,data:e.tableData},on:{"on-sort-change":e.handleSort,"on-selection-change":e.changeSelect}})],1),t("div",{staticStyle:{margin:"10px",overflow:"hidden"}},[t("div",{staticStyle:{float:"left"}},[t("Page",{attrs:{total:e.pageTotal,current:e.searchParams.page_number,"page-size":e.searchParams.page_size,"page-size-opts":[12,35,50,100,2e3],"show-sizer":"","show-total":""},on:{"on-change":e.changePage,"on-page-size-change":e.handlePageSize}})],1)])],1),t("Modal",{attrs:{width:"450"},model:{value:e.modalAddrEdit,callback:function(t){e.modalAddrEdit=t},expression:"modalAddrEdit"}},[t("p",{staticStyle:{color:"#f60","text-align":"center"},attrs:{slot:"header"},slot:"header"},[t("Icon",{attrs:{type:"ios-information-circle"}}),t("span",[e._v("批量修改业务出口地址")])],1),t("div",{staticStyle:{"text-align":"center"}},[t("p",[e._v("地址出错会严重影响业务！")]),t("p",[e._v("当真要修改吗！")])]),t("div",{staticStyle:{padding:"10px 0 0 0"}},[t("Input",{staticClass:"search-input",attrs:{clearable:"",maxlength:250,placeholder:"输入当前的业务出口地址，一般是是EIP、LB、域名"},model:{value:e.outer_biz_addr,callback:function(t){e.outer_biz_addr=t},expression:"outer_biz_addr"}})],1),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("Button",{attrs:{type:"error",size:"large",long:"",loading:e.btnLoading},on:{click:e.handleSaveAddr}},[e._v("提交")])],1)]),t("Drawer",{staticStyle:{"background-color":"#f8f8f9"},attrs:{title:"选择展示的字段",width:"500"},model:{value:e.showDrawer,callback:function(t){e.showDrawer=t},expression:"showDrawer"}},[t("Transfer",{attrs:{filterable:"","list-style":e.listStyle,titles:e.tranferTitles,data:e.sourceField,"target-keys":e.targetField},on:{"on-change":e.handleSettingChange}})],1),t("server-add",{attrs:{"modal-data":e.modalAdd},on:{"drawer-close":e.handleClose,"save-data":e.handleSaveData}}),t("div",{staticStyle:{position:"relative"}},[t("Drawer",{attrs:{"mask-closable":!1,width:"75%"},model:{value:e.showDrawerSecurity,callback:function(t){e.showDrawerSecurity=t},expression:"showDrawerSecurity"}},[t("security-group",{attrs:{instance_id:e.instance_id,sg_ids:e.sg_ids}})],1)],1)],1)},s=[],i=(a("14d9"),a("aaa2")),l=a("e380"),n=a("3a71"),o=a("9c6b"),d={components:{serverDetail:l["default"],serverAdd:n["default"],SecurityGroup:o["default"]},data(){return{showDrawer:!1,sourceField:[{label:"selection",key:"selection",disabled:!0},{label:"ID",key:"id",disabled:!0},{label:"云厂商",key:"cloud_name",disabled:!0},{label:"实例ID",key:"instance_id",disabled:!0},{label:"实例名称",key:"name",disabled:!0},{label:"内网IP",key:"inner_ip",disabled:!0},{label:"外网IP",key:"outer_ip"},{label:"运行状态",key:"state",disabled:!0},{label:"最后更新时间",key:"update_time",disabled:!0},{label:"地区",key:"region"},{label:"机房",key:"zone"},{label:"是否过期",key:"is_expired"},{label:"Agent ID",key:"agent_id"},{label:"CPU",key:"cpu"},{label:"内存",key:"memory"},{label:"系统OS",key:"os_name"},{label:"系统盘",key:"system_disk"},{label:"数据盘",key:"data_disk"},{label:"付费类型",key:"charge_type"},{label:"网络类型",key:"network_type"},{label:"实例类型",key:"instance_type"},{label:"实例创建时间",key:"instance_create_time"},{label:"线上使用",key:"is_product"}],targetField:["selection","id","cloud_name","instance_id","name","inner_ip","show_security_group","state","update_time"],tranferTitles:["所有字段","收藏字段"],listStyle:{width:"200px",height:"750px"},modalData:{show:!1,title:"主机详情"},modalAdd:{show:!1,action:"post",title:"添加主机"},modalAddrEdit:!1,outer_biz_addr:null,serverData:{},selectOperation:"more",check_box_list:[],tableColumnsChecked:["selection","name","cloud_name","instance_id","inner_ip","show_security_group","agent_id","state","update_time"],modalMap:{loading:!1,modalVisible:!1,modalTitle:"添加"},selectList:[],searchVal:null,pageTotal:null,method_data:null,formValidate:{},tableData:[],tableColumns2:[],ruleValidate:{},showDrawerSecurity:!1,instance_id:null,sg_ids:[],searchParams:{page_number:1,page_size:12,search_filter:"is_normal",order_by:"",order:"ascend"}}},mounted(){this.getTableData(),this.tableColumns2=this.getTable2Columns(),this.getUserFieldFavorites()},methods:{getTable2Columns(){const e={selection:{type:"selection",title:"selection",key:"selection",width:60,align:"center"},id:{title:"ID",key:"id",align:"center",width:100,sortable:!0},cloud_name:{title:"厂商",key:"cloud_name",align:"center",width:120,sortable:!0,render:(e,t)=>{const a=t.row.cloud_name;return e("div","qcloud"===a?[e("Tag",{props:{color:"geekblue"}},"腾讯云")]:"aliyun"===a?[e("Tag",{props:{color:"blue"}},"阿里云")]:"cds"===a?[e("Tag",{props:{color:"cyan"}},"首都云")]:"vmware"===a?[e("Tag",{props:{color:"purple"}},"VMware")]:"volc"===a?[e("Tag",{props:{color:"orange"}},"火山云")]:"aws"===a?[e("Tag",{props:{color:"volcano"}},"AWS")]:[e("Tag",{props:{color:"gold"}},a)])}},region:{title:"地区",key:"zone",align:"center",width:150,sortable:!0},zone:{title:"机房",key:"zone",align:"center",width:150,sortable:!0},instance_id:{title:"实例ID",key:"instance_id",minWidth:190,align:"center",render:(e,t)=>e("a",{on:{click:()=>{this.handleDetail(t.row)}}},t.row.instance_id)},name:{title:"实例名称",minWidth:220,key:"name",align:"left",sortable:!0,tooltip:!0},inner_ip:{title:"内网IP",key:"inner_ip",align:"center",width:150,sortable:!0},outer_ip:{title:"外网IP",key:"outer_ip",align:"center",width:150,sortable:!0},show_security_group:{title:"安全组",key:"instance_id",align:"center",minWidth:90,render:(e,t)=>e("a",[e("Icon",{props:{type:"ios-eye"},nativeOn:{click:()=>{this.handlerShowSecurity(t.row)}}}),e("a",{on:{click:()=>{this.handlerShowSecurity(t.row)}}},"  查看")])},cpu:{title:"CPU",key:"cpu",align:"center",width:80,sortable:!0},memory:{title:"内存",key:"memory",align:"center",width:80,sortable:!0},system_disk:{title:"系统盘(G)",key:"system_disk",align:"center",width:120},data_disk:{title:"数据盘(G)",key:"data_disk",align:"center",width:120},state:{title:"状态",key:"state",align:"center",width:130,sortable:!0,render:(e,t)=>{const{row:a}=t,r="运行中"===a.state?"success":"关机"===a.state?"error":"创建中"===a.state?"primary":"error",s="运行中"===a.state?"运行中":"关机"===a.state?"已关机":"创建中"===a.state?"创建中":"Fail";return e("Tag",{props:{type:"dot",color:r}},s)}},os_name:{title:"系统",key:"os_name",align:"center",width:150,sortable:!0},network_type:{title:"网络类型",key:"network_type",align:"center",width:150,sortable:!0,render:(e,t)=>"经典网络"===t.row.network_type?e("div",[e("Tag",{props:{color:"cyan"}},"经典网络")]):"专有网络"===t.row.network_type?e("div",[e("Tag",{props:{color:"green"}},"专有网络")]):e("div",[e("Tag",{props:{color:"error"}},"未知")])},charge_type:{title:"付费类型",key:"charge_type",align:"center",width:120,sortable:!0,render:(e,t)=>"包年包月"===t.row.charge_type?e("div",[e("Tag",{props:{color:"blue"}},"包年包月")]):"按量付费"===t.row.charge_type?e("div",[e("Tag",{props:{color:"orange"}},"按量付费")]):e("div",[e("Tag",{props:{color:"error"}},"未知")])},instance_type:{title:"实例类型",key:"instance_type",align:"center",width:150,sortable:!0},is_expired:{title:"是否过期",key:"is_expired",align:"center",width:120,sortable:!0,render:(e,t)=>!0===t.row.is_expired?e("div",[e("Tag",{props:{color:"error"}},"已过期")]):!1===t.row.is_expired?e("div",[e("Tag",{props:{color:"success"}},"正常")]):e("div",[e("Tag",{props:{color:"error"}},"未知")])},instance_create_time:{title:"创建时间",key:"instance_create_time",align:"center",width:190,sortable:!0},instance_expired_time:{title:"过期时间",key:"instance_expired_time",align:"center",width:185,sortable:!0},update_time:{title:"数据更新时间",key:"update_time",align:"center",fixed:"right",width:180,sortable:!0},detail:{title:"备注",key:"detail",align:"center",width:150,sortable:!0},agent_id:{title:"Agent ID",key:"agent_id",align:"center",width:150,sortable:!0},is_product:{title:"线上使用",key:"is_product",align:"center",width:120,sortable:!0,render:(e,t)=>0===t.row.is_product?e("div",[e("Tag",{props:{color:"error"}},"False")]):1===t.row.is_product?e("div",[e("Tag",{props:{color:"success"}},"True")]):e("div",[e("Tag",{props:{color:"error"}},"未知")])}},t=[];return this.targetField.forEach(e=>{-1===this.tableColumnsChecked.indexOf(e)&&this.tableColumnsChecked.push(e)}),this.tableColumnsChecked.forEach(a=>t.push(e[a])),t},changeTableColumns(){this.tableColumns2=this.getTable2Columns()},async getTableData(){const e=await Object(i["getServerList"])(this.searchParams);0===e.code?(this.tableData=e.data,this.pageTotal=e.count):this.$message.error(""+e.msg)},handleClose(){this.modalData.show=!1,this.modalAdd.show=!1,this.modalAddrEdit=!1,this.getTableData()},handleDetail(e){this.serverData=e,this.modalData.show=!0},handleSearch(){this.searchParams.page_number=1,this.getTableData()},handcustomView(){this.modalMap.modalVisible=!0,this.modalMap.modalTitle="列表显示属性配置"},handleAdd(){this.modalAdd.show=!0},handleSaveData(e,t,a){Object(i["optServer"])(e,t).then(e=>{0==e.code?(this.$Message.success("成功"),a?this.getTableData():this.handleClose()):this.$Message.error(e.msg)})},handleShowEditAddr(){this.modalAddrEdit=!0,this.outer_biz_addr=null},handleSaveAddr(){this.outer_biz_addr?this.$Modal.confirm({title:"二次确认",content:"确定修改已选中的数据?",onOk:()=>{Object(i["optBatchServer"])({hosts:this.selectList,outer_biz_addr:this.outer_biz_addr},"patch").then(e=>{0===e.code?(this.$Message.success(e.msg),this.handleClose()):this.$Notice.error({title:""+e.msg}),this.clearSelectAll()})},onCancel:()=>{this.$Message.info("回头是岸~"),this.clearSelectAll()}}):this.$Message.warning("地址数据不能为空~")},handlefilter(e){this.searchParams.search_filter=e,this.getTableData()},handleDelete(){this.$Modal.confirm({title:"二次确认",content:"确定删除已选中的数据? 只能删除与业务没有关联的主机",onOk:()=>{Object(i["optServer"])({hosts:this.selectList},"delete").then(e=>{0===e.code?(this.$Message.success(e.msg),this.handleClose()):this.$Notice.error({title:""+e.msg}),this.clearSelectAll()})},onCancel:()=>{this.$Message.info("回头是岸~"),this.clearSelectAll()}})},handerSelectOperation(e){try{0===this.selectList.length?this.$Message.error("同学, 请至少选择一条数据."):this.$Message.info("你选择了（待开发）",e)}finally{this.selectOperation="more"}},exportData(e){1===e?this.$refs.selection.exportCsv({filename:"codo_cmdb_original_data"}):2===e&&this.$refs.selection.exportCsv({filename:"codo_cmdb_sorting_and_filtering_data",original:!1}),this.clearSelectAll()},handlerShowSecurity(e){this.instance_id=e.instance_id,this.sg_ids=e.security_group_ids,e.security_group_ids?this.showDrawerSecurity=!this.showDrawerSecurity:this.$Notice.error({title:"当前实例下没有安全组或者不支持查询"})},handleSort(e,t,a){this.searchParams.order="asc"===e.order?"ascend":"descend",this.searchParams.order_by=e.key,this.getTableData()},changePage(e){this.searchParams.page_number=e,this.clearSelectAll(),this.getTableData()},handlePageSize(e){this.searchParams.page_size=e,this.clearSelectAll(),this.getTableData()},changeSelect(e){this.selectList=e},clearSelectAll(){this.$refs.selection.selectAll(!1)},handleReset(e){this.$refs[e].resetFields()},handerSettingShow(){this.showDrawer=!this.showDrawer},handleSettingChange(e,t,a){console.log("最终提交上去的。",e),console.log("向",t),console.log("移动",a),this.targetField=e,this.tableColumnsChecked=this.$options.data().tableColumnsChecked,this.handlerUpdateFavorites(),this.changeTableColumns()},async handlerUpdateFavorites(){const e=[...new Set(this.targetField)],t=e.join(","),a={user_type:"server",user_fields:t},r=await Object(i["optrationUserField"])(a);0===r.code?this.$Message.success(""+r.msg):this.$Message.error(""+r.msg)},getUserFieldFavorites(){Object(i["getUserField"])({user_type:"server"}).then(e=>{0===e.code&&e.data&&e.data.split(",").forEach(e=>{this.targetField.push(e)}),this.changeTableColumns()})}}},c=d,p=a("2877"),h=Object(p["a"])(c,r,s,!1,null,null,null);t["default"]=h.exports},4861:function(e,t,a){"use strict";a("e011")},"55e2":function(e,t,a){"use strict";a.r(t),a.d(t,"getSecurityGroup",(function(){return s})),a.d(t,"optSecurityGroup",(function(){return i})),a.d(t,"getSecurityGroupRefs",(function(){return l}));var r=a("be3b");const s=e=>Object(r["default"])({url:"/api/v2/cmdb/security_group/",method:"get",params:e}),i=(e,t)=>Object(r["default"])({url:"/api/v2/cmdb/security_group/",method:t,data:e}),l=e=>Object(r["default"])({url:"/api/v2/cmdb/security_group/refs/",method:"get",params:e})},"7bd2":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[t("Drawer",{attrs:{title:e.drawerData.title,"mask-closable":!1,transfer:!1,inner:!0,width:"75%"},model:{value:e.drawerData.show,callback:function(t){e.$set(e.drawerData,"show",t)},expression:"drawerData.show"}},[t("Tabs",{attrs:{value:"attribute"},on:{"on-click":e.handleClick}},[t("TabPane",{attrs:{label:"安全组规则",name:"attribute"}},[t("Table",{attrs:{size:"small",columns:e.tableColumns,data:e.security_info}})],1),t("TabPane",{attrs:{label:"安全组内主机",name:"server"}},[t("Table",{attrs:{size:"small",columns:e.tableColumnsServer,data:e.tableDataServer}})],1),e.ref_info.length>0?t("TabPane",{attrs:{label:"安全组间关联",name:"references"}},[e._v(" "+e._s(e.ref_info)+" 关联了本安全组 ")]):e._e()],1),e.serverData?t("div",[t("serverDetail",{attrs:{modalData:e.modalData,serverData:e.serverData}})],1):e._e()],1)],1)},s=[],i=a("55e2"),l=a("e380"),n={name:"SecurityGroupDetail",components:{serverDetail:l["default"]},props:{drawerData:{type:Object,default:{}},security_info:{type:Array|Object,default:[]},ref_info:{type:Array|Object,default:[]},securityGroupId:{type:String,default:null}},data(){return{tableColumns:[{title:"安全组ID",key:"security_group_id",ellipsis:!0,tooltip:!0,minWidth:100},{title:"授权策略",key:"policy",minWidth:100,render:(e,t)=>{let a=t.row.policy;return e("span",{},"Accept"==a||"ACCEPT"==a?"允许":a)}},{title:"优先级",key:"priority",minWidth:80},{title:"协议类型",key:"ip_protocol",minWidth:100},{title:"端口范围",key:"port_range",minWidth:100},{title:"授权对象",key:"source_cidr_ip",minWidth:180,render:(e,t)=>{console.info(t.row);let a=t.row.direction;return e("span",{},"ingress"==a?`源：${t.row.source_cidr_ip} ${t.row.source_group_name}`:"egress"==a?`目标：${t.row.dest_cidr_ip} ${t.row.dest_group_name}`:`源：${t.row.source_cidr_ip}  目标：${t.row.dest_cidr_ip} `)}},{title:"授权方向",key:"direction",minWidth:100,render:(e,t)=>{let a=t.row.direction;return e("span",{},"ingress"==a?"入方向":"egress"==a?"出方向":"all"==a?"全部":t.row.direction)}},{title:"描述",key:"description",tooltip:!0,minWidth:100}],tableDataServer:[],tableColumnsServer:[{title:"实例ID",key:"instance_id",minWidth:150,render:(e,t)=>e("a",{on:{click:()=>{this.handlerDetail(t.row)}}},t.row.instance_id)},{title:"主机名",key:"name",minWidth:100},{title:"内网IP",key:"inner_ip",minWidth:130},{title:"地域",key:"region",minWidth:100}],serverData:{},modalData:{show:!1,title:"主机详情"},referencesGroup:null}},methods:{handleGetSecurityGroupServer(){Object(i["getSecurityGroupRefs"])({sg_id:this.securityGroupId,asset_type:"server"}).then(e=>{0==e.code?this.tableDataServer=e.data:(this.tableDataServer=[],this.$Message.info("当前安全组下没有找到实例"))})},handleClick(e){},handlerDetail(e){this.serverData=e,this.modalData.show=!0}},watch:{securityGroupId(e){this.handleGetSecurityGroupServer()}},mounted(){}},o=n,d=a("2877"),c=Object(d["a"])(o,r,s,!1,null,null,null);t["default"]=c.exports},"9c6b":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"search-con search-con-top"},[t("Input",{staticClass:"search-input",attrs:{search:"",maxlength:50,placeholder:"输入关键字搜索"},on:{"on-search":e.handleSearch},model:{value:e.initPara.searchVal,callback:function(t){e.$set(e.initPara,"searchVal",t)},expression:"initPara.searchVal"}}),e.instance_id?t("h4",{staticClass:"search-col"},[e._v("实例："+e._s(e.instance_id))]):e._e(),e.instance_id?e._e():t("Button",{staticClass:"search-add-btn",attrs:{type:"error",disabled:0===e.selectList.length},on:{click:e.handleDel}},[e._v("批量删除")]),e.instance_id?e._e():t("Button",{staticClass:"search-add-btn",attrs:{disabled:0===e.selectList.length},on:{click:e.exportData}},[t("Icon",{attrs:{type:"ios-download-outline"}}),e._v("导出数据 ")],1)],1),t("Table",{ref:"selection",attrs:{size:"small",columns:e.tableColumns,data:e.tableData,loading:e.i.tableLoading},on:{"on-sort-change":e.handleSort,"on-selection-change":e.handleSelect}}),t("div",{staticStyle:{margin:"10px",overflow:"hidden"}},[t("div",{staticStyle:{float:"left"}},[t("Page",{attrs:{total:e.i.pageTotal,current:e.initPara.page_number,"page-size":e.initPara.page_size,"show-total":"","show-sizer":"","page-size-opts":[15,50,100,1e3]},on:{"on-change":e.handlerChangePage,"on-page-size-change":e.handlePageSize}})],1)]),t("SecurityGroupDetail",{ref:"sgDetail",attrs:{drawerData:e.drawerData,security_info:e.securityInfoList,ref_info:e.refList,securityGroupId:e.selectSecurityGroupId}})],1)},s=[],i=(a("14d9"),a("55e2")),l=a("7bd2"),n={name:"SecurityGroup",components:{SecurityGroupDetail:l["default"]},props:{instance_id:{type:String,default:null},sg_ids:{type:Object|Array,default:null}},data(){return{tableColumns:[{type:"selection",key:"selection",width:60,align:"center"},{title:"安全组名",key:"security_group_name",tooltip:!0,sortable:!0,minWidth:150},{title:"安全组ID",key:"instance_id",ellipsis:!0,tooltip:!0,minWidth:200,render:(e,t)=>e("a",{on:{click:()=>{this.handlerDetail(t.row)}}},t.row.instance_id)},{title:"类型",key:"security_group_type",minWidth:100},{title:"厂商",key:"cloud_name",minWidth:90},{title:"地域",key:"region",minWidth:90},{title:"备注",key:"description",ellipsis:!0,tooltip:!0,minWidth:200},{title:"更新时间",key:"update_time",sortable:!0,width:170}],tableData:[],i:{pageTotal:0,tableLoading:!0},initPara:{page_number:1,page_size:15,searchVal:null,sg_ids:[],order_by:"",order:"ascend"},selectList:[],drawerData:{show:!1,title:"安全组信息"},securityInfoList:[],refList:[],selectSecurityGroupId:null}},methods:{async handleGetData(){const e=await Object(i["getSecurityGroup"])(this.initPara);0==e.code?(this.tableData=e.data,this.i.pageTotal=e.count):this.$Message.error(e.msg),this.i.tableLoading=!1},handleDel(){this.$Modal.confirm({title:"二次确认",content:"确定删除已选中的数据？",onOk:()=>{Object(i["optSecurityGroup"])({id_list:this.selectList},"delete").then(e=>{0===e.code?(this.$Message.success(e.msg),this.handleGetData()):this.$Notice.error({title:""+e.msg})})},onCancel:()=>{this.$Message.info("回头是岸~")}})},handlerDetail(e){this.securityInfoList=e.security_info.items,this.refList=e.ref_info.items,this.selectSecurityGroupId=e.instance_id,this.drawerData.show=!0},exportData(){this.$refs.selection.exportCsv({filename:"codo_cmdb_original_sg_data"})},handleSelect(e){let t=[];e.forEach(e=>{t.push(e.id)}),this.selectList=t},handleSearch(){this.initPara.page_number=1,this.handleGetData()},handleSort(e,t,a){this.initPara.order="asc"===e.order?"ascend":"descend",this.initPara.order_by=e.key,this.handleGetData()},handlerChangePage(e){this.initPara.page_number=e,this.handleGetData()},handlePageSize(e){this.initPara.page_number=1,this.initPara.page_size=e,this.handleGetData()}},watch:{searchValue(e){this.pageNum=1,this.handleGetData()},instance_id(e){this.pageNum=1,this.securityInfoList=[],this.handleGetData()},sg_ids(e){this.initPara["sg_ids"]=JSON.stringify(this.sg_ids),this.pageNum=1,this.securityInfoList=[],this.handleGetData()}},computed:{},mounted(){this.handleGetData()}},o=n,d=(a("4861"),a("2877")),c=Object(d["a"])(o,r,s,!1,null,"0a04be8a",null);t["default"]=c.exports},aaa2:function(e,t,a){"use strict";a.r(t),a.d(t,"getServerList",(function(){return s})),a.d(t,"optServer",(function(){return i})),a.d(t,"optBatchServer",(function(){return l})),a.d(t,"getUserField",(function(){return n})),a.d(t,"optrationUserField",(function(){return o}));var r=a("be3b");const s=e=>Object(r["default"])({url:"/api/v2/cmdb/server/",method:"get",params:e}),i=(e,t)=>Object(r["default"])({url:"/api/v2/cmdb/server/",method:t,data:e}),l=(e,t)=>Object(r["default"])({url:"/api/v2/cmdb/server/batch/",method:t,data:e}),n=e=>Object(r["default"])({url:"/api/v2/cmdb/user_field/",method:"get",params:e}),o=e=>Object(r["default"])({url:"/api/v2/cmdb/user_field/",method:"put",data:e})},e011:function(e,t,a){},e380:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("Modal",{attrs:{width:"780px;",title:e.modalData.title,"footer-hide":!0,styles:{top:"30px"}},model:{value:e.modalData.show,callback:function(t){e.$set(e.modalData,"show",t)},expression:"modalData.show"}},[t("Card",{attrs:{"dis-hover":""}},[t("div",{staticClass:"inner"},[t("Alert",{attrs:{"show-icon":""}},[e._v("基本信息")]),t("div",{staticStyle:{"margin-top":"10px","margin-bottom":"10px"}},[t("Row",[t("Col",{attrs:{span:"4"}},[t("p",[t("b",[e._v("实例ID：")])])]),t("Col",{attrs:{span:"20"}},[t("p",[e._v(" "+e._s(e.serverData.instance_id))])])],1),t("Row",{staticStyle:{"margin-top":"10px","margin-bottom":"10px"}},[t("Col",{attrs:{span:"4"}},[t("p",[t("b",[e._v("主机名：")])])]),t("Col",{attrs:{span:"20"}},[t("p",[e._v(" "+e._s(e.serverData.name))])])],1),t("Row",{staticStyle:{"margin-top":"10px","margin-bottom":"10px"}},[t("Col",{attrs:{span:"4"}},[t("p",[t("b",[e._v("厂商：")])])]),e.serverData.cloud_name?t("Col",{attrs:{span:"8"}},[t("p",[e._v(" "+e._s(e.serverData.cloud_name)+" ")])]):e._e(),t("Col",{attrs:{span:"4"}},[t("p",[t("b",[e._v("可用区：")])])]),t("Col",{attrs:{span:"8"}},[t("p",[e._v(" "+e._s(e.serverData.zone)+" ")])])],1),t("Row",{staticStyle:{"margin-top":"10px","margin-bottom":"10px"}},[t("Col",{attrs:{span:"4"}},[t("p",[t("b",[e._v("网络类型：")])])]),e.serverData.network_type?t("Col",{attrs:{span:"8"}},[t("p",[e._v(" "+e._s(e.serverData.network_type)+" ")])]):t("Col",{attrs:{span:"8"}},[t("p",[e._v("未知信息")])]),t("Col",{attrs:{span:"4"}},[t("p",[t("b",[e._v("付费类型：")])])]),e.serverData.charge_type?t("Col",{attrs:{span:"8"}},[t("p",[e._v(" "+e._s(e.serverData.charge_type)+" ")])]):t("Col",{attrs:{span:"8"}},[t("p",[e._v("未知信息")])])],1),t("Row",{staticStyle:{"margin-top":"10px","margin-bottom":"10px"}},[t("Col",{attrs:{span:"4"}},[t("p",[t("b",[e._v("实例状态：")])])]),"运行中"==e.serverData.state?t("Col",{attrs:{span:"8"}},[t("p",[t("tag",{attrs:{color:"success"}},[e._v(e._s(e.serverData.state))])],1)]):t("Col",{attrs:{span:"8"}},[t("p",[t("tag",{attrs:{color:"red"}},[e._v(e._s(e.serverData.state))])],1)]),t("Col",{attrs:{span:"4"}},[t("p",[t("b",[e._v("实例类型：")])])]),t("Col",{attrs:{span:"8"}},[t("p",[e._v(" "+e._s(e.serverData.instance_type)+" ")])])],1),t("Row",{staticStyle:{"margin-top":"10px","margin-bottom":"10px"}},[t("Col",{attrs:{span:"4"}},[t("p",[t("b",[e._v("公网IP：")])])]),e.serverData.outer_ip?t("Col",{attrs:{span:"8"}},[t("p",[e._v(" "+e._s(e.serverData.outer_ip))])]):t("Col",{attrs:{span:"8"}},[t("p",[e._v("没有公网IP")])]),t("Col",{attrs:{span:"4"}},[t("p",[t("b",[e._v("私网IP：")])])]),t("Col",{attrs:{span:"8"}},[t("p",[e._v(" "+e._s(e.serverData.inner_ip)+" ")])])],1),t("Row",{staticStyle:{"margin-top":"10px","margin-bottom":"10px"}},[t("Col",{attrs:{span:"4"}},[t("p",[t("b",[e._v("CPU核心：")])])]),e.serverData.cpu?t("Col",{attrs:{span:"8"}},[t("p",[e._v(" "+e._s(e.serverData.cpu)+" ")])]):t("Col",{attrs:{span:"8"}},[t("p",[e._v("未知信息")])]),t("Col",{attrs:{span:"4"}},[t("p",[t("b",[e._v("内存：")])])]),e.serverData.memory?t("Col",{attrs:{span:"8"}},[t("p",[e._v(" "+e._s(e.serverData.memory)+" ")])]):t("Col",{attrs:{span:"8"}},[t("p",[e._v("未知信息")])])],1),t("Row",{staticStyle:{"margin-top":"10px","margin-bottom":"10px"}},[t("Col",{attrs:{span:"4"}},[t("p",[t("b",[e._v("系统磁盘：")])])]),e.serverData.system_disk?t("Col",{attrs:{span:"8"}},[t("p",[e._v(" "+e._s(e.serverData.system_disk)+" ")])]):t("Col",{attrs:{span:"8"}},[t("p",[e._v("未知信息")])]),t("Col",{attrs:{span:"4"}},[t("p",[t("b",[e._v("数据磁盘：")])])]),e.serverData.data_disk?t("Col",{attrs:{span:"8"}},[t("p",[e._v(" "+e._s(e.serverData.data_disk))])]):t("Col",{attrs:{span:"8"}},[t("p",[e._v("未知信息")])])],1),t("Row",{staticStyle:{"margin-top":"10px","margin-bottom":"10px"}},[t("Col",{attrs:{span:"4"}},[t("p",[t("b",[e._v("安全组：")])])]),e.serverData.security_group_ids?t("Col",{attrs:{span:"20"}},e._l(e.serverData.security_group_ids,(function(a){return t("span",{staticStyle:{"margin-right":"6px"}},[e._v(" "+e._s(a)+" ")])})),0):t("Col",{attrs:{span:"20"}},[t("p",[e._v("没有安全组")])])],1),t("Row",{staticStyle:{"margin-top":"10px","margin-bottom":"10px"}},[t("Col",{attrs:{span:"4"}},[t("p",[t("b",[e._v("系统名称：")])])]),e.serverData.os_name?t("Col",{attrs:{span:"8"}},[t("p",[e._v(" "+e._s(e.serverData.os_name))])]):t("Col",{attrs:{span:"8"}},[t("p",[e._v("未知信息")])]),t("Col",{attrs:{span:"4"}},[t("p",[t("b",[e._v("CloudWatch：")])])]),e.serverData.cloudwatch_state?t("Col",{attrs:{span:"8"}},[t("p",[e._v(" "+e._s(e.serverData.cloudwatch_state)+" ")])]):t("Col",{attrs:{span:"8"}},[t("p",[e._v("未知信息")])])],1),t("Row",{staticStyle:{"margin-top":"10px","margin-bottom":"10px"}},[t("Col",{attrs:{span:"4"}},[t("p",[t("b",[e._v("是否过期：")])])]),!0===e.serverData.is_expired?t("Col",{attrs:{span:"8"}},[t("p",[t("tag",{attrs:{color:"red"}},[e._v(e._s(e.serverData.is_expired))])],1)]):t("Col",{attrs:{span:"8"}},[t("p",[e._v("正常")])]),t("Col",{attrs:{span:"4"}},[t("p",[t("b",[e._v("备注信息：")])])]),e.serverData.detail?t("Col",{attrs:{span:"8"}},[t("p",[e._v(" "+e._s(e.serverData.detail)+" ")])]):t("Col",{attrs:{span:"8"}},[t("p",[e._v("无")])])],1),t("Row",{staticStyle:{"margin-top":"10px","margin-bottom":"10px"}},[t("Col",{attrs:{span:"4"}},[t("p",[t("b",[e._v("创建时间：")])])]),e.serverData.instance_create_time?t("Col",{attrs:{span:"8"}},[t("p",[e._v(" "+e._s(e.serverData.instance_create_time)+" ")])]):t("Col",{attrs:{span:"8"}},[t("p",[e._v("未知信息")])]),t("Col",{attrs:{span:"4"}},[t("p",[t("b",[e._v("过期时间：")])])]),e.serverData.instance_expired_time?t("Col",{attrs:{span:"8"}},[t("p",[e._v(" "+e._s(e.serverData.instance_expired_time))])]):t("Col",{attrs:{span:"8"}},[t("p",[e._v("未知信息")])])],1),t("Row",[t("Col",{attrs:{span:"4"}},[t("p",[t("b",[e._v("最后更新时间：")])])]),t("Col",{attrs:{span:"20"}},[t("p",[e._v(" "+e._s(e.serverData.update_time)+" ")])])],1)],1)],1)])],1)},s=[],i={name:"serverDetail",props:{modalData:{type:Object,default:()=>{}},serverData:{type:Object,default:()=>{}}}},l=i,n=a("2877"),o=Object(n["a"])(l,r,s,!1,null,null,null);t["default"]=o.exports}}]);
//# sourceMappingURL=chunk-27a74ccb.8e45b90a.js.map