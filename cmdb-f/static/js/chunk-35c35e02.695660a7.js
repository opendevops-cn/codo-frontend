(window["webpackJsonp_cmdb"]=window["webpackJsonp_cmdb"]||[]).push([["chunk-35c35e02","chunk-0f6d2c94","chunk-6e4db0c8","chunk-2d208deb","chunk-2d0d5c4c"],{"13d5":function(e,t,a){"use strict";var s=a("23e7"),o=a("d58f").left,n=a("a640"),l=a("2d00"),i=a("605d"),r=!i&&l>79&&l<83,c=r||!n("reduce");s({target:"Array",proto:!0,forced:c},{reduce:function(e){var t=arguments.length;return o(this,e,t,t>1?arguments[1]:void 0)}})},3261:function(e,t,a){"use strict";a.r(t),a.d(t,"getFeFormInfo",(function(){return s})),a.d(t,"getUniqueStr",(function(){return o})),a.d(t,"getParams",(function(){return n}));a("13d5");const s=(e,t)=>{var a;return{...e,renderTags:Object.entries(e.tags).reduce((e,t)=>{const[a,s]=t;return e+=`${a} | ${s};`,e},""),resTypeRender:null===(a=t.resTypeOptions.find(t=>t.value===e.res_type))||void 0===a?void 0:a.label,cloundAccountRender:`${e.account_id} | ${e.vendor}`,tagsValues:Object.entries(e.tags).map(e=>(t.handleSelectTag({value:e[0]}),{key:e[0],value:e[1]}))}},o=e=>`^${Number(Math.random().toString().substring(2,e)+Date.now()).toString(36)}$`,n=(e,t)=>{const{name:a,account_id:s,vendor:o,cloud_region_id:n,res_type:l,region:i,zone:r,tagsValues:c,content:d,description:u,vpc_id:_,vpc_name:m,subnet_id:p,subnet_name:h}=e;return{name:a,account_id:s,vendor:o,cloud_region_id:n,vpc_id:_,vpc_name:m,subnet_id:p,subnet_name:h,res_type:l,region:i,zone:r,tags:c.reduce((e,t)=>(e[t.key]=t.value,e),{}),content:d,description:u}}},"3c7f":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"orders__header"},[t("Input",{staticClass:"orders__header__input",attrs:{placeholder:"请输入搜索内容"},model:{value:e.searchParams.searchVal,callback:function(t){e.$set(e.searchParams,"searchVal",t)},expression:"searchParams.searchVal"}}),t("Button",{staticClass:"orders__header__button",on:{click:e.getTableData}},[e._v("搜索")])],1),t("Table",{ref:"selection",attrs:{stripe:"",size:"small",columns:e.columns,data:e.tableData}}),t("div",{staticStyle:{display:"flex","justify-content":"flex-end","margin-top":"10px",overflow:"hidden"}},[t("Page",{attrs:{total:e.pageTotal,current:e.searchParams.page_number,"page-size":e.searchParams.page_size,"page-size-opts":[12,35,50,100],"show-sizer":"","show-total":""},on:{"on-change":e.changePage,"on-page-size-change":e.handlePageSize}})],1),t("Modal",{attrs:{title:"删除采购记录",width:520,loading:e.deleteModalLoading},on:{"on-ok":e.deleteModalOk,"on-cancel":e.deleteModalCancel},model:{value:e.showDeleteModal,callback:function(t){e.showDeleteModal=t},expression:"showDeleteModal"}},[t("div",[e._v(" 确认删除采购记录吗？ ")])]),t("AddTemplateModal",{attrs:{show:e.showModal,buyRow:e.buyRow},on:{closeAddModal:e.closeAddModal,addSuccessCallback:e.addSuccessCallback}})],1)},o=[],n=(a("d9e2"),a("30b3")),l=a("5e65");const i=e=>{switch(e){case"0":return"#FF9900";case"1":return"#19BE6B";default:return"#ED4014"}},r=5e3;var c={components:{AddTemplateModal:l["default"]},data(){return{buyRow:null,showModal:!1,timer:null,curRow:{},showDeleteModal:!1,deleteModalLoading:!0,pageTotal:0,tableLoading:!1,columns:[{title:"ID",key:"id",width:100},{title:"任务ID",key:"flow_id",width:120,render:(e,t)=>e("div",[e("div",{style:{color:"#2d8cf0",cursor:"pointer"},on:{click:()=>{window.open("https://flow.huanle.com/#/orderCenter/order-list?order_id="+t.row.flow_id)}}},t.row.flow_id)])},{title:"名称",key:"instance_name",width:220},{title:"模板",key:"name",minWidth:200},{title:"资源",key:"res_type_alias",minWidth:120},{title:"厂商",key:"vendor_alias",width:160},{title:"状态",key:"status_alias",width:160,render:(e,t)=>e("div",[e("Tag",{props:{color:i(t.row.status)},style:{}},t.row.status_alias)])},{title:"开始时间",key:"create_time",width:240},{title:"结束时间",key:"update_time",width:240},{title:"操作",render:(e,t)=>e("div",[e("Button",{props:{type:"text",size:"small"},style:{color:"#2d8cf0"},on:{click:()=>{this.buyRow=t.row.data,this.showModal=!0}}},"复购")]),width:120}],tableData:[],searchParams:{page_number:1,page_size:12,order_by:"id",order:"descend",searchVal:""}}},mounted(){this.getTableData()},beforeDestroy(){clearTimeout(this.timer)},methods:{addSuccessCallback(){this.showModal=!1,this.getTableData()},closeAddModal(){this.showModal=!1},async deleteModalOk(){try{const{id:e}=this.curRow,t=await Object(n["deleteOrderInfo"])({id_list:[e]});if(!t)throw new Error("请求错误，请重试");this.showDeleteModal=!1,this.$Message.success(t.msg),this.getTableData()}catch(e){this.$Message.error(e.message),this.deleteModalLoading=!1}finally{this.$nextTick(()=>{this.deleteModalLoading=!0})}},deleteModalCancel(){this.showDeleteModal=!1},async getTableData(){try{this.tableLoading=!0;const{data:e,count:t}=await Object(n["getOrderInfoList"])(this.searchParams);this.pageTotal=t,this.tableData=e}catch(e){this.$Message.error(e.message)}finally{this.tableLoading=!1,clearTimeout(this.timer),this.timer=setTimeout(()=>{this.getTableData()},r)}},handlePageSize(e){this.searchParams.page_size=e,this.getTableData()},changePage(e){this.searchParams.page_number=e,this.getTableData()}}},d=c,u=(a("dbf5"),a("2877")),_=Object(u["a"])(d,s,o,!1,null,"bbea0208",null);t["default"]=_.exports},"5e65":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("Modal",{attrs:{title:e.title,loading:e.modalLoading,width:70},on:{"on-ok":e.ok,"on-cancel":e.cancel},model:{value:e.showModal,callback:function(t){e.showModal=t},expression:"showModal"}},[t("div",{staticClass:"modal__content"},[t("Form",{ref:"form",attrs:{model:e.formValues,"label-width":100,rules:e.formRules}},[t("div",{staticClass:"modal__content__section"},[t("div",{staticClass:"modal__content__section__title"},[e._v("基础配置")]),t("div",{staticClass:"modal__content__section__form"},[t("div",{staticClass:"modal__content__section__form__custom"},[t("FormItem",{attrs:{prop:"name",label:"模板名称"}},[t("Input",{attrs:{type:"text",placeholder:"请输入模板名称"},model:{value:e.formValues.name,callback:function(t){e.$set(e.formValues,"name",t)},expression:"formValues.name"}})],1)],1),t("div",{staticClass:"modal__content__section__form__select"},[t("FormItem",{attrs:{prop:"res_type",label:"模板类型"}},[t("Select",{attrs:{type:"text",placeholder:"请选择模板类型"},model:{value:e.formValues.res_type,callback:function(t){e.$set(e.formValues,"res_type",t)},expression:"formValues.res_type"}},e._l(e.resTypeOptions,(function(a){return t("Option",{key:a.value,attrs:{value:a.value}},[e._v(e._s(a.label))])})),1)],1)],1),t("div",{staticClass:"modal__content__section__form__longer"},[t("FormItem",{attrs:{prop:"subnet_id",label:"私有子网"}},[t("Select",{attrs:{filterable:"",placeholder:"请选择私有子网"},on:{"on-change":e.handleInstanceChange},model:{value:e.formValues.subnet_id,callback:function(t){e.$set(e.formValues,"subnet_id",t)},expression:"formValues.subnet_id"}},e._l(e.vswitchOptions,(function(a){return t("Option",{key:a.id,attrs:{value:a.instance_id}},[e._v(e._s(a.label))])})),1)],1)],1),t("div",{staticClass:"modal__content__section__form__longer"},[t("FormItem",{attrs:{prop:"vpc_name",label:"私有网络"}},[t("Input",{attrs:{type:"text",disabled:""},model:{value:e.formValues.vpc_name,callback:function(t){e.$set(e.formValues,"vpc_name",t)},expression:"formValues.vpc_name"}})],1)],1),t("div",{staticClass:"modal__content__section__form__select"},[t("FormItem",{attrs:{prop:"cloud_region_id",label:"云区域"}},[t("Input",{attrs:{type:"text",placeholder:""},model:{value:e.formValues.cloud_region_id,callback:function(t){e.$set(e.formValues,"cloud_region_id",t)},expression:"formValues.cloud_region_id"}})],1)],1),t("div",{staticClass:"modal__content__section__form__select"},[t("FormItem",{attrs:{prop:"cloundAccountRender",label:"云厂商"}},[t("Input",{attrs:{type:"text",disabled:"",placeholder:""},model:{value:e.formValues.cloundAccountRender,callback:function(t){e.$set(e.formValues,"cloundAccountRender",t)},expression:"formValues.cloundAccountRender"}})],1)],1),t("div",{staticClass:"modal__content__section__form__select"},[t("FormItem",{attrs:{prop:"region",label:"地域"}},[t("Input",{attrs:{type:"text",disabled:"",placeholder:""},model:{value:e.formValues.region,callback:function(t){e.$set(e.formValues,"region",t)},expression:"formValues.region"}})],1)],1),t("div",{staticClass:"modal__content__section__form__select"},[t("FormItem",{attrs:{prop:"zone",label:"可用区"}},[t("Input",{attrs:{type:"text",placeholder:""},model:{value:e.formValues.zone,callback:function(t){e.$set(e.formValues,"zone",t)},expression:"formValues.zone"}})],1)],1)]),t("div",{staticClass:"modal__content__section"},[t("div",{staticClass:"modal__content__section__title"},[e._v("TF配置")]),t("div",{staticClass:"modal__content__section__form__longer"},[t("FormItem",{attrs:{prop:"content"}},[t("codo-editor",{key:""+e._uid,attrs:{lang:e.formValues.script_type,read:e.read},model:{value:e.formValues.content,callback:function(t){e.$set(e.formValues,"content",t)},expression:"formValues.content"}})],1)],1)]),t("div",{staticClass:"modal__content__section"},[t("div",{staticClass:"modal__content__section__title"},[e._v("其他设置")]),t("div",{staticClass:"modal__content__section__form"},[t("div",{staticClass:"modal__content__section__form__tags"},[t("div",{staticClass:"modal__content__section__form__tags__label"},[e._v(" 标签 ")]),t("div",{staticClass:"modal__content__section__form__tags__content"},e._l(e.formValues.tagsValues,(function(a,s){return t("div",{key:s,staticClass:"modal__content__section__form__tags__content__line"},[t("FormItem",{attrs:{prop:"tagsValues."+s+".key",rules:{required:!0,message:"标签键不能为空",trigger:"blur"}}},[t("Select",{attrs:{filterable:""},on:{"on-select":e.handleSelectTag},model:{value:a.key,callback:function(t){e.$set(a,"key",t)},expression:"item.key"}},e._l(e.tagKeyOptions,(function(a){return t("Option",{key:a.value,attrs:{value:a.value}},[e._v(e._s(a.label))])})),1)],1),t("FormItem",{attrs:{prop:"tagsValues."+s+".value",rules:{required:!0,message:"标签值不能为空",trigger:"blur"}}},[t("Select",{attrs:{filterable:"",loading:void 0===e.tagValueOptions[a.key],disabled:""===a.key,placeholder:""===a.key?"请先选择标签键":"请选择"},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"item.value"}},e._l(e.tagValueOptions[a.key],(function(a){return t("Option",{key:a.value,attrs:{value:a.value}},[e._v(e._s(a.label))])})),1)],1),s===e.formValues.tagsValues.length-1?t("Icon",{attrs:{size:"20",type:"md-add"},on:{click:e.handleAddTag}}):e._e(),e.formValues.tagsValues.length>1?t("Icon",{attrs:{size:"20",type:"md-close"},on:{click:function(t){return e.handleRemoveTag(s)}}}):e._e()],1)})),0)]),t("div",{staticClass:"modal__content__section__form__longer"},[t("FormItem",{attrs:{prop:"description",label:"备注"}},[t("Input",{attrs:{type:"textarea",placeholder:"请输入备注"},model:{value:e.formValues.description,callback:function(t){e.$set(e.formValues,"description",t)},expression:"formValues.description"}})],1)],1)])])])]),e.buy?t("div",{staticClass:"modal__content__buy"},[t("Form",{ref:"buyForm",attrs:{model:e.buyValues,"label-width":100,rules:e.buyFormRules}},[t("FormItem",{attrs:{prop:"name"}},[t("span",{attrs:{slot:"label"},slot:"label"},[t("span",[e._v("资源名称")]),t("Tooltip",{attrs:{placement:"top-start"}},[t("div",{attrs:{slot:"content"},slot:"content"},[t("div",[e._v(" 示例：业务-厂商-地域-环境-服务+编号(ops-tx-sh-test-etcd01) ")]),t("div",[e._v("全部为英文或者数字，-为分隔符 是关键字不能被占用")])]),t("Icon",{staticStyle:{"margin-left":"5px"},attrs:{type:"ios-help-circle-outline"}})],1)],1),t("Input",{attrs:{type:"text"},model:{value:e.buyValues.name,callback:function(t){e.$set(e.buyValues,"name",t)},expression:"buyValues.name"}})],1),t("FormItem",{attrs:{prop:"count",label:"购买数量"}},[t("InputNumber",{attrs:{max:10,min:1},model:{value:e.buyValues.count,callback:function(t){e.$set(e.buyValues,"count",t)},expression:"buyValues.count"}})],1)],1)],1):e._e()],1)])},o=[],n=(a("14d9"),a("d9e2"),a("30b3")),l=a("a743"),i=a("3261"),r=a("d4f7"),c=a("7063");const d={script_type:"python",content:"",cloud_region_id:"",cloud_region_name:"",account_id:"",name:"",res_type:"",vendor:"",region:"",zone:"",tags:{},tagsValues:[{key:"",value:""}]},u={bandwidth_dis_count:100,bandwidth_dis_count_price:0,bandwidth_original_price:0,dis_count:100,dis_count_price:0,original_price:0};var _={components:{codoEditor:r["default"]},name:"AddTemplateModal",props:{show:{type:Boolean,default:!1},buyRow:{type:Object,default:null}},data(){return{lang:"text",read:!1,imageIdOptions:[],imageIdLoading:!1,bindWidthIdOptions:[],bindWidthIdLoading:!1,title:"创建模板",priceLoading:!1,buy:!1,price:u,specialSplit:"",resTypeOptions:c["resTypeOptions"],dataDiskTypeOptions:c["dataDiskTypeOptions"],systemDiskTypeOptions:c["systemDiskTypeOptions"],instanceChargeTypeOptions:c["instanceChargeTypeOptions"],internetChargeTypeOptions:c["internetChargeTypeOptions"],vswitchOptions:[],securityGroupOptions:[],tagKeyOptions:[],tagValueOptions:{},buyValues:{name:"",count:1},formValues:d,formRules:{name:[{required:!0,message:"模板名称必填",trigger:"blur"}],res_type:[{required:!0,message:"模板类型必选",trigger:"blur"}],subnet_id:[{required:!0,message:"私有子网必选",trigger:"blur"}],cloundAccountRender:[{required:!0,message:"云厂商不能为空",trigger:"blur"}],vpc_name:[{required:!0,message:"私有网络不能为空",trigger:"blur"}],region:[{required:!0,message:"地域不能为空",trigger:"blur"}],zone:[{required:!0,message:"可用区不能为空",trigger:"blur"}],tags:[{required:!0,message:"标签必填",trigger:"blur"}]},showModal:this.show,modalLoading:!0}},computed:{realShow(){return this.show},insTypeParams(){const{account_id:e,vendor:t,res_type:a,region:s,zone:o,instance_type:n,content:l}=this.formValues;return{account_id:e,vendor:t,res_type:a,region:s,zone:o,instance_type:n,content:l}}},watch:{show(e){e&&this.getSettings(),this.showModal=e},insTypeParams:{async handler(e){const{account_id:t,vendor:a,res_type:s,region:o,zone:n,instance_type:l}=e;t&&a&&s&&o&&n&&l&&this.getInsTypeOptions()},deep:!0}},mounted(){this.specialSplit=Object(i["getUniqueStr"])(3)},methods:{async getSettings(){this.getVswitchData(),this.getTagData()},async getVswitchData(){const{data:e}=await Object(l["getVswitch"])();this.vswitchOptions=e.map(e=>({...e,label:`${e.instance_id} | ${e.name} | ${e.cidr_block_v4}`}))},async getTagData(){const{data:e}=await Object(n["getTagList"])();this.tagKeyOptions=e.map(e=>({label:e,value:e}))},async handleSelectTag(e){const{data:t}=await Object(n["getTagList"])({tag_key:e.value});this.$set(this.tagValueOptions,e.value,t.map(e=>({label:e,value:e})))},handleAddTag(){this.formValues.tagsValues.push({key:"",value:""})},handleRemoveTag(e){this.formValues.tagsValues=this.formValues.tagsValues.filter((t,a)=>a!==e)},handleInstanceChange(e){const t=this.vswitchOptions.find(t=>(null===t||void 0===t?void 0:t.instance_id)===e);t&&(this.formValues={...this.formValues,subnet_name:`${t.instance_id} | ${t.name} | ${t.cidr_block_v4}`,vendor:t.cloud_name,account_id:t.account_id,cloundAccountRender:`${t.account_id} | ${t.cloud_name}`,vpc_id:t.vpc_id.replace(/[\r\n]/g,""),vpc_name:`${t.vpc_id} | ${t.vpc_name}`,cloud_region_id:t.cloud_region_id||"",cloudRender:""+t.cloud_region_id,region:t.region,zone:t.zone})},async ok(){this.modalLoading=!1;try{await new Promise((e,t)=>{this.$refs.form.validate(e=>{e||t(new Error("表单校验失败，请检查"))}),this.buy&&this.$refs.buyForm.validate(e=>{e||t(new Error("表单校验失败，请检查"))}),e()});const e=Object(i["getParams"])(this.formValues,this),t=await(this.buy?Object(n["createOrder"])({instance_name:this.buyValues.name,count:this.buyValues.count,image_passwd:"",...e}):Object(n["createOrderTemplate"])({...e}));if(!t)throw new Error("请求错误，请重试");this.$emit("addSuccessCallback"),this.showModal=!1,this.$Message.success(t.msg)}catch(e){this.$Message.error(e.message),this.modalLoading=!1}finally{this.$nextTick(()=>{this.modalLoading=!0})}},cancel(){this.$emit("closeAddModal")}}},m=_,p=(a("765a"),a("2877")),h=Object(p["a"])(m,s,o,!1,null,"3ebe8931",null);t["default"]=h.exports},"605d":function(e,t,a){(function(t){var s=a("c6b6");e.exports="undefined"!=typeof t&&"process"==s(t)}).call(this,a("4362"))},"61c6":function(e,t,a){},7063:function(e,t,a){"use strict";a.r(t),a.d(t,"resTypeOptions",(function(){return n})),a.d(t,"dataDiskTypeOptions",(function(){return s})),a.d(t,"systemDiskTypeOptions",(function(){return o})),a.d(t,"instanceChargeTypeOptions",(function(){return l})),a.d(t,"internetChargeTypeOptions",(function(){return i}));const s=[{label:"高性能云硬盘",value:"CLOUD_PREMIUM"},{label:"通用型SSD云硬盘",value:"CLOUD_BSSD"},{label:"SSD云硬盘",value:"CLOUD_SSD"},{label:"增强型SSD云硬盘",value:"CLOUD_HSSD"}],o=[{label:"高性能云硬盘",value:"CLOUD_PREMIUM"},{label:"通用型SSD云硬盘",value:"CLOUD_BSSD"},{label:"SSD云硬盘",value:"CLOUD_SSD"},{label:"增强型SSD云硬盘",value:"CLOUD_HSSD"}],n=[{label:"服务器",value:"server"},{label:"LB",value:"LB"}],l=[{label:"包年包月",value:"PREPAID"},{label:"按量计费",value:"POSTPAID_BY_HOUR"}],i=[{label:"带宽包用户",value:"BANDWIDTH_PACKAGE"},{label:"按带宽包年包月计费",value:"BANDWIDTH_PREPAID"},{label:"流量按小时后付费",value:"TRAFFIC_POSTPAID_BY_HOUR"}]},"765a":function(e,t,a){"use strict";a("d0e4")},a640:function(e,t,a){"use strict";var s=a("d039");e.exports=function(e,t){var a=[][e];return!!a&&s((function(){a.call(null,t||function(){return 1},1)}))}},a743:function(e,t,a){"use strict";a.r(t),a.d(t,"getVswitch",(function(){return o})),a.d(t,"optVswitch",(function(){return n}));var s=a("be3b");const o=e=>Object(s["default"])({url:"/api/v2/cmdb/vswitch/",method:"get",params:e}),n=(e,t)=>Object(s["default"])({url:"/api/v2/cmdb/vswitch/",method:t,data:e})},d0e4:function(e,t,a){},d58f:function(e,t,a){var s=a("59ed"),o=a("7b0b"),n=a("44ad"),l=a("07fa"),i=TypeError,r=function(e){return function(t,a,r,c){s(a);var d=o(t),u=n(d),_=l(d),m=e?_-1:0,p=e?-1:1;if(r<2)while(1){if(m in u){c=u[m],m+=p;break}if(m+=p,e?m<0:_<=m)throw i("Reduce of empty array with no initial value")}for(;e?m>=0:_>m;m+=p)m in u&&(c=a(c,u[m],m,d));return c}};e.exports={left:r(!1),right:r(!0)}},dbf5:function(e,t,a){"use strict";a("61c6")}}]);
//# sourceMappingURL=chunk-35c35e02.695660a7.js.map