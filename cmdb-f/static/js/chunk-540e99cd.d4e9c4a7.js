(window["webpackJsonp_cmdb"]=window["webpackJsonp_cmdb"]||[]).push([["chunk-540e99cd","chunk-2d0c17f4"],{"45fc":function(t,e,a){"use strict";a.r(e),a.d(e,"getVPC",(function(){return r})),a.d(e,"optVPC",(function(){return s}));var o=a("be3b");const r=t=>Object(o["default"])({url:"/api/v2/cmdb/vpc/",method:"get",params:t}),s=(t,e)=>Object(o["default"])({url:"/api/v2/cmdb/vpc/",method:e,data:t})},"6b44":function(t,e,a){"use strict";a("cbff")},8219:function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t._self._c;return e("Card",{attrs:{bordered:!1,"dis-hover":""}},[e("Form",{ref:"formValidate",attrs:{model:t.formValidate,rules:t.ruleValidate,"label-colon":!0,"label-position":"right","label-width":200}},[e("Row",[e("Col",{attrs:{span:"12",offset:"4"}},[e("Divider",[t._v("基础配置")]),t.formData.id?e("FormItem",{attrs:{label:"云区域名称",prop:"name"}},[e("Input",{attrs:{maxlength:"50",type:"text",disabled:"",placeholder:"请输入规则名称..."},model:{value:t.formValidate.name,callback:function(e){t.$set(t.formValidate,"name",e)},expression:"formValidate.name"}})],1):e("FormItem",{attrs:{label:"云区域名称",prop:"name"}},[e("Input",{attrs:{maxlength:"50",type:"text",placeholder:"请输入规则名称..."},model:{value:t.formValidate.name,callback:function(e){t.$set(t.formValidate,"name",e)},expression:"formValidate.name"}})],1),e("FormItem",{attrs:{label:"云区域ID",prop:"cloud_region_id"}},[e("Input",{attrs:{maxlength:"10",type:"text",placeholder:"云区域ID、代理ID..."},model:{value:t.formValidate.cloud_region_id,callback:function(e){t.$set(t.formValidate,"cloud_region_id",e)},expression:"formValidate.cloud_region_id"}})],1),e("FormItem",{attrs:{label:"代理地址",prop:"proxy_ip"}},[e("Input",{attrs:{maxlength:"100",type:"text",placeholder:"连接代理节点IP地址或域名地址，一般为内网LB或者内网域名"},model:{value:t.formValidate.proxy_ip,callback:function(e){t.$set(t.formValidate,"proxy_ip",e)},expression:"formValidate.proxy_ip"}})],1),e("FormItem",{attrs:{label:"SSH",prop:"ssh_user"}},[e("Row",{attrs:{gutter:6}},[e("Col",{attrs:{span:"8"}},[e("Input",{attrs:{maxlength:"25",type:"text",placeholder:"用户名..."},model:{value:t.formValidate.ssh_user,callback:function(e){t.$set(t.formValidate,"ssh_user",e)},expression:"formValidate.ssh_user"}},[e("span",{attrs:{slot:"prepend"},slot:"prepend"},[t._v("ssh")])])],1),e("Col",{attrs:{span:"8"}},[e("Input",{attrs:{maxlength:"100",type:"text",placeholder:"主机/ip..."},model:{value:t.formValidate.ssh_ip,callback:function(e){t.$set(t.formValidate,"ssh_ip",e)},expression:"formValidate.ssh_ip"}},[e("span",{attrs:{slot:"prepend"},slot:"prepend"},[t._v("@")])])],1),e("Col",{attrs:{span:"8"}},[e("Input",{attrs:{maxlength:"10",type:"text",placeholder:"端口..."},model:{value:t.formValidate.ssh_port,callback:function(e){t.$set(t.formValidate,"ssh_port",e)},expression:"formValidate.ssh_port"}},[e("span",{attrs:{slot:"prepend"},slot:"prepend"},[t._v("-p")])])],1)],1)],1),t._l(t.formValidate.asset_group_rules,(function(a,o){return[t.formValidate.asset_group_rules&&0!==t.formValidate.asset_group_rules.length?e("FormItem",{attrs:{label:"关联主机"}},[0===o?e("Alert",{staticStyle:{width:"100%","margin-bottom":"8px"},attrs:{"show-icon":""}},[t._v(" 通过关联vpc把一组vpc下的主机资产划分到云区域，vpc之间的的条件关系为或。 ")]):t._e(),e("Row",{attrs:{gutter:20}},[e("Col",[a.length>0?e("Card",{staticStyle:{"margin-bottom":"0px"},attrs:{"dis-hover":""}},t._l(a,(function(r,s){return r.status?e("FormItem",{key:s+t._uid},[e("div",{staticClass:"alert-con",staticStyle:{"margin-bottom":"10px"}},[e("span",{staticStyle:{"margin-right":"5px","min-width":"30px",display:"inline-block"}},[t._v(" "+t._s(s+1)+" - ")]),e("Cascader",{staticStyle:{width:"700px","margin-left":"10px"},attrs:{data:t.vpcOptions},model:{value:r.query_value,callback:function(e){t.$set(r,"query_value",e)},expression:"item.query_value"}}),e("Button",{staticClass:"rule-btn-add",attrs:{shape:"circle",type:"text",icon:"md-add"},on:{click:function(e){return t.handleAddRules(o)}}}),1!==a.length?e("Button",{staticClass:"rule-btn-del",attrs:{shape:"circle",type:"text",icon:"md-close"},on:{click:function(e){return t.handleRemoveRules(o,s)}}}):t._e()],1)]):t._e()})),1):t._e(),t.formValidate.asset_group_rules.length>1&&2!=o?e("p",{staticStyle:{"padding-top":"15px"}},[t._v("或")]):t._e()],1),e("Col",{attrs:{span:"2"}},[1!==t.formValidate.asset_group_rules.length?e("a",{on:{click:function(e){return e.preventDefault(),t.handleRemoveCard(o)}}},[t._v(" 删除")]):t._e()])],1)],1):t._e()]})),e("Divider",{attrs:{dashed:""}},[t._v("堡垒机配置")]),e("FormItem",{attrs:{prop:"jms_org_id"},scopedSlots:t._u([{key:"label",fn:function(){return[t._v(" 组织ID "),e("Tooltip",{attrs:{placement:"top-start","max-width":"400"},scopedSlots:t._u([{key:"content",fn:function(){return[e("p",[t._v("关联堡垒机组织，社区版不支持组织管理，只有默认Default组织，企业版支持多组织管理")]),e("p",[t._v("堡垒机查看组织ID方法：堡垒机资产管理--\x3e网域列表--\x3e点击网域查看ID")])]},proxy:!0}])},[e("Icon",{attrs:{type:"ios-help-circle-outline"}}),t._v(" : ")],1)]},proxy:!0}])},[e("Input",{attrs:{maxlength:"100",type:"text",placeholder:"堡垒机组织ID..."},model:{value:t.formValidate.jms_org_id,callback:function(e){t.$set(t.formValidate,"jms_org_id",e)},expression:"formValidate.jms_org_id"}})],1),e("FormItem",{attrs:{prop:"jms_domain_id"},scopedSlots:t._u([{key:"label",fn:function(){return[t._v(" 网域ID "),e("Tooltip",{attrs:{placement:"top-start","max-width":"400"},scopedSlots:t._u([{key:"content",fn:function(){return[e("p",[t._v("关联堡垒机网域，指定云区域下的主机属于哪个网域，理论上一个区域的主机归属于同一个网域")]),e("p",[t._v("堡垒机查看网域ID方法：堡垒机资产管理--\x3e网域列表--\x3e点击网域查看ID")])]},proxy:!0}])},[e("Icon",{attrs:{type:"ios-help-circle-outline"}}),t._v(" : ")],1)]},proxy:!0}])},[e("Input",{attrs:{maxlength:"100",type:"text",placeholder:"堡垒机网域ID..."},model:{value:t.formValidate.jms_domain_id,callback:function(e){t.$set(t.formValidate,"jms_domain_id",e)},expression:"formValidate.jms_domain_id"}})],1),e("FormItem",{attrs:{label:"",prop:"jms_account_template"},scopedSlots:t._u([{key:"label",fn:function(){return[t._v(" 特权账号模版ID "),e("Tooltip",{attrs:{placement:"top-start","max-width":"400"},scopedSlots:t._u([{key:"content",fn:function(){return[e("p",[t._v("关联堡垒机特权账户模板，创建主机时需指定特权账号，用户推送创建非特权账号到服务器")]),e("p",[t._v("堡垒机特权账号模版ID方法：堡垒机账号管理--\x3e账号模板--\x3e点击特权账号查看ID")])]},proxy:!0}])},[e("Icon",{attrs:{type:"ios-help-circle-outline"}}),t._v(" : ")],1)]},proxy:!0}])},[e("Input",{attrs:{maxlength:"100",type:"text",placeholder:"堡垒机特权账户模板ID..."},model:{value:t.formValidate.jms_account_template,callback:function(e){t.$set(t.formValidate,"jms_account_template",e)},expression:"formValidate.jms_account_template"}})],1)],2),e("Col",{attrs:{span:"12",offset:"4"}},[t._l(t.formValidate.accounts,(function(a,o){return[a.status?e("FormItem",{key:o,attrs:{label:"账户模板ID "+(o+1),prop:"accounts."+o+".value"},scopedSlots:t._u([{key:"label",fn:function(){return[t._v(" 账户模板ID "),e("Tooltip",{attrs:{placement:"top-start","max-width":"400"},scopedSlots:t._u([{key:"content",fn:function(){return[e("p",[t._v("关联堡垒机特权账户模板，需指定普通账号模板ID和特权账户模板ID，分别用于创建普通用户和特权账户, 如模板不存在则需在堡垒机创建并录入")]),e("p",[t._v("查看堡垒机账号模版ID方法：堡垒机账号管理--\x3e账号模板--\x3e点击特权查看ID")])]},proxy:!0}],null,!0)},[e("Icon",{attrs:{type:"ios-help-circle-outline"}}),t._v(" : ")],1)]},proxy:!0}],null,!0)},[e("Row",[e("Select",{staticStyle:{"margin-right":"1px","margin-left":"1px","max-width":"100px"},attrs:{placeholder:"选择账户类型"},model:{value:a.account_type,callback:function(e){t.$set(a,"account_type",e)},expression:"item.account_type"}},[e("Option",{attrs:{value:"dev"}},[t._v("普通账户")]),e("Option",{attrs:{value:"ops"}},[t._v("特权账户")])],1),e("Input",{staticStyle:{"max-width":"500px"},attrs:{placeholder:"请输入待创建账号模板ID"},model:{value:a.jms_account_template_id,callback:function(e){t.$set(a,"jms_account_template_id",e)},expression:"item.jms_account_template_id"}}),e("Icon",{staticStyle:{"margin-top":"8px","margin-left":"4px"},attrs:{type:"ios-backspace"},on:{click:function(e){return t.handleRemove(o)}}})],1)],1):t._e()]})),e("FormItem",[e("Row",[e("Col",{attrs:{span:"12"}},[e("Tooltip",{attrs:{trigger:"hover",placement:"top-start",content:"只允许添加两个不同类型的账户"}},[e("Button",{attrs:{type:"dashed",long:"",icon:"md-add"},on:{click:function(e){return t.handleAdd(t.account_type)}}},[t._v("添加账户")])],1)],1)],1)],1)],2),e("Col",{attrs:{span:"12",offset:"4"}},[e("FormItem",{attrs:{label:"网域密钥"}},[e("Input",{attrs:{type:"textarea",maxlength:"65500",autosize:{minRows:6,maxRows:15},placeholder:"当前云区域网域私钥..."},model:{value:t.formValidate.ssh_key,callback:function(e){t.$set(t.formValidate,"ssh_key",e)},expression:"formValidate.ssh_key"}})],1)],1),e("Col",{attrs:{span:"12",offset:"4"}},[e("FormItem",{attrs:{label:"网域公钥"}},[e("Input",{attrs:{type:"textarea",maxlength:"65500",autosize:{minRows:3,maxRows:15},placeholder:"当前云区域网域公钥..."},model:{value:t.formValidate.ssh_pub_key,callback:function(e){t.$set(t.formValidate,"ssh_pub_key",e)},expression:"formValidate.ssh_pub_key"}})],1)],1),e("Col",{attrs:{span:"12",offset:"4"}},[e("FormItem",{attrs:{label:"备注信息"}},[e("Input",{attrs:{type:"textarea",maxlength:"65500",autosize:{minRows:2,maxRows:5},placeholder:"备注信息..."},model:{value:t.formValidate.detail,callback:function(e){t.$set(t.formValidate,"detail",e)},expression:"formValidate.detail"}})],1)],1),e("Col",{attrs:{span:"12",offset:"4"}},[e("FormItem",[e("Button",{attrs:{type:"primary",loading:t.btnLoading},on:{click:function(e){return t.handleSubmit("formValidate")}}},[t._v("确定")]),e("Button",{staticStyle:{"margin-left":"15px"},on:{click:t.handleCancel}},[t._v("返回")])],1)],1)],1)],1)],1)},r=[],s=(a("14d9"),a("30b3")),i=a("45fc"),l={components:{},name:"cloudRegionEdit",props:{formData:{type:Object,default:{}}},data(){return{btnLoading:!1,cloudList:[],index:1,vpcList:[],vpcOptions:[],vendorMap:{},account_type:"dev",ruleValidate:{name:[{required:!0,message:"名称不能为空",trigger:"blur"}],cloud_region_id:[{required:!0,message:"不能为空",trigger:"blur"}],ssh_user:[{required:!0,message:"不能为空",trigger:"blur"}],proxy_ip:[{required:!0,message:"不能为空",trigger:"blur"}],detail:[{type:"string",max:300,message:"备注也不能太长吧",trigger:"blur"}],asset_group_rules:[{type:"array",max:10,message:"不能为空",trigger:"blur",required:!0}],jms_domain_id:[{message:"不能为空",trigger:"blur",required:!0,max:100}],jms_account_template:[{message:"不能为空",trigger:"blur",required:!0,max:100}],jms_org_id:[{required:!0,message:"组织ID为空",trigger:"blur",max:100}]}}},filters:{testF(t,e){return 1===e?"资产 B":2===e?"资产 C":0===e?"资产 A":void 0}},methods:{handleAdd(){if(this.index++,this.index>2)return this.$Notice.warning({title:"条件超出最大限制"}),void this.index--;this.formValidate.accounts.push({account_type:"dev",jms_account_template_id:"",index:this.index,status:1})},handleRemove(t){this.index--,this.formValidate.accounts.splice(t,1)},transformData(t){return t.forEach(t=>{t.cloud_zh_name&&(this.vendorMap[t.cloud_zh_name]||(this.vendorMap[t.cloud_zh_name]={}),this.vendorMap[t.cloud_zh_name][t.region]||(this.vendorMap[t.cloud_zh_name][t.region]=[]),this.vendorMap[t.cloud_zh_name][t.region].push({label:t.vpc_name,value:t.instance_id}))}),Object.keys(this.vendorMap).map(t=>({label:t,value:t,children:Object.keys(this.vendorMap[t]).map(e=>({label:e,value:e,children:this.vendorMap[t][e]}))}))},async getCloudSettingList(){const t=await Object(s["getCloudSettinglist"])();0===t.code?this.cloudList=t.data:this.$message.error(""+t.msg)},getVpcCloudName(t){const e=this.cloudList.find(e=>e.account_id===t);return e?e.name:""},getVpcRegion(t){const e=this.vpcList.find(e=>e.vpc_name===t);return e?e.region:""},async getVpcList(){const t={page_number:1,page_size:300},e=await Object(i["getVPC"])(t);if(0===e.code){this.vpcList=e.data;for(const t of this.vpcList)t.cidr_block_v4&&(t.vpc_name=t.vpc_name+"("+t.cidr_block_v4+")"),t.cloud_zh_name=this.getVpcCloudName(t.account_id);this.vpcOptions=this.transformData(this.vpcList)}else this.$message.error(""+e.msg)},handleAddRules(t){this.index++,this.formValidate.asset_group_rules[t].length>14?this.$Notice.warning({title:"限制提示",desc:"添加指标的个数不能超过十五个",duration:10}):this.formValidate.asset_group_rules[t].push({index:this.index,query_name:"vpc",query_conditions:"=",query_value:[],status:1})},handleRemoveRules(t,e){this.formValidate.asset_group_rules[t].splice(e,1)},handleRemoveCard(t){this.formValidate.asset_group_rules.splice(t,1)},handleCancel(){JSON.stringify(this.formValidate)!=JSON.stringify(this.formData)?this.$Modal.confirm({content:"<p>编辑还没有保存，确定要离开？</p>",onOk:()=>{this.$emit("edit-close")},onCancel:()=>{this.$Message.info("回头是岸")}}):this.$emit("edit-close")},handleSubmit(t){this.$refs[t].validate(t=>{if(t){const t=new Set;let e=!1;if(this.formValidate.accounts)for(const a of this.formValidate.accounts){if(1===a.status&&(""===a.jms_account_template_id||!a.jms_account_template_id))return void this.$Notice.warning({title:"账号模板ID存在空值！"});if(t.has(a.account_type)){e=!0;break}t.add(a.account_type)}if(e)return void this.$Notice.warning({title:"账号类型重复，请检查！"});if(this.formValidate.asset_group_rules)for(const a of this.formValidate.asset_group_rules)for(const t of a){if(1===t.status&&Array.isArray(t.query_value)&&t.query_value.length<2)return void this.$Notice.warning({title:"查询条件存在空值！"});if(!t.query_value[t.query_value.length-1])return void this.$Notice.warning({title:"VPC存在空值！"})}this.btnLoading=!0,this.formValidate.name=this.formValidate.name.trim(),setTimeout(()=>{this.$emit("save-data",this.formValidate),this.btnLoading=!1},1e3)}else this.$Message.error("表单校验不通过!")})}},watch:{formValidate(t){}},computed:{formValidate:function(){return this.formData}},mounted(){this.getCloudSettingList(),this.getVpcList()}},n=l,c=(a("6b44"),a("2877")),d=Object(c["a"])(n,o,r,!1,null,"7f901a44",null);e["default"]=d.exports},cbff:function(t,e,a){}}]);
//# sourceMappingURL=chunk-540e99cd.d4e9c4a7.js.map