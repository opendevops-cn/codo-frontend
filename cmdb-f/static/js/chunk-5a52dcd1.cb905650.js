(window["webpackJsonp_cmdb"]=window["webpackJsonp_cmdb"]||[]).push([["chunk-5a52dcd1"],{"3c6f":function(e,t,a){},"5e65":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("Modal",{attrs:{title:e.title,loading:e.modalLoading,width:70},on:{"on-ok":e.ok,"on-cancel":e.cancel},model:{value:e.showModal,callback:function(t){e.showModal=t},expression:"showModal"}},[t("div",{staticClass:"modal__content"},[t("Form",{ref:"form",attrs:{model:e.formValues,"label-width":100,rules:e.formRules}},[t("div",{staticClass:"modal__content__section"},[t("div",{staticClass:"modal__content__section__title"},[e._v("基础配置")]),t("div",{staticClass:"modal__content__section__form"},[t("div",{staticClass:"modal__content__section__form__custom"},[t("FormItem",{attrs:{prop:"name",label:"模板名称"}},[t("Input",{attrs:{type:"text",placeholder:"请输入模板名称"},model:{value:e.formValues.name,callback:function(t){e.$set(e.formValues,"name",t)},expression:"formValues.name"}})],1)],1),t("div",{staticClass:"modal__content__section__form__select"},[t("FormItem",{attrs:{prop:"res_type",label:"模板类型"}},[t("Select",{attrs:{type:"text",placeholder:"请选择模板类型"},model:{value:e.formValues.res_type,callback:function(t){e.$set(e.formValues,"res_type",t)},expression:"formValues.res_type"}},e._l(e.resTypeOptions,(function(a){return t("Option",{key:a.value,attrs:{value:a.value}},[e._v(e._s(a.label))])})),1)],1)],1),t("div",{staticClass:"modal__content__section__form__longer"},[t("FormItem",{attrs:{prop:"subnet_id",label:"私有子网"}},[t("Select",{attrs:{filterable:"",placeholder:"请选择私有子网"},on:{"on-change":e.handleInstanceChange},model:{value:e.formValues.subnet_id,callback:function(t){e.$set(e.formValues,"subnet_id",t)},expression:"formValues.subnet_id"}},e._l(e.vswitchOptions,(function(a){return t("Option",{key:a.id,attrs:{value:a.instance_id}},[e._v(e._s(a.label))])})),1)],1)],1),t("div",{staticClass:"modal__content__section__form__longer"},[t("FormItem",{attrs:{prop:"vpc_name",label:"私有网络"}},[t("Input",{attrs:{type:"text",disabled:""},model:{value:e.formValues.vpc_name,callback:function(t){e.$set(e.formValues,"vpc_name",t)},expression:"formValues.vpc_name"}})],1)],1),t("div",{staticClass:"modal__content__section__form__select"},[t("FormItem",{attrs:{prop:"cloud_region_id",label:"云区域"}},[t("Input",{attrs:{type:"text",placeholder:""},model:{value:e.formValues.cloud_region_id,callback:function(t){e.$set(e.formValues,"cloud_region_id",t)},expression:"formValues.cloud_region_id"}})],1)],1),t("div",{staticClass:"modal__content__section__form__select"},[t("FormItem",{attrs:{prop:"cloundAccountRender",label:"云厂商"}},[t("Input",{attrs:{type:"text",disabled:"",placeholder:""},model:{value:e.formValues.cloundAccountRender,callback:function(t){e.$set(e.formValues,"cloundAccountRender",t)},expression:"formValues.cloundAccountRender"}})],1)],1),t("div",{staticClass:"modal__content__section__form__select"},[t("FormItem",{attrs:{prop:"region",label:"地域"}},[t("Input",{attrs:{type:"text",disabled:"",placeholder:""},model:{value:e.formValues.region,callback:function(t){e.$set(e.formValues,"region",t)},expression:"formValues.region"}})],1)],1),t("div",{staticClass:"modal__content__section__form__select"},[t("FormItem",{attrs:{prop:"zone",label:"可用区"}},[t("Input",{attrs:{type:"text",placeholder:""},model:{value:e.formValues.zone,callback:function(t){e.$set(e.formValues,"zone",t)},expression:"formValues.zone"}})],1)],1)]),t("div",{staticClass:"modal__content__section"},[t("div",{staticClass:"modal__content__section__title"},[e._v("TF配置")]),t("div",{staticClass:"modal__content__section__form__longer"},[t("FormItem",{attrs:{prop:"content"}},[t("codo-editor",{key:""+e._uid,attrs:{lang:e.formValues.script_type,read:e.read},model:{value:e.formValues.content,callback:function(t){e.$set(e.formValues,"content",t)},expression:"formValues.content"}})],1)],1)]),t("div",{staticClass:"modal__content__section"},[t("div",{staticClass:"modal__content__section__title"},[e._v("其他设置")]),t("div",{staticClass:"modal__content__section__form"},[t("div",{staticClass:"modal__content__section__form__tags"},[t("div",{staticClass:"modal__content__section__form__tags__label"},[e._v(" 标签 ")]),t("div",{staticClass:"modal__content__section__form__tags__content"},e._l(e.formValues.tagsValues,(function(a,s){return t("div",{key:s,staticClass:"modal__content__section__form__tags__content__line"},[t("FormItem",{attrs:{prop:"tagsValues."+s+".key",rules:{required:!0,message:"标签键不能为空",trigger:"blur"}}},[t("Select",{attrs:{filterable:""},on:{"on-select":e.handleSelectTag},model:{value:a.key,callback:function(t){e.$set(a,"key",t)},expression:"item.key"}},e._l(e.tagKeyOptions,(function(a){return t("Option",{key:a.value,attrs:{value:a.value}},[e._v(e._s(a.label))])})),1)],1),t("FormItem",{attrs:{prop:"tagsValues."+s+".value",rules:{required:!0,message:"标签值不能为空",trigger:"blur"}}},[t("Select",{attrs:{filterable:"",loading:void 0===e.tagValueOptions[a.key],disabled:""===a.key,placeholder:""===a.key?"请先选择标签键":"请选择"},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"item.value"}},e._l(e.tagValueOptions[a.key],(function(a){return t("Option",{key:a.value,attrs:{value:a.value}},[e._v(e._s(a.label))])})),1)],1),s===e.formValues.tagsValues.length-1?t("Icon",{attrs:{size:"20",type:"md-add"},on:{click:e.handleAddTag}}):e._e(),e.formValues.tagsValues.length>1?t("Icon",{attrs:{size:"20",type:"md-close"},on:{click:function(t){return e.handleRemoveTag(s)}}}):e._e()],1)})),0)]),t("div",{staticClass:"modal__content__section__form__longer"},[t("FormItem",{attrs:{prop:"description",label:"备注"}},[t("Input",{attrs:{type:"textarea",placeholder:"请输入备注"},model:{value:e.formValues.description,callback:function(t){e.$set(e.formValues,"description",t)},expression:"formValues.description"}})],1)],1)])])])]),e.buy?t("div",{staticClass:"modal__content__buy"},[t("Form",{ref:"buyForm",attrs:{model:e.buyValues,"label-width":100,rules:e.buyFormRules}},[t("FormItem",{attrs:{prop:"name"}},[t("span",{attrs:{slot:"label"},slot:"label"},[t("span",[e._v("资源名称")]),t("Tooltip",{attrs:{placement:"top-start"}},[t("div",{attrs:{slot:"content"},slot:"content"},[t("div",[e._v(" 示例：业务-厂商-地域-环境-服务+编号(ops-tx-sh-test-etcd01) ")]),t("div",[e._v("全部为英文或者数字，-为分隔符 是关键字不能被占用")])]),t("Icon",{staticStyle:{"margin-left":"5px"},attrs:{type:"ios-help-circle-outline"}})],1)],1),t("Input",{attrs:{type:"text"},model:{value:e.buyValues.name,callback:function(t){e.$set(e.buyValues,"name",t)},expression:"buyValues.name"}})],1),t("FormItem",{attrs:{prop:"count",label:"购买数量"}},[t("InputNumber",{attrs:{max:10,min:1},model:{value:e.buyValues.count,callback:function(t){e.$set(e.buyValues,"count",t)},expression:"buyValues.count"}})],1)],1)],1):e._e()],1)])},o=[],l=(a("14d9"),a("d9e2"),a("30b3")),n=a("a743"),i=a("3261"),r=a("d4f7"),c=a("7063");const d={script_type:"python",content:"",cloud_region_id:"",cloud_region_name:"",account_id:"",name:"",res_type:"",vendor:"",region:"",zone:"",tags:{},tagsValues:[{key:"",value:""}]},u={bandwidth_dis_count:100,bandwidth_dis_count_price:0,bandwidth_original_price:0,dis_count:100,dis_count_price:0,original_price:0};var _={components:{codoEditor:r["default"]},name:"AddTemplateModal",props:{show:{type:Boolean,default:!1},buyRow:{type:Object,default:null}},data(){return{lang:"text",read:!1,imageIdOptions:[],imageIdLoading:!1,bindWidthIdOptions:[],bindWidthIdLoading:!1,title:"创建模板",priceLoading:!1,buy:!1,price:u,specialSplit:"",resTypeOptions:c["resTypeOptions"],dataDiskTypeOptions:c["dataDiskTypeOptions"],systemDiskTypeOptions:c["systemDiskTypeOptions"],instanceChargeTypeOptions:c["instanceChargeTypeOptions"],internetChargeTypeOptions:c["internetChargeTypeOptions"],vswitchOptions:[],securityGroupOptions:[],tagKeyOptions:[],tagValueOptions:{},buyValues:{name:"",count:1},formValues:d,formRules:{name:[{required:!0,message:"模板名称必填",trigger:"blur"}],res_type:[{required:!0,message:"模板类型必选",trigger:"blur"}],subnet_id:[{required:!0,message:"私有子网必选",trigger:"blur"}],cloundAccountRender:[{required:!0,message:"云厂商不能为空",trigger:"blur"}],vpc_name:[{required:!0,message:"私有网络不能为空",trigger:"blur"}],region:[{required:!0,message:"地域不能为空",trigger:"blur"}],zone:[{required:!0,message:"可用区不能为空",trigger:"blur"}],tags:[{required:!0,message:"标签必填",trigger:"blur"}]},showModal:this.show,modalLoading:!0}},computed:{realShow(){return this.show},insTypeParams(){const{account_id:e,vendor:t,res_type:a,region:s,zone:o,instance_type:l,content:n}=this.formValues;return{account_id:e,vendor:t,res_type:a,region:s,zone:o,instance_type:l,content:n}}},watch:{show(e){e&&this.getSettings(),this.showModal=e},insTypeParams:{async handler(e){const{account_id:t,vendor:a,res_type:s,region:o,zone:l,instance_type:n}=e;t&&a&&s&&o&&l&&n&&this.getInsTypeOptions()},deep:!0}},mounted(){this.specialSplit=Object(i["getUniqueStr"])(3)},methods:{async getSettings(){this.getVswitchData(),this.getTagData()},async getVswitchData(){const{data:e}=await Object(n["getVswitch"])();this.vswitchOptions=e.map(e=>({...e,label:`${e.instance_id} | ${e.name} | ${e.cidr_block_v4}`}))},async getTagData(){const{data:e}=await Object(l["getTagList"])();this.tagKeyOptions=e.map(e=>({label:e,value:e}))},async handleSelectTag(e){const{data:t}=await Object(l["getTagList"])({tag_key:e.value});this.$set(this.tagValueOptions,e.value,t.map(e=>({label:e,value:e})))},handleAddTag(){this.formValues.tagsValues.push({key:"",value:""})},handleRemoveTag(e){this.formValues.tagsValues=this.formValues.tagsValues.filter((t,a)=>a!==e)},handleInstanceChange(e){const t=this.vswitchOptions.find(t=>(null===t||void 0===t?void 0:t.instance_id)===e);t&&(this.formValues={...this.formValues,subnet_name:`${t.instance_id} | ${t.name} | ${t.cidr_block_v4}`,vendor:t.cloud_name,account_id:t.account_id,cloundAccountRender:`${t.account_id} | ${t.cloud_name}`,vpc_id:t.vpc_id.replace(/[\r\n]/g,""),vpc_name:`${t.vpc_id} | ${t.vpc_name}`,cloud_region_id:t.cloud_region_id||"",cloudRender:""+t.cloud_region_id,region:t.region,zone:t.zone})},async ok(){this.modalLoading=!1;try{await new Promise((e,t)=>{this.$refs.form.validate(e=>{e||t(new Error("表单校验失败，请检查"))}),this.buy&&this.$refs.buyForm.validate(e=>{e||t(new Error("表单校验失败，请检查"))}),e()});const e=Object(i["getParams"])(this.formValues,this),t=await(this.buy?Object(l["createOrder"])({instance_name:this.buyValues.name,count:this.buyValues.count,image_passwd:"",...e}):Object(l["createOrderTemplate"])({...e}));if(!t)throw new Error("请求错误，请重试");this.$emit("addSuccessCallback"),this.showModal=!1,this.$Message.success(t.msg)}catch(e){this.$Message.error(e.message),this.modalLoading=!1}finally{this.$nextTick(()=>{this.modalLoading=!0})}},cancel(){this.$emit("closeAddModal")}}},m=_,p=(a("765a"),a("2877")),h=Object(p["a"])(m,s,o,!1,null,"3ebe8931",null);t["default"]=h.exports},"765a":function(e,t,a){"use strict";a("d0e4")},"8d8e":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"template__header"},[t("div",{staticClass:"template__header__search"},[t("Input",{staticClass:"template__header__search__input",attrs:{placeholder:"请输入搜索内容"},model:{value:e.searchParams.searchVal,callback:function(t){e.$set(e.searchParams,"searchVal",t)},expression:"searchParams.searchVal"}}),t("Button",{staticClass:"template__header__search__button",on:{click:e.getTableData}},[e._v("搜索")])],1),t("Button",{attrs:{type:"primary"},on:{click:e.handleAddddTemplate}},[e._v("创建模板")])],1),t("Table",{ref:"selection",attrs:{stripe:"",size:"small",loading:e.tableLoading,columns:e.columns,data:e.tableData}}),t("div",{staticStyle:{display:"flex","justify-content":"flex-end","margin-top":"10px",overflow:"hidden"}},[t("Page",{attrs:{total:e.pageTotal,current:e.searchParams.page_number,"page-size":e.searchParams.page_size,"page-size-opts":[12,35,50,100],"show-sizer":"","show-total":""},on:{"on-change":e.changePage,"on-page-size-change":e.handlePageSize}})],1),t("Modal",{attrs:{title:"克隆模板",loading:e.cloneModalLoading,width:60},on:{"on-ok":e.colneModalOk,"on-cancel":e.cloneModalCancel},model:{value:e.showCloneModal,callback:function(t){e.showCloneModal=t},expression:"showCloneModal"}},[t("div",{staticClass:"clone-modal__content"},[t("Form",{ref:"form",attrs:{model:e.cloneFormValues}},[t("FormItem",{attrs:{prop:"name",label:"模板名称","label-width":100,rules:{required:!0,message:"模板名称必填",trigger:"change"}}},[t("Input",{model:{value:e.cloneFormValues.name,callback:function(t){e.$set(e.cloneFormValues,"name",t)},expression:"cloneFormValues.name"}})],1)],1)],1)]),t("Modal",{attrs:{title:"删除模板",loading:e.deleteModalLoading},on:{"on-ok":e.deleteModalOk,"on-cancel":e.deleteModalCancel},model:{value:e.showDeleteModal,callback:function(t){e.showDeleteModal=t},expression:"showDeleteModal"}},[e._v(" 确认删除模板吗？ ")]),t("AddTemplateModal",{attrs:{show:e.showModal,buyRow:e.buyRow},on:{closeAddModal:e.closeAddModal,addSuccessCallback:e.addSuccessCallback}}),t("EditTemplate",{attrs:{show:e.showDrawer,row:e.curRow},on:{closeDrawer:e.closeDrawer,editSuccessCallback:e.editSuccessCallback}})],1)},o=[],l=(a("d9e2"),a("30b3")),n=a("5e65"),i=a("fec9"),r={components:{AddTemplateModal:n["default"],EditTemplate:i["default"]},data(){return{buyRow:null,pageTotal:0,showDrawer:!1,showDeleteModal:!1,deleteModalLoading:!0,curRow:{},showModal:!1,showCloneModal:!1,cloneModalLoading:!0,tableLoading:!1,cloneFormValues:{name:""},columns:[{title:"资源ID",key:"id",width:100},{title:"模板名称",key:"name",align:"center",minWidth:160,render:(e,t)=>e("div",[e("div",{style:{color:"#2d8cf0",cursor:"pointer"},on:{click:()=>{this.showDrawer=!0,this.curRow=t.row}}},t.row.name)])},{title:"子网信息",key:"subnet_name",width:400,align:"center"},{title:"模板类型",key:"res_type_alias",width:120,align:"center"},{title:"云厂商",key:"vendor_alias",width:120,align:"center"},{title:"更新时间",key:"update_time",width:160,align:"center"},{title:"最后一次使用时间",key:"last_time",width:160,align:"center"},{title:"修改人",key:"modify_user",width:160,align:"center"},{title:"操作",align:"center",render:(e,t)=>e("div",[e("Button",{props:{type:"text",size:"small"},style:{color:"#2d8cf0"},on:{click:()=>{this.cloneFormValues.name=t.row.name+"-克隆",this.curRow=t.row,this.showCloneModal=!0}}},"克隆"),e("Button",{props:{type:"text",size:"small"},style:{color:"#ed4014"},on:{click:()=>{this.curRow=t.row,this.showDeleteModal=!0}}},"删除")]),width:200}],tableData:[],searchParams:{page_number:1,page_size:12,order_by:"id",order:"descend",searchVal:""}}},mounted(){this.getTableData()},methods:{handleAddddTemplate(){this.buyRow=null,this.showModal=!0},editSuccessCallback(){this.showDrawer=!1,this.getTableData()},closeDrawer(){this.showDrawer=!1},async deleteModalOk(){try{const{id:e}=this.curRow,t=await Object(l["deleteOrderTemplate"])({id_list:[e]});if(!t)throw new Error("请求错误，请重试");this.showDeleteModal=!1,this.$Message.success(t.msg),this.getTableData()}catch(e){this.$Message.error(e.message),this.deleteModalLoading=!1}finally{this.$nextTick(()=>{this.deleteModalLoading=!0})}},deleteModalCancel(){this.showDeleteModal=!1},addSuccessCallback(){this.showModal=!1,this.getTableData()},closeAddModal(){this.showModal=!1},cloneModalCancel(){this.showCloneModal=!1},async colneModalOk(){try{await new Promise((e,t)=>{this.$refs.form.validate(a=>{a||t(new Error("表单校验失败，请检查")),e()})});const{account_id:e,vendor:t,cloud_region_id:a,res_type:s,region:o,zone:n,instance_type:i,tags:r,vpc_id:c,vpc_name:d,subnet_id:u,subnet_name:_,content:m}=this.curRow,p=await Object(l["createOrderTemplate"])({name:this.cloneFormValues.name,account_id:e,vendor:t,cloud_region_id:a,res_type:s,region:o,zone:n,instance_type:i,tags:r,vpc_id:c,vpc_name:d,subnet_id:u,subnet_name:_,content:m,description:this.cloneFormValues.description||""});if(!p)throw new Error("请求错误，请重试");this.showCloneModal=!1,this.$Message.success(p.msg),this.getTableData()}catch(e){this.$Message.error(e.message),this.cloneModalLoading=!1}finally{this.$nextTick(()=>{this.cloneModalLoading=!0})}},async getTableData(){try{this.tableLoading=!0;const{data:e,count:t}=await Object(l["getOrderTemplateList"])(this.searchParams);this.pageTotal=t,this.tableData=e}catch(e){this.$Message.error(e.message)}finally{this.tableLoading=!1}},handleShowModal(e){this.showModal=e},handlePageSize(e){this.searchParams.page_size=e,this.getTableData()},changePage(e){this.searchParams.page_number=e,this.getTableData()}}},c=r,d=(a("9bfa"),a("2877")),u=Object(d["a"])(c,s,o,!1,null,"5a734a5d",null);t["default"]=u.exports},"9bfa":function(e,t,a){"use strict";a("3c6f")},d0e4:function(e,t,a){}}]);
//# sourceMappingURL=chunk-5a52dcd1.cb905650.js.map