(window["webpackJsonp_cmdb"]=window["webpackJsonp_cmdb"]||[]).push([["chunk-47a15632"],{"50d4":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e._self._c;return t("div",[t("Row",{attrs:{type:"flex",justify:"start",gutter:10}},[e.expand?t("i-col",{staticStyle:{"margin-bottom":"10px"},attrs:{md:24,xl:5}},[t("Card",{attrs:{"dis-hover":"",bordered:!1}},[e.businessList?[t("Alert",{attrs:{"show-icon":""}},[e._v(" 当前选择的是： "),t("span",{staticClass:"select-title"},[e._v(" "+e._s(e.currentTreeName))])]),t("Select",{attrs:{filterable:"","label-in-value":"",placeholder:"请选择"},on:{"on-change":e.handlerChange},model:{value:e.theBusinessID,callback:function(t){e.theBusinessID=t},expression:"theBusinessID"}},e._l(e.businessList,(function(e){return t("Option",{key:e.biz_id,attrs:{value:e.biz_id,label:e.biz_cn_name}})})),1),t("Affix",[t("Input",{staticStyle:{"padding-bottom":"10px","padding-top":"10px"},attrs:{autofocus:"autofocus",placeholder:"搜素..."},model:{value:e.searchVal,callback:function(t){e.searchVal=t},expression:"searchVal"}})],1)]:e._e(),t("div",{staticClass:"tree-bar"},[t("Tree",{ref:"tree",staticStyle:{height:"600px"},attrs:{data:e.treeData,render:e.renderContent},on:{"on-contextmenu":e.handleContextMenu,"on-select-change":e.handlerTreeChange}},[t("template",{slot:"contextMenu"},[t("DropdownItem",{nativeOn:{click:function(t){return e.handleContextMenuAdd.apply(null,arguments)}}},[e._v("添加子节点")]),t("DropdownItem",{nativeOn:{click:function(t){return e.handleContextMenuEdit.apply(null,arguments)}}},[e._v("编辑节点")]),t("DropdownItem",{staticStyle:{color:"#ed4014"},nativeOn:{click:function(t){return e.handleContextMenuDelete.apply(null,arguments)}}},[e._v("删除节点")])],1)],2)],1)],2)],1):e._e(),t("i-col",{staticStyle:{"margin-bottom":"10px"},attrs:{md:24,xl:19}},[t("TreeAsset",{ref:"treeAsset",attrs:{"tree-node-data":e.treeNodeData}})],1)],1),t("TreeAdd",{attrs:{dialog:e.modalMapTree,method:e.methodData,form:e.formValidateTree},on:{"e-close":function(t){e.modalMapTree.modalVisible=!1},"e-update":e.getTreeData}}),t("TreeDelete",{attrs:{dialog:e.deleteDialog,data:e.contextData},on:{"e-close":function(t){e.deleteDialog.show=!1},"e-update":e.getTreeData}})],1)},r=[],s=(a("14d9"),a("30b3")),l=a("0b12"),i=a("e3f2"),n=a("662c"),d=a("629f"),c={name:"ServiceTreeIndex",components:{TreeAdd:i["default"],TreeDelete:n["default"],TreeAsset:d["default"]},data(){return{selectedNodeId:null,treeNodeData:{},deleteDialog:{show:!1,name:""},searchVal:"",expand:!0,businessList:[],currentTreeName:null,theBusinessID:null,treeData:[],treeSetList:[],contextData:null,methodData:null,searchParams:{},modalMapTree:{modalVisible:!1,modalTitle:"添加子节点"},formValidateTree:{create_from:"直接创建",biz_id:null,node_type:null,node_sort:100,title:null,grand_node:null,parent_node:null,expand:!1,ext_info:{}}}},watch:{searchVal(e){this.handlerSearchTree(e)}},mounted(){localStorage.getItem("selectBusinessID")?this.theBusinessID=localStorage.getItem("selectBusinessID"):this.theBusinessID="502",this.getBizList(),this.getTreeData()},methods:{contextToConfig(e){return{...e}},resetformValidateTree(){return{title:null,biz_id:null,parent_node:null,node_type:null,node_sort:100,detail:null,create_from:"直接创建",ext_info:{}}},handleContextMenuDelete(){0!==this.contextData.node_type?(this.deleteDialog.show=!0,this.deleteDialog.name=`/${this.contextData.parent_node}/${this.contextData.title}`):this.$Message.error("项目节点不能被删除！")},handleContextMenuEdit(){this.methodData="put";const e=this.contextData.node_type;0===e?this.$Message.error("Root节点不支持编辑!"):(this.modalMapTree.modalVisible=!0,this.modalMapTree.modalTitle="编辑节点",this.formValidateTree=this.contextToConfig(this.contextData))},handleContextMenuAdd(){this.methodData="post";const e=this.contextData.node_type;if(3===e)return void this.$Message.error("模块下不支持添加子节点了！");let t="添加子节点",a=this.contextData.title;this.formValidateTree=this.resetformValidateTree(),0===e?(t="添加环境",a=this.contextData.title):1===e?(t="添加集群",a=this.contextData.title):2===e&&(t="添加模块",this.formValidateTree.grand_node=JSON.parse(JSON.stringify(this.contextData.parent_node)),a=this.contextData.title),this.formValidateTree.biz_id=this.theBusinessID,this.formValidateTree.parent_node=a,this.formValidateTree.node_type=e+1,this.modalMapTree.modalTitle=t,this.modalMapTree.modalVisible=!0},async getBizList(){const e=await Object(s["getBusinesslist"])();this.businessList=e.data},async getTreeData(){const e=await Object(l["getServiceTreelist"])({biz_id:this.theBusinessID});this.treeData=e.data,this.treeSetList=this.treeData[0].children},async handlerChange(e){this.bizServerList=[],this.theBusinessID=e.value,localStorage.setItem("selectBusinessID",this.theBusinessID),localStorage.setItem("selectBusinessName",e.label),this.getTreeData(this.theBusinessID),this.$refs.treeAsset.getTableData()},handlerSearchTree(e){const t=[];this.treeSetList.forEach(a=>{-1!==a.title.indexOf(e)&&t.push(a)}),this.treeData[0].children=t},renderContent(e,{data:t}){let a="";const o=this.treeNodeData.node_type===t.node_type&&this.treeNodeData.biz_id===t.biz_id&&this.treeNodeData.id===t.id;return a=0===t.node_type?o?"icon_biz1-selected":"icon_biz1-default":1===t.node_type?o?"icon_env2-selected":"icon_env2-default":2===t.node_type?o?"icon_set3-selected":"icon_set3-default":3===t.node_type?o?"icon_module4-selected":"icon_module4-default":"logo-tux",e("div",{style:{minWidth:"200px",paddingRight:"26px",position:"relative"}},[e("span",{style:{display:"flex",alignItems:"center"}},[e("SvgIcon",{props:{size:"18",iconClass:a},style:{"margin-right":"8px","flex-shrink":0}}),e("span",{style:{"font-size":"16px"}},t.title)]),e("Badge",{props:{count:t.count,type:o?"info":"normal",overflowCount:99999},style:{position:"absolute",right:0,top:"2px"}})])},handleContextMenu(e){this.contextData=e},handlerTreeChange(e){if(0===e.length)return;const t=e[0];this.currentTreeName=t.title,this.selectedNodeId=t.id,this.treeNodeData=t}}},m=c,h=(a("f2ab"),a("2877")),u=Object(h["a"])(m,o,r,!1,null,null,null);t["default"]=u.exports},"662c":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e._self._c;return t("Modal",{attrs:{width:"360"},model:{value:e.modalMap.show,callback:function(t){e.$set(e.modalMap,"show",t)},expression:"modalMap.show"}},[t("p",{staticStyle:{color:"#f60","text-align":"center"},attrs:{slot:"header"},slot:"header"},[t("Icon",{attrs:{type:"ios-information-circle"}}),t("span",[e._v("Delete confirmation")])],1),t("div",{staticStyle:{"text-align":"center"}},[t("p",[e._v("确定要删除-"+e._s(e.modalMap.name)+"？")]),t("p",[e._v("如果该节点下有子节点请先删除子节点.")])]),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("Button",{attrs:{type:"error",size:"large",long:""},on:{click:e.handleDelTreeNode}},[e._v("Delete")])],1)])},r=[],s=a("0b12"),l={name:"TreeDelete",props:{dialog:{default(){return{}},type:Object},data:{default(){return{}},type:Object}},data(){return{}},computed:{modalMap(){return this.dialog},contextData(){return this.data}},methods:{handleDelTreeNode(){const e=this.contextData.children;0===e.length?Object(s["operationTree"])({id:this.contextData.id,biz_id:this.contextData.biz_id,title:this.contextData.title,parent_node:this.contextData.parent_node,node_type:this.contextData.node_type},"delete").then(e=>{0===e.code?(this.$Message.success(""+e.msg),this.$emit("e-close"),this.$emit("e-update")):this.$Message.error(""+e.msg),this.$emit("e-close")}):this.$Message.error("节点下存在数据,删除失败！")}}},i=l,n=a("2877"),d=Object(n["a"])(i,o,r,!1,null,null,null);t["default"]=d.exports},e3f2:function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e._self._c;return t("Modal",{attrs:{title:e.modalMapTree.modalTitle,loading:!0,"footer-hide":!0,width:"650","mask-closable":!1},model:{value:e.modalMapTree.modalVisible,callback:function(t){e.$set(e.modalMapTree,"modalVisible",t)},expression:"modalMapTree.modalVisible"}},[t("Form",{ref:"formValidateTree",attrs:{model:e.formValidateTree,"label-width":95}},["post"===e.methodData?[t("FormItem",{attrs:{label:"模式："}},[t("RadioGroup",{model:{value:e.formValidateTree.create_from,callback:function(t){e.$set(e.formValidateTree,"create_from",t)},expression:"formValidateTree.create_from"}},[t("Radio",{attrs:{label:"直接创建"}}),2===e.formValidateTree.node_type?[t("Radio",{attrs:{label:"模板创建"}})]:[t("Radio",{attrs:{label:"模板创建",disabled:""}})]],2)],1)]:e._e(),t("FormItem",{attrs:{label:"节点：",prop:"parent_node"}},[t("span",[e._v(e._s(e.formValidateTree.parent_node))])]),"post"===e.methodData?[t("FormItem",{attrs:{label:"名称：",prop:"title"}},[t("Input",{attrs:{maxlength:35,placeholder:"请输入名称"},model:{value:e.formValidateTree.title,callback:function(t){e.$set(e.formValidateTree,"title",t)},expression:"formValidateTree.title"}})],1)]:[t("FormItem",{attrs:{label:"名称：",prop:"title"}},[t("Input",{attrs:{disabled:"",maxlength:35,placeholder:"请输入名称"},model:{value:e.formValidateTree.title,callback:function(t){e.$set(e.formValidateTree,"title",t)},expression:"formValidateTree.title"}})],1)],"模板创建"===e.formValidateTree.create_from?[t("FormItem",{attrs:{label:"模板："}},[t("Select",{model:{value:e.formValidateTree.temp_id,callback:function(t){e.$set(e.formValidateTree,"temp_id",t)},expression:"formValidateTree.temp_id"}},e._l(e.setTempList,(function(a){return t("Option",{key:a.id,attrs:{value:a.id}},[e._v(e._s(a.temp_name))])})),1)],1)]:[t("FormItem",{attrs:{label:"排序：",prop:"node_sort"}},[t("Tooltip",{attrs:{trigger:"hover",placement:"right",content:"值越小越靠前"}},[t("InputNumber",{attrs:{max:1e3,min:1},model:{value:e.formValidateTree.node_sort,callback:function(t){e.$set(e.formValidateTree,"node_sort",t)},expression:"formValidateTree.node_sort"}})],1)],1),t("FormItem",{attrs:{label:"展开：",prop:"expand"}},[t("i-switch",{attrs:{size:"large"},model:{value:e.formValidateTree.expand,callback:function(t){e.$set(e.formValidateTree,"expand",t)},expression:"formValidateTree.expand"}},[t("span",{attrs:{slot:"open"},slot:"open"},[e._v("启用")]),t("span",{attrs:{slot:"close"},slot:"close"},[e._v("关闭")])])],1),t("FormItem",{attrs:{label:"扩展字段"}},[t("vue-json-editor",{attrs:{"show-btns":!1,mode:"code",lang:"zh"},on:{"json-change":e.onJsonChange,"json-save":e.onJsonSave,"has-error":e.onError},model:{value:e.formValidateTree.ext_info,callback:function(t){e.$set(e.formValidateTree,"ext_info",t)},expression:"formValidateTree.ext_info"}})],1),t("FormItem",{attrs:{label:"备注：",prop:"detail"}},[t("Input",{attrs:{type:"textarea",rows:2,maxlength:1024,placeholder:"Enter something..."},model:{value:e.formValidateTree.detail,callback:function(t){e.$set(e.formValidateTree,"detail",t)},expression:"formValidateTree.detail"}})],1)],t("FormItem",{staticStyle:{"text-align":"right"}},[t("Button",{attrs:{type:"primary"},on:{click:function(t){return e.handleSubmitTree("formValidateTree")}}},[e._v("Submit")])],1)],2)],1)},r=[],s=a("45a3"),l=a("30b3"),i=a("0b12"),n={name:"TreeAdd",components:{vueJsonEditor:s["a"]},props:{dialog:{default(){return{}},type:Object},method:{default(){return null},type:String},form:{default(){return{}},type:Object}},data(){return{setTempList:[],jsonErrFlag:!1}},computed:{modalMapTree(){return this.dialog},methodData(){return this.method},formValidateTree(){return this.form}},mounted(){this.getSetTempList()},methods:{async getSetTempList(){const e=await Object(l["getSetTemplist"])();this.setTempList=e.data},handleSubmitTree(e){this.$refs[e].validate(e=>{e?setTimeout(()=>{console.info(this.formValidateTree,this.methodData),Object(i["operationTree"])(this.formValidateTree,this.methodData).then(e=>{0===e.code?(this.$Message.success(""+e.msg),this.$emit("e-close"),this.$emit("e-update")):this.$Message.error(""+e.msg)})},1e3):this.$Message.error("缺少必要参数")})},onJsonChange(e){console.log("更改了--\x3e"+e),this.jsonErrFlag=!1},onJsonSave(e){console.log("保存了---\x3e",e)},onError(e){this.$Message.error("必须为JSON格式--\x3e"+e),this.jsonErrFlag=!0}}},d=n,c=a("2877"),m=Object(c["a"])(d,o,r,!1,null,null,null);t["default"]=m.exports},f234:function(e,t,a){},f2ab:function(e,t,a){"use strict";a("f234")}}]);
//# sourceMappingURL=chunk-47a15632.5e72bb3b.js.map