(window["webpackJsonp_mg"]=window["webpackJsonp_mg"]||[]).push([["chunk-79dfed0e"],{"147b":function(t,e,a){},"162f":function(t,e,a){"use strict";a.d(e,"b",(function(){return i})),a.d(e,"c",(function(){return r})),a.d(e,"d",(function(){return o})),a.d(e,"e",(function(){return s})),a.d(e,"a",(function(){return l}));var n=a("66df"),i=function(t){return n["a"].request({url:"/api/p/v4/user/",method:"get",params:t})},r=function(t,e){return n["a"].request({url:"/api/p/v4/user/",method:e,data:t})},o=function(t){return n["a"].request({url:"/api/p/v4/reset_mfa/",method:"put",data:t})},s=function(t){return n["a"].request({url:"/api/p/v4/reset_pw/",method:"put",data:t})},l=function(t){return n["a"].request({url:"/api/p/v4/token/",method:"post",data:t})}},"254a":function(t,e,a){"use strict";a("147b")},"681b":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t._self._c;return e("div",{staticStyle:{height:"100%"}},[e("Alert",{attrs:{type:"success","show-icon":""}},[t._v("\n    使用说明：\n    "),e("Icon",{attrs:{slot:"icon",type:"ios-bulb-outline"},slot:"icon"}),e("template",{slot:"desc"},[t._v("这里用来管理用户，可以从第三方同步和导入，被禁用后无法加入角色，但是可以看到。\n      "),e("p",[t._v("关于token： 1、超级用户不可以生成长期令牌。2、非虚拟用户必须设置可以拥有令牌才可以获取长期令牌")])])],2),e("div",{staticClass:"search-con search-con-top"},[e("Input",{staticClass:"search-input",attrs:{search:"",maxlength:100,placeholder:"输入关键字全局搜索"},on:{"on-search":t.handleSearch},model:{value:t.initPara.searchVal,callback:function(e){t.$set(t.initPara,"searchVal",e)},expression:"initPara.searchVal"}}),e("Button",{staticClass:"search-btn",attrs:{type:"info"},on:{click:t.handleAdd}},[t._v("添加用户")]),e("Button",{staticClass:"search-btn",attrs:{type:"error",disabled:0===t.selectList.length},on:{click:t.handleDel}},[t._v("批量删除")])],1),e("Table",{ref:"selection",attrs:{size:"small",columns:t.columns,data:t.tableData,loading:t.i.tableLoading},on:{"on-sort-change":t.handleSort,"on-selection-change":t.handleSelect}}),e("div",{staticStyle:{margin:"10px",overflow:"hidden"}},[e("div",{staticStyle:{float:"left"}},[e("Page",{attrs:{total:t.i.pageTotal,current:t.initPara.page_number,"page-size":t.initPara.page_size,"show-total":"","show-sizer":"","page-size-opts":[15,50,100,1e3]},on:{"on-change":t.handlerChangePage,"on-page-size-change":t.handlePageSize}})],1)]),e("user-edit",{attrs:{modalData:t.modalData,formValidate:t.theData},on:{"save-data":t.handleSaveUser,"drawer-close":t.handleClose}})],1)},i=[],r=(a("8e6e"),a("456d"),a("ade3")),o=(a("ac6a"),a("96cf"),a("1da1")),s=a("2f62"),l=function(){var t=this,e=t._self._c;return e("div",[e("Drawer",{attrs:{title:t.modalData.title,width:"750px;",draggable:"","footer-hide":!0},on:{"on-close":t.handleCancel},model:{value:t.modalData.show,callback:function(e){t.$set(t.modalData,"show",e)},expression:"modalData.show"}},[e("Form",{ref:"formValidate",attrs:{model:t.formValidate,rules:t.ruleValidate,"label-width":120,"label-colon":!0}},[e("FormItem",{attrs:{label:"账户名称",prop:"username"}},["put"==t.modalData.action?[e("Input",{attrs:{maxlength:"50",type:"text",readonly:""},model:{value:t.formValidate.username,callback:function(e){t.$set(t.formValidate,"username",e)},expression:"formValidate.username"}})]:[e("Input",{attrs:{maxlength:"50",type:"text"},model:{value:t.formValidate.username,callback:function(e){t.$set(t.formValidate,"username",e)},expression:"formValidate.username"}})]],2),e("FormItem",{attrs:{label:"用户姓名",prop:"nickname"}},[e("Input",{attrs:{maxlength:"50",type:"text"},model:{value:t.formValidate.nickname,callback:function(e){t.$set(t.formValidate,"nickname",e)},expression:"formValidate.nickname"}})],1),e("FormItem",{attrs:{label:"部门",prop:"department"}},[e("Input",{attrs:{maxlength:"255",type:"text"},model:{value:t.formValidate.department,callback:function(e){t.$set(t.formValidate,"department",e)},expression:"formValidate.department"}})],1),e("FormItem",{attrs:{label:"手机",prop:"tel"}},[e("Input",{attrs:{maxlength:"18",type:"text"},model:{value:t.formValidate.tel,callback:function(e){t.$set(t.formValidate,"tel",e)},expression:"formValidate.tel"}})],1),e("FormItem",{attrs:{label:"邮箱",prop:"email"}},[e("Input",{attrs:{maxlength:"80",type:"text"},model:{value:t.formValidate.email,callback:function(e){t.$set(t.formValidate,"email",e)},expression:"formValidate.email"}})],1),e("FormItem",{attrs:{label:"启用令牌"}},[e("i-switch",{attrs:{"true-color":"#19be6b",size:"large","true-value":"yes","false-value":"no"},model:{value:t.formValidate.have_token,callback:function(e){t.$set(t.formValidate,"have_token",e)},expression:"formValidate.have_token"}},[e("span",[t._v("启用")]),e("span",[t._v("禁用")])])],1),e("FormItem",{attrs:{label:"是否启用"}},[e("i-switch",{attrs:{"true-color":"#19be6b",size:"large","true-value":"0","false-value":"20"},model:{value:t.formValidate.status,callback:function(e){t.$set(t.formValidate,"status",e)},expression:"formValidate.status"}},[e("span",[t._v("启用")]),e("span",[t._v("禁用")])])],1),e("FormItem",[e("Button",{attrs:{type:"primary",loading:t.btnLoading},on:{click:function(e){return t.handleSubmit("formValidate")}}},[t._v("保存")]),e("Button",{staticStyle:{"margin-left":"8px"},on:{click:function(e){return t.handleSubmit("formValidate",!0)}}},[t._v("保存并继续")]),e("Button",{staticStyle:{"margin-left":"15px"},on:{click:function(e){return t.handlerReset("formValidate")}}},[t._v("重置")])],1)],1)],1)],1)},c=[],d=(a("7f7f"),{name:"userEdit",props:{modalData:{type:Object,default:{}},formValidate:{type:Object,default:{}}},data:function(){return{newargs_items:[],btnLoading:!1,ruleValidate:{username:[{required:!0,message:"账户名称不能为空。。。",trigger:"blur"}],nickname:[{required:!0,message:"用户姓名不能为空。。。",trigger:"blur"}],department:[{required:!0,message:"部门不能为空。。。",trigger:"blur"}],wechat:[{required:!0,message:"微信不能为空。。。",trigger:"blur"}],tel:[{required:!0,type:"string",min:11,max:11,message:"手机号不能为空且必须为手机号码",trigger:"blur"}],email:[{required:!0,message:"邮箱不能为空。。。",trigger:"blur"},{type:"email",message:"必须为邮箱格式",trigger:"blur"}]}}},methods:{handleCancel:function(){this.$emit("drawer-close")},handleSubmit:function(t,e){var a=this;this.$refs[t].validate((function(t){t?(a.btnLoading=!0,setTimeout((function(){a.$emit("save-data",a.formValidate,a.modalData.action,e),a.btnLoading=!1}),1e3)):(a.$Message.error("表单校验不通过!"),a.btnLoading=!1)}))},handlerReset:function(t){this.$refs[t].resetFields()}},watch:{},mounted:function(){}}),u=d,m=a("2877"),h=Object(m["a"])(u,l,c,!1,null,null,null),f=h.exports,p=a("162f");function g(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function b(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?g(Object(a),!0).forEach((function(e){Object(r["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):g(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var v={components:{userEdit:f},data:function(){var t=this;return{columns:[{type:"selection",title:"",key:"",width:60,align:"center"},{title:"用户名",key:"username",sortable:!0,minWidth:80,maxWidth:200},{title:"昵称",key:"nickname",sortable:!0,minWidth:80,maxWidth:200},{title:"部门",key:"department",sortable:!0,minWidth:100},{title:"手机",key:"tel",sortable:!0,minWidth:100,maxWidth:120},{title:"邮箱",key:"email",minWidth:110,maxWidth:250},{title:"来源",key:"source",sortable:!0,minWidth:80,maxWidth:130},{title:"登录IP",key:"last_ip",sortable:!0,minWidth:100},{title:"最后登录",key:"last_login",sortable:!0,minWidth:100},{title:"状态",key:"status",minWidth:80,maxWidth:100,sortable:!0,align:"center",render:function(e,a,n){return e("div",[e("i-switch",{props:{trueColor:"#19be6b",value:"0"===a.row.status},style:{marginRight:"5px"},on:{"on-change":function(){t.handleSwitch(a.row)}}})])}},{title:"",key:"operation",minWidth:100,maxWidth:180,render:function(e,a){return e("div",[e("Dropdown",{props:{trigger:"click",transfer:!0}},[e("div",[e("a",[e("span","操作"),e("Icon",{props:{type:"ios-arrow-down"},style:{marginLeft:"5px"}})])]),e("DropdownMenu",{slot:"list"},[e("DropdownItem",{props:{},nativeOn:{click:function(){t.handleResetPassword(a)}}},"重置密码"),e("DropdownItem",{props:{},nativeOn:{click:function(){t.handleResetMFA(a)}}},"重置MFA"),e("DropdownItem",{nativeOn:{click:function(){t.handleGetToken(a)}}},"获取令牌"),e("DropdownItem",{props:{},nativeOn:{click:function(){t.handleEdit(a.row)}}},"编辑用户")])])])}}],tableData:[],theData:{have_token:"yes",status:"0"},selectList:[],tableLoading:!0,btn_loading:!1,initPara:{page_number:1,page_size:15,searchVal:null,order_by:"id",order:"ascend"},i:{pageTotal:0,tableLoading:!0},modalData:{show:!1,title:"添加",action:"post"}}},methods:{handleGetData:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(p["b"])(this.initPara);case 2:e=t.sent,0===e.data.code?(this.tableData=e.data.data,this.i.pageTotal=e.data.count):this.$Message.error(e.data.msg),this.i.tableLoading=!1;case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),handleAdd:function(){this.modalData={show:!0,title:"添加用户",action:"post"},this.theData=this.$options.data().theData},handleEdit:function(t){this.modalData={show:!0,title:"编辑用户",action:"put"},this.theData=t},handleSaveUser:function(t,e,a){var n=this;Object(p["c"])(t,e).then((function(t){0==t.data.code?(n.$Message.success("".concat(t.data.msg)),a?n.handleGetData():n.handleClose()):n.$Message.error("".concat(t.data.msg))}))},handleClose:function(){this.handleGetData(),this.modalData.show=!1,this.theData=this.$options.data().theData},handleSwitch:function(t){var e=this;Object(p["c"])({user_id:t.id},"patch").then((function(t){0==t.data.code?e.$Message.success("".concat(t.data.msg)):e.$Message.error("".concat(t.data.msg))}))},handleDel:function(){var t=this;this.$Modal.confirm({title:"提醒",content:"<p>删除用户之后无法找回，请谨慎操作！</p>",onOk:function(){setTimeout((function(){Object(p["c"])({id_list:t.selectList},"delete").then((function(e){0==e.data.code?(t.handleClose(),t.$Message.success(e.data.msg)):t.$Message.error(e.data.msg)}))}),500)},onCancel:function(){t.$Message.info("回头是岸~")}})},handleResetPassword:function(t){var e=this;this.$Modal.confirm({title:"提醒",content:"<p>重置用户密码：《".concat(t.row.nickname,"》，请谨慎操作！</p>"),onOk:function(){setTimeout((function(){Object(p["e"])({id_list:[t.row.id]}).then((function(t){0==t.data.code?e.$Message.success(t.data.msg):e.$Message.error(t.data.msg)}))}),500)},onCancel:function(){e.$Message.info("回头是岸~")}})},handleResetMFA:function(t){var e=this;this.$Modal.confirm({title:"提醒",content:"<p>重置用户MFA：《".concat(t.row.nickname,"》，请谨慎操作！</p>"),onOk:function(){setTimeout((function(){Object(p["d"])({id_list:[t.row.id]}).then((function(t){0==t.data.code?e.$Message.success(t.data.msg):e.$Message.error(t.data.msg)}))}),500)},onCancel:function(){e.$Message.info("回头是岸~")}})},handleGetToken:function(t){var e=this;this.$Modal.confirm({title:"提醒",content:"<p>获取用户令牌：《".concat(t.row.nickname,"》，请谨慎操作！</p>"),onOk:function(){setTimeout((function(){Object(p["a"])({id_list:[t.row.id]}).then((function(t){0===t.data.code?e.$Message.success("".concat(t.data.msg)):e.$Message.error("".concat(t.data.msg))}))}),500)},onCancel:function(){e.$Message.info("回头是岸~")}})},handleSelect:function(t){var e=[];t.forEach((function(t){e.push(t.id)})),this.selectList=e},handleSearch:function(){this.initPara.page_number=1,this.handleGetData()},handleSort:function(t,e,a){this.initPara.order="asc"===t.order?"ascend":"descend",this.initPara.order_by=t.key,this.handleGetData()},handlerChangePage:function(t){this.initPara.page_number=t,this.handleGetData()},handlePageSize:function(t){this.initPara.page_number=1,this.initPara.page_size=t,this.handleGetData()}},watch:{},computed:b({},Object(s["e"])({rules:function(t){return t.user.rules}})),mounted:function(){this.handleGetData()}},w=v,k=(a("254a"),Object(m["a"])(w,n,i,!1,null,"485b6210",null));e["default"]=k.exports}}]);