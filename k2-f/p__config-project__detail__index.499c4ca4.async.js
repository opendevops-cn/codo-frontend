"use strict";(self.webpackChunkk2=self.webpackChunkk2||[]).push([[5931],{58575:function(e,n,t){t.r(n),t.d(n,{default:function(){return oe}});var r=t(90228),i=t.n(r),o=t(87999),c=t.n(o),l=t(26068),a=t.n(l),s=t(48305),d=t.n(s),u=t(16975),p=t(38218),f=t(51081),h=t(12350),v=t(49944),m=t(17034),j=t(39048),x=t(31988),Z=t(62193),g=t(3885),y=t(69180),b=t(48670),k=t(13702),C=t(47852),w=t(70334),_=t(91894),I=t(97607),P=t(50959),O=t(11527),S=function(e){var n=e.open,t=void 0===n||n,r=e.onCancel,o=e.projectId,l=I.Z.useForm(),a=d()(l,1)[0],s=(0,j.Z)((function(){return(0,u.Z)({url:"/api/k2/v1/project/approval/detail/?project_id=".concat(o)}).then((function(e){return e&&a.setFieldsValue(e),e}))})).data,p=(0,j.Z)((function(){return(0,u.Z)({url:"/api/p/v4/user/list/"})})).data,f=(0,P.useMemo)((function(){return(null==p?void 0:p.map((function(e){return{label:"".concat(e.username,"(").concat(e.nickname,")"),value:"".concat(e.username,"(").concat(e.nickname,")")}})))||[]}),[p]);return(0,O.jsx)(C.Z,{title:"授权和审批",open:t,onCancel:r,width:760,maskClosable:!1,onOk:c()(i()().mark((function e(){var n;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.validateFields();case 2:return n=e.sent,e.next=5,(0,u.Z)({url:"/api/k2/v1/project/approval/",method:null!=s&&s.id?"PUT":"POST",data:{id:null==s?void 0:s.id,project_id:Number(o),admin_users:n.admin_users,approval_users:n.approval_users,member_users:n.member_users}});case 5:w.ZP.success("修改成功"),null==r||r();case 7:case"end":return e.stop()}}),e)}))),children:(0,O.jsxs)(I.Z,{form:a,labelCol:{span:3},children:[(0,O.jsx)(I.Z.Item,{name:"admin_users",label:"管理员",tooltip:"请选择管理员，管理员可以、发布、管理授权",children:(0,O.jsx)(k.Z,{options:f,mode:"multiple",placeholder:"请选择管理员，管理员可以、发布、管理授权"})}),(0,O.jsx)(I.Z.Item,{name:"approval_users",label:"审批人",tooltip:"请选择审批人，为空时无需审批，任意审批人通过即可",children:(0,O.jsx)(k.Z,{options:f,mode:"multiple",placeholder:"请选择审批人，为空时无需审批，任意审批人通过即可"})}),(0,O.jsx)(I.Z.Item,{name:"member_users",label:"成员",tooltip:"普通成员发布需要审批",children:(0,O.jsx)(k.Z,{options:f,mode:"multiple",placeholder:"普通成员发布需要审批"})})]})})},T=t(25659),E=t(33825),F=t(2843),M=t(70617),R=t(59410),D=t(93441),W=function(e){var n=e.projectId,t=e.open,r=void 0===t||t,o=e.onCancel,l=e.environments,s=I.Z.useForm(),p=d()(s,1)[0],f=(0,j.Z)((function(){return(0,u.Z)({url:"/api/k2/v1/project/etcd/detail/?project_id=".concat(n)}).then((function(e){return p.setFieldsValue({content:(null==e?void 0:e.content.map((function(e){return a()(a()({},e),{},{config:JSON.stringify(e.config)})})))||[]}),e}))})).data,h=I.Z.useWatch("content",p);return(0,O.jsxs)(D.Z,{title:"关联ETCD信息",open:r,onClose:o,width:900,extra:(0,O.jsxs)(g.Z,{children:[(0,O.jsx)(y.ZP,{onClick:function(){null==o||o()},children:"取消"}),(0,O.jsx)(y.ZP,{type:"primary",onClick:function(){p.validateFields().then(function(){var e=c()(i()().mark((function e(t){var r,c;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(t),c={content:null===(r=t.content)||void 0===r?void 0:r.map((function(e){return a()(a()({},e),{},{config:JSON.parse(e.config)})})),id:null==f?void 0:f.id,project_id:n},null==f||!f.id){e.next=7;break}return e.next=5,(0,u.Z)({url:"/api/k2/v1/project/etcd/?",method:"PUT",data:c});case 5:e.next=9;break;case 7:return e.next=9,(0,u.Z)({url:"/api/k2/v1/project/etcd/?",method:"POST",data:c});case 9:w.ZP.success("修改成功"),null==o||o();case 11:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}())},children:"确定"})]}),children:[(0,O.jsx)(_.Z,{showIcon:!0,type:"warning",description:'{"ETCD_HOST_PORT": [["10.10.6.154", 2379], ["10.10.6.154", 2379]], "ETCD_USER": "", "ETCD_PASSWORD": ""}',message:"发布时会推送到关联的ETCD，ETCD版本要求3.4+， 格式要求："}),(0,O.jsx)(T.A,{form:p,style:{marginTop:20},submitter:{render:!1},children:(0,O.jsx)(E.u,{name:"content",initialValue:null==f?void 0:f.content.map((function(e){return a()(a()({},e),{},{config:JSON.stringify(e.config)})})),children:(0,O.jsxs)(F.UW,{children:[(0,O.jsx)(M.Z,{name:"environment",style:{width:200},placeholder:"请选择环境",fieldProps:{options:l.map((function(e){return{label:e,value:e}}))},rules:[{required:!0},{validator:function(e,n){if(!n)return Promise.resolve();var t=0;return h.forEach((function(e){e.environment===n&&(t+=1)})),t>1?Promise.reject("环境不能重复"):Promise.resolve()}}]}),(0,O.jsx)(R.Z,{name:"config",width:540,placeholder:"请输入环境ETCD配置",rules:[{required:!0},{validator:function(e,n){if(!n)return Promise.resolve();try{return JSON.parse(n),Promise.resolve()}catch(e){return Promise.reject("配置格式不正确")}}}]})]},"group")})})]})},B=t(15558),q=t.n(B),L=t(89169),A=function(e){return"approving"===e?(0,O.jsx)(L.Z,{color:"green",children:"审批中"}):"online"===e?(0,O.jsx)(L.Z,{color:"blue",children:"已上线"}):"offline"===e?(0,O.jsx)(L.Z,{children:"已下线"}):"-"},N=t(36741),H=function(e){var n=e.currentId,t=e.projectConfigId,r=e.onOk,i=e.disableChangeHistory,o=e.current,c=e.compareId,l=e.onCancel,s=e.open,p=e.title,f=e.alert,h=(0,P.useRef)(null),v=(0,P.useRef)(null),m=(0,P.useState)([c||"",n||(o?"currentCode":"")]),x=d()(m,2),Z=x[0],y=x[1],b=(0,j.Z)((function(){return(0,u.Z)({url:"/api/k2/v1/project/config/version/?project_config_id=".concat(t)}).then((function(e){var t=e.items,r=Z;if(c&&n)r=[c,n];else if(n&&!c){var i,l=t.findIndex((function(e){return"".concat(e.id)===n}));r=["".concat(null==t||null===(i=t[0])||void 0===i?void 0:i.id)||"","".concat(t[l].id)]}else if(o&&!n){var s;r=[c||(null!=t&&null!==(s=t[0])&&void 0!==s&&s.id?"".concat(t[0].id):""),"currentCode"]}return y(r),function(e,n){v.current=N.editor.createDiffEditor(h.current,{theme:"vs-dark",automaticLayout:!0,readOnly:!0,renderSideBySide:!0,minimap:{enabled:!1}});var t=e.find((function(e){return"".concat(e.id)===n[0]})),r=e.find((function(e){return"".concat(e.id)===n[1]}));v.current.setModel({original:N.editor.createModel((null==t?void 0:t.content)||"",(null==t?void 0:t.file_type)||"yaml"),modified:N.editor.createModel((null==r?void 0:r.content)||"",(null==r?void 0:r.file_type)||"yaml")})}(o?[{content:o.content,file_type:o.language,id:"currentCode"}].concat(q()(t.map((function(e){return a()(a()({},e),{},{id:"".concat(e.id)})})))):t.map((function(e){return a()(a()({},e),{},{id:"".concat(e.id)})})),r),t}))})).data,w=(0,P.useMemo)((function(){return(null==b?void 0:b.map((function(e){return{value:"".concat(e.id),label:(0,O.jsxs)(g.Z,{children:[e.version," # ",e.created_at," # ",e.creator," ",A(e.status)]})}})))||[]}),[b]),_=function(e){var n=null==b?void 0:b.find((function(n){return"".concat(n.id)===e[0]})),t=null==b?void 0:b.find((function(n){return"".concat(n.id)===e[1]}));v.current.setModel({original:N.editor.createModel((null==n?void 0:n.content)||"",(null==n?void 0:n.file_type)||"yaml"),modified:"currentCode"===e[1]?N.editor.createModel(o.content,o.language):N.editor.createModel((null==t?void 0:t.content)||"",(null==t?void 0:t.file_type)||"yaml")}),y(e)};return(0,O.jsxs)(C.Z,{title:p||"对比",open:s,onCancel:l,width:1200,onOk:r,children:[f&&(0,O.jsx)("div",{style:{marginBottom:20},children:f}),(0,O.jsxs)("div",{style:{display:"flex",marginBottom:20},children:[(0,O.jsx)("div",{style:{width:"50%"},children:(0,O.jsx)(k.Z,{disabled:i,style:{width:460},options:w,value:Z[0],onChange:function(e){_([e,Z[1]])}})}),(0,O.jsx)("div",{style:{width:"50%"},children:(0,O.jsx)(k.Z,{disabled:i,style:{width:460},value:Z[1],options:[{label:"本地草稿",value:"currentCode"}].concat(q()(w)),onChange:function(e){_([Z[0],e])}})})]}),(0,O.jsx)("div",{ref:h,style:{width:"100%",height:"500px",border:"1px solid #ddd"}})]})},J=[{value:"python",label:"Python"},{value:"json",label:"JSON"},{value:"yaml",label:"YAML"},{value:"ini",label:"INI"},{value:"dockerfile",label:"Dockerfile"},{value:"xml",label:"XML"},{value:"toml",label:"TOML"},{value:"sql",label:"SQL"},{value:"lua",label:"Lua"},{value:"php",label:"PHP"},{value:"java",label:"JAVA"},{value:"golang",label:"GO"},{value:"javascript",label:"JavaScript"}],V=t(21374),U=t(32643),z=t(63176),G=t(4561),K=function(e){var n=e.open,t=void 0===n||n,r=e.onCancel,o=e.project,l=e.environments,s=void 0===l?[]:l,p=e.editData,f=e.onOk,h=(0,P.useMemo)((function(){return s.map((function(e){return{label:e,value:e}}))}),[s]),v=(0,P.useState)(h),m=d()(v,2),j=m[0],x=m[1],Z=I.Z.useForm(),b=d()(Z,1)[0],C=I.Z.useWatch("file_type",b);return(0,O.jsx)(D.Z,{title:p?"编辑配置":"添加配置",open:t,onClose:r,maskClosable:!1,width:960,extra:(0,O.jsxs)(g.Z,{children:[(0,O.jsx)(y.ZP,{onClick:function(){null==r||r()},children:"取消"}),(0,O.jsx)(y.ZP,{onClick:c()(i()().mark((function e(){var n,t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.validateFields();case 2:if(n=e.sent,!p){e.next=10;break}return e.next=6,(0,u.Z)({url:"/api/k2/v1/project/config/",method:"PUT",data:a()({project_id:o.id,id:p.id},n)});case 6:w.ZP.success("编辑成功"),null==f||f(n),e.next=15;break;case 10:return e.next=12,(0,u.Z)({url:"/api/k2/v1/project/config/",method:"POST",data:a()({project_id:o.id},n)});case 12:t=e.sent,w.ZP.success("添加成功"),null==f||f(a()(a()({},n),t));case 15:case"end":return e.stop()}}),e)}))),type:"primary",children:"确认"})]}),children:(0,O.jsxs)(I.Z,{form:b,labelCol:{span:3},initialValues:p,children:[(0,O.jsx)(I.Z.Item,{name:"project",label:"项目",required:!0,rules:[{required:!0}],initialValue:"项目名称 ".concat(o.name," | 项目代号 ").concat(o.code),children:(0,O.jsx)(z.Z,{disabled:!0})}),(0,O.jsx)(I.Z.Item,{name:"environment",label:"环境",required:!0,rules:[{required:!0}],children:(0,O.jsx)(k.Z,{allowClear:!0,showSearch:!0,disabled:!!p,placeholder:"请输入或选择环境，不存在的环境会新建",options:j,onChange:function(){x(h)},onSearch:function(e){x(s.includes(e)||!e?h:[{label:e,value:e}].concat(q()(h)))}})}),(0,O.jsx)(I.Z.Item,{name:"file_name",label:"文件名",required:!0,rules:[{required:!0}],children:(0,O.jsx)(z.Z,{placeholder:"请输入配置文件名，如需自定义目录，请在文件名前增加【/】，如：nginx/nginx.config",disabled:!!p})}),(0,O.jsx)(I.Z.Item,{name:"webhook",label:"变更通知",tooltip:"版本成功发布后，会请求该地址，发送消息【版本1已发布，发布人：张三，发布时间：2024-12-12 12:30:00】",children:(0,O.jsx)(z.Z,{placeholder:"请输入变更通知地址"})}),(0,O.jsx)(I.Z.Item,{label:"配置内容",required:!0,children:(0,O.jsxs)(g.Z,{children:[(0,O.jsx)(I.Z.Item,{noStyle:!0,name:"file_type",rules:[{required:!0}],initialValue:"yaml",children:(0,O.jsx)(k.Z,{style:{width:200},options:J})}),(0,O.jsx)(G.Z,{title:"支持选择配置内容主题，仅做展示效果用",children:(0,O.jsx)(V.Z,{})})]})}),(0,O.jsx)(I.Z.Item,{label:" ",name:"content",colon:!1,rules:[{required:!0}],children:(0,O.jsx)(U.ZP,{theme:"vs-dark",language:C,height:400,options:{minimap:{enabled:!1},fontSize:14,scrollBeyondLastLine:!1}})})]})})},Q=function(e){var n=e.onCancel,t=e.open,r=e.code,o=e.environment,l=e.service,a=e.filename,s=(0,j.Z)((function(){return(0,u.Z)({url:"/api/k2/v1/project/published/shared/config/url/?project_code=".concat(r,"&environment=").concat(o,"&service=").concat(l,"&filename=").concat(a)})})).data,d=(0,j.Z)((function(){return(0,u.Z)({url:"/api/k2/v1/project/published/shared/service/config/url/?project_code=".concat(r,"&environment=").concat(o,"&service=").concat(l)})}),{ready:!!l}).data,p=(0,P.useMemo)((function(){return[{label:"获取当前配置",url:"".concat(window.location.origin,"/api/k2/v1/project/published/config/?project_code=").concat(r,"&environment=").concat(o,"&service=").concat(l,"&filename=").concat(a)}].concat(q()(l?[{label:"获取文件夹下配置",url:"".concat(window.location.origin,"/api/k2/v1/project/published/service/config/?project_code=").concat(r,"&environment=").concat(o,"&service=").concat(l)}]:[]),[{label:"免密获取当前配置",url:"".concat(window.location.origin,"/api/k2-acc").concat(null==s?void 0:s.url)}],q()(l?[{label:"免密获取文件夹下配置",url:"".concat(window.location.origin,"/api/k2-acc").concat(null==d?void 0:d.url)}]:[]))}),[r,o,a,l,null==s?void 0:s.url,null==d?void 0:d.url]);return(0,O.jsxs)(C.Z,{title:"获取API",onCancel:n,width:840,okButtonProps:{style:{display:"none"}},open:t,children:[(0,O.jsx)(_.Z,{type:"success",description:"已发布的配置，可通过下方API获取，支持获取当前配置文件".concat(l?"和文件夹下全部配置":"","，认证方式支持登录和免认证"),style:{marginBottom:20}}),p.map((function(e,n){return(0,O.jsxs)(Z.Z,{justify:"space-between",align:"center",style:{marginBottom:20},children:[(0,O.jsx)("div",{style:{width:160},children:e.label}),(0,O.jsxs)(g.Z.Compact,{style:{width:0,flex:1},children:[(0,O.jsx)(z.Z,{value:e.url}),(0,O.jsx)(y.ZP,{onClick:c()(i()().mark((function n(){return i()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,navigator.clipboard.writeText(e.url);case 3:w.ZP.success("复制成功"),n.next=9;break;case 6:n.prev=6,n.t0=n.catch(0),w.ZP.error("复制失败");case 9:case"end":return n.stop()}}),n,null,[[0,6]])}))),children:"复制"})]})]},"".concat(n))}))]})},X=t(27768),Y=t(23091),$=function(e){var n=e.onRollback,t=e.projectId,r=e.projectConfigId,o=e.open,l=void 0===o||o,a=e.onCancel,s=e.current,d=(0,j.Z)((function(){return(0,u.Z)({url:"/api/k2/v1/project/config/version/?project_config_id=".concat(r)}).then((function(e){return e.items}))})).data,p=(0,j.Z)((function(){return(0,u.Z)({url:"/api/k2/v1/project/approval/detail/?project_id=".concat(t)})})).data;return(0,O.jsx)(D.Z,{title:"历史版本",open:l,onClose:a,maskClosable:!1,width:960,extra:(0,O.jsx)(g.Z,{children:(0,O.jsx)(y.ZP,{onClick:function(){null==a||a()},children:"取消"})}),children:(0,O.jsx)(Y.Z,{dataSource:d,pagination:!1,columns:[{title:"版本号",dataIndex:"version"},{title:"发布人",dataIndex:"creator"},{title:"发布时间",dataIndex:"created_at"},{title:"上线状态",dataIndex:"status",render:A},{title:"操作",dataIndex:"operation",render:function(e,t){return(0,O.jsxs)(g.Z,{children:[(0,O.jsx)(X.FW,{modalRender:function(e){return(0,O.jsx)(H,{onCancel:function(){e()},projectConfigId:r,compareId:"".concat(t.id),current:s})},children:(0,O.jsx)("a",{children:"对比"})}),(0,O.jsx)(X.FW,{modalRender:function(e){var o;return(0,O.jsx)(H,{onCancel:function(){e()},title:"回滚",alert:(0,O.jsx)(_.Z,{message:"历史版本回滚，会将历史版本的配置复制一份并发布，版本号+1。".concat(null!=p&&null!==(o=p.approval_users)&&void 0!==o&&o.length?"本项目发布需要审批，审批人：".concat((null==p?void 0:p.approval_users.join(","))||"","。审批进度可以查看历史版本标签"):""),type:"info",showIcon:!0}),disableChangeHistory:!0,projectConfigId:r,currentId:"".concat(t.id),current:s,onOk:c()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.Z)({url:"/api/k2/v1/project/config/version/rollback/",method:"POST",data:{id:t.id}});case 2:null==n||n();case 3:case"end":return e.stop()}}),e)})))})},children:"offline"===t.status&&(0,O.jsx)("a",{children:"回滚"})})]})}}]})})},ee=t(81901),ne=t(32699),te=t.n(ne),re="block___RGs_P",ie="content___Wui8U";var oe=function(){var e=(0,p.useParams)().id,n=void 0===e?"":e,t=(0,P.useState)(""),r=d()(t,2),o=r[0],l=r[1],s=(0,P.useState)(!1),I=d()(s,2),T=I[0],E=I[1],F=(0,P.useState)(),M=d()(F,2),R=M[0],D=M[1],B=(0,P.useState)(!1),q=d()(B,2),L=q[0],A=q[1],N=(0,j.Z)((function(){return(0,u.Z)({url:"/api/k2/v1/project/detail/?id=".concat(n)})})),V=N.data,z=N.refresh,G=N.loading,Y=(0,ee.Z)({configId:""}),ne=d()(Y,2),oe=ne[0],ce=ne[1],le=(0,j.Z)((function(){return(0,u.Z)({url:'/api/k2/v1/project/config/?filter_map={"project_id":'.concat(V.id,"}")}).then((function(e){return e.items}))}),{ready:!!V}),ae=le.data,se=le.refresh,de=le.loading,ue=(0,j.Z)((function(){return(0,u.Z)({url:"/api/k2/v1/project/approval/detail/?project_id=".concat(n)})})).data,pe=(0,P.useMemo)((function(){return T&&G&&de}),[de,G,T]);(0,P.useEffect)((function(){ae&&!oe.configId&&(te().isEmpty(ae)?ce({configId:""}):ce({configId:ae[0].id}))}),[ae,ce,oe.configId]);var fe=(0,P.useMemo)((function(){return te().groupBy(ae,"environment")}),[ae]),he=(0,P.useMemo)((function(){if(V&&ae){var e=function e(n,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=Object.entries(n).map((function(n){var t=d()(n,2),i=t[0],o=t[1];return te().isObject(o)?{title:"".concat(i),key:"".concat(i,"-").concat(r),children:e(o,i,r+1),icon:(0,O.jsx)(f.Z,{}),selectable:!1}:{title:"".concat(i),key:"".concat(o),icon:(0,O.jsx)(h.Z,{}),selectable:!0}}));return i};return[{title:"".concat(V.code),key:"-".concat(V.code),selectable:!1,icon:(0,O.jsx)(v.Z,{}),children:Object.entries(fe).map((function(n){var t,r,i,o=d()(n,2),c=o[0],l=o[1];return{title:"".concat(c),key:"".concat(V.code,"-").concat(c),selectable:!1,icon:(0,O.jsx)(m.Z,{}),children:e((t=l.map((function(e){return e.file_name})),r=l.map((function(e){return e.id})),i={},t.forEach((function(e,n){for(var t=e.split("/"),o=i,c=0;c<t.length;c++){var l=t[c];o[l]||(o[l]=c===t.length-1?r[n]:{}),c<t.length-1&&(o=o[l])}})),i),c)}}))}]}}),[ae,V,fe]),ve=(0,P.useMemo)((function(){if(oe.configId&&ae)return ae.find((function(e){return"".concat(e.id)===oe.configId}))}),[ae,oe.configId]);(0,P.useEffect)((function(){ve&&(D(ve),l((null==ve?void 0:ve.file_type)||""))}),[ve]);return V?(0,O.jsxs)(x.Z,{spinning:pe,children:[(0,O.jsx)("div",{className:re,children:(0,O.jsxs)(Z.Z,{justify:"space-between",children:[(0,O.jsxs)("h3",{style:{marginBottom:0,lineHeight:"32px"},children:["配置详情：项目名称",V.name," | 项目代号",V.code]}),(0,O.jsxs)(g.Z,{children:[(0,O.jsx)(X.FW,{modalRender:function(e){return(0,O.jsx)(W,{projectId:n,environments:Object.keys(fe),onCancel:function(){e()}})},children:(0,O.jsx)(y.ZP,{children:"关联ETCD"})}),(0,O.jsx)(X.FW,{modalRender:function(e){return(0,O.jsx)(S,{onCancel:function(){e()},projectId:n})},children:(0,O.jsx)(y.ZP,{children:"授权和审批"})}),(0,O.jsx)(X.FW,{modalRender:function(e){return(0,O.jsx)(K,{project:a()({},V),onCancel:function(){e()},onOk:function(n){se(),z(),ce({configId:"".concat(null==n?void 0:n.id)}),e()},environments:Object.keys(fe)})},children:(0,O.jsx)(y.ZP,{type:"primary",children:"添加配置"})})]})]})}),(0,O.jsxs)(Z.Z,{style:{height:"calc(100vh - 160px)"},children:[(0,O.jsx)("div",{className:re,style:{width:300,overflow:"auto"},children:he&&(0,O.jsx)(b.Z,{treeData:he,showIcon:!0,defaultExpandAll:!0,selectedKeys:oe.configId?[oe.configId]:[],onSelect:function(e){A(!1),te().isEmpty(e)||ce({configId:e[0]})}})}),(0,O.jsx)("div",{className:ie,style:{flex:1,width:0},children:ve?(0,O.jsxs)("div",{children:[(0,O.jsxs)(Z.Z,{justify:"space-between",align:"center",children:[(0,O.jsxs)("span",{children:[V.code,"/",ve.environment,"/",ve.file_name]}),(0,O.jsxs)(g.Z,{children:[(0,O.jsx)(k.Z,{style:{width:120},options:J,value:o,onChange:l}),(0,O.jsx)(y.ZP,{danger:!0,onClick:function(){var e;C.Z.confirm({title:"删除配置文件",width:500,onOk:(e=c()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.Z)({url:"/api/k2/v1/project/config/",method:"DELETE",data:{id:ve.id}});case 2:w.ZP.success("删除成功"),se(),ce({configId:""});case 5:case"end":return e.stop()}}),e)}))),function(){return e.apply(this,arguments)}),okButtonProps:{disabled:!ve.can_delete},content:(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)("p",{children:["确认删除配置文件【",ve.file_name,"】？"]}),!ve.can_delete&&(0,O.jsx)("p",{style:{color:"var(--color-error)"},children:"当前文件已有线上发布版本，请联系平台超管进行删除"})]})})},children:"删除"}),(0,O.jsx)(X.FW,{modalRender:function(e){var n=ve.file_name.split("/"),t=n[n.length-1],r=n.slice(0,n.length-1).join("/");return(0,O.jsx)(Q,{code:V.code,environment:ve.environment,onCancel:e,service:r,filename:t})},children:(0,O.jsx)(y.ZP,{children:"API"})}),(0,O.jsx)(X.FW,{modalRender:function(e){return(0,O.jsx)($,{onCancel:function(){e()},projectId:n,projectConfigId:"".concat(ve.id),current:{content:R.content,language:o},onRollback:function(){e()}})},children:(0,O.jsx)(y.ZP,{children:"历史版本"})}),(0,O.jsx)(X.FW,{modalRender:function(e){return(0,O.jsx)(K,{project:a()({},V),onCancel:function(){e()},editData:ve,onOk:function(n){e(),A(!0),se(),D(a()(a()({},ve),n))},environments:Object.keys(fe)})},children:(0,O.jsx)(y.ZP,{type:"primary",ghost:!0,children:"编辑"})})]})]}),(0,O.jsxs)(Z.Z,{vertical:!0,style:{height:"calc(100vh - 240px)",marginTop:10},children:[ve&&"published"!==ve.status&&(0,O.jsx)(_.Z,{type:"warning",showIcon:!0,message:(0,O.jsxs)(Z.Z,{justify:"space-between",align:"center",children:["本地草稿已变更！",(0,O.jsxs)(g.Z,{children:[(0,O.jsx)(X.FW,{modalRender:function(e){return(0,O.jsx)(H,{title:"对比",onCancel:function(){e()},onOk:function(){e()},projectConfigId:"".concat(ve.id),current:{content:ve.content,language:ve.file_type}})},children:(0,O.jsx)(y.ZP,{type:"primary",children:"对比线上"})}),(0,O.jsx)(X.FW,{modalRender:function(e){var n,t;return(0,O.jsx)(H,{title:"发布",alert:(null==ue||null===(n=ue.approval_users)||void 0===n?void 0:n.length)&&(0,O.jsx)(_.Z,{message:"本项目发布需要审批，审批人：".concat((null==ue||null===(t=ue.approval_users)||void 0===t?void 0:t.join(","))||"","。审批进度可以查看历史版本标签"),type:"info",showIcon:!0}),onCancel:function(){e()},onOk:c()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return E(!0),e.next=3,(0,u.Z)({url:"/api/k2/v1/project/config/",method:"PATCH",data:{id:ve.id}});case 3:se(),E(!1),A(!1),w.ZP.success("发布成功");case 7:case"end":return e.stop()}}),e)}))),projectConfigId:"".concat(ve.id),disableChangeHistory:!0,current:{content:ve.content,language:ve.file_type}})},children:(0,O.jsx)(y.ZP,{type:"primary",danger:!0,children:"发布线上"})})]})]}),style:{marginBottom:10}}),L&&ve&&"published"===ve.status&&L&&(0,O.jsx)(_.Z,{type:"success",style:{marginBottom:10},showIcon:!0,message:"本地草稿与线上一致，无需发布"}),(0,O.jsx)("div",{style:{flex:1,height:0},children:(0,O.jsx)(U.ZP,{theme:"vs-dark",language:o,value:(null==R?void 0:R.content)||"",height:"100%",options:{minimap:{enabled:!1},fontSize:14,readOnly:!0,scrollBeyondLastLine:!1}})})]})]}):(0,O.jsx)(_.Z,{message:"请选择需要查看的配置文件",type:"info",showIcon:!0})})]})]}):null}}}]);