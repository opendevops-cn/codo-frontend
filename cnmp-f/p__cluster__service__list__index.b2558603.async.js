(self.webpackChunkcnmp=self.webpackChunkcnmp||[]).push([[2961],{27274:function(t,e,n){"use strict";n.d(e,{Z:function(){return g}});var r=n(15558),a=n.n(r),i=n(26068),o=n.n(i),u=n(48305),s=n.n(u),c=n(45778),l=n(95974),d=n(41710),f=n(10534),h=n(65460),v=n(96286),m=n(50959),p="table___Rup7Y",x=n(11527),g=function(t){var e=t.placeholder,n=t.request,r=t.columns,i=t.leftTitle,u=t.tableProps,g=t.showSearch,j=void 0===g||g,$=t.dataSource,y=t.searchWidth,Z=t.rightTitle,w=void 0===Z?[]:Z,S=t.refreshDeps,b=t.actionRef,C=t.hideTitle,_=t.searchStyle,P=t.onSearch,k=(0,c.T)(b),T=(0,m.useState)(""),D=s()(T,2),M=D[0],R=D[1],O=(0,m.useRef)(""),I=(0,f.Z)((function(){var t,e;null==P||P(M),null===(t=k.current)||void 0===t||null===(e=t.reloadAndRest)||void 0===e||e.call(t)}),{wait:500}).run;return(0,h.Z)((function(){var t;null===(t=k.current)||void 0===t||t.reload()}),S||[]),(0,x.jsx)(d.Z,o()({className:p,actionRef:k,headerTitle:i,dataSource:$,search:!1,columns:r,request:n&&function(t){return n(o()(o()({},t),{},{keyword:O.current}))},pagination:{showSizeChanger:!0,defaultPageSize:50},options:{reload:!!n},toolBarRender:!C&&function(){return[].concat(a()(w),a()(j?[(0,x.jsx)(v.Z,{style:o()({width:null!=y?y:300},_),value:M,placeholder:e,onChange:function(t){R(t.target.value),O.current=t.target.value,I()},allowClear:!0,suffix:(0,x.jsx)(l.Z,{style:{color:"#918f8f"}})},"__search__input")]:[]))}},u))}},45778:function(t,e,n){"use strict";n.d(e,{T:function(){return a}});var r=n(50959),a=function(t,e){var n=(0,r.useRef)(e);return t||n}},21722:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return O}});var r=n(90228),a=n.n(r),i=n(87999),o=n.n(i),u=n(26068),s=n.n(u),c=n(48305),l=n.n(c),d=n(15268),f=n(79890),h=n(27274),v=n(57014),m=n(34593),p=n(36954),x=n(16782),g=n(56765),j=n(38218),$=n(3885),y=n(89169),Z=n(4561),w=n(62193),S=n(3827),b=n(96286),C=n(70334),_=n(69180),P=n(13702),k=n(50959),T="tag___bd2fJ",D="max-width-300___KnBkb",M=n(11527),R=function(t){return t?Object.entries(t).map((function(t){var e=l()(t,2);return{key:e[0],value:e[1]}})):[]},O=function(){var t=(0,j.useParams)(),e=t.clusterName,n=void 0===e?"":e,r=t.namespace,i=void 0===r?"":r,u=(0,k.useState)(),c=l()(u,2),O=c[0],I=c[1],N=(0,k.useRef)();return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(m.Z,{items:[{title:"Service"}],showNamespace:!0}),(0,M.jsx)(h.Z,{actionRef:N,columns:[{dataIndex:"name",title:"名称",width:100,className:D,ellipsis:!0,render:function(t,e){return(0,M.jsx)(x.Z,{follow_type:"Svc",follow_value:e.name,follow:e.is_followed,style:{paddingRight:6},title:e.name,children:(0,M.jsx)(j.Link,{to:"/cluster/".concat(n,"/service-network/").concat(i,"/service/").concat(e.name),children:e.name})})}},{dataIndex:"svc_type",title:"类型",width:100,render:function(t,e){return(0,M.jsxs)("div",{children:[(0,M.jsx)("div",{children:e.headless?"Headless":t}),e.vip&&(0,M.jsxs)($.Z,{children:[e.vip,(0,M.jsx)(y.Z,{color:"blue",children:"VIP"})]})]})}},{dataIndex:"cluster_ip",title:"ClusterIP",width:140},{dataIndex:"ports",title:"端口",ellipsis:!0,render:function(t,e){return e.ports.map((function(t,e){return(0,M.jsx)(Z.Z,{overlayStyle:{maxWidth:900},title:(0,M.jsxs)(M.Fragment,{children:[t.name&&(0,M.jsxs)("div",{children:["name:",t.name]}),t.port&&(0,M.jsxs)("div",{children:["port:",t.port]}),t.protocol&&(0,M.jsxs)("div",{children:["protocol:",t.protocol]}),t.nodePort&&(0,M.jsxs)("div",{children:["name:",t.nodePort]}),t.targetPort&&(0,M.jsxs)("div",{children:["targetPort:",t.targetPort]})]}),children:(0,M.jsx)(w.Z,{style:{marginTop:e?10:0},children:[{value:t.name,color:"rgb(108,164,229)",maxWidth:500},{value:t.port,color:"rgb(18,73,135)"},{value:t.protocol,color:"rgb(198, 94, 175)"},{value:t.nodePort,color:"rgb(250, 173, 20)"},{value:t.targetPort,color:"rgb(181, 181, 181)"}].filter((function(t){return t.value})).map((function(t,e){return(0,M.jsx)("div",{className:T,style:{backgroundColor:t.color,maxWidth:t.maxWidth},children:t.value},e)}))},e)},e)}))}},{dataIndex:"ref_count",title:"关联Pod数",width:100},{dataIndex:"create_time",title:"创建时间",render:g.kZ,width:160},{dataIndex:"operation",title:"操作",fixed:"right",width:160,render:function(t,e){return(0,M.jsxs)($.Z,{children:[(0,M.jsx)(f.Z,{modalRender:function(t){return(0,M.jsx)(v.Z,{onCancel:t,onOk:function(){var e;t(),null===(e=N.current)||void 0===e||e.reload(!1)},initialValues:s()(s()({},e),{},{labels:R(e.labels),selector:R(e.selector),annotations:R(e.annotations)})})},children:(0,M.jsx)("a",{children:"编辑"})}),(0,M.jsx)(f.Z,{modalRender:function(t){return(0,M.jsx)(p.Z,{defaultValue:e.yaml,clusterName:n,onCancel:function(){t()}})},children:(0,M.jsx)("a",{children:"编辑yaml"})}),(0,M.jsx)("a",{onClick:function(){var t=S.Z.confirm({title:"删除Service",width:420,content:(0,M.jsxs)(M.Fragment,{children:[(0,M.jsxs)("p",{children:["确认删除Service【",e.name,"】？"]}),(0,M.jsx)("p",{style:{color:"#FF4D4F"},children:"删除Service可能导致关联服务无法访问，请谨慎操作。"}),(0,M.jsx)(b.Z,{placeholder:"请输入Service名称",onChange:function(n){n.target.value===e.name?t.update({okButtonProps:{disabled:!1}}):t.update({okButtonProps:{disabled:!0}})}})]}),okButtonProps:{disabled:!0},onOk:function(){(0,d.dM)({cluster_name:n,name:e.name,namespace:i}).then((function(){var t,e;C.ZP.success("删除成功"),null===(t=N.current)||void 0===t||null===(e=t.reset)||void 0===e||e.call(t)}))}})},children:"删除"})]})}}],request:function(){var t=o()(a()().mark((function t(e){var r;return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,d.zu)({cluster_name:n,page:e.current,page_size:e.pageSize,keyword:e.keyword,namespace:i,svc_type:e.svc_type});case 2:return r=t.sent,t.abrupt("return",{data:r.list||[],total:r.total||0});case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),searchStyle:{width:360},tableProps:{scroll:{x:"max-content"},rowKey:"name",params:{svc_type:O}},placeholder:"模糊搜索Service名称、类型、ClusterIP、端口等",leftTitle:(0,M.jsx)(f.Z,{modalRender:function(t){return(0,M.jsx)(v.Z,{onCancel:t,onOk:function(){var e;t(),null===(e=N.current)||void 0===e||e.reload(!0)}})},children:(0,M.jsx)(_.ZP,{type:"primary",children:"新建Service"})}),rightTitle:[(0,M.jsx)(P.Z,{placeholder:"请选择类型进行筛选",style:{width:200},value:O,onChange:I,allowClear:!0,options:[{label:"ClusterIP",value:"ClusterIP"},{label:"NodePort",value:"NodePort"},{label:"LoadBalancer",value:"LoadBalancer"},{label:"ExternalName",value:"ExternalName"}]},"filter")]})]})}},56765:function(t,e,n){"use strict";n.d(e,{jp:function(){return s},kZ:function(){return l},yq:function(){return c}});var r=n(5726),a=n.n(r),i=n(11110),o=n.n(i);a().extend(o());var u=function(t){var e=(Date.now()-t)/1e3;return e<60?{duration:e,unit:"second"}:e<3600?{duration:Math.floor(e/60),unit:"minute"}:e<86400?{duration:Math.floor(e/3600),unit:"hour"}:{duration:Math.floor(e/86400),unit:"day"}},s=function(t){if(void 0===t)return"";var e=u(t);return"second"===e.unit?"1分钟内":"".concat(e.duration," ").concat({second:"秒",minute:"分钟",hour:"小时",day:"天"}[e.unit],"前")},c=function(t){var e=u(t);return"second"===e.unit?"1分钟内":"约".concat(e.duration).concat({second:"秒",minute:"分钟",hour:"小时",day:"天"}[e.unit])},l=function(t){return isNaN(Number(t))?t:a()(Number(t)).format("YYYY-MM-DD HH:mm:ss")}},10534:function(t,e,n){"use strict";var r=n(99938),a=n(66292),i=n.n(a),o=n(50959),u=n(53270),s=n(77924),c=n(25492),l=n(80785);e.Z=function(t,e){var n;l.Z&&((0,c.mf)(t)||console.error("useDebounceFn expected parameter is a function, got ".concat(typeof t)));var a=(0,u.Z)(t),d=null!==(n=null==e?void 0:e.wait)&&void 0!==n?n:1e3,f=(0,o.useMemo)((function(){return i()((function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return a.current.apply(a,(0,r.ev)([],(0,r.CR)(t),!1))}),d,e)}),[]);return(0,s.Z)((function(){f.cancel()})),{run:f,cancel:f.cancel,flush:f.flush}}},12246:function(t,e,n){"use strict";var r=n(50959),a=n(25492),i=n(80785);e.Z=function(t){i.Z&&((0,a.mf)(t)||console.error("useMemoizedFn expected parameter is a function, got ".concat(typeof t)));var e=(0,r.useRef)(t);e.current=(0,r.useMemo)((function(){return t}),[t]);var n=(0,r.useRef)();return n.current||(n.current=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.current.apply(this,t)}),n.current}},25844:function(t,e,n){"use strict";var r=n(99938),a=n(50959);e.Z=function(){var t=(0,r.CR)((0,a.useState)({}),2)[1];return(0,a.useCallback)((function(){return t({})}),[])}},11110:function(t){t.exports=function(){"use strict";var t="minute",e=/[+-]\d\d(?::?\d\d)?/g,n=/([+-]|\d\d)/g;return function(r,a,i){var o=a.prototype;i.utc=function(t){return new a({date:t,utc:!0,args:arguments})},o.utc=function(e){var n=i(this.toDate(),{locale:this.$L,utc:!0});return e?n.add(this.utcOffset(),t):n},o.local=function(){return i(this.toDate(),{locale:this.$L,utc:!1})};var u=o.parse;o.parse=function(t){t.utc&&(this.$u=!0),this.$utils().u(t.$offset)||(this.$offset=t.$offset),u.call(this,t)};var s=o.init;o.init=function(){if(this.$u){var t=this.$d;this.$y=t.getUTCFullYear(),this.$M=t.getUTCMonth(),this.$D=t.getUTCDate(),this.$W=t.getUTCDay(),this.$H=t.getUTCHours(),this.$m=t.getUTCMinutes(),this.$s=t.getUTCSeconds(),this.$ms=t.getUTCMilliseconds()}else s.call(this)};var c=o.utcOffset;o.utcOffset=function(r,a){var i=this.$utils().u;if(i(r))return this.$u?0:i(this.$offset)?c.call(this):this.$offset;if("string"==typeof r&&(r=function(t){void 0===t&&(t="");var r=t.match(e);if(!r)return null;var a=(""+r[0]).match(n)||["-",0,0],i=a[0],o=60*+a[1]+ +a[2];return 0===o?0:"+"===i?o:-o}(r),null===r))return this;var o=Math.abs(r)<=16?60*r:r,u=this;if(a)return u.$offset=o,u.$u=0===r,u;if(0!==r){var s=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(u=this.local().add(o+s,t)).$offset=o,u.$x.$localOffset=s}else u=this.utc();return u};var l=o.format;o.format=function(t){var e=t||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return l.call(this,e)},o.valueOf=function(){var t=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*t},o.isUTC=function(){return!!this.$u},o.toISOString=function(){return this.toDate().toISOString()},o.toString=function(){return this.toDate().toUTCString()};var d=o.toDate;o.toDate=function(t){return"s"===t&&this.$offset?i(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():d.call(this)};var f=o.diff;o.diff=function(t,e,n){if(t&&this.$u===t.$u)return f.call(this,t,e,n);var r=this.local(),a=i(t).local();return f.call(r,a,e,n)}}}()}}]);