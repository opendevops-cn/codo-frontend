"use strict";(self.webpackChunkcnmp=self.webpackChunkcnmp||[]).push([[4842],{77230:function(e,n,t){t.r(n);var a=t(90228),r=t.n(a),s=t(87999),l=t.n(s),i=t(26068),c=t.n(i),o=t(48305),u=t.n(o),d=t(34593),m=t(15268),h=t(64059),f=t(27274),v=t(34015),p=t(29762),b=t(43162),g=t(39383),k=t(42912),x=t(62319),y=t(75026),_=t(56765),j=t(38218),Z=t(81901),I=t(47212),S=t(3827),C=t(96286),P=t(70334),w=t(73634),B=t(49072),F=t(19338),N=t(50959),O=t(11527),R=function(e){return e?Object.entries(e).map((function(e){var n=u()(e,2);return{key:n[0],value:n[1]}})):[]};n.default=function(){var e,n,t=(0,j.useParams)(),a=t.clusterName,s=void 0===a?"":a,i=t.name,o=void 0===i?"":i,D=t.namespace,L=void 0===D?"":D,A=(0,Z.Z)({tab:"info"}),M=u()(A,2),T=M[0],V=M[1],W=(0,N.useState)(!1),G=u()(W,2),H=G[0],K=G[1],Y=(0,j.useNavigate)(),z=(0,I.Z)((function(){return(0,m.SG)({name:o,cluster_name:s,namespace:L}).then((function(e){return e.detail}))}),{pollingInterval:2e3,pollingWhenHidden:!1}),Q=z.data,U=z.refreshAsync,$=z.refresh,q=(0,N.useMemo)((function(){var e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.entries(e).map((function(e){var n=u()(e,2),t=n[0],a=n[1];return{value:"".concat(t,":").concat(a)}}))};return[e(null==Q?void 0:Q.annotations),e(null==Q?void 0:Q.labels)]}),[Q]),E=q.some((function(e){return e.length>3})),J=(0,N.useMemo)((function(){return!E||H?q:q.map((function(e){return e.slice(0,3)}))}),[H,E,q]);return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(d.Z,{items:[{title:(0,O.jsx)(j.Link,{to:"/cluster/".concat(s,"/service-network/").concat(L?"".concat(L,"/"):"","ingress"),children:"Ingress"})},{title:"Ingress详情：".concat(o)}],showCreateYamlButton:!1,onParamsChange:function(e){Y("/cluster/".concat(e.clusterName,"/service-network/").concat(e.namespace,"/ingress"))},footRender:function(){return Q&&(0,O.jsx)(p.Z,{yaml:Q.yaml,name:Q.name,refresh:$,title:"Ingress",editRender:function(e){var n;return(0,O.jsx)(k.Z,{onCancel:e.onClose,onOk:function(){e.onClose(),$()},open:e.open,initialValues:c()(c()({},Q),{},{tls:null==Q||null===(n=Q.tls)||void 0===n?void 0:n.map((function(e){var n;return c()(c()({},e),{},{type:(null===(n=e.hosts)||void 0===n?void 0:n.length)>0?"define":"default"})})),labels:R(Q.labels),annotations:R(Q.annotations)})})},onDelete:function(){var e=S.Z.confirm({title:"删除Ingress",width:420,content:(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)("p",{children:["Ingress【",Q.name,"】？"]}),(0,O.jsx)("p",{style:{color:"#FF4D4F"},children:"删除Ingress可能导致关联服务无法访问，请谨慎操作。"}),(0,O.jsx)(C.Z,{placeholder:"请输入Ingress名称",onChange:function(n){n.target.value===Q.name?e.update({okButtonProps:{disabled:!1}}):e.update({okButtonProps:{disabled:!0}})}})]}),okButtonProps:{disabled:!0},onOk:function(){(0,m.pt)({cluster_name:s,name:Q.name,namespace:L}).then((function(){P.ZP.success("删除成功"),Y("/cluster/".concat(s,"/service-network/").concat(L?"".concat(L,"/"):"","ingress"))}))}})}})}}),Q&&(0,O.jsx)(w.Z,{activeKey:T.tab,onChange:function(e){V({tab:e})},items:[{key:"info",label:"基础信息",children:(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(B.Z,{style:{marginBottom:20},children:(0,O.jsx)(F.Z,{title:"基础信息",items:[{key:"name",label:"名称",children:Q.name},{key:"vip",label:"VIP",children:Q.vip},{key:"ingress_class_name",label:"Ingress Class",children:Q.ingress_class_name},{key:"default_backend",label:"默认后端",children:Q.default_backend?"".concat(Q.default_backend.service,":").concat(null===(e=Q.default_backend.service)||void 0===e||null===(e=e.port)||void 0===e?void 0:e.number):"-"},{key:"create_time",label:"创建时间",children:(0,_.kZ)(Q.create_time)},{key:"update_time",label:"更新时间",children:(0,_.kZ)(Q.update_time||"")}]})}),(0,O.jsxs)(B.Z,{style:{marginBottom:20},children:[(0,O.jsx)(F.Z,{title:"注解&标签&选择器",items:[{key:"annotations",label:"注解",children:(0,O.jsx)(v.Z,{items:J[0],tagStyle:{maxWidth:300},direction:"vertical"})},{key:"labels",label:"标签",children:(0,O.jsx)(v.Z,{items:J[1],tagStyle:{maxWidth:300},direction:"vertical"})}]}),E&&(0,O.jsx)("div",{style:{textAlign:"right"},children:(0,O.jsx)("a",{onClick:function(){K(!H)},children:H?"收起":"展开"})})]}),(0,O.jsx)(f.Z,{showSearch:!1,leftTitle:"端口映射",dataSource:(null===(n=Q.ingress_rules)||void 0===n?void 0:n.reduce((function(e,n){return e.concat(n.ingressRuleValue.http.paths.map((function(e){return c()(c()({},e),{},{host:n.host})})))}),[]))||[],columns:[{title:"域名",dataIndex:"host"},{title:"路径",dataIndex:"path"},{title:"匹配规则",dataIndex:"pathType",render:function(e){return x.$[e]}},{title:"Service",dataIndex:["backend","service","name"]},{title:"Port",dataIndex:["backend","service","port","number"]}]})]})},{key:"event",label:"事件",children:(0,O.jsx)("div",{className:y.Z.block,style:{padding:"16px 0"},children:(0,O.jsx)(b.Z,{type:g.L.ingress,name:Q.name,leftTitle:"健康检查"})})},{key:"yaml",label:"YAML",children:(0,O.jsx)("div",{className:y.Z.block,children:(0,O.jsx)(h.Z,{defaultContent:Q.yaml||"",onRefresh:l()(r()().mark((function e(){var n;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U();case 2:return n=e.sent,P.ZP.success("刷新成功"),e.abrupt("return",n.yaml);case 5:case"end":return e.stop()}}),e)}))),editorHeight:"calc(100vh - 380px)"})})}]})]})}},39383:function(e,n,t){t.d(n,{L:function(){return a}});var a={deployment:"Deployment","clone-set":"CloneSet","game-server-set":"GameServerSet","stateful-set":"StatefulSet","daemon-set":"DaemonSet","sidecar-set":"SideCarSet",pod:"Pod",service:"Service",ingress:"Ingress"}},75026:function(e,n){n.Z={block:"block___kQaPg",title:"title___OiznK",name:"name___RaxxU",breadcrumb:"breadcrumb___Zch_1"}}}]);