"use strict";(self.webpackChunkcnmp=self.webpackChunkcnmp||[]).push([[3790],{64059:function(e,n,t){var a=t(48305),i=t.n(a),c=t(81798),s=t(62193),r=t(3885),l=t(99790),o=t(69180),u=t(70334),d=t(69005),m=t(3827),h=t(91894),f=t(15268),x=t(38218),k=t(50959),y=t(11527);n.Z=function(e){var n=e.onRefresh,t=e.defaultContent,a=e.editorHeight,p=void 0===a?300:a,j=e.disabledEdit,v=(0,k.useState)(!1),Z=i()(v,2),b=Z[0],g=Z[1],_=(0,k.useState)(t),w=i()(_,2),C=w[0],S=w[1],P=(0,k.useState)(t),N=i()(P,2),F=N[0],I=N[1],O=(0,k.useState)(!1),R=i()(O,2),A=R[0],L=R[1],V=(0,k.useState)(!1),Y=i()(V,2),M=Y[0],T=Y[1],B=(0,x.useParams)().clusterName,H=void 0===B?"":B,D=(0,k.useState)("edit"),E=i()(D,2),W=E[0],U=E[1];return(0,k.useEffect)((function(){b&&L(!0)}),[b]),(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)(s.Z,{justify:"space-between",children:["edit"===W?(0,y.jsxs)(r.Z,{children:[b?(0,y.jsx)(l.Z,{beforeUpload:function(e){var n=new FileReader;return n.readAsText(e),n.onload=function(e){var n,t=null===(n=e.target)||void 0===n?void 0:n.result;t&&I(t)},!1},accept:".yaml,.yml",showUploadList:!1,children:(0,y.jsx)(o.ZP,{type:"primary",children:"导入YAML"})}):(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(o.ZP,{type:"primary",onClick:function(){g(!0)},disabled:j,children:"编辑YAML"}),(0,y.jsx)(o.ZP,{onClick:function(){navigator.clipboard.writeText(F).then((function(){u.ZP.success("复制成功")}))},children:"复制"}),(0,y.jsx)(o.ZP,{onClick:function(){null==n||n().then((function(e){S(e),u.ZP.success("刷新成功")}))},children:"刷新"})]}),(0,y.jsx)(d.Z,{checked:A,onChange:function(e){L(e.target.checked)},children:"精简字段"}),A&&(0,y.jsx)(d.Z,{checked:M,onChange:function(e){T(e.target.checked)},children:"隐藏status字段"})]}):(0,y.jsx)("div",{}),b&&(0,y.jsxs)(r.Z,{children:[(0,y.jsx)(o.ZP,{onClick:function(){g(!1),I(C),U("edit")},children:"取消"}),(0,y.jsx)(o.ZP,{onClick:function(){F?"edit"!==W?(0,f.e7)({yaml:F,cluster_name:H}).then((function(e){m.Z.confirm({title:"确认更新",width:800,content:e.success?(0,y.jsx)(h.Z,{message:"检查通过，点击‘应用’执行变更",type:"success",showIcon:!0}):(0,y.jsx)(h.Z,{message:"检查未通过",type:"error",description:e.message,showIcon:!0}),okText:"应用",onOk:function(){(0,f.aA)({yaml:F,cluster_name:H}).then((function(){S(F),g(!1),U("edit"),u.ZP.success("编辑成功")})).catch((function(e){u.ZP.error(e.reason)}))}})})):U("diff"):u.ZP.warning("请输入YAML")},children:"确定"})]})]}),(0,y.jsx)("div",{style:{marginTop:20},children:(0,y.jsx)(c.Z,{readOnly:!b,simplify:A,hideStatus:M,originalValue:C,value:F,onChange:function(e){I(e||"")},diff:"diff"===W,height:p})})]})}},30330:function(e,n,t){t.r(n);var a=t(90228),i=t.n(a),c=t(87999),s=t.n(c),r=t(26068),l=t.n(r),o=t(48305),u=t.n(o),d=t(15268),m=t(64059),h=t(34015),f=t(15209),x=t(34593),k=t(29762),y=t(16249),p=t(56765),j=t(38218),v=t(81901),Z=t(47212),b=t(3827),g=t(70334),_=t(73634),w=t(19338),C=t(86309),S=t(32699),P=t.n(S),N=t(50959),F=t(11527);n.default=function(){var e=(0,j.useParams)(),n=e.clusterName,t=void 0===n?"":n,a=e.name,c=void 0===a?"":a,r=e.namespace,o=void 0===r?"":r,S=(0,v.Z)({tab:"basic"}),I=u()(S,2),O=I[0],R=I[1],A=(0,j.useNavigate)(),L=(0,Z.Z)((function(){return(0,d.Hs)({name:c,cluster_name:t,namespace:o}).then((function(e){return e.detail}))})),V=L.data,Y=L.refresh,M=(0,N.useState)(!1),T=u()(M,2),B=T[0],H=T[1],D=Object.keys((null==V?void 0:V.labels)||{}).length>3||Object.keys((null==V?void 0:V.annotations)||{}).length>3;return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(x.Z,{items:[{title:(0,F.jsx)(j.Link,{to:"/cluster/".concat(t,"/configuration-resources/").concat(o,"/secret"),children:"Secret"})},{title:"Secret详情：".concat(c)}],sourceType:"secret",showNamespace:!0,showCreateYamlButton:!1,onParamsChange:function(e){A("/cluster/".concat(e.clusterName||t,"/configuration-resource/").concat(e.namespace||o,"/secret"))},footRender:function(){return V&&(0,F.jsx)(k.Z,{formInitialValues:{data:P().map(V.data,(function(e,n){return{key:n,value:e}})),annotations:P().map(V.annotations,(function(e,n){return{key:n,value:e}})),labels:P().map(V.labels,(function(e,n){return{key:n,value:e}})),name:V.name},yaml:V.yaml,name:V.name,refresh:Y,title:"编辑Secret",editRender:function(e){return(0,F.jsx)(f.Z,l()({},e))},onDelete:function(){var e;b.Z.confirm({title:"删除Secret",content:(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)("p",{children:["确认删除Secret【",V.name,"】"]}),V.refs&&(0,F.jsxs)("p",{style:{color:"#FF4D4F"},children:["当前已经被",null===(e=V.refs)||void 0===e?void 0:e.map((function(e){return"".concat(e.kind,"-").concat(e.name)})).join("、"),"引用，删除可能导致引用的工作负载失效"]})]}),okButtonProps:{disabled:!0},onOk:function(){(0,d.d5)({cluster_name:t,name:V.name,namespace:o}).then((function(){g.ZP.success("删除成功"),A("/cluster/".concat(t,"/configuration-resource/").concat(o,"/secret"))}))}})}})}}),V&&(0,F.jsx)(_.Z,{activeKey:O.tab,onChange:function(e){R({tab:e})},items:[{key:"basic",label:"基础信息",children:(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)("div",{className:y.Z.block,children:(0,F.jsx)(w.Z,{items:[{key:"name",label:"名称",children:V.name},{key:"type",label:"类型",children:V.type},{key:"create_time",label:"创建时间",children:(0,p.kZ)(V.create_time)},{key:"update_time",label:"更新时间",children:(0,p.kZ)(V.update_time)}]})}),(0,F.jsxs)("div",{className:y.Z.block,children:[(0,F.jsx)(w.Z,{title:"注解&标签",items:[{key:"annotations",label:"注解",children:(0,F.jsx)(h.Z,{items:Object.keys(V.annotations||{}).map((function(e){return{value:"".concat(e,":").concat(V.annotations[e])}})),tagStyle:{maxWidth:300},direction:"vertical",max:B?void 0:3})},{key:"labels",label:"标签",children:(0,F.jsx)(h.Z,{items:Object.keys(V.labels||{}).map((function(e){return{value:"".concat(e,":").concat(V.labels[e])}})),tagStyle:{maxWidth:300},max:B?void 0:3,direction:"vertical"})}]}),D&&(0,F.jsx)("div",{style:{right:20,top:20,position:"absolute"},children:(0,F.jsx)("a",{onClick:function(){H(!B)},children:B?"收起":"展开"})})]}),(0,F.jsx)("div",{className:y.Z.block,children:(0,F.jsx)(C.Z,{columns:[{dataIndex:"key",title:"key",render:function(e){return(0,F.jsx)("div",{style:{wordBreak:"break-word"},children:e})}},{dataIndex:"value",title:"value",render:function(e){return(0,F.jsx)("div",{style:{wordBreak:"break-word"},children:e})}}],dataSource:P().map(V.data,(function(e,n){return{key:n,value:e}})),pagination:!1})})]})},{key:"refs",label:"引用列表",children:(0,F.jsx)("div",{className:y.Z.block,children:(0,F.jsx)(C.Z,{columns:[{dataIndex:"name",title:"名称"},{dataIndex:"kind",title:"类型"}],dataSource:V.refs,pagination:!1})})},{key:"yaml",label:"YAML",children:(0,F.jsx)("div",{className:y.Z.block,children:(0,F.jsx)(m.Z,{defaultContent:V.yaml,onRefresh:s()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.Hs)({name:c,cluster_name:t,namespace:o}).then((function(e){var n;return(null===(n=e.detail)||void 0===n?void 0:n.yaml)||""})));case 1:case"end":return e.stop()}}),e)}))),editorHeight:"calc(100vh - 380px)"})})}]})]})}},29762:function(e,n,t){t.d(n,{Z:function(){return p}});var a=t(48305),i=t.n(a),c=t(36954),s=t(38218),r=t(36241),l=t(21630),o=t(62193),u=t(3885),d=t(97536),m=t(69180),h=t(50959),f="title___qEjyg",x="name___p26Np",k="dropdown___unIV5",y=t(11527),p=function(e){var n=l.Z.useForm(),t=i()(n,1)[0],a=(0,h.useState)(!1),p=i()(a,2),j=p[0],v=p[1],Z=(0,h.useState)(!1),b=i()(Z,2),g=b[0],_=b[1],w=(0,s.useParams)().clusterName,C=void 0===w?"":w,S=e.title,P=e.formInitialValues,N=e.onDelete,F=e.refresh,I=e.operationRender,O=e.onRestart,R=e.editRender,A=e.yaml,L=e.name,V=(0,h.useMemo)((function(){var e=[];return void 0!==A&&e.push({label:"编辑yaml",key:"edit-yaml"}),R&&e.push({label:"编辑",key:"edit"}),O&&e.push({label:"重启",key:"restart"}),N&&e.push({label:"删除",key:"delete"}),e}),[A,S,L,C,F,N,O]);return(0,y.jsxs)("div",{className:f,children:[(0,y.jsxs)(o.Z,{justify:"space-between",children:[(0,y.jsxs)(u.Z,{children:[(0,y.jsx)("span",{className:x,children:S}),(0,y.jsx)(u.Z,{children:I&&I()})]}),V.length>0&&(0,y.jsx)(d.Z,{overlayClassName:k,menu:{items:V,onClick:function(e){if("delete"!==e.key)return"edit"===e.key?(v(!0),void t.setFieldsValue(P||{})):void("restart"!==e.key?"edit-yaml"!==e.key||_(!0):null==O||O());null==N||N()}},children:(0,y.jsx)(m.ZP,{style:{padding:"4px 8px"},children:(0,y.jsx)(r.Z,{})})})]}),R&&R({title:S,form:t,open:j,onClose:function(){v(!1)},onOk:function(){v(!1),null==F||F()},type:"edit"}),g&&(0,y.jsx)(c.Z,{title:"【".concat(S,"-").concat(L,"】编辑Yaml"),defaultValue:A,clusterName:C,onCancel:function(){_(!1),null==F||F()}})]})}},16249:function(e,n){n.Z={block:"block___u4hkW"}}}]);