(self.webpackChunkcnmp=self.webpackChunkcnmp||[]).push([[3411],{27274:function(t,e,n){"use strict";n.d(e,{Z:function(){return g}});var r=n(15558),a=n.n(r),i=n(26068),l=n.n(i),s=n(48305),o=n.n(s),u=n(45778),c=n(95974),d=n(41710),f=n(10534),h=n(65460),v=n(96286),m=n(50959),p="table___Rup7Y",x=n(11527),g=function(t){var e=t.placeholder,n=t.request,r=t.columns,i=t.leftTitle,s=t.tableProps,g=t.showSearch,$=void 0===g||g,w=t.dataSource,j=t.searchWidth,y=t.rightTitle,_=void 0===y?[]:y,Z=t.refreshDeps,S=t.actionRef,T=t.hideTitle,k=t.searchStyle,C=t.onSearch,D=(0,u.T)(S),b=(0,m.useState)(""),I=o()(b,2),O=I[0],Y=I[1],M=(0,m.useRef)(""),R=(0,f.Z)((function(){var t,e;null==C||C(O),null===(t=D.current)||void 0===t||null===(e=t.reloadAndRest)||void 0===e||e.call(t)}),{wait:500}).run;return(0,h.Z)((function(){var t;null===(t=D.current)||void 0===t||t.reload()}),Z||[]),(0,x.jsx)(d.Z,l()({className:p,actionRef:D,headerTitle:i,dataSource:w,search:!1,columns:r,request:n&&function(t){return n(l()(l()({},t),{},{keyword:M.current}))},pagination:{showSizeChanger:!0,defaultPageSize:50},options:{reload:!!n},toolBarRender:!T&&function(){return[].concat(a()(_),a()($?[(0,x.jsx)(v.Z,{style:l()({width:null!=j?j:300},k),value:O,placeholder:e,onChange:function(t){Y(t.target.value),M.current=t.target.value,R()},allowClear:!0,suffix:(0,x.jsx)(c.Z,{style:{color:"#918f8f"}})},"__search__input")]:[]))}},s))}},45778:function(t,e,n){"use strict";n.d(e,{T:function(){return a}});var r=n(50959),a=function(t,e){var n=(0,r.useRef)(e);return t||n}},86817:function(t,e,n){"use strict";n.r(e);var r=n(90228),a=n.n(r),i=n(87999),l=n.n(i),s=n(26068),o=n.n(s),u=n(48305),c=n.n(u),d=n(15268),f=n(27274),h=n(34015),v=n(34593),m=n(38218),p=n(50660),x=n(21630),g=n(69180),$=n(3885),w=n(4561),j=n(3827),y=n(70334),_=n(79890),Z=n(57108),S=n(80173),T=n(36954),k=n(16782),C=n(56765),D=n(5726),b=n.n(D),I=n(50959),O=n(11527);e.default=function(){var t=(0,I.useState)(!1),e=c()(t,2),n=e[0],r=e[1],i=(0,I.useState)("create"),s=c()(i,2),u=s[0],D=s[1],Y=x.Z.useForm(),M=c()(Y,1)[0],R=(0,m.useParams)(),H=R.clusterName,z=void 0===H?"":H,F=R.namespace,U=void 0===F?"":F,P=(0,I.useRef)();return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(v.Z,{items:[{title:"版本伸缩HPA"}],showNamespace:!0,sourceType:"ezrollout"}),(0,O.jsx)(f.Z,{actionRef:P,placeholder:"模糊搜索弹性伸缩名称、选择器、标签",searchStyle:{width:320},leftTitle:(0,O.jsx)(g.ZP,{type:"primary",onClick:function(){D("create"),r(!0),M.resetFields()},children:"新建版本伸缩"}),tableProps:{scroll:{x:1400},polling:1e4,rowKey:"name"},columns:[{dataIndex:"name",title:"名称",width:200,render:function(t,e){return(0,O.jsx)(k.Z,{follow_type:"EzRollout",follow_value:e.name,follow:e.is_followed,style:{paddingRight:6},title:t,children:(0,O.jsx)(m.Link,{to:"/cluster/".concat(z,"/scale/").concat(U,"/ezrollout/").concat(e.name),children:t})})}},{dataIndex:"namespace",title:"命名空间",width:200,ellipsis:!0},{dataIndex:"ready",title:"ready",width:200,render:function(t,e){return(0,O.jsxs)($.Z,{children:[(0,O.jsx)("span",{style:{color:t?"var(--color-success)":"var(--color-error)"},children:t?"true":"false"}),(0,O.jsx)(w.Z,{title:(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)("div",{children:["ready:",t?"true":"false"]}),(0,O.jsxs)("div",{children:["latestErrorMessage:",e.latest_error_message||"-"]}),(0,O.jsxs)("div",{children:["latestErrorTime:",e.latest_error_time?b()(e.latest_error_time).format("YYYY-MM-DD HH:mm:ss"):"-"]})]}),children:(0,O.jsx)(p.Z,{})})]})}},{dataIndex:"scale_up_metrics",title:"扩容/锁定指标",width:180,render:function(t,e){var n;return(0,O.jsx)(O.Fragment,{children:(null===(n=e.scale_up_metrics)||void 0===n?void 0:n.map((function(t,e){var n;return(0,O.jsxs)("div",{children:[null===(n=S.v.find((function(e){return e.value===t.name})))||void 0===n?void 0:n.label,":",t.value]},e)})))||[]})}},{dataIndex:"scale_down_metrics",title:"缩容指标",width:180,render:function(t,e){var n;return(0,O.jsx)(O.Fragment,{children:(null===(n=e.scale_down_metrics)||void 0===n?void 0:n.map((function(t,e){var n;return(0,O.jsxs)("div",{children:[null===(n=S.v.find((function(e){return e.value===t.name})))||void 0===n?void 0:n.label,":",t.value]},e)})))||[]})}},{dataIndex:"online_version",title:"线上版本",width:120,ellipsis:!0},{dataIndex:"min_replicas",title:"最小实例数",width:100},{dataIndex:"max_replicas",title:"最大实例数",width:100},{dataIndex:"current_replicas",title:"当前实例数",width:100},{dataIndex:"offline_deadline",title:"历史版本下线",width:160,render:C.kZ},{dataIndex:"selector",title:"选择器",width:220,render:function(t,e){return(0,O.jsx)(h.Z,{tagStyle:{maxWidth:200},items:e.selector.map((function(t){return{value:"".concat(t.key,":").concat(t.value)}})),max:3})}},{dataIndex:"labels",title:"标签",width:220,render:function(t,e){return(0,O.jsx)(h.Z,{tagStyle:{maxWidth:200},items:e.labels.map((function(t){return{value:"".concat(t.key,":").concat(t.value)}})),max:3})}},{dataIndex:"annotations",title:"注释",width:220,render:function(t,e){return(0,O.jsx)(h.Z,{tagStyle:{maxWidth:200},items:e.annotations.map((function(t){return{value:"".concat(t.key,":").concat(t.value)}})),max:3})}},{dataIndex:"create_time",title:"创建时间",width:200},{dataIndex:"operation",title:"操作",fixed:"right",width:180,render:function(t,e){return(0,O.jsxs)($.Z,{children:[(0,O.jsx)("a",{onClick:function(){D("edit"),r(!0),M.setFieldsValue(o()(o()({},e),{},{offline_deadline:b()(Number(e.offline_deadline))}))},children:"编辑"}),(0,O.jsx)(_.Z,{modalRender:function(t){return(0,O.jsx)(T.Z,{defaultValue:e.yaml,clusterName:z,onCancel:function(){var e;t(),null===(e=P.current)||void 0===e||e.reload()},sourceType:"ezrollout"})},children:(0,O.jsx)("a",{children:"编辑yaml"})}),(0,O.jsx)("a",{onClick:function(){j.Z.confirm({title:"【".concat(e.name,"】删除"),content:(0,O.jsx)(O.Fragment,{children:(0,O.jsxs)("p",{children:["确认删除：HPA- ",e.name,"？"]})}),onOk:function(){(0,d.Hc)({cluster_name:z,name:e.name,namespace:U}).then((function(){var t;y.ZP.success("删除成功"),null===(t=P.current)||void 0===t||t.reload(!0)}))}})},children:"删除"}),(0,O.jsx)(_.Z,{})]})}}],request:function(){var t=l()(a()().mark((function t(e){var n,r;return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,d.dD)({cluster_name:z,namespace:U,keyword:e.keyword,page:e.current,page_size:e.pageSize});case 2:return r=t.sent,t.abrupt("return",{data:(null===(n=r.list)||void 0===n?void 0:n.map((function(t){return o()(o()({},t),{},{annotations:Object.entries(t.annotations||{}).map((function(t){return{key:t[0],value:t[1]}})),selector:Object.entries(t.selector||{}).map((function(t){return{key:t[0],value:t[1]}})),labels:Object.entries(t.labels||{}).map((function(t){return{key:t[0],value:t[1]}}))})})))||[],total:r.total||0});case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}),(0,O.jsx)(Z.Z,{title:"".concat("create"===u?"新建":"编辑","版本伸缩"),form:M,open:n,onClose:function(){r(!1)},onOk:function(){var t;null===(t=P.current)||void 0===t||t.reload(!0),r(!1)},type:u})]})}},10534:function(t,e,n){"use strict";var r=n(99938),a=n(66292),i=n.n(a),l=n(50959),s=n(53270),o=n(77924),u=n(25492),c=n(80785);e.Z=function(t,e){var n;c.Z&&((0,u.mf)(t)||console.error("useDebounceFn expected parameter is a function, got ".concat(typeof t)));var a=(0,s.Z)(t),d=null!==(n=null==e?void 0:e.wait)&&void 0!==n?n:1e3,f=(0,l.useMemo)((function(){return i()((function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return a.current.apply(a,(0,r.ev)([],(0,r.CR)(t),!1))}),d,e)}),[]);return(0,o.Z)((function(){f.cancel()})),{run:f,cancel:f.cancel,flush:f.flush}}},11110:function(t){t.exports=function(){"use strict";var t="minute",e=/[+-]\d\d(?::?\d\d)?/g,n=/([+-]|\d\d)/g;return function(r,a,i){var l=a.prototype;i.utc=function(t){return new a({date:t,utc:!0,args:arguments})},l.utc=function(e){var n=i(this.toDate(),{locale:this.$L,utc:!0});return e?n.add(this.utcOffset(),t):n},l.local=function(){return i(this.toDate(),{locale:this.$L,utc:!1})};var s=l.parse;l.parse=function(t){t.utc&&(this.$u=!0),this.$utils().u(t.$offset)||(this.$offset=t.$offset),s.call(this,t)};var o=l.init;l.init=function(){if(this.$u){var t=this.$d;this.$y=t.getUTCFullYear(),this.$M=t.getUTCMonth(),this.$D=t.getUTCDate(),this.$W=t.getUTCDay(),this.$H=t.getUTCHours(),this.$m=t.getUTCMinutes(),this.$s=t.getUTCSeconds(),this.$ms=t.getUTCMilliseconds()}else o.call(this)};var u=l.utcOffset;l.utcOffset=function(r,a){var i=this.$utils().u;if(i(r))return this.$u?0:i(this.$offset)?u.call(this):this.$offset;if("string"==typeof r&&(r=function(t){void 0===t&&(t="");var r=t.match(e);if(!r)return null;var a=(""+r[0]).match(n)||["-",0,0],i=a[0],l=60*+a[1]+ +a[2];return 0===l?0:"+"===i?l:-l}(r),null===r))return this;var l=Math.abs(r)<=16?60*r:r,s=this;if(a)return s.$offset=l,s.$u=0===r,s;if(0!==r){var o=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(s=this.local().add(l+o,t)).$offset=l,s.$x.$localOffset=o}else s=this.utc();return s};var c=l.format;l.format=function(t){var e=t||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return c.call(this,e)},l.valueOf=function(){var t=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*t},l.isUTC=function(){return!!this.$u},l.toISOString=function(){return this.toDate().toISOString()},l.toString=function(){return this.toDate().toUTCString()};var d=l.toDate;l.toDate=function(t){return"s"===t&&this.$offset?i(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():d.call(this)};var f=l.diff;l.diff=function(t,e,n){if(t&&this.$u===t.$u)return f.call(this,t,e,n);var r=this.local(),a=i(t).local();return f.call(r,a,e,n)}}}()}}]);