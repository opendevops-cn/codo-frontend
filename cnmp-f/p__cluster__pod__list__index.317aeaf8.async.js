(self.webpackChunkcnmp=self.webpackChunkcnmp||[]).push([[5035],{59999:function(e,n,t){"use strict";t.d(n,{Z:function(){return l}});var r=t(79482),a=t(50959),i={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64c247.4 0 448 200.6 448 448S759.4 960 512 960 64 759.4 64 512 264.6 64 512 64zm0 76c-205.4 0-372 166.6-372 372s166.6 372 372 372 372-166.6 372-372-166.6-372-372-372zm128.01 198.83c.03 0 .05.01.09.06l45.02 45.01a.2.2 0 01.05.09.12.12 0 010 .07c0 .02-.01.04-.05.08L557.25 512l127.87 127.86a.27.27 0 01.05.06v.02a.12.12 0 010 .07c0 .03-.01.05-.05.09l-45.02 45.02a.2.2 0 01-.09.05.12.12 0 01-.07 0c-.02 0-.04-.01-.08-.05L512 557.25 384.14 685.12c-.04.04-.06.05-.08.05a.12.12 0 01-.07 0c-.03 0-.05-.01-.09-.05l-45.02-45.02a.2.2 0 01-.05-.09.12.12 0 010-.07c0-.02.01-.04.06-.08L466.75 512 338.88 384.14a.27.27 0 01-.05-.06l-.01-.02a.12.12 0 010-.07c0-.03.01-.05.05-.09l45.02-45.02a.2.2 0 01.09-.05.12.12 0 01.07 0c.02 0 .04.01.08.06L512 466.75l127.86-127.86c.04-.05.06-.06.08-.06a.12.12 0 01.07 0z"}}]},name:"close-circle",theme:"outlined"},c=t(28371),o=function(e,n){return a.createElement(c.Z,(0,r.Z)({},e,{ref:n,icon:i}))};var l=a.forwardRef(o)},27274:function(e,n,t){"use strict";t.d(n,{Z:function(){return g}});var r=t(15558),a=t.n(r),i=t(26068),c=t.n(i),o=t(48305),l=t.n(o),u=t(45778),s=t(95974),d=t(41710),f=t(10534),h=t(65460),m=t(96286),v=t(50959),p="table___Rup7Y",x=t(11527),g=function(e){var n=e.placeholder,t=e.request,r=e.columns,i=e.leftTitle,o=e.tableProps,g=e.showSearch,j=void 0===g||g,Z=e.dataSource,w=e.searchWidth,y=e.rightTitle,_=void 0===y?[]:y,$=e.refreshDeps,k=e.actionRef,b=e.hideTitle,C=e.searchStyle,S=e.onSearch,P=(0,u.T)(k),T=(0,v.useState)(""),O=l()(T,2),R=O[0],D=O[1],I=(0,v.useRef)(""),M=(0,f.Z)((function(){var e,n;null==S||S(R),null===(e=P.current)||void 0===e||null===(n=e.reloadAndRest)||void 0===n||n.call(e)}),{wait:500}).run;return(0,h.Z)((function(){var e;null===(e=P.current)||void 0===e||e.reload()}),$||[]),(0,x.jsx)(d.Z,c()({className:p,actionRef:P,headerTitle:i,dataSource:Z,search:!1,columns:r,request:t&&function(e){return t(c()(c()({},e),{},{keyword:I.current}))},pagination:{showSizeChanger:!0,defaultPageSize:50},options:{reload:!!t},toolBarRender:!b&&function(){return[].concat(a()(_),a()(j?[(0,x.jsx)(m.Z,{style:c()({width:null!=w?w:300},C),value:R,placeholder:n,onChange:function(e){D(e.target.value),I.current=e.target.value,M()},allowClear:!0,suffix:(0,x.jsx)(s.Z,{style:{color:"#918f8f"}})},"__search__input")]:[]))}},o))}},45778:function(e,n,t){"use strict";t.d(n,{T:function(){return a}});var r=t(50959),a=function(e,n){var t=(0,r.useRef)(n);return e||t}},60665:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return B}});var r=t(90228),a=t.n(r),i=t(87999),c=t.n(i),o=t(48305),l=t.n(o),u=t(15558),s=t.n(u),d=t(15268),f=t(3885),h=t(69005),m=t(96286),v=t(69180),p=t(32699),x=t.n(p),g=t(50959),j=t(95974),Z="checkbox-item___VdPHO",w=t(11527),y=function(e){var n,t,r=e.options,a=void 0===r?[]:r,i=e.value,c=void 0===i?[]:i,o=e.onChange,u=e.disabled,d=e.showAll,p=void 0===d||d,y=e.showSearch,_=void 0===y||y,$=e.searchProps,k=e.maxHeight,b=(0,g.useState)(""),C=l()(b,2),S=C[0],P=C[1],T=(0,g.useMemo)((function(){return a.reduce((function(e,n){return n.children?[].concat(s()(e),s()(n.children)):[].concat(s()(e),[n])}),[])}),[a]),O=function(e,n){var t=Array.isArray(n)?n:[n];o(e?[].concat(s()(c),s()(t)):c.filter((function(e){return!t.includes(e)})))},R=function(e){o(e?T.map((function(e){return e.value})):[])},D=(0,g.useMemo)((function(){return new RegExp(S,"i")}),[S]);return(0,w.jsxs)("div",{children:[!u&&(p||_)&&(0,w.jsx)("div",{style:{marginBottom:10},children:(0,w.jsxs)(f.Z,{size:35,children:[p&&(0,w.jsx)(h.Z,{checked:(null==c?void 0:c.length)===T.length,indeterminate:(null==c?void 0:c.length)>0&&(null==c?void 0:c.length)!==T.length,onChange:function(e){return R(e.target.checked)},children:"全选"}),_&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(m.Z,{allowClear:!0,placeholder:null!==(n=null==$?void 0:$.placeholder)&&void 0!==n?n:"支持按关键字模糊搜索",onChange:function(e){return P(e.target.value)},suffix:(0,w.jsx)(j.Z,{})}),(0,w.jsxs)(f.Z,{children:[(0,w.jsx)(v.ZP,{onClick:function(){var e;if(S){var n=null===(e=T.filter((function(e){return D.test(e.label)})))||void 0===e?void 0:e.map((function(e){return e.value}));o(s()(new Set([].concat(s()(c),s()(n)))))}},children:"选中搜索"}),(null===(t=null==$?void 0:$.showClear)||void 0===t||t)&&(0,w.jsx)(v.ZP,{onClick:function(){var e;if(S){var n=null===(e=T.filter((function(e){return D.test(e.label)})))||void 0===e?void 0:e.map((function(e){return e.value}));o(c.filter((function(e){return!n.includes(e)})))}},children:"取消选中搜索"})]})]})]})}),(0,w.jsx)("div",{style:{maxHeight:k,overflowY:"auto"},children:null==a?void 0:a.map((function(e){var n=e.children?e.children.map((function(e){return e.value})):e.value,t=e.children?0===x().difference(n,c).length:null==c?void 0:c.includes(e.value),r=e.children&&0!==x().difference(n,c).length&&0!==x().intersection(n,c).length;return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(h.Z,{className:Z,title:e.label,disabled:u,value:e.value,checked:t,indeterminate:r,onChange:function(e){return O(e.target.checked,n)},children:(0,w.jsx)("span",{className:e.className,children:e.label})},String(e.value)),(null==e?void 0:e.children)&&(0,w.jsx)(w.Fragment,{children:(0,w.jsx)("div",{style:{margin:"10px 0 10px 20px"},children:null==e?void 0:e.children.map((function(e){var n;return(0,w.jsx)(h.Z,{className:Z,title:e.label,disabled:u,value:e.value,checked:null==c?void 0:c.includes(e.value),onChange:function(n){return O(n.target.checked,e.value)},children:(0,w.jsx)("span",{className:e.className,dangerouslySetInnerHTML:{__html:null===(n=e.label)||void 0===n?void 0:n.replace(D,"<em>$&</em>")}})},String(e.value))}))})})]})}))})]})},_=(0,g.memo)(y),$=t(79890),k=t(27274),b=t(34015),C=t(34593),S=t(36954),P=t(16782),T=t(56765),O=t(38218),R=t(56260),D=t(59999),I=t(21374),M=t(47212),N=t(60080),H=t(62193),Y=t(67813),L=t(3827),z=t(70334),U=t(4561),F=t(86309),E=function(e){var n={};return e.forEach((function(e){var t=e.split("#");n[t[0]]=[].concat(s()(n[t[0]]||[]),[t[1]])})),Object.keys(n).map((function(e){return{pod_name:e,container_names:n[e]}}))},A="pod-delete-container-notification",B=function(){var e=(0,g.useRef)(),n=(0,O.useParams)(),t=n.clusterName,r=void 0===t?"":t,i=n.namespace,o=void 0===i?"":i,u=(0,g.useState)([]),s=l()(u,2),h=s[0],m=s[1],p=(0,g.useState)([]),x=l()(p,2),j=x[0],Z=x[1],y=(0,M.Z)((function(e){return(0,d.Vr)({cluster_name:r,namespace:o,names:e})}),{pollingInterval:1e3,manual:!0,pollingWhenHidden:!1,onSuccess:function(e){var n,t,a,i=(null===(n=e.list.filter((function(e){return e.total_count&&e.success_count===e.total_count})))||void 0===n?void 0:n.length)||0;i===e.list.length&&q(),N.ZP.open({key:A,description:(0,w.jsx)("div",{style:{marginTop:10},children:null===(t=e.list)||void 0===t?void 0:t.map((function(e){return(0,w.jsxs)("div",{style:{marginBottom:10},children:[(0,w.jsxs)(H.Z,{style:{width:"100%"},justify:"space-between",children:[(0,w.jsx)("a",{target:"_blank",href:"/cnmp/cluster/".concat(r,"/workloads/").concat(o,"/pod/detail/").concat(e.pod_name),rel:"noreferrer",children:e.pod_name}),(0,w.jsxs)("span",{children:[e.success_count,"/",e.total_count]})]}),(0,w.jsx)(Y.Z,{percent:e.success_count===e.total_count?100:e.success_count/e.total_count*100})]},e.name)}))}),message:"容器删除中（".concat(i,"/").concat((null===(a=e.list)||void 0===a?void 0:a.length)||0,"）"),placement:"bottomRight",duration:null,onClose:function(){N.ZP.destroy(A),q()}})}}),B=y.run,q=y.cancel;return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(C.Z,{items:[{title:"Pod"}],sourceType:"pod",showNamespace:!0}),(0,w.jsx)(k.Z,{actionRef:e,request:function(){var e=c()(a()().mark((function e(n){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,d.ky)({cluster_name:r,page:n.current,page_size:n.pageSize,keyword:n.keyword,namespace:o});case 2:return t=e.sent,e.abrupt("return",{data:t.list||[],total:t.total||0});case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),leftTitle:(0,w.jsxs)(f.Z,{children:[(0,w.jsx)(v.ZP,{disabled:0===h.length,onClick:function(){var n;L.Z.confirm({title:"删除POD",content:(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)("p",{children:["确认删除:",h.slice(0,3).join("、"),h.length>3?"等":"","共计",h.length,"个资源?"]}),(0,w.jsx)("p",{children:"如Pod所属工作负载配置未变更，Pod会被重建，资源不足时可能导致重建失败"})]}),onOk:(n=c()(a()().mark((function n(){var t;return a()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,d.$1)({cluster_name:r,namespace:o,pod_names:h.map((function(e){return e.name}))});case 2:null===(t=e.current)||void 0===t||t.reload(!0),m([]),z.ZP.success("删除成功");case 5:case"end":return n.stop()}}),n)}))),function(){return n.apply(this,arguments)})})},children:"批量删除"}),(0,w.jsx)($.Z,{modalRender:function(e){return(0,w.jsx)(L.Z,{open:!0,title:"批量删除容器",width:800,onCancel:function(){e(),Z([])},okButtonProps:{disabled:0===j.length},onOk:c()(a()().mark((function n(){var t,i;return a()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,d.vA)({cluster_name:r,namespace:o,container_items:E(j)});case 2:i=n.sent,e(),Z([]),B((null===(t=i.list)||void 0===t?void 0:t.map((function(e){return e.name})))||[]);case 6:case"end":return n.stop()}}),n)}))),children:(0,w.jsx)(_,{value:j,onChange:function(e){Z(e)},searchProps:{placeholder:"模糊搜索容器名"},options:h.map((function(e){return{label:e.name,value:e.name,children:e.containers.map((function(n){return{label:n.name||"",value:"".concat(e.name,"#").concat(n.name)||""}}))}})),maxHeight:400})})},children:(0,w.jsx)(v.ZP,{disabled:0===h.length,children:"批量删除容器"})})]}),placeholder:"模糊搜索负载名称、镜像、标签",columns:[{dataIndex:"name",title:"名称",width:240,render:function(e,n){return(0,w.jsx)(P.Z,{follow_type:"Pod",follow_value:n.name,follow:n.is_followed,style:{paddingRight:6},title:e,children:(0,w.jsx)(O.Link,{to:"/cluster/".concat(r,"/workloads/").concat(n.namespace,"/pod/detail/").concat(n.name),children:e})})}},{dataIndex:"namespace",title:"命名空间",ellipsis:!0},{dataIndex:"status",width:120,title:"状态",render:function(e,n){return"Running"===e||"Succeeded"===e?(0,w.jsxs)(f.Z,{style:{color:"var(--color-success)"},children:[(0,w.jsx)(R.Z,{}),e]}):(0,w.jsxs)(f.Z,{style:{color:"Failed"===e||"CrashLoopBackOff"===e?"var(--color-error)":"var(--color-warning)"},children:["Failed"===e||"CrashLoopBackOff"===e?(0,w.jsx)(D.Z,{}):(0,w.jsx)(I.Z,{}),(0,w.jsx)(U.Z,{title:n.reason,children:e})]})}},{dataIndex:"ready_count",title:"Ready",render:function(e,n){return"".concat(e,"/").concat(n.container_count)},width:80},{dataIndex:"restart_count",title:"重启",width:80},{dataIndex:"containers",title:"镜像",width:180,render:function(e,n){return(0,w.jsx)(b.Z,{tagStyle:{maxWidth:110},items:n.containers.map((function(e){return{value:e.image}})),max:1})}},{dataIndex:"create_time",title:"运行时长",render:T.yq,width:100},{dataIndex:"node_ip",title:"节点IP",width:120},{dataIndex:"pod_ip",title:"实例IP",width:120},{dataIndex:"labels",title:"标签",width:180,render:function(e,n){return n.labels?(0,w.jsx)(b.Z,{tagStyle:{maxWidth:110},items:Object.keys(n.labels).map((function(e){return{value:"".concat(e,":").concat(n.labels[e])}})),max:1}):"-"}},{dataIndex:"operation",title:"操作",fixed:"right",width:160,render:function(n,t){return(0,w.jsxs)(f.Z,{children:[(0,w.jsx)($.Z,{modalRender:function(e){return(0,w.jsx)(S.Z,{defaultValue:t.yaml,clusterName:r,onCancel:function(){e()},onOk:function(n){(0,d.kH)({cluster_name:r,namespace:o,pod_name:t.name,yaml:n}).then((function(){e(),z.ZP.success("编辑成功")}))}})},children:(0,w.jsx)("a",{children:"编辑yaml"})}),(0,w.jsx)($.Z,{modalRender:function(n){return(0,w.jsxs)(L.Z,{open:!0,title:"【".concat(t.name,"】删除"),onCancel:function(){n()},onOk:function(){(0,d.dS)({cluster_name:r,namespace:o,pod_name:t.name}).then((function(){var t;null===(t=e.current)||void 0===t||t.reload(!0),z.ZP.success("删除成功"),n()}))},children:[(0,w.jsxs)("p",{children:["确认删除资源：",t.name,"？"]}),(0,w.jsx)("p",{children:"如Pod所属工作负载配置未变更，Pod会被重建，资源不足时可能 导致重建失败"})]})},children:(0,w.jsx)("a",{children:"删除"})})]})}}],tableProps:{rowKey:"name",scroll:{x:1400},rowSelection:{selectedRowKeys:h.map((function(e){return e.name})),selections:[F.Z.SELECTION_ALL,F.Z.SELECTION_INVERT],onChange:function(e,n){m(n)}},tableAlertRender:!1}})]})}},56765:function(e,n,t){"use strict";t.d(n,{jp:function(){return l},kZ:function(){return s},yq:function(){return u}});var r=t(5726),a=t.n(r),i=t(11110),c=t.n(i);a().extend(c());var o=function(e){var n=(Date.now()-e)/1e3;return n<60?{duration:n,unit:"second"}:n<3600?{duration:Math.floor(n/60),unit:"minute"}:n<86400?{duration:Math.floor(n/3600),unit:"hour"}:{duration:Math.floor(n/86400),unit:"day"}},l=function(e){if(void 0===e)return"";var n=o(e);return"second"===n.unit?"1分钟内":"".concat(n.duration," ").concat({second:"秒",minute:"分钟",hour:"小时",day:"天"}[n.unit],"前")},u=function(e){var n=o(e);return"second"===n.unit?"1分钟内":"约".concat(n.duration).concat({second:"秒",minute:"分钟",hour:"小时",day:"天"}[n.unit])},s=function(e){return isNaN(Number(e))?e:a()(Number(e)).format("YYYY-MM-DD HH:mm:ss")}},10534:function(e,n,t){"use strict";var r=t(99938),a=t(66292),i=t.n(a),c=t(50959),o=t(53270),l=t(77924),u=t(25492),s=t(80785);n.Z=function(e,n){var t;s.Z&&((0,u.mf)(e)||console.error("useDebounceFn expected parameter is a function, got ".concat(typeof e)));var a=(0,o.Z)(e),d=null!==(t=null==n?void 0:n.wait)&&void 0!==t?t:1e3,f=(0,c.useMemo)((function(){return i()((function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return a.current.apply(a,(0,r.ev)([],(0,r.CR)(e),!1))}),d,n)}),[]);return(0,l.Z)((function(){f.cancel()})),{run:f,cancel:f.cancel,flush:f.flush}}},11110:function(e){e.exports=function(){"use strict";var e="minute",n=/[+-]\d\d(?::?\d\d)?/g,t=/([+-]|\d\d)/g;return function(r,a,i){var c=a.prototype;i.utc=function(e){return new a({date:e,utc:!0,args:arguments})},c.utc=function(n){var t=i(this.toDate(),{locale:this.$L,utc:!0});return n?t.add(this.utcOffset(),e):t},c.local=function(){return i(this.toDate(),{locale:this.$L,utc:!1})};var o=c.parse;c.parse=function(e){e.utc&&(this.$u=!0),this.$utils().u(e.$offset)||(this.$offset=e.$offset),o.call(this,e)};var l=c.init;c.init=function(){if(this.$u){var e=this.$d;this.$y=e.getUTCFullYear(),this.$M=e.getUTCMonth(),this.$D=e.getUTCDate(),this.$W=e.getUTCDay(),this.$H=e.getUTCHours(),this.$m=e.getUTCMinutes(),this.$s=e.getUTCSeconds(),this.$ms=e.getUTCMilliseconds()}else l.call(this)};var u=c.utcOffset;c.utcOffset=function(r,a){var i=this.$utils().u;if(i(r))return this.$u?0:i(this.$offset)?u.call(this):this.$offset;if("string"==typeof r&&(r=function(e){void 0===e&&(e="");var r=e.match(n);if(!r)return null;var a=(""+r[0]).match(t)||["-",0,0],i=a[0],c=60*+a[1]+ +a[2];return 0===c?0:"+"===i?c:-c}(r),null===r))return this;var c=Math.abs(r)<=16?60*r:r,o=this;if(a)return o.$offset=c,o.$u=0===r,o;if(0!==r){var l=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(o=this.local().add(c+l,e)).$offset=c,o.$x.$localOffset=l}else o=this.utc();return o};var s=c.format;c.format=function(e){var n=e||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return s.call(this,n)},c.valueOf=function(){var e=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*e},c.isUTC=function(){return!!this.$u},c.toISOString=function(){return this.toDate().toISOString()},c.toString=function(){return this.toDate().toUTCString()};var d=c.toDate;c.toDate=function(e){return"s"===e&&this.$offset?i(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():d.call(this)};var f=c.diff;c.diff=function(e,n,t){if(e&&this.$u===e.$u)return f.call(this,e,n,t);var r=this.local(),a=i(e).local();return f.call(r,a,n,t)}}}()}}]);