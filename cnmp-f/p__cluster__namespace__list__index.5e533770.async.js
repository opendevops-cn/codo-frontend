"use strict";(self.webpackChunkcnmp=self.webpackChunkcnmp||[]).push([[797],{69346:function(e,n,t){t.d(n,{Z:function(){return g}});var r=t(15558),a=t.n(r),i=t(26068),l=t.n(i),o=t(48305),s=t.n(o),c=t(56330),u=t(79179),d=t(60125),p=t(10534),f=t(65460),m=t(80699),h=t(82187),v=t.n(h),x=t(50959),Z="no-left-title___t8LWq",y=t(11527),g=function(e){var n=e.placeholder,t=e.request,r=e.columns,i=e.leftTitle,o=e.tableProps,h=e.showSearch,g=void 0===h||h,k=e.dataSource,j=e.searchWidth,b=e.rightTitle,w=void 0===b?[]:b,C=e.refreshDeps,_=e.actionRef,S=e.hideTitle,L=(0,d.T)(_),P=(0,x.useState)(""),T=s()(P,2),B=T[0],R=T[1],F=(0,x.useRef)(""),N=(0,p.Z)((function(){var e,n;null===(e=L.current)||void 0===e||null===(n=e.reloadAndRest)||void 0===n||n.call(e)}),{wait:500}).run;return(0,f.Z)((function(){var e;null===(e=L.current)||void 0===e||e.reload()}),C||[]),(0,y.jsx)(u.Z,l()({className:v()((""===i||void 0===i)&&Z),actionRef:L,headerTitle:i,dataSource:k,search:!1,columns:r,request:t&&function(e){return t(l()(l()({},e),{},{keyword:F.current}))},pagination:{showSizeChanger:!0},options:{reload:!!t},toolBarRender:!S&&function(){return[].concat(a()(w),a()(g?[(0,y.jsx)(m.Z,{style:{width:null!=j?j:300},value:B,placeholder:n,onChange:function(e){R(e.target.value),F.current=e.target.value,N()},allowClear:!0,suffix:(0,y.jsx)(c.Z,{style:{color:"#918f8f"}})},"__search__input")]:[]))}},o))}},7253:function(e,n,t){t.d(n,{Z:function(){return u}});var r=t(26068),a=t.n(r),i=t(67825),l=t.n(i),o=(t(50959),"disabled___nnQy2"),s=t(11527),c=["disabled","children","onClick","className"],u=function(e){var n=e.disabled,t=e.children,r=e.onClick,i=e.className,u=void 0===i?"":i,d=l()(e,c);return(0,s.jsx)("a",a()(a()({className:n?o+" "+u:u,onClick:function(){n||null==r||r()}},d),{},{children:t}))}},60125:function(e,n,t){t.d(n,{T:function(){return a}});var r=t(50959),a=function(e,n){var t=(0,r.useRef)(n);return e||t}},58082:function(e,n,t){t.d(n,{J:function(){return i}});var r=t(32030),a=t(50959),i=function(){var e=(0,r.useNavigate)();return(0,a.useCallback)((function(n){n&&e(n),e("/refresh"),setTimeout((function(){e(-1)}),0)}),[e])}},60830:function(e,n,t){t.r(n);var r=t(90228),a=t.n(r),i=t(87999),l=t.n(i),o=t(48305),s=t.n(o),c=t(30813),u=t(52525),d=t(69346),p=t(7253),f=t(40191),m=t(44908),h=t(32030),v=t(16639),x=t(35028),Z=t(59614),y=t(26059),g=t(88934),k=t(80699),j=t(97628),b=t(50959),w=t(11527);n.default=function(){var e=(0,h.useParams)().clusterName,n=v.Z.useForm(),t=s()(n,1)[0],r=(0,b.useState)(),i=s()(r,2),o=i[0],C=i[1],_=(0,b.useRef)(),S=function(){C(void 0),t.resetFields()};return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(m.Z,{items:[{title:"命名空间"}],clusterName:e,sourceType:"namespace",switchCluster:!0}),(0,w.jsx)("div",{className:f.Z.block,children:(0,w.jsx)(d.Z,{actionRef:_,placeholder:"模糊搜索命名空间名称、备注",leftTitle:(0,w.jsx)(x.ZP,{type:"primary",onClick:function(){C("add"),t.resetFields()},children:"新建命名空间"}),refreshDeps:[e],request:function(){var n=l()(a()().mark((function n(t){var r;return a()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,u.V)({keyword:t.keyword,page:t.current,page_size:t.pageSize,cluster_name:e});case 2:return r=n.sent,n.abrupt("return",{total:r.total,data:r.list});case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),columns:[{title:"名称",dataIndex:"name",render:function(n,t){return(0,w.jsx)(h.Link,{to:"/cluster/".concat(e,"/namespace/").concat(t.name),children:n})},minWidth:200,ellipsis:!0},{title:"状态",dataIndex:"state",render:function(e){return(0,w.jsx)("span",{style:{color:"Active"===e?"#52C41A":""},children:e})},minWidth:160},{title:"创建时间",dataIndex:"create_time",minWidth:200},{title:"备注",dataIndex:"description",render:function(e){return e||"-"},minWidth:200,ellipsis:!0},{title:"操作",minWidth:80,dataIndex:"operation",render:function(n,r){return(0,w.jsxs)(Z.Z,{children:[(0,w.jsx)("a",{onClick:function(){var e,n;e=r.name,n=r.description,C("edit"),t.setFieldsValue({name:e,description:n||""})},children:"编辑"}),(0,w.jsx)(y.Z,{title:r.is_default?"不可删除默认命名空间":"",children:(0,w.jsx)(p.Z,{disabled:r.is_default,onClick:function(){var n=g.Z.confirm({title:"删除命名空间",content:(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)("p",{children:["确认删除命名空间【",r.name,"】"]}),(0,w.jsx)("p",{style:{color:"#FF4D4F"},children:"删除命名空间将销毁该命名空间下的所有资源，销毁后不可恢复，请谨慎操作。"}),(0,w.jsx)(k.Z,{placeholder:"请输入命名空间名称",onChange:function(e){e.target.value===r.name?n.update({okButtonProps:{disabled:!1}}):n.update({okButtonProps:{disabled:!0}})}})]}),okButtonProps:{disabled:!0},onOk:function(){(0,c.u1)({cluster_name:e,name:r.name}).then((function(){var e,n;j.ZP.success("删除成功"),null===(e=_.current)||void 0===e||null===(n=e.reset)||void 0===n||n.call(e)}))}})},children:"删除"})})]})}}]})}),(0,w.jsx)(g.Z,{title:"add"===o?"新建命名空间":"编辑命名空间",open:!!o,onCancel:function(){S()},onOk:function(){t.validateFields().then((function(n){"add"===o?(0,c.N3)({name:n.name,description:n.description,cluster_name:e}).then((function(){var e,n;j.ZP.success("创建命名空间成功"),null===(e=_.current)||void 0===e||null===(n=e.reset)||void 0===n||n.call(e),S()})).catch((function(e){j.ZP.error(e.message)})):"edit"===o&&(0,c.Nq)({cluster_name:e,name:n.name,description:n.description}).then((function(){var e;j.ZP.success("编辑命名空间成功"),null===(e=_.current)||void 0===e||e.reload(),S()})).catch((function(e){j.ZP.error(e.message)}))}))},width:800,children:(0,w.jsxs)(v.Z,{labelCol:{span:2},wrapperCol:{span:22},form:t,style:{marginTop:30},children:[(0,w.jsx)(v.Z.Item,{label:"名称",required:!0,name:"name",rules:[{required:!0,message:"请输入集群名称"},{max:63,message:"名称最大63字符"},{pattern:/^[a-z](?:[a-z0-9-]*[a-z0-9])?$/,message:'只能包含小写字母、数字及分隔符("-")，且必须以小写字母开头，数字或小写字母结尾'}],children:(0,w.jsx)(k.Z,{disabled:"edit"===o,placeholder:'最长63个字符，只能包含小写字母、数字及分隔符("-")，且必须以小写字母开头，数字或小写字母结尾'})}),(0,w.jsx)(v.Z.Item,{label:"备注",name:"description",rules:[{max:1e3,message:"备注最大1000字符"}],children:(0,w.jsx)(k.Z.TextArea,{placeholder:"请输入备注，不超过1000字符",rows:4})})]})})]})}},44908:function(e,n,t){var r=t(15558),a=t.n(r),i=t(48305),l=t.n(i),o=t(30813),s=t(58082),c=t(29882),u=t(32030),d=t(8096),p=t(33587),f=t(20811),m=t(51142),h=t(2918),v=t(30766),x=t(80699),Z=t(59614),y=t(35028),g=t(50959),k=t(84609),j=t(11527),b=f.Z.useToken;n.Z=function(e){var n=e.clusterName,t=e.items,r=e.sourceType,i=e.switchCluster,f=(0,g.useState)(""),w=l()(f,2),C=w[0],_=w[1],S=(0,g.useState)([]),L=l()(S,2),P=L[0],T=L[1],B=(0,p.Z)(!1),R=l()(B,2),F=R[0],N=R[1],Y=N.setFalse,q=N.setTrue,A=b().token,O=(0,s.J)(),U=(0,u.useLocation)(),I={backgroundColor:A.colorBgElevated,borderRadius:A.borderRadiusLG,boxShadow:A.boxShadowSecondary},M={boxShadow:"none"},W=(0,g.useMemo)((function(){return P.filter((function(e){return""===e||e.toLowerCase().indexOf(C.toLowerCase())>-1})).map((function(e){return{key:e,label:(0,j.jsx)("a",{onClick:function(){var n=U.pathname.split("/");i?(n[2]=e,O(n.join("/"))):O("/cluster/".concat(e,"/namespace"))},children:e})}}))}),[C,P,i]);return(0,g.useEffect)((function(){(0,o.LB)({list_all:"1"}).then((function(e){var n;T((null===(n=e.list)||void 0===n?void 0:n.map((function(e){return e.name})))||[])}))}),[]),(0,j.jsxs)("div",{className:k.Z.block,children:[(0,j.jsxs)(m.Z,{justify:"space-between",align:"center",children:[(0,j.jsx)(h.Z,{items:[{title:(0,j.jsx)(u.Link,{to:"/cluster-list",children:"集群列表"})},{title:(0,j.jsx)(v.Z,{dropdownRender:function(e){return(0,j.jsxs)("div",{style:I,children:[(0,j.jsx)("div",{style:{padding:8},children:(0,j.jsx)(x.Z,{style:{width:"100%"},placeholder:"请输入集群名称",value:C,onChange:function(e){return _(e.target.value)}})}),g.cloneElement(e,{style:M})]})},menu:{items:W},children:(0,j.jsxs)(Z.Z,{children:["集群名称: ",n,(0,j.jsx)(d.Z,{})]})})}].concat(a()(t||[]))}),(0,j.jsx)(y.ZP,{type:"primary",onClick:function(){q()},children:"YAML创建资源"})]}),F&&(0,j.jsx)(c.Z,{clusterName:n,onCancel:function(){Y()},sourceType:r})]})}},29882:function(e,n,t){var r=t(48305),a=t.n(r),i=t(26068),l=t.n(i),o=t(30813),s=t(30433),c=t(31906),u=t(88934),d=t(97628),p=t(35028),f=t(81861),m=t(32699),h=t.n(m),v=t(50959),x=t(11527),Z=l()({node:o.wB,namespace:o.B8,hpa:o.F_},h().mapValues(s.J,(function(e){return e.createOrUpdateByYaml})));n.Z=function(e){var n=e.onCancel,t=e.onOk,r=e.clusterName,i=e.defaultValue,l=e.readonly,o=e.sourceType,s=(0,v.useState)(i||""),m=a()(s,2),h=m[0],y=m[1];return(0,x.jsxs)(u.Z,{title:"YAML创建资源",open:!0,style:{top:20},onCancel:n,okButtonProps:l?{style:{display:"none"}}:{},onOk:function(){h?o?Z[o]({yaml:h,cluster_name:r}).then((function(){null==n||n(),null==t||t(h),d.ZP.success("YAML创建资源成功")})).catch((function(e){d.ZP.error(e.reason)})):null==t||t(h):d.ZP.warning("请输入YAML")},width:"80vw",children:[(0,x.jsx)(c.ZP,{theme:"vs-dark",language:"yaml",value:h,onChange:function(e){y(e||"")},height:"75vh",options:{minimap:{enabled:!1},fontSize:14,wordWrap:"on",scrollBeyondLastLine:!1}}),(0,x.jsx)("div",{style:{position:"relative",height:0},children:l?(0,x.jsx)(p.ZP,{type:"primary",style:{position:"absolute",top:12},ghost:!0,onClick:function(){navigator.clipboard.writeText(h).then((function(){d.ZP.success("复制成功")}))},children:"复制"}):(0,x.jsx)(f.Z,{beforeUpload:function(e){var n=new FileReader;return n.readAsText(e),n.onload=function(e){var n,t=null===(n=e.target)||void 0===n?void 0:n.result;t&&y(t)},!1},accept:".yaml",showUploadList:!1,children:(0,x.jsx)(p.ZP,{type:"primary",onClick:function(){},style:{position:"absolute",top:12},children:"导入YAML"})})})]})}},30433:function(e,n,t){t.d(n,{J:function(){return a}});var r=t(30813),a={deployment:{detail:r.Ke,createOrUpdateByYaml:r.ek,replicasetList:r.hX,rollback:r.KZ,delete:r.Ax,restart:r.$l,scale:r.po,scaleStream:void 0,upgradeStrategy:void 0},"clone-set":{detail:r.iP,createOrUpdateByYaml:r.WX,replicasetList:r.qr,rollback:r.nV,delete:r.VE,restart:r.pk,scale:r.YM,scaleStream:r.kd,upgradeStrategy:r.S8},"game-server-set":{detail:r.dq,createOrUpdateByYaml:r.q4,replicasetList:r.lr,rollback:r.MC,delete:r.L5,restart:r._U,scale:r.lq,scaleStream:r.b_,upgradeStrategy:r.ZG},"stateful-set":{detail:r.dd,createOrUpdateByYaml:r.Iu,replicasetList:r.tR,rollback:r.Cq,delete:r.iU,restart:r.R,scale:r.K9,scaleStream:void 0,upgradeStrategy:void 0},"daemon-set":{detail:r.x2,createOrUpdateByYaml:r.D7,replicasetList:r.Xi,rollback:r.ti,delete:r.JY,restart:r.Bw,scale:r.Xx,scaleStream:void 0,upgradeStrategy:void 0}}},40191:function(e,n){n.Z={block:"block___QmcSu"}},84609:function(e,n){n.Z={block:"block___a01xI"}},10534:function(e,n,t){var r=t(99938),a=t(66292),i=t.n(a),l=t(50959),o=t(53270),s=t(77924),c=t(25492),u=t(80785);n.Z=function(e,n){var t;u.Z&&((0,c.mf)(e)||console.error("useDebounceFn expected parameter is a function, got ".concat(typeof e)));var a=(0,o.Z)(e),d=null!==(t=null==n?void 0:n.wait)&&void 0!==t?t:1e3,p=(0,l.useMemo)((function(){return i()((function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return a.current.apply(a,(0,r.ev)([],(0,r.CR)(e),!1))}),d,n)}),[]);return(0,s.Z)((function(){p.cancel()})),{run:p,cancel:p.cancel,flush:p.flush}}}}]);