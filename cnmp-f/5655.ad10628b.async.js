"use strict";(self.webpackChunkcnmp=self.webpackChunkcnmp||[]).push([[5655],{64059:function(e,n,t){var r=t(48305),i=t.n(r),a=t(81798),s=t(62193),o=t(3885),u=t(99790),c=t(69180),l=t(70334),d=t(69005),f=t(3827),h=t(91894),m=t(15268),p=t(38218),x=t(50959),v=t(11527);n.Z=function(e){var n=e.onRefresh,t=e.defaultContent,r=e.editorHeight,y=void 0===r?300:r,Z=e.disabledEdit,j=(0,x.useState)(!1),g=i()(j,2),k=g[0],w=g[1],_=(0,x.useState)(t),b=i()(_,2),C=b[0],P=b[1],S=(0,x.useState)(t),I=i()(S,2),N=I[0],R=I[1],T=(0,x.useState)(!1),F=i()(T,2),M=F[0],Y=F[1],A=(0,x.useState)(!1),D=i()(A,2),q=D[0],L=D[1],V=(0,p.useParams)().clusterName,z=void 0===V?"":V,O=(0,x.useState)("edit"),E=i()(O,2),H=E[0],U=E[1];return(0,x.useEffect)((function(){k&&Y(!0)}),[k]),(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)(s.Z,{justify:"space-between",children:["edit"===H?(0,v.jsxs)(o.Z,{children:[k?(0,v.jsx)(u.Z,{beforeUpload:function(e){var n=new FileReader;return n.readAsText(e),n.onload=function(e){var n,t=null===(n=e.target)||void 0===n?void 0:n.result;t&&R(t)},!1},accept:".yaml,.yml",showUploadList:!1,children:(0,v.jsx)(c.ZP,{type:"primary",children:"导入YAML"})}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(c.ZP,{type:"primary",onClick:function(){w(!0)},disabled:Z,children:"编辑YAML"}),(0,v.jsx)(c.ZP,{onClick:function(){navigator.clipboard.writeText(N).then((function(){l.ZP.success("复制成功")}))},children:"复制"}),(0,v.jsx)(c.ZP,{onClick:function(){null==n||n().then((function(e){P(e),l.ZP.success("刷新成功")}))},children:"刷新"})]}),(0,v.jsx)(d.Z,{checked:M,onChange:function(e){Y(e.target.checked)},children:"精简字段"}),M&&(0,v.jsx)(d.Z,{checked:q,onChange:function(e){L(e.target.checked)},children:"隐藏status字段"})]}):(0,v.jsx)("div",{}),k&&(0,v.jsxs)(o.Z,{children:[(0,v.jsx)(c.ZP,{onClick:function(){w(!1),R(C),U("edit")},children:"取消"}),(0,v.jsx)(c.ZP,{onClick:function(){N?"edit"!==H?(0,m.e7)({yaml:N,cluster_name:z}).then((function(e){f.Z.confirm({title:"确认更新",width:800,content:e.success?(0,v.jsx)(h.Z,{message:"检查通过，点击‘应用’执行变更",type:"success",showIcon:!0}):(0,v.jsx)(h.Z,{message:"检查未通过",type:"error",description:e.message,showIcon:!0}),okText:"应用",onOk:function(){(0,m.aA)({yaml:N,cluster_name:z}).then((function(){P(N),w(!1),U("edit"),l.ZP.success("编辑成功")})).catch((function(e){l.ZP.error(e.reason)}))}})})):U("diff"):l.ZP.warning("请输入YAML")},children:"确定"})]})]}),(0,v.jsx)("div",{style:{marginTop:20},children:(0,v.jsx)(a.Z,{readOnly:!k,simplify:M,hideStatus:q,originalValue:C,value:N,onChange:function(e){R(e||"")},diff:"diff"===H,height:y})})]})}},27274:function(e,n,t){t.d(n,{Z:function(){return y}});var r=t(15558),i=t.n(r),a=t(26068),s=t.n(a),o=t(48305),u=t.n(o),c=t(45778),l=t(95974),d=t(41710),f=t(10534),h=t(65460),m=t(96286),p=t(50959),x="table___Rup7Y",v=t(11527),y=function(e){var n=e.placeholder,t=e.request,r=e.columns,a=e.leftTitle,o=e.tableProps,y=e.showSearch,Z=void 0===y||y,j=e.dataSource,g=e.searchWidth,k=e.rightTitle,w=void 0===k?[]:k,_=e.refreshDeps,b=e.actionRef,C=e.hideTitle,P=e.searchStyle,S=e.onSearch,I=(0,c.T)(b),N=(0,p.useState)(""),R=u()(N,2),T=R[0],F=R[1],M=(0,p.useRef)(""),Y=(0,f.Z)((function(){var e,n;null==S||S(T),null===(e=I.current)||void 0===e||null===(n=e.reloadAndRest)||void 0===n||n.call(e)}),{wait:500}).run;return(0,h.Z)((function(){var e;null===(e=I.current)||void 0===e||e.reload()}),_||[]),(0,v.jsx)(d.Z,s()({className:x,actionRef:I,headerTitle:a,dataSource:j,search:!1,columns:r,request:t&&function(e){return t(s()(s()({},e),{},{keyword:M.current}))},pagination:{showSizeChanger:!0,defaultPageSize:50},options:{reload:!!t},toolBarRender:!C&&function(){return[].concat(i()(w),i()(Z?[(0,v.jsx)(m.Z,{style:s()({width:null!=g?g:300},P),value:T,placeholder:n,onChange:function(e){F(e.target.value),M.current=e.target.value,Y()},allowClear:!0,suffix:(0,v.jsx)(l.Z,{style:{color:"#918f8f"}})},"__search__input")]:[]))}},o))}},45778:function(e,n,t){t.d(n,{T:function(){return i}});var r=t(50959),i=function(e,n){var t=(0,r.useRef)(n);return e||t}},29762:function(e,n,t){t.d(n,{Z:function(){return y}});var r=t(48305),i=t.n(r),a=t(36954),s=t(38218),o=t(36241),u=t(21630),c=t(62193),l=t(3885),d=t(97536),f=t(69180),h=t(50959),m="title___qEjyg",p="name___p26Np",x="dropdown___unIV5",v=t(11527),y=function(e){var n=u.Z.useForm(),t=i()(n,1)[0],r=(0,h.useState)(!1),y=i()(r,2),Z=y[0],j=y[1],g=(0,h.useState)(!1),k=i()(g,2),w=k[0],_=k[1],b=(0,s.useParams)().clusterName,C=void 0===b?"":b,P=e.title,S=e.formInitialValues,I=e.onDelete,N=e.refresh,R=e.operationRender,T=e.onRestart,F=e.editRender,M=e.yaml,Y=e.name,A=(0,h.useMemo)((function(){var e=[];return void 0!==M&&e.push({label:"编辑yaml",key:"edit-yaml"}),F&&e.push({label:"编辑",key:"edit"}),T&&e.push({label:"重启",key:"restart"}),I&&e.push({label:"删除",key:"delete"}),e}),[M,P,Y,C,N,I,T]);return(0,v.jsxs)("div",{className:m,children:[(0,v.jsxs)(c.Z,{justify:"space-between",children:[(0,v.jsxs)(l.Z,{children:[(0,v.jsx)("span",{className:p,children:P}),(0,v.jsx)(l.Z,{children:R&&R()})]}),A.length>0&&(0,v.jsx)(d.Z,{overlayClassName:x,menu:{items:A,onClick:function(e){if("delete"!==e.key)return"edit"===e.key?(j(!0),void t.setFieldsValue(S||{})):void("restart"!==e.key?"edit-yaml"!==e.key||_(!0):null==T||T());null==I||I()}},children:(0,v.jsx)(f.ZP,{style:{padding:"4px 8px"},children:(0,v.jsx)(o.Z,{})})})]}),F&&F({title:P,form:t,open:Z,onClose:function(){j(!1)},onOk:function(){j(!1),null==N||N()},type:"edit"}),w&&(0,v.jsx)(a.Z,{title:"【".concat(P,"-").concat(Y,"】编辑Yaml"),defaultValue:M,clusterName:C,onCancel:function(){_(!1),null==N||N()}})]})}},43162:function(e,n,t){var r=t(90228),i=t.n(r),a=t(87999),s=t.n(a),o=t(15268),u=t(27274),c=t(56765),l=t(38218),d=t(91894),f=(t(50959),t(11527));n.Z=function(e){var n=(0,l.useParams)(),t=n.clusterName,r=void 0===t?"":t,a=n.namespace,h=void 0===a?"":a,m=e.name,p=e.type,x=e.leftTitle;return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(d.Z,{message:"只展示最近 1 小时内发生的事件信息，请及时查看。",type:"info",showIcon:!0,style:{margin:"0 20px"}}),(0,f.jsx)(u.Z,{request:function(){var e=s()(i()().mark((function e(n){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,o.LO)({cluster_name:r,controller_name:m,namespace:h,keyword:n.keyword,page:n.current,page_size:n.pageSize,controller_type:p});case 2:return t=e.sent,e.abrupt("return",{data:t.list||[],total:t.total||0});case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),tableProps:{scroll:{x:1e3}},columns:[{title:"首次出现时间",dataIndex:"first_time_stamp",width:160,render:c.kZ},{title:"最近出现时间",dataIndex:"last_time_stamp",width:160,render:c.kZ},{title:"事件等级",dataIndex:"type",width:120,render:function(e){return(0,f.jsx)("span",{style:{color:"Warning"===e?"#FF4D4F":""},children:e})}},{title:"资源类型",dataIndex:"involved_object_kind",width:120},{title:"资源名称",dataIndex:"involved_object_name",width:160,ellipsis:!0},{title:"内容",dataIndex:"reason",width:200,ellipsis:!0},{title:"消息",dataIndex:"message",width:300,ellipsis:!0},{title:"出现次数",dataIndex:"count",width:120}],leftTitle:x})]})}},56765:function(e,n,t){t.d(n,{jp:function(){return u},kZ:function(){return l},yq:function(){return c}});var r=t(5726),i=t.n(r),a=t(11110),s=t.n(a);i().extend(s());var o=function(e){var n=(Date.now()-e)/1e3;return n<60?{duration:n,unit:"second"}:n<3600?{duration:Math.floor(n/60),unit:"minute"}:n<86400?{duration:Math.floor(n/3600),unit:"hour"}:{duration:Math.floor(n/86400),unit:"day"}},u=function(e){if(void 0===e)return"";var n=o(e);return"second"===n.unit?"1分钟内":"".concat(n.duration," ").concat({second:"秒",minute:"分钟",hour:"小时",day:"天"}[n.unit],"前")},c=function(e){var n=o(e);return"second"===n.unit?"1分钟内":"约".concat(n.duration).concat({second:"秒",minute:"分钟",hour:"小时",day:"天"}[n.unit])},l=function(e){return isNaN(Number(e))?e:i()(Number(e)).format("YYYY-MM-DD HH:mm:ss")}}}]);