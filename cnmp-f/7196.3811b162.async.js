(self.webpackChunkcnmp=self.webpackChunkcnmp||[]).push([[7196],{59999:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(79482),i=n(50959),l={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64c247.4 0 448 200.6 448 448S759.4 960 512 960 64 759.4 64 512 264.6 64 512 64zm0 76c-205.4 0-372 166.6-372 372s166.6 372 372 372 372-166.6 372-372-166.6-372-372-372zm128.01 198.83c.03 0 .05.01.09.06l45.02 45.01a.2.2 0 01.05.09.12.12 0 010 .07c0 .02-.01.04-.05.08L557.25 512l127.87 127.86a.27.27 0 01.05.06v.02a.12.12 0 010 .07c0 .03-.01.05-.05.09l-45.02 45.02a.2.2 0 01-.09.05.12.12 0 01-.07 0c-.02 0-.04-.01-.08-.05L512 557.25 384.14 685.12c-.04.04-.06.05-.08.05a.12.12 0 01-.07 0c-.03 0-.05-.01-.09-.05l-45.02-45.02a.2.2 0 01-.05-.09.12.12 0 010-.07c0-.02.01-.04.06-.08L466.75 512 338.88 384.14a.27.27 0 01-.05-.06l-.01-.02a.12.12 0 010-.07c0-.03.01-.05.05-.09l45.02-45.02a.2.2 0 01.09-.05.12.12 0 01.07 0c.02 0 .04.01.08.06L512 466.75l127.86-127.86c.04-.05.06-.06.08-.06a.12.12 0 01.07 0z"}}]},name:"close-circle",theme:"outlined"},o=n(28371),a=function(e,t){return i.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:l}))};var s=i.forwardRef(a)},66780:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(79482),i=n(50959),l={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zM704 536c0 4.4-3.6 8-8 8H544v152c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V544H328c-4.4 0-8-3.6-8-8v-48c0-4.4 3.6-8 8-8h152V328c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v152h152c4.4 0 8 3.6 8 8v48z"}}]},name:"plus-square",theme:"filled"},o=n(28371),a=function(e,t){return i.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:l}))};var s=i.forwardRef(a)},37610:function(e,t,n){"use strict";var r=n(48305),i=n.n(r),l=n(22927),o=n(66780),a=n(21630),s=n(75929),u=n(62193),c=n(3885),d=n(14621),f=n(32699),h=n.n(f),m=n(50959),v=n(11527);t.Z=function(e){var t=e.operationProps,n=e.label,r=e.name,f=e.fieldRender,p=e.labelCol,x=e.itemMax,g=e.addText,j=e.showSwitch,Z=e.minItem,b=(0,m.useState)(!0),y=i()(b,2),k=y[0],C=y[1],w=a.Z.useFormInstance(),_=(0,m.useRef)();return(0,m.useEffect)((function(){if(j){var e=w.getFieldValue([r]);C(!(!e||h().isEmpty(e)))}}),[w,j,r]),(0,v.jsx)(v.Fragment,{children:(0,v.jsxs)(a.Z.Item,{labelCol:p,label:n,children:[j&&(0,v.jsx)("div",{style:{height:32,display:"flex",alignItems:"center",marginBottom:k?10:0},children:(0,v.jsx)(s.Z,{value:k,onChange:function(e){C(e),e?_.current?w.setFieldValue([r],_.current):w.setFieldValue([r],[{type:"default"}]):(_.current=w.getFieldValue([r]),w.setFieldValue([r],[]))}})}),k&&(0,v.jsx)(a.Z.List,{name:r,children:function(e,n){return(0,v.jsxs)(v.Fragment,{children:[e.map((function(t,r){return(0,v.jsxs)(u.Z,{gap:16,children:[f(t,r,n),(!Z||Z<e.length)&&(0,v.jsx)(l.Z,{style:{display:"flex",alignSelf:"baseline",paddingTop:10},onClick:function(){n.remove(t.name)}})]},t.key)})),(0,v.jsx)("div",{children:(0,v.jsx)(d.Z,{disabled:!!x&&e.length>=x,onClick:function(){var e;n.add(null==t||null===(e=t.add)||void 0===e?void 0:e.defaultValue)},children:(0,v.jsxs)(c.Z,{children:[(0,v.jsx)(o.Z,{style:{fontSize:20,verticalAlign:"text-bottom"}}),null!=g?g:"添加"]})})})]})}})]})})}},13885:function(e,t,n){"use strict";var r=n(26068),i=n.n(r),l=n(15558),o=n.n(l),a=n(21630),s=n(96286),u=n(37610),c=n(32699),d=n.n(c),f=(n(50959),n(11527)),h=function(e,t,n,r){var i=r||{},l=i.repeat,a=i.required,s=i.rules;return[].concat(o()(a?[{required:!0,message:"string"==typeof a?a:"请输入"}]:[]),o()(l?[]:[{validator:function(r,i){return(t.getFieldValue(n[0])||[]).some((function(t,r){return!d().isNil(null==t?void 0:t[n[1]])&&t[n[1]]===i&&e!==r}))?Promise.reject(new Error("string"==typeof l?l:"存在重复值，请修改")):Promise.resolve()}}]),o()(s||[]))};t.Z=function(e){var t=e.keyOption,n=void 0===t?{}:t,r=e.valueOption,l=void 0===r?{}:r,o=e.placeholder,c=e.label,d=e.name,m=e.keyRules,v=e.valueRules,p=e.addText,x=a.Z.useFormInstance();return(0,f.jsx)(u.Z,{label:c,name:d,addText:p,fieldRender:function(e,t){var r,u;return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(a.Z.Item,{name:[e.name,"key"],rules:h(t,x,[d,"key"],i()({required:!0,repeat:!1,rules:[]},n))||(null==m?void 0:m(t))||[],style:{width:"100%"},children:(0,f.jsx)(s.Z,{placeholder:null!==(r=null==o?void 0:o[0])&&void 0!==r?r:"请输入键"})}),(0,f.jsx)(a.Z.Item,{name:[e.name,"value"],rules:h(t,x,[d,"value"],i()({required:!1,repeat:!0,rules:[]},l))||(null==v?void 0:v(t))||[],style:{width:"100%"},children:(0,f.jsx)(s.Z,{placeholder:null!==(u=null==o?void 0:o[1])&&void 0!==u?u:"请输入值"})})]})}})}},27274:function(e,t,n){"use strict";n.d(t,{Z:function(){return g}});var r=n(15558),i=n.n(r),l=n(26068),o=n.n(l),a=n(48305),s=n.n(a),u=n(45778),c=n(95974),d=n(41710),f=n(10534),h=n(65460),m=n(96286),v=n(50959),p="table___Rup7Y",x=n(11527),g=function(e){var t=e.placeholder,n=e.request,r=e.columns,l=e.leftTitle,a=e.tableProps,g=e.showSearch,j=void 0===g||g,Z=e.dataSource,b=e.searchWidth,y=e.rightTitle,k=void 0===y?[]:y,C=e.refreshDeps,w=e.actionRef,_=e.hideTitle,I=e.searchStyle,S=e.onSearch,F=(0,u.T)(w),$=(0,v.useState)(""),P=s()($,2),D=P[0],T=P[1],M=(0,v.useRef)(""),N=(0,f.Z)((function(){var e,t;null==S||S(D),null===(e=F.current)||void 0===e||null===(t=e.reloadAndRest)||void 0===t||t.call(e)}),{wait:500}).run;return(0,h.Z)((function(){var e;null===(e=F.current)||void 0===e||e.reload()}),C||[]),(0,x.jsx)(d.Z,o()({className:p,actionRef:F,headerTitle:l,dataSource:Z,search:!1,columns:r,request:n&&function(e){return n(o()(o()({},e),{},{keyword:M.current}))},pagination:{showSizeChanger:!0,defaultPageSize:50},options:{reload:!!n},toolBarRender:!_&&function(){return[].concat(i()(k),i()(j?[(0,x.jsx)(m.Z,{style:o()({width:null!=b?b:300},I),value:D,placeholder:t,onChange:function(e){T(e.target.value),M.current=e.target.value,N()},allowClear:!0,suffix:(0,x.jsx)(c.Z,{style:{color:"#918f8f"}})},"__search__input")]:[]))}},a))}},14621:function(e,t,n){"use strict";n.d(t,{Z:function(){return c}});var r=n(26068),i=n.n(r),l=n(67825),o=n.n(l),a=(n(50959),"disabled___nnQy2"),s=n(11527),u=["disabled","children","onClick","className"],c=function(e){var t=e.disabled,n=e.children,r=e.onClick,l=e.className,c=void 0===l?"":l,d=o()(e,u);return(0,s.jsx)("a",i()(i()({className:t?a+" "+c:c,onClick:function(){t||null==r||r()}},d),{},{children:n}))}},45778:function(e,t,n){"use strict";n.d(t,{T:function(){return i}});var r=n(50959),i=function(e,t){var n=(0,r.useRef)(t);return e||n}},27196:function(e,t,n){"use strict";n.d(t,{Z:function(){return ue}});var r=n(26068),i=n.n(r),l=n(15558),o=n.n(l),a=n(90228),s=n.n(a),u=n(87999),c=n.n(u),d=n(48305),f=n.n(d),h=n(67825),m=n.n(h),v=n(25298),p=n.n(v),x=n(17069),g=n.n(x),j=n(82092),Z=n.n(j),b=n(15268),y=n(13885),k=n(27274),C=n(34015),w=n(35754),_=n(56765),I=n(38218),S=n(56260),F=n(59999),$=n(21374),P=n(50643),D=n(32643),T=n(47212),M=n(62193),N=n(4561),O=n(51327),q=n(70334),A=n(3885),R=n(89169),U=n(67813),V=n(21630),H=n(3827),B=n(91894),E=n(96286),K=n(69180),L=n(93441),Y=n(18772),z=n(13702),W=n(80487),G=n(32699),X=n.n(G),J=n(36741),Q=n(50959),ee="ellipsis-text___uYXM_",te="comment___kKz5f",ne="follow___EsJHj",re=n(11527),ie=["showAll","leftTitle","dataSource","request","operationAble","showFollow"],le=(J.editor.IContentWidget,J.editor.ICodeEditor,{ClusterReady:{label:"运行中",color:"#52C41A",icon:(0,re.jsx)(S.Z,{})},ClusterError:{label:"异常",color:"#FF4D4F",icon:(0,re.jsx)(F.Z,{})},ClusterOffline:{label:"离线",color:"#AAAAAA",icon:(0,re.jsx)($.Z,{})}}),oe={Healthy:{label:"健康",color:"green"},MemoryUsageHigh:{label:"内存使用量过80%",color:"red"},APIServerUnHealthy:{label:"离线",color:"red"},CpuUsageHigh:{label:"CPU使用量过80%",color:"red"},DiskUsageHigh:{label:"磁盘使用量过80%",color:"red"},NetworkIOHigh:{label:"网络IO过高",color:"red"},NodeNotReady:{label:"节点状态异常",color:"red"},SchedulerUnhealthy:{label:"调度器异常",color:"red"},ControllerManagerUnhealthy:{label:"控制器管理器异常",color:"red"},EtcdUnhealthy:{label:"存储异常",color:"red"}},ae=function(e){var t,n,r=W.ZP.load(e||"");return{api_server:null==r||null===(t=r.clusters)||void 0===t||null===(t=t[0])||void 0===t||null===(t=t.cluster)||void 0===t?void 0:t.server,contexts:null==r||null===(n=r.contexts)||void 0===n?void 0:n.map((function(e){var t;return null==e||null===(t=e.context)||void 0===t?void 0:t.cluster})).filter((function(e){return void 0!==e}))}},se=function(){function e(t,n,r){var i=this;p()(this,e),Z()(this,"domNode",void 0),this.placeholder=t,this.editor=n,this.monaco=r,n.onDidChangeModelContent((function(){return i.onDidChangeModelContent()})),this.onDidChangeModelContent()}return g()(e,[{key:"onDidChangeModelContent",value:function(){""===this.editor.getValue()?this.editor.addContentWidget(this):this.editor.removeContentWidget(this)}},{key:"getId",value:function(){return e.ID}},{key:"getDomNode",value:function(){return this.domNode||(this.domNode=document.createElement("div"),this.domNode.setAttribute("class","placeholder-content-widget"),this.domNode.style.width="max-content",this.domNode.style.whiteSpace="pre-wrap",this.domNode.style.pointerEvents="none",this.domNode.textContent=this.placeholder,this.editor.applyFontInfo(this.domNode)),this.domNode}},{key:"getPosition",value:function(){return{position:{lineNumber:1,column:1},preference:[this.monaco.editor.ContentWidgetPositionPreference.EXACT]}}},{key:"dispose",value:function(){this.editor.removeContentWidget(this)}}]),e}();Z()(se,"ID","editor.widget.placeholderHint");var ue=function(e){var t=e.showAll,n=e.leftTitle,r=e.dataSource,l=e.request,a=e.operationAble,u=void 0!==a&&a,d=e.showFollow,h=void 0===d||d,v=m()(e,ie),p=(0,Q.useRef)(null),x=V.Z.useForm(),g=f()(x,1)[0],j=(0,I.useNavigate)(),Z=V.Z.useWatch("connect_type",g),S=(0,Q.useState)([]),F=f()(S,2),$=F[0],W=F[1],G=(0,Q.useState)(!1),J=f()(G,2),ue=J[0],ce=J[1],de=(0,Q.useState)(),fe=f()(de,2),he=fe[0],me=fe[1],ve=(0,T.Z)((function(){return(0,b.wn)({list_all:1}).then((function(e){return e.list}))})).data,pe=(0,T.Z)((function(){return(0,b.Cz)({list_all:1}).then((function(e){var t;return(null===(t=e.list)||void 0===t?void 0:t.map((function(e){return{value:e.id,label:e.name}})))||[]}))})).data,xe=function(){var e=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=3;break}return q.ZP.warning("IDIP地址为空，请输入"),e.abrupt("return");case 3:return e.next=5,(0,b.KO)({idip:t});case 5:q.ZP.success("测试连接成功");case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ge=function(){var e=c()(s()().mark((function e(t,n){var r,i,l,o,a;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,b.X)({id:t});case 2:r=e.sent,i=r.kube_config||"",l=new Blob([i],{type:"text/plain;charset=utf-8"}),o=URL.createObjectURL(l),(a=document.createElement("a")).href=o,a.download="".concat(n,".kubeconfig"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(o);case 13:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),je=(0,Q.useMemo)((function(){var e,t=(e={follow:h,userList:ve,navigate:j},[{title:"名称/备注",dataIndex:"name",width:300,render:function(t,n){return(0,re.jsxs)(re.Fragment,{children:[(0,re.jsxs)(M.Z,{children:[(0,re.jsx)(N.Z,{title:t,overlayInnerStyle:{width:100,overflow:"hidden"},children:(0,re.jsx)(P.FW,{modalRender:function(t){return(0,re.jsx)(w.Z,{onCancel:t,clusterName:n.name,onOk:function(n,r){var i;null==e||null===(i=e.navigate)||void 0===i||i.call(e,"/cluster/".concat(n,"/workloads/").concat(r,"/deployment")),t()}})},children:(0,re.jsx)("a",{style:{maxWidth:160},className:ee,children:t})})}),(null==e?void 0:e.follow)&&(0,re.jsx)(O.Z,{count:1,className:ne,defaultValue:n.is_followed?1:0,onChange:function(e){e>0?(0,b.EV)({follow_type:"Cluster",follow_value:"".concat(n.id)}).then((function(){q.ZP.success("关注成功")})):(0,b.T9)({follow_type:"Cluster",follow_value:"".concat(n.id)}).then((function(){q.ZP.success("取消关注成功")}))}})]}),(0,re.jsx)(N.Z,{title:t,overlayInnerStyle:{width:100,overflow:"hidden"},children:(0,re.jsx)("div",{className:"".concat(te," ").concat(ee),style:{maxWidth:200},children:n.description})})]})}},{title:"状态",dataIndex:"cluster_state",width:100,render:function(e){var t,n,r,i;return(0,re.jsxs)(A.Z,{style:{color:(null===(t=le[e])||void 0===t?void 0:t.color)||"#000000"},children:[(null===(n=le[e])||void 0===n?void 0:n.icon)&&(null===(r=le[e])||void 0===r?void 0:r.icon),null===(i=le[e])||void 0===i?void 0:i.label]})}},{title:"健康检查",dataIndex:"health_state",width:120,render:function(e){return(0,re.jsx)(C.Z,{items:e.map((function(e){var t,n;return{value:null===(t=oe[e])||void 0===t?void 0:t.label,color:null===(n=oe[e])||void 0===n?void 0:n.color}}))})}},{title:"版本",dataIndex:"server_version",width:160},{title:"负责人",dataIndex:"ops",width:120,ellipsis:!0,render:function(t,n){return X().isEmpty(n.ops)?"-":n.ops.map((function(t){var n;return null==e||null===(n=e.userList)||void 0===n||null===(n=n.find((function(e){return"".concat(e.user_id)==="".concat(t)})))||void 0===n?void 0:n.nickname})).filter(Boolean).join(",")}},{title:"快速链接",dataIndex:"links",width:140,render:function(e){return(0,re.jsx)(re.Fragment,{children:e.map((function(e,t){var n,r;return(0,re.jsx)(N.Z,{title:e.name,children:(0,re.jsx)(R.Z,{style:{maxWidth:120,overflow:"hidden",textOverflow:"ellipsis"},children:(0,re.jsx)("a",{style:{color:"#1677ff"},target:"_blank",href:0===(null===(n=e.url)||void 0===n?void 0:n.indexOf("http://"))||0===(null===(r=e.url)||void 0===r?void 0:r.indexOf("https://"))?e.url:"https://".concat(e.url),rel:"noreferrer",children:e.name})})},t)}))})}},{title:"节点数",dataIndex:"node_count",width:100,render:function(e,t){return(0,re.jsx)(I.Link,{to:"/cluster/".concat(t.name,"/node"),children:t.node_count})}},{title:"CPU使用量",dataIndex:"cpu_usage",width:180,render:function(e,t){var n=e?e/t.cpu_total*100:0,r="#1677ff";return n>80?r="#ff4d4f":n>60&&(r="#faad14"),(0,re.jsxs)("div",{children:[(0,re.jsx)("div",{children:"".concat(e||0,"/").concat(t.cpu_total||0,"核")}),(0,re.jsx)(U.Z,{style:{marginBottom:0},percent:n,strokeColor:r,format:function(){return Math.round(n)+"%"}})]})}},{title:"内存使用量",dataIndex:"memory_usage",width:180,render:function(e,t){var n=e?e/t.memory_total*100:0,r="#1677ff";return n>80?r="#ff4d4f":n>60&&(r="#faad14"),(0,re.jsxs)("div",{children:[(0,re.jsx)("div",{children:"".concat(e||0,"/").concat(t.memory_total||0,"GB")}),(0,re.jsx)(U.Z,{style:{marginBottom:0},percent:n,strokeColor:r,format:function(){return Math.round(n)+"%"}})]})}},{title:"创建时间",dataIndex:"build_date",width:160,render:_.kZ}]);return u?[].concat(o()(t),[{title:"操作",dataIndex:"operation",width:160,fixed:"right",render:function(e,t){return(0,re.jsxs)(A.Z,{children:[(0,re.jsx)("a",{onClick:function(){H.Z.confirm({title:"Kubectl访问集群",width:800,content:(0,re.jsxs)(re.Fragment,{children:[(0,re.jsx)(B.Z,{type:"info",message:"灵云平台允许用户通过KubeConfig访问集群，配置文件内权限等于灵云平台上的权限"}),(0,re.jsx)("p",{style:{marginTop:10},children:"通过Kubectl访问K8S集群"}),(0,re.jsxs)("p",{children:["1、请先到Kubernetes官网下载并安装Kubectl客户端工具，访问",(0,re.jsx)("a",{href:"https://kubernetes.io/zh-cn/docs/tasks/tools/",target:"_blank",rel:"noreferrer",children:"官网"})]}),(0,re.jsxs)("p",{children:["2、",(0,re.jsx)("a",{onClick:function(){ge(t.id,t.name)},children:"下载config"}),"文件，并复制到计算机 $HOME/.kube/config（kubectl 的默认路径）文件中"]})]})})},children:"访问凭证"}),(0,re.jsx)("a",{onClick:function(){me(t),(0,b.yc)({id:t.id}).then((function(e){var t;g.setFieldsValue(i()(i()({},e.detail),{},{links:null===(t=e.detail.links)||void 0===t?void 0:t.map((function(e){return{key:e.name,value:e.url}}))}));var n=ae(e.detail.import_detail.kube_config||"").contexts;W(n||[])})),ce(!0)},children:"编辑"}),(0,re.jsx)("a",{onClick:function(){var e,n=H.Z.confirm({title:"删除集群",content:(0,re.jsxs)(re.Fragment,{children:[(0,re.jsxs)("p",{children:["确认删除集群【",t.name,"】？输入集群名进行确认"]}),(0,re.jsx)(E.Z,{placeholder:"请输入集群名",onChange:function(e){e.target.value===t.name?n.update({okButtonProps:{disabled:!1}}):n.update({okButtonProps:{disabled:!0}})}})]}),okButtonProps:{disabled:!0},onOk:(e=c()(s()().mark((function e(){var n;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,b.Ue)({id:t.id});case 2:q.ZP.success("删除成功"),null===(n=p.current)||void 0===n||n.reload();case 4:case"end":return e.stop()}}),e)}))),function(){return e.apply(this,arguments)})})},children:"删除"})]})}}]):t}),[u,h,ve]);return(0,re.jsxs)(re.Fragment,{children:[(0,re.jsx)(k.Z,{searchWidth:320,actionRef:p,columns:je,request:l,leftTitle:u?(0,re.jsx)(K.ZP,{type:"primary",onClick:function(){ce(!0)},children:"导入集群"}):n,placeholder:"模糊搜索集群名称、备注、状态、版本",showSearch:!t,tableProps:i()(i()({rowKey:"id"},v),{},{pagination:!t&&void 0}),dataSource:r}),ue&&(0,re.jsx)(L.Z,{open:!0,maskClosable:!1,title:"导入K8S集群",width:800,onClose:function(){ce(!1),me(void 0),g.resetFields()},extra:(0,re.jsxs)(A.Z,{children:[(0,re.jsx)(K.ZP,{onClick:function(){ce(!1),me(void 0),g.resetFields()},children:"取消"}),(0,re.jsx)(K.ZP,{type:"primary",onClick:function(){g.validateFields().then(function(){var e=c()(s()().mark((function e(t){var n,r,l,o;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(he){e.next=7;break}return e.next=3,(0,b.$S)(i()(i()({},t),{},{links:(null==t||null===(n=t.links)||void 0===n?void 0:n.map((function(e){return{name:e.key,url:e.value||""}})))||[]}));case 3:q.ZP.success("导入成功"),null===(r=p.current)||void 0===r||r.reload(!0),e.next=11;break;case 7:return e.next=9,(0,b.Nw)(i()(i()({},t),{},{links:(null==t||null===(l=t.links)||void 0===l?void 0:l.map((function(e){return{name:e.key,url:e.value||""}})))||[],id:he.id}));case 9:q.ZP.success("编辑成功"),null===(o=p.current)||void 0===o||o.reload();case 11:ce(!1),me(void 0),g.resetFields();case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},children:"确认"})]}),children:(0,re.jsxs)(V.Z,{labelCol:{span:4},wrapperCol:{span:20},form:g,children:[(0,re.jsx)(V.Z.Item,{label:"集群名称",required:!0,name:"name",rules:[{required:!0,message:"请输入集群名称"},{max:100,message:"集群名称最大100字符"}],children:(0,re.jsx)(E.Z,{placeholder:"请输入集群名称"})}),(0,re.jsx)(V.Z.Item,{label:"备注",name:"description",rules:[{max:1e3,message:"备注最大100字符"}],children:(0,re.jsx)(E.Z.TextArea,{placeholder:"请输入集群备注"})}),!he&&(0,re.jsx)(re.Fragment,{children:(0,re.jsx)(V.Z.Item,{label:"管理方式",required:!0,name:"import_type",initialValue:"KubeConfig",children:(0,re.jsxs)(Y.ZP.Group,{children:[(0,re.jsx)(Y.ZP,{value:"KubeConfig",children:"KubeConfig"}),(0,re.jsx)(Y.ZP,{value:"Token",disabled:!0,children:"Token"})]})})}),(0,re.jsx)(V.Z.Item,{label:"KubeConfig",required:!0,rules:[{required:!0}],name:["import_detail","kube_config"],children:(0,re.jsx)(D.ZP,{theme:"vs-dark",language:"yaml",height:300,options:{minimap:{enabled:!1},fontSize:14,scrollBeyondLastLine:!1},onMount:function(e,t){new se("请在执行kubectl指令所在机器的用户目录下的 .kube/config 文件的内容粘贴到此处\n注意包含集群的CA证书和用户认证信息",e,t)},onChange:function(e){try{var t=ae(e||""),n=t.contexts,r=t.api_server;if(g.setFieldsValue({import_detail:{api_server:r}}),n)if(W(n),n.length>0){var i=g.getFieldValue("context");n.some((function(e){return i===e}))||g.setFieldsValue({import_detail:{context:n[0]}})}else g.setFieldsValue({import_detail:{context:void 0}});else void 0===n&&(W([]),g.setFieldsValue({import_detail:{context:void 0}}))}catch(e){g.setFieldsValue({import_detail:{api_server:void 0,context:void 0}})}}})}),(0,re.jsx)(V.Z.Item,{label:"API Server地址",required:!0,rules:[{required:!0}],name:["import_detail","api_server"],children:(0,re.jsx)(E.Z,{placeholder:"请输入API Server地址，为空时会自动读取KubeConfig文件的内容"})}),(0,re.jsx)(V.Z.Item,{label:"Context",required:!0,rules:[{required:!0}],name:["import_detail","context"],children:(0,re.jsx)(z.Z,{placeholder:"请选择Context，会自动读取KubeConfig文件的内容",options:$.map((function(e){return{label:e,value:e}}))})}),(0,re.jsx)(V.Z.Item,{label:"连接方式",required:!0,style:{marginBottom:0},tooltip:(0,re.jsxs)(re.Fragment,{children:["支持直连和异地组网两种方式接入。",(0,re.jsx)("br",{}),"直连：云原生服务直接调容器集群apiserver。",(0,re.jsx)("br",{}),"异地组网：通过集群内的代理转发请求实现容器集群链接"]}),children:(0,re.jsxs)(M.Z,{children:[(0,re.jsx)(V.Z.Item,{name:"connect_type",initialValue:"Direct",children:(0,re.jsx)(Y.ZP.Group,{options:[{label:"直连",value:"Direct"},{label:"异地组网",value:"Mesh"}]})}),"Mesh"===Z&&(0,re.jsx)(V.Z.Item,{name:"dst_agent_id",style:{flex:1},children:(0,re.jsx)(z.Z,{placeholder:"选择异地组网代理",options:pe})})]})}),(0,re.jsxs)(re.Fragment,{children:[(0,re.jsx)(V.Z.Item,{label:"负责人",name:"ops",required:!0,rules:[{required:!0}],children:(0,re.jsx)(z.Z,{mode:"multiple",placeholder:"请选择选择集群运维负责人",optionFilterProp:"label",options:(null==ve?void 0:ve.map((function(e){return{label:"".concat(e.nickname,"(").concat(e.username,")"),value:e.user_id}})))||[]})}),(0,re.jsx)(V.Z.Item,{label:"IDIP地址",style:{marginBottom:0},children:(0,re.jsxs)("div",{style:{display:"flex"},children:[(0,re.jsx)(V.Z.Item,{name:"idip",style:{flex:1,marginRight:10},children:(0,re.jsx)(E.Z,{placeholder:"请输入此集群对接的CBB服务IDIP地址"})}),(0,re.jsx)(K.ZP,{type:"primary",onClick:function(){xe(g.getFieldValue("idip"))},children:"测试连接"})]})}),(0,re.jsx)(V.Z.Item,{label:"AppID",style:{marginBottom:0},children:(0,re.jsx)(V.Z.Item,{name:"app_id",children:(0,re.jsx)(E.Z,{placeholder:"请输入AppID"})})}),(0,re.jsx)(V.Z.Item,{label:"AppSecret",style:{marginBottom:0},children:(0,re.jsx)(V.Z.Item,{name:"app_secret",children:(0,re.jsx)(E.Z,{placeholder:"请输入AppSecret"})})}),(0,re.jsx)(y.Z,{name:"links",label:"快捷链接",form:g,addText:"添加快捷链接",placeholder:["请输入链接名","请输入链接地址"],keyOption:{repeat:!0},valueOption:{required:!0}})]})]})})]})}},56765:function(e,t,n){"use strict";n.d(t,{jp:function(){return s},kZ:function(){return c},yq:function(){return u}});var r=n(5726),i=n.n(r),l=n(11110),o=n.n(l);i().extend(o());var a=function(e){var t=(Date.now()-e)/1e3;return t<60?{duration:t,unit:"second"}:t<3600?{duration:Math.floor(t/60),unit:"minute"}:t<86400?{duration:Math.floor(t/3600),unit:"hour"}:{duration:Math.floor(t/86400),unit:"day"}},s=function(e){if(void 0===e)return"";var t=a(e);return"second"===t.unit?"1分钟内":"".concat(t.duration," ").concat({second:"秒",minute:"分钟",hour:"小时",day:"天"}[t.unit],"前")},u=function(e){var t=a(e);return"second"===t.unit?"1分钟内":"约".concat(t.duration).concat({second:"秒",minute:"分钟",hour:"小时",day:"天"}[t.unit])},c=function(e){return isNaN(Number(e))?e:i()(Number(e)).format("YYYY-MM-DD HH:mm:ss")}},11110:function(e){e.exports=function(){"use strict";var e="minute",t=/[+-]\d\d(?::?\d\d)?/g,n=/([+-]|\d\d)/g;return function(r,i,l){var o=i.prototype;l.utc=function(e){return new i({date:e,utc:!0,args:arguments})},o.utc=function(t){var n=l(this.toDate(),{locale:this.$L,utc:!0});return t?n.add(this.utcOffset(),e):n},o.local=function(){return l(this.toDate(),{locale:this.$L,utc:!1})};var a=o.parse;o.parse=function(e){e.utc&&(this.$u=!0),this.$utils().u(e.$offset)||(this.$offset=e.$offset),a.call(this,e)};var s=o.init;o.init=function(){if(this.$u){var e=this.$d;this.$y=e.getUTCFullYear(),this.$M=e.getUTCMonth(),this.$D=e.getUTCDate(),this.$W=e.getUTCDay(),this.$H=e.getUTCHours(),this.$m=e.getUTCMinutes(),this.$s=e.getUTCSeconds(),this.$ms=e.getUTCMilliseconds()}else s.call(this)};var u=o.utcOffset;o.utcOffset=function(r,i){var l=this.$utils().u;if(l(r))return this.$u?0:l(this.$offset)?u.call(this):this.$offset;if("string"==typeof r&&(r=function(e){void 0===e&&(e="");var r=e.match(t);if(!r)return null;var i=(""+r[0]).match(n)||["-",0,0],l=i[0],o=60*+i[1]+ +i[2];return 0===o?0:"+"===l?o:-o}(r),null===r))return this;var o=Math.abs(r)<=16?60*r:r,a=this;if(i)return a.$offset=o,a.$u=0===r,a;if(0!==r){var s=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(a=this.local().add(o+s,e)).$offset=o,a.$x.$localOffset=s}else a=this.utc();return a};var c=o.format;o.format=function(e){var t=e||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return c.call(this,t)},o.valueOf=function(){var e=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*e},o.isUTC=function(){return!!this.$u},o.toISOString=function(){return this.toDate().toISOString()},o.toString=function(){return this.toDate().toUTCString()};var d=o.toDate;o.toDate=function(e){return"s"===e&&this.$offset?l(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():d.call(this)};var f=o.diff;o.diff=function(e,t,n){if(e&&this.$u===e.$u)return f.call(this,e,t,n);var r=this.local(),i=l(e).local();return f.call(r,i,t,n)}}}()}}]);