"use strict";(self.webpackChunkcnmp=self.webpackChunkcnmp||[]).push([[6631],{1018:function(e,n,t){var s=t(24680),i=t(65095),a=t(83408),o=t(61960),r=t(56031),l=t(97500),c=t(32699),d=t(50959),u=t(22241),m=t(99182),h=t(2177),p=t(24831),x=t(32779),j=t(59409),v=t(5695),y=t(19175),f=t(11527),g=[i.N,a.N,o.N],Z=[u.N,m.N,h.N,p.N,x.N,j.N,v.N];r.D([].concat(g,Z,[y.N]));var b={tooltip:{confine:!0},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},toolbox:{feature:{},showTitle:!1}};n.Z=function(e){var n=e.option,t=e.opts,i=e.onEvents,a=e.onChartReady,o=e.theme,r=e.style,u=e.showLoading,m=void 0!==u&&u,h=(0,d.useRef)(),p=(0,d.useMemo)((function(){return(0,c.merge)({},b,n)}),[n]);return(0,d.useEffect)((function(){h.current&&h.current.getEchartsInstance().setOption(p)}),[p]),(0,f.jsx)(s.Z,{ref:h,echarts:l,option:p,notMerge:!0,lazyUpdate:!1,theme:o,onChartReady:a,onEvents:i,opts:t,showLoading:m,style:r})}},86631:function(e,n,t){t.d(n,{Z:function(){return $}});var s=t(48305),i=t.n(s),a=t(26068),o=t.n(a),r=t(30813),l=t(1018),c=t(60396),d=t(69346),u=t(58082),m=t(29882),h=t(32030),p=t(61562),x=t(84916),j=t(1295),v=t(57562),y=t(21697),f=t(98632),g=t(83565),Z=t(31906),b=t(88934),_=t(59614),k=t(24390),w=t(50959),N=t(11527),P=function(e){var n=e.name,t=e.onCancel,s=e.onOk,a=(0,w.useState)("0"),o=i()(a,2),r=o[0],l=o[1];return(0,N.jsxs)(b.Z,{open:!0,onCancel:t,onOk:function(){s(r)},title:"【".concat(n,"】删除"),children:[(0,N.jsxs)("p",{style:{marginTop:20},children:["确定删除 ",n,"?"]}),(0,N.jsxs)(_.Z,{style:{paddingLeft:10},children:["副本数",(0,N.jsxs)(k.ZP.Group,{value:r,onChange:function(e){l(e.target.value)},children:[(0,N.jsx)(k.ZP,{value:"0",children:"-1"}),(0,N.jsx)(k.ZP,{value:"1",children:"不变(pod重建)"})]})]})]})},C=t(69328),I=t(85584),S=t(51142),M=t(35028),L=t(97628),R=t(6910),T=t(12710),H=t(8230),O=t(64211),D=t(18869),E=t(87940),z=t(5726),F=t.n(z),Y=t(32699),A=t.n(Y),q="block___kxAaL",B="container___wBdIt",U="container-icon-list___VIW6z",V="disabled___uwFe1",W="editor___yJH9t",G="vertical-text___uSve5",J=C.Z.Title,K=function(e,n){return{grid:{top:10,bottom:0,left:30,right:10},xAxis:{type:"category",boundaryGap:!1,data:e.map((function(e){return e[0]})),axisLabel:{rotate:30,formatter:function(e){return F()(Number(e)).format("HH:mm")}}},tooltip:{trigger:"axis",formatter:function(e){var n=F()(Number(e[0].name)).format("YYYY-MM-DD HH:mm"),t=e[0].value,s=e[0].marker;return"".concat(n,"<br/>").concat(s," Value: ").concat(t)}},yAxis:{type:"value",splitNumber:3,name:null==n?void 0:n.yAxisName,nameTextStyle:{fontSize:14,padding:[0,0,0,20]},axisLabel:{align:"right",borderWidth:1,rich:{value:{width:200}}}},color:null!=n&&n.color?[null==n?void 0:n.color]:"#0fbe8f",series:[{data:e.map((function(e){return e[1]})),type:"line",smooth:!0,symbol:"none",areaStyle:{opacity:.2}}]}},Q={Running:"var(--color-success)",Succeeded:"var(--color-success)",Failed:"var(--color-error)"},X={running:"success",created:"success"},$=function(e){var n,t,s,a,k,C,z,Y,$,ee,ne,te,se=e.data,ie=e.type,ae=e.showBelong,oe=(0,h.useParams)(),re=oe.clusterName,le=void 0===re?"":re,ce=oe.namespace,de=void 0===ce?"":ce,ue=oe.name,me=void 0===ue?"":ue,he=(0,h.useLocation)(),pe=(0,h.useNavigate)(),xe=(0,u.J)(),je=(0,w.useCallback)((function(e,n){function t(){var t=e.getOption(n.editor.EditorOption.lineHeight),s=t*e.getModel().getLineCount(),i=1*t,a=30*t,o=Math.max(i,Math.min(s,a));console.log("newHeight",o),e.layout({height:o})}e.getModel().onDidChangeContent((function(){t()})),t()}),[]),ve=(0,w.useState)(),ye=i()(ve,2),fe=ye[0],ge=ye[1],Ze=[{icon:p.Z,content:function(e){var n,t,s,i;return(0,N.jsxs)("div",{className:q,style:{width:600},children:[(0,N.jsx)(J,{level:5,children:"资源请求/限制"}),(0,N.jsx)(d.Z,{columns:[{title:"名称",dataIndex:"name"},{title:"请求Request",dataIndex:"request"},{title:"限制Limit",dataIndex:"limit"}],dataSource:[{name:"CPU",request:null==e||null===(n=e.requests)||void 0===n?void 0:n.cpu,limit:null==e||null===(t=e.limits)||void 0===t?void 0:t.cpu},{name:"内存",request:null==e||null===(s=e.requests)||void 0===s?void 0:s.memory,limit:null==e||null===(i=e.limits)||void 0===i?void 0:i.memory}],hideTitle:!0,tableProps:{pagination:!1}})]})},key:"resources"},{icon:x.Z,content:function(e){return(0,N.jsxs)("div",{className:q,style:{width:600},children:[(0,N.jsx)(J,{level:5,children:"端口映射"}),(0,N.jsx)(d.Z,{columns:[{title:"名称",dataIndex:"name"},{title:"协议",dataIndex:"protocol"},{title:"容器端口",dataIndex:"containerPort"},{title:"宿主机端口",dataIndex:"hostPort"}],dataSource:e,hideTitle:!0,tableProps:{pagination:!1}})]})},key:"ports"},{icon:j.Z,content:function(e){return(0,N.jsxs)("div",{className:q,style:{width:600},children:[(0,N.jsx)(J,{level:5,children:"环境变量"}),(0,N.jsx)(d.Z,{columns:[{title:"Key",dataIndex:"name"},{title:"Value",dataIndex:"value"}],dataSource:e,hideTitle:!0,tableProps:{pagination:!1}})]})},key:"env"},{icon:v.Z,content:function(e){return(0,N.jsxs)("div",{className:q,style:{width:600},children:[(0,N.jsx)(J,{level:5,children:"数据卷挂载"}),e.map((function(e){return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(_.Z,{style:{marginTop:10},children:e.read_only?(0,N.jsx)(I.Z,{color:"orange",children:"只读"}):(0,N.jsx)(I.Z,{color:"green",children:"读写"})}),(0,N.jsx)(Z.ZP,{theme:"vs-dark",language:"yaml",value:e.content,options:{minimap:{enabled:!1},fontSize:14,wordWrap:"on",scrollBeyondLastLine:!1},className:W,onMount:je})]})}))]})},key:"volume_mounts"},{icon:y.Z,content:function(e){return(0,N.jsxs)("div",{className:q,style:{width:600},children:[(0,N.jsx)(J,{level:5,children:"探针"}),e.map((function(e){return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(_.Z,{style:{marginTop:10},children:(0,N.jsx)(I.Z,{color:e.color,children:e.name})}),(0,N.jsx)(Z.ZP,{theme:"vs-dark",language:"yaml",value:e.value,options:{minimap:{enabled:!1},fontSize:14,wordWrap:"on",scrollBeyondLastLine:!1},className:W,onMount:je})]})}))]})},key:"probe"}],be=(0,w.useState)([]),_e=i()(be,2),ke=_e[0],we=_e[1],Ne=(0,w.useState)([]),Pe=i()(Ne,2),Ce=Pe[0],Ie=Pe[1];(0,w.useEffect)((function(){se&&((0,r.rl)({cluster_name:le,namespace:de,pod_name:se.name||"",time:Math.floor(Date.now()/1e3)},{showErrorMessage:!1}).then((function(e){var n;ge(void 0),we((null===(n=e.items)||void 0===n||null===(n=n[0])||void 0===n||null===(n=n.metricPoints)||void 0===n?void 0:n.map((function(e){return[Number(1e3*e.timestamp),parseFloat((e.value/1e3).toFixed(3))]})))||[])})).catch((function(e){(e.message||e.reason)&&ge(e)})),(0,r.HQ)({cluster_name:le,namespace:de,pod_name:se.name||"",time:Math.floor(Date.now()/1e3)},{showErrorMessage:!1}).then((function(e){var n;ge(void 0),Ie((null===(n=e.items)||void 0===n||null===(n=n[0])||void 0===n||null===(n=n.metricPoints)||void 0===n?void 0:n.map((function(e){return[1e3*e.timestamp,parseFloat((e.value/1024/1024).toFixed(3))]})))||[])})).catch((function(e){(e.message||e.reason)&&ge(e)})))}),[se]);var Se=(0,w.useMemo)((function(){var e={};return se.pod_conditions.forEach((function(n){n.type&&(e[n.type]={status:"True"===n.status,time:F()(1e3*n.lastTransitionTime).format("YYYY-MM-DD HH:mm:ss")})})),e}),[se.pod_conditions]);return(0,N.jsx)(N.Fragment,{children:(0,N.jsxs)("div",{className:B,children:[(0,N.jsxs)(S.Z,{justify:"space-between",align:"center",className:q,children:[(0,N.jsxs)("span",{children:["Pod详情 - ",se.name]}),(0,N.jsxs)(_.Z,{children:[ae&&ie&&"workload"in se&&(0,N.jsx)(M.ZP,{type:"primary",ghost:!0,onClick:function(){},children:(0,N.jsx)(h.Link,{to:"/cluster/".concat(le,"/workloads/").concat(ie,"/detail/").concat(se.workload,"/").concat(de),children:"所属负载"})}),(0,N.jsx)(c.Z,{modalRender:function(e){return(0,N.jsx)(m.Z,{defaultValue:se.yaml,clusterName:le,onCancel:function(){e()},onOk:function(n){(0,r.kH)({cluster_name:le,namespace:de,pod_name:se.name,yaml:n}).then((function(){e(),L.ZP.success("编辑成功")}))}})},children:(0,N.jsx)(M.ZP,{type:"primary",ghost:!0,children:"编辑POD YAML"})}),"deployment"===ie&&(0,N.jsx)(R.ZP,{theme:{token:{colorPrimary:"#faad14"}},children:(0,N.jsx)(M.ZP,{type:"primary",ghost:!0,onClick:function(){b.Z.confirm({title:"Pod重建",content:"确认销毁重建：".concat(se.name,"？"),onOk:function(){(0,r.dS)({cluster_name:le,namespace:de,pod_name:se.name}).then((function(){L.ZP.success("重建成功"),xe()}))}})},children:"重建"})}),ie&&"deployment"!==ie&&(0,N.jsx)(c.Z,{modalRender:function(e){return(0,N.jsx)(P,{name:se.name,onCancel:e,onOk:function(e){(0,r.Nl)({name:me,namespace:de,cluster_name:le,delete_policy:Number(e),pod_names:[se.name]}).then((function(){L.ZP.success("删除成功"),xe(he.pathname)}))}})},children:(0,N.jsx)(M.ZP,{type:"primary",ghost:!0,danger:!0,children:"删除"})})]})]}),(0,N.jsx)("div",{className:q,children:(0,N.jsxs)(S.Z,{justify:"space-between",align:"middle",children:[(0,N.jsxs)("div",{children:["节点IP   ",(0,N.jsx)(h.Link,{to:"/cluster/".concat(le,"/node/").concat(se.node_name),children:se.node_ip})]}),(0,N.jsxs)("div",{children:["实例IP   ",se.pod_ip]}),(0,N.jsxs)("div",{children:["状态   ",(0,N.jsx)("span",{style:{color:Q[se.status]||"var(--color-warning)"},children:se.status})]})]})}),(0,N.jsx)("div",{className:q,children:fe?(0,N.jsx)(T.Z,{message:fe.message,description:fe.reason,type:"error",showIcon:!0}):(0,N.jsxs)(H.Z,{children:[(0,N.jsx)(O.Z,{span:12,children:(0,N.jsxs)("div",{style:{position:"relative"},children:[(0,N.jsx)("div",{className:G,children:"CPU(核)"}),(0,N.jsx)(l.Z,{option:K(ke,{yAxisName:"cpu（核）"}),style:{height:100,width:"100%"}})]})}),(0,N.jsx)(O.Z,{span:12,children:(0,N.jsxs)("div",{style:{position:"relative"},children:[(0,N.jsx)("div",{className:G,children:"内存(Mi)"}),(0,N.jsx)(l.Z,{option:K(Ce,{color:"#234883",yAxisName:"内存（Mi）"}),style:{height:100}})]})})]})}),(0,N.jsx)("div",{style:{marginBottom:24},children:(0,N.jsxs)(H.Z,{gutter:[16,16],children:[(0,N.jsx)(O.Z,{span:12,children:(0,N.jsx)(T.Z,{message:(0,N.jsxs)(S.Z,{justify:"space-between",children:[(0,N.jsx)("span",{children:null!==(n=Se.PodScheduled)&&void 0!==n&&n.status?"已调度":"未调度"}),(0,N.jsx)("span",{children:null===(t=Se.PodScheduled)||void 0===t?void 0:t.time})]}),type:null!==(s=Se.PodScheduled)&&void 0!==s&&s.status?"success":"error",showIcon:!0})}),(0,N.jsx)(O.Z,{span:12,children:(0,N.jsx)(T.Z,{message:(0,N.jsxs)(S.Z,{justify:"space-between",children:[(0,N.jsx)("span",{children:null!==(a=Se.Initialized)&&void 0!==a&&a.status?"初始化":"未初始化"}),(0,N.jsx)("span",{children:null===(k=Se.Initialized)||void 0===k?void 0:k.time})]}),type:null!==(C=Se.Initialized)&&void 0!==C&&C.status?"success":"error",showIcon:!0})}),(0,N.jsx)(O.Z,{span:12,children:(0,N.jsx)(T.Z,{message:(0,N.jsxs)(S.Z,{justify:"space-between",children:[(0,N.jsx)("span",{children:null!==(z=Se.ContainersReady)&&void 0!==z&&z.status?"Pods已就绪":"Pods未就绪"}),(0,N.jsx)("span",{children:null===(Y=Se.ContainersReady)||void 0===Y?void 0:Y.time})]}),type:null!==($=Se.ContainersReady)&&void 0!==$&&$.status?"success":"error",showIcon:!0})}),(0,N.jsx)(O.Z,{span:12,children:(0,N.jsx)(T.Z,{message:(0,N.jsxs)(S.Z,{justify:"space-between",children:[(0,N.jsx)("span",{children:null!==(ee=Se.Ready)&&void 0!==ee&&ee.status?"容器已就绪":"容器未就绪"}),(0,N.jsx)("span",{children:null===(ne=Se.Ready)||void 0===ne?void 0:ne.time})]}),type:null!==(te=Se.Ready)&&void 0!==te&&te.status?"success":"error",showIcon:!0})})]})}),(0,N.jsx)("div",{className:q,children:"容器信息"}),se.containers.map((function(e){var n,t,s=function(e){var n=o()(o()({},e),{},{probe:[]});return e.startup_probe&&n.probe.push({name:"启动探针",color:"orange",value:e.startup_probe}),e.liveness_probe&&n.probe.push({name:"存活探针",color:"blue",value:e.liveness_probe}),e.readiness_probe&&n.probe.push({name:"就绪探针",color:"blue",value:e.readiness_probe}),n}(e);return(0,N.jsxs)("div",{className:q,children:[(0,N.jsxs)(S.Z,{justify:"space-between",align:"center",children:[(0,N.jsxs)("span",{children:[(0,N.jsx)(f.Z,{style:{fontSize:18,marginRight:10}}),"容器名称 ",s.container_name]}),(0,N.jsxs)(_.Z,{children:[(0,N.jsxs)("span",{children:["CPU ",((null===(n=s.usage)||void 0===n?void 0:n.cpu)||0)/1e3,"核"]}),(0,N.jsxs)("span",{children:["内存 ",Math.floor(((null===(t=s.usage)||void 0===t?void 0:t.memory)||0)/1024/1024),"MiB"]})]}),(0,N.jsxs)("div",{children:[(0,N.jsx)(I.Z,{color:s.status.ready?"success":"error",children:s.status.ready?"Ready":"Not Ready"}),(0,N.jsx)(I.Z,{color:s.status.state?"success":"error",children:s.status.started?"Started":"Not Started"}),s.status.state&&Object.keys(s.status.state).map((function(e){return(0,N.jsx)(I.Z,{color:X[e]||"warning",children:e},e)}))]})]}),(0,N.jsx)(D.Z,{style:{marginTop:20},column:3,items:[{key:"id",label:"容器ID",children:(0,N.jsxs)("div",{children:[s.container_id,(0,N.jsx)("a",{style:{marginLeft:4,padding:"0 6px"},onClick:function(){navigator.clipboard.writeText(s.container_id).then((function(){L.ZP.success("复制成功")}))},children:(0,N.jsx)(g.Z,{})})]}),contentStyle:{paddingRight:20},span:2},{key:"time",label:"重启次数",children:s.restart_count},{key:"mirror",label:"镜像",children:(0,N.jsxs)("div",{children:[s.image,(0,N.jsx)("a",{style:{marginLeft:4,padding:"0 6px"},onClick:function(){navigator.clipboard.writeText(s.image).then((function(){L.ZP.success("复制成功")}))},children:(0,N.jsx)(g.Z,{})})]}),span:2,contentStyle:{paddingRight:20}},{key:"strategy",label:"镜像拉取策略",children:s.image_pull_policy}]}),(0,N.jsxs)(S.Z,{justify:"space-between",children:[(0,N.jsx)(_.Z,{className:U,children:Ze.map((function(e){return s[e.key]&&!A().isEmpty(s[e.key])?(0,N.jsx)(E.Z,{destroyTooltipOnHide:!0,content:(0,N.jsx)("div",{children:e.content(s[e.key])||""}),children:(0,N.jsx)(e.icon,{})},e.key):(0,N.jsx)(e.icon,{className:V},e.key)}))}),(0,N.jsxs)(_.Z,{children:[(0,N.jsx)(M.ZP,{type:"primary",ghost:!0,children:(0,N.jsx)(h.Link,{to:"/cluster/".concat(le,"/workloads/").concat(ie,"/command/").concat(de,"/").concat(me,"/").concat(se.name,"/").concat(s.container_name),target:"_blank",children:"控制台"})}),(0,N.jsx)(M.ZP,{type:"primary",ghost:!0,onClick:function(){pe("".concat(he.pathname,"?pod_name=").concat(se.name,"&container_name=").concat(s.container_name,"&tab=log"))},children:"查看日志"})]})]})]},s.container_id)}))]})})}}}]);