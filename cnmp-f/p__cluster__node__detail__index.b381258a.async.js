"use strict";(self.webpackChunkcnmp=self.webpackChunkcnmp||[]).push([[3630],{31962:function(e,n,t){var r=t(48305),a=t.n(r),i=t(31906),o=t(51142),l=t(81861),u=t(35028),c=t(59614),s=t(97628),d=t(50959),f=t(11527);n.Z=function(e){var n=e.onRefresh,t=e.onSave,r=e.defaultContent,p=e.editorHeight,h=void 0===p?300:p,v=e.disabledEdit,m=(0,d.useState)(!1),x=a()(m,2),y=x[0],j=x[1],b=(0,d.useState)(r),g=a()(b,2),k=g[0],Z=g[1],_=(0,d.useRef)(r);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(o.Z,{justify:"space-between",children:y?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(l.Z,{beforeUpload:function(e){var n=new FileReader;return n.readAsText(e),n.onload=function(e){var n,t=null===(n=e.target)||void 0===n?void 0:n.result;t&&Z(t)},!1},accept:".yaml,.yml",showUploadList:!1,children:(0,f.jsx)(u.ZP,{type:"primary",children:"导入YAML"})}),(0,f.jsxs)(c.Z,{children:[(0,f.jsx)(u.ZP,{onClick:function(){j(!1),Z(_.current)},children:"取消"}),(0,f.jsx)(u.ZP,{onClick:function(){t(k).then((function(){_.current=k,j(!1)}))},children:"确定"})]})]}):(0,f.jsxs)(c.Z,{children:[(0,f.jsx)(u.ZP,{type:"primary",onClick:function(){j(!0)},disabled:v,children:"编辑YAML"}),(0,f.jsx)(u.ZP,{onClick:function(){navigator.clipboard.writeText(k).then((function(){s.ZP.success("复制成功")}))},children:"复制"}),(0,f.jsx)(u.ZP,{onClick:function(){null==n||n().then((function(e){Z(e),s.ZP.success("刷新成功")}))},children:"刷新"})]})}),(0,f.jsx)("div",{style:{marginTop:20},children:(0,f.jsx)(i.ZP,{theme:"vs-dark",language:"yaml",value:k,onChange:function(e){Z(e||"")},height:h,options:{minimap:{enabled:!1},fontSize:14,readOnly:!y,scrollBeyondLastLine:!1}})})]})}},65055:function(e,n,t){t.d(n,{Z:function(){return F}});var r=t(82092),a=t.n(r),i=t(26068),o=t.n(i),l=t(90228),u=t.n(l),c=t(15558),s=t.n(c),d=t(87999),f=t.n(d),p=t(48305),h=t.n(p),v=t(56330),m=t(39703),x=t(60125),y=t(52850),j=t(35028),b=t(97628),g=t(80699),k=t(82187),Z=t.n(k),_=t(32699),w=t.n(_),S=t(50959),C=t(59739),P="editable-table___ELOJW",I=t(11527),T=function(e,n,t){return void 0===n||""===n?e:e.filter((function(e){return!t||t(e,n)}))},F=function(e){var n=e.defaultIsEdit,t=void 0!==n&&n,r=e.placeholder,i=e.columns,l=e.editTitle,c=e.searchWidth,d=e.search,p=e.onSave,k=e.hide,_=e.operationOptions,F=e.editable,R=e.recordCreatorProps,N=e.rowKey,E=void 0===N?"id":N,V=(0,y.Z)(e),B=h()(V,2),L=B[0],M=B[1],W=(0,S.useState)(""),A=h()(W,2),K=A[0],O=A[1],q=(0,S.useState)(t),D=h()(q,2),z=D[0],H=D[1],U=(0,x.T)(e.editorFormRef),Y=(0,S.useRef)(),G=(0,S.useState)([]),J=h()(G,2),X=J[0],$=J[1],Q=(0,S.useState)([]),ee=h()(Q,2),ne=ee[0],te=ee[1],re=(0,S.useMemo)((function(){return T(L,K,d)}),[L,d,K]),ae=(0,S.useState)(0),ie=h()(ae,2),oe=ie[0],le=ie[1];(0,S.useEffect)((function(){te(T(L||[],K,d))}),[L,d,K]),(0,S.useEffect)((function(){$(z&&(null==L?void 0:L.map((function(e){return e[E]})))||[])}),[z,L]);var ue=function(){var e=f()(u()().mark((function e(){var n,t,r,a;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=w().differenceBy(ne,re,E),t=w().differenceBy(re,ne,E),r=w().intersectionBy(ne,re,E),a=[].concat(s()(n),s()(L.filter((function(e){return!t.some((function(n){return e[E]===n[E]}))})).map((function(e){var n=r.findIndex((function(n){return e[E]===n[E]}));return n>-1?r[n]:e})))),!p){e.next=7;break}return e.next=7,p(a);case 7:M(a),H(!1);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,I.jsx)(m.Z,{rowKey:E,className:Z()(P,e.className),headerTitle:z||"string"!=typeof l?(0,I.jsx)("span",{onClick:function(){z||H(!0)},children:l}):(0,I.jsx)(j.ZP,{type:"primary",onClick:function(){z||H(!0)},children:l}),toolBarRender:function(){return null!=k&&k.toolBarRender?[]:z?[(0,I.jsx)(j.ZP,{onClick:function(){te(re),H(!1),le(oe+1)},children:"取消"},"cancel"),(0,I.jsx)(j.ZP,{type:"primary",onClick:f()(u()().mark((function e(){var n;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,null===(n=U.current)||void 0===n?void 0:n.validateFields();case 3:e.next=9;break;case 5:return e.prev=5,e.t0=e.catch(0),b.ZP.warning("存在校验未通过项，请修改"),e.abrupt("return");case 9:ue();case 10:case"end":return e.stop()}}),e,null,[[0,5]])}))),children:"确认"},"ok")]:[(0,I.jsx)(g.Z,{style:{width:null!=c?c:300},value:K,placeholder:r,onChange:function(e){O(e.target.value)},allowClear:!0,suffix:(0,I.jsx)(v.Z,{style:{color:"#918f8f"}})},"__search__input")]},editableFormRef:U,columns:[].concat(s()(i),s()(z?[{dataIndex:"operation",title:"操作",valueType:"option",width:(null==_?void 0:_.width)||250,render:function(){return null}}]:[])),recordCreatorProps:!!z&&o()({position:"top",newRecordType:"dataSource",record:function(){return a()({},E,(0,C.Z)())}},R),value:ne,onChange:function(e){te(e)},actionRef:Y,editable:o()({type:"multiple",editableKeys:X,actionRender:function(e,n,t){return[t.delete]},onValuesChange:function(n,t){var r;(te(t),null!=k&&k.toolBarRender)&&(null===(r=e.onChange)||void 0===r||r.call(e,t))},onChange:function(e){$(e)}},F)},oe)}},75575:function(e,n,t){t.r(n),t.d(n,{default:function(){return K}});var r=t(90228),a=t.n(r),i=t(87999),o=t.n(i),l=t(48305),u=t.n(l),c=t(30813),s=t(31962),d=t(69346),f=t(60148),p=t(13726),h=t(69328),v=t(64211),m=t(51142),x=t(8230),y=t(69042),j="block___DKXwS",b="card___T0cDj",g=t(11527),k=h.Z.Title,Z={0:{title:"运行中",color:"#52C41A"},1:{title:"异常",color:"#FF4D4F"}},_=[{title:"CPU使用量",usage:"node_cpu_usage",total:"node_cpu_total",unit:"核"},{title:"内存使用量",usage:"node_memory_usage",total:"node_memory_total",unit:"GB"},{title:"POD使用量",usage:"pod_usage",total:"pod_total",unit:""}],w=function(e){return(0,g.jsx)(v.Z,{span:8,style:{minHeight:36,lineHeight:"36px"},children:(0,g.jsxs)(m.Z,{children:[(0,g.jsx)("div",{style:{width:100},children:e.label}),(0,g.jsx)("div",{style:e.style,children:e.value})]})})},S=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"前",t=Date.now(),r=t/1e3-e;return r<60?"1分钟内":r<3600?"".concat(Math.floor(r/60),"分钟").concat(n):r<86400?"".concat(Math.floor(r/3600),"小时").concat(n):r>=86400?"".concat(Math.floor(r/86400),"天").concat(n):""},C=function(e){var n=e.data,t=n.node_item,r=n.resource_usage,a=n.system_info,i=n.node_condition;return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("div",{className:j,children:[(0,g.jsxs)(x.Z,{children:[(0,g.jsx)(w,{label:"名称",value:t.name}),(0,g.jsx)(w,{label:"kubelet版本",value:t.kubelet_version}),(0,g.jsx)(w,{label:"系统",value:t.os_image})]}),(0,g.jsxs)(x.Z,{children:[(0,g.jsx)(w,{label:"IP",value:t.internal_ip}),(0,g.jsx)(w,{label:"kubeproxy",value:a.kubeProxyVersion}),(0,g.jsx)(w,{label:"架构",value:a.architecture})]}),(0,g.jsxs)(x.Z,{children:[(0,g.jsx)(w,{label:"状态",value:Z[t.state].title,style:{color:Z[t.state].color}}),(0,g.jsx)(w,{label:"容器引擎",value:t.container_runtime_version}),(0,g.jsx)(w,{label:"镜像",value:a.osImage})]}),(0,g.jsxs)(x.Z,{children:[(0,g.jsx)(w,{label:"健康检查",style:{paddingTop:4},value:(0,g.jsx)(f.Z,{max:3,items:t.health_state.map((function(e){var n,t;return{value:null===(n=p.E[e])||void 0===n?void 0:n.label,color:null===(t=p.E[e])||void 0===t?void 0:t.color}}))})}),(0,g.jsx)(w,{label:"创建时间",value:t.create_time}),(0,g.jsx)(w,{label:"内核",value:a.kernelVersion})]})]}),(0,g.jsxs)("div",{className:j,children:[(0,g.jsx)(k,{level:5,children:"资源用量"}),(0,g.jsx)(x.Z,{gutter:16,children:_.map((function(e){var n=r[e.usage]/r[e.total]*100;return(0,g.jsx)(v.Z,{span:8,children:(0,g.jsxs)("div",{className:b,children:[(0,g.jsx)("div",{children:e.title}),(0,g.jsx)("div",{children:"".concat(r[e.usage],"/").concat(r[e.total]," ").concat(e.unit)}),(0,g.jsx)(y.Z,{style:{marginBottom:0},percent:n,status:n>100?"exception":void 0,format:function(){return Math.round(n)+"%"}})]})},e.usage)}))})]}),(0,g.jsx)(d.Z,{leftTitle:(0,g.jsx)(k,{level:5,children:"健康检查"}),tableProps:{pagination:!1},hideTitle:!0,dataSource:i,columns:[{dataIndex:"type",title:"类型"},{dataIndex:"status",title:"状态"},{dataIndex:"reason",title:"reason"},{dataIndex:"message",title:"message"},{dataIndex:"last_heartbeat_time",title:"lastHeartbeatTime",render:function(e){return S(Number(e))}},{dataIndex:"last_transition_time",title:"lastTransitionTime",render:function(e){return S(Number(e))}}],refreshDeps:[i]})]})},P=t(15558),I=t.n(P),T=t(26068),F=t.n(T),R=t(65055),N=t(50959),E=t(59739),V=function(e,n){return!n||[e.value||"",e.key||""].some((function(e){return e.toLowerCase().indexOf(n.toLowerCase())>-1}))},B=function(e){var n=e.editTitle,t=e.columns,r=e.onSave,a=(0,N.useMemo)((function(){return e.dataSource.map((function(e){return F()(F()({},e),{},{id:(0,E.Z)()})}))}),[e.dataSource]);return(0,g.jsx)(R.Z,{placeholder:"模糊搜索标签Key、Value",searchWidth:400,defaultValue:a,onSave:r,editTitle:n,search:V,columns:I()(t.map((function(e){return F()(F()({},e),{},{formItemProps:function(n,t){return{rules:"select"===e.valueType?[{required:e.required,message:"此项是必填项"}]:[{required:e.required,message:"此项是必填项"},{message:"支持字母、数字及分隔符（“-”、“_”、”.”、“/”），需以字母、数字开头",pattern:/^[a-zA-Z0-9][a-zA-Z0-9./_-]*$/},{max:63,message:"长度支持1-63个字符"},{validator:function(r,a){if(!e.only)return Promise.resolve();var i=n.getFieldsValue();return Object.keys(i).filter((function(e){var n;return e!==(null===(n=t.rowKey)||void 0===n?void 0:n[0])})).some((function(e){return i[e][t.dataIndex]===a}))?Promise.reject(new Error("".concat(e.title,"值不能重复"))):Promise.resolve()}}]}}})})))})},L=t(44908),M=t(32030),W=t(38616),A=t(97628),K=function(){var e=(0,N.useState)(),n=u()(e,2),t=n[0],r=n[1],i=(0,M.useParams)(),l=i.clusterName,p=i.name,h=function(){var e=o()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.pC)({name:p,cluster_name:l}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,N.useEffect)((function(){h().then((function(e){r(e)}))}),[]),(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(L.Z,{clusterName:l,sourceType:"node",items:[{title:(0,g.jsx)(M.Link,{to:"/cluster/".concat(l,"/node"),children:"节点管理"})},{title:"节点详情:".concat(p)}]}),t&&(0,g.jsx)(W.Z,{items:[{key:"basic",label:"基础信息",children:(0,g.jsx)(C,{data:t})},{key:"pods",label:"Pods",children:(0,g.jsx)(d.Z,{placeholder:"模糊搜索pod名称、状态、命名空间、镜像、所属工作负载",searchWidth:440,request:function(){var e=o()(a()().mark((function e(n){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,c.EI)({keyword:n.keyword,page:n.current,page_size:n.pageSize,cluster_name:l,node_name:p});case 2:return t=e.sent,e.abrupt("return",{data:t.list||[],total:t.total||0});case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),columns:[{dataIndex:"name",title:"名称",minWidth:160,ellipsis:!0},{dataIndex:"status",title:"状态",width:120,render:function(e){return["Running","Succeeded","Completed"].includes(e)?(0,g.jsx)("span",{style:{color:"#52C41A"},children:e}):["Pending","Unknown"].includes(e)?(0,g.jsx)("span",{style:{color:"#F59A23"},children:e}):["Failed","CrashLoopBackOff"].includes(e)?(0,g.jsx)("span",{style:{color:"#FF4D4F"},children:e}):e}},{dataIndex:"namespace",title:"命名空间",minWidth:120,ellipsis:!0},{dataIndex:"containers",title:"镜像",width:160,render:function(e,n){return(0,g.jsx)(f.Z,{tagStyle:{maxWidth:150},items:n.containers.map((function(e){return{value:e.image}})),direction:"vertical"})}},{dataIndex:"ready_count",title:"Ready",minWidth:100,render:function(e,n){return"".concat(e,"/").concat(n.containers.length)}},{dataIndex:"restart_count",title:"重启",minWidth:100},{dataIndex:"creationTimestamp",title:"运行时间",minWidth:120},{dataIndex:"workload",title:"所属工作负载",ellipsis:!0}]})},{key:"labels",label:"标签",children:(0,g.jsx)(B,{onSave:function(){var e=o()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,c.SV)({name:p,cluster_name:l,labels:n.reduce((function(e,n){var t=n.key,r=n.value;return e[t]=r,e}),{})});case 2:A.ZP.success("操作成功");case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),dataSource:Object.keys((null==t?void 0:t.labels)||{}).map((function(e){var n;return{key:e,value:(null==t||null===(n=t.labels)||void 0===n?void 0:n[e])||""}})),columns:[{title:"Key",dataIndex:"key",only:!0,required:!0},{title:"Value",dataIndex:"value"}],editTitle:"编辑标签"})},{key:"annotations",label:"注解",children:(0,g.jsx)(B,{onSave:function(){var e=o()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,c.SV)({name:p,cluster_name:l,annotations:n.reduce((function(e,n){var t=n.key,r=n.value;return e[t]=r,e}),{})});case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),dataSource:Object.keys((null==t?void 0:t.annotations)||{}).map((function(e){var n;return{key:e,value:(null==t||null===(n=t.annotations)||void 0===n?void 0:n[e])||""}})),columns:[{title:"Key",dataIndex:"key",only:!0,required:!0},{title:"Value",dataIndex:"value"}],editTitle:"编辑注解"})},{key:"taints",label:"污点",children:(0,g.jsx)(B,{onSave:function(){var e=o()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,c.SV)({name:p,cluster_name:l,taints:n});case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),dataSource:(null==t?void 0:t.taints)||[],columns:[{title:"Key",dataIndex:"key",only:!0,required:!0},{title:"Value",dataIndex:"value"},{title:"效果",dataIndex:"effect",valueType:"select",valueEnum:{NoSchedule:{text:"NoSchedule"},NoExecute:{text:"NoExecute"},PreferNoSchedule:{text:"PreferNoSchedule"}}}],editTitle:"编辑污点"})},{key:"yaml",label:"YAML",children:(0,g.jsx)(s.Z,{onRefresh:o()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",h().then((function(e){return e.yaml})));case 1:case"end":return e.stop()}}),e)}))),onSave:function(){var e=o()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,c.wB)({yaml:n,cluster_name:l});case 2:A.ZP.success("编辑成功");case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),defaultContent:t.yaml,editorHeight:500})}]})]})}},12246:function(e,n,t){var r=t(50959),a=t(25492),i=t(80785);n.Z=function(e){i.Z&&((0,a.mf)(e)||console.error("useMemoizedFn expected parameter is a function, got ".concat(typeof e)));var n=(0,r.useRef)(e);n.current=(0,r.useMemo)((function(){return e}),[e]);var t=(0,r.useRef)();return t.current||(t.current=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.current.apply(this,e)}),t.current}},25844:function(e,n,t){var r=t(99938),a=t(50959);n.Z=function(){var e=(0,r.CR)((0,a.useState)({}),2)[1];return(0,a.useCallback)((function(){return e({})}),[])}}}]);