(self.webpackChunkcnmp=self.webpackChunkcnmp||[]).push([[5855],{27274:function(t,e,n){"use strict";n.d(e,{Z:function(){return _}});var i=n(15558),r=n.n(i),a=n(26068),o=n.n(a),l=n(48305),s=n.n(l),u=n(45778),c=n(95974),d=n(41710),h=n(10534),f=n(65460),m=n(96286),p=n(50959),v="table___Rup7Y",x=n(11527),_=function(t){var e=t.placeholder,n=t.request,i=t.columns,a=t.leftTitle,l=t.tableProps,_=t.showSearch,g=void 0===_||_,w=t.dataSource,Z=t.searchWidth,j=t.rightTitle,b=void 0===j?[]:j,y=t.refreshDeps,C=t.actionRef,S=t.hideTitle,$=t.searchStyle,I=t.onSearch,T=(0,u.T)(C),D=(0,p.useState)(""),k=s()(D,2),M=k[0],Y=k[1],H=(0,p.useRef)(""),O=(0,h.Z)((function(){var t,e;null==I||I(M),null===(t=T.current)||void 0===t||null===(e=t.reloadAndRest)||void 0===e||e.call(t)}),{wait:500}).run;return(0,f.Z)((function(){var t;null===(t=T.current)||void 0===t||t.reload()}),y||[]),(0,x.jsx)(d.Z,o()({className:v,actionRef:T,headerTitle:a,dataSource:w,search:!1,columns:i,request:n&&function(t){return n(o()(o()({},t),{},{keyword:H.current}))},pagination:{showSizeChanger:!0,defaultPageSize:50},options:{reload:!!n},toolBarRender:!S&&function(){return[].concat(r()(b),r()(g?[(0,x.jsx)(m.Z,{style:o()({width:null!=Z?Z:300},$),value:M,placeholder:e,onChange:function(t){Y(t.target.value),H.current=t.target.value,O()},allowClear:!0,suffix:(0,x.jsx)(c.Z,{style:{color:"#918f8f"}})},"__search__input")]:[]))}},l))}},14621:function(t,e,n){"use strict";n.d(e,{Z:function(){return c}});var i=n(26068),r=n.n(i),a=n(67825),o=n.n(a),l=(n(50959),"disabled___nnQy2"),s=n(11527),u=["disabled","children","onClick","className"],c=function(t){var e=t.disabled,n=t.children,i=t.onClick,a=t.className,c=void 0===a?"":a,d=o()(t,u);return(0,s.jsx)("a",r()(r()({className:e?l+" "+c:c,onClick:function(){e||null==i||i()}},d),{},{children:n}))}},45778:function(t,e,n){"use strict";n.d(e,{T:function(){return r}});var i=n(50959),r=function(t,e){var n=(0,i.useRef)(e);return t||n}},71904:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return P}});var i=n(26068),r=n.n(i),a=n(67825),o=n.n(a),l=n(90228),s=n.n(l),u=n(87999),c=n.n(u),d=n(48305),h=n.n(d),f=n(15268),m=n(4578),p=n(32643),v=n(50959),x=n(11527),_=function(t){var e=t.onChange,n=t.value,i=void 0===n?"":n,r=t.maxLine,a=void 0===r?30:r,o=t.minLine,l=void 0===o?1:o,s=t.language,u=(0,v.useCallback)((function(t,e){function n(){t.layout();var n=t.getOption(e.editor.EditorOption.lineHeight),i=t.getScrollHeight(),r=n*l,o=n*a,s=Math.max(r,Math.min(i,o));t.layout({height:s})}t.getModel().onDidChangeContent((function(){n()})),n()}),[]);return(0,v.useEffect)((function(){}),[]),(0,x.jsx)(p.ZP,{theme:"vs-dark",value:i,language:s,onChange:function(t){null==e||e(t||"")},options:{minimap:{enabled:!1},fontSize:14,lineHeight:19,wordWrap:"on",automaticLayout:!0,stickyScroll:{enabled:!1},scrollBeyondLastLine:!1},className:m.Z.editor,onMount:u})},g=n(27274),w=n(14621),Z=n(34593),j=n(56765),b=n(47212),y=n(60913),C=n(21630),S=n(96286),$=n(13702),I=n(69180),T=n(89169),D=n(3827),k="block___RAE7h",M="form___OTCTy",Y=["time"],H=y.default.RangePicker;function O(t){try{var e="string"==typeof t?JSON.parse(t):t;return JSON.stringify(e,null,2)}catch(e){return console.error("Invalid JSON string:",e),t}}var P=function(){var t=C.Z.useForm(),e=h()(t,1)[0],n=(0,b.Z)(c()(s()().mark((function t(){return s()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,f.By)());case 1:case"end":return t.stop()}}),t)})))).data,i=void 0===n?{}:n,a=i.status,l=void 0===a?[]:a,u=i.namespace,d=void 0===u?[]:u,m=i.resource_type,p=void 0===m?[]:m,y=i.cluster,P=void 0===y?[]:y,N=i.action,L=void 0===N?[]:N,F=i.module,U=void 0===F?[]:F,R=(0,v.useState)({}),z=h()(R,2),J=z[0],q=z[1],A=(0,v.useState)(),B=h()(A,2),W=B[0],E=B[1];return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(Z.Z,{items:[{title:"操作审计"}],showCluster:!1,showCreateYamlButton:!1}),(0,x.jsx)("div",{className:k,children:(0,x.jsxs)(C.Z,{layout:"inline",className:M,labelCol:{style:{width:70}},wrapperCol:{style:{width:170}},form:e,children:[(0,x.jsx)(C.Z.Item,{name:"username",label:"操作人",children:(0,x.jsx)(S.Z,{placeholder:"请输入"})}),(0,x.jsx)(C.Z.Item,{name:"client_ip",label:"操作IP",children:(0,x.jsx)(S.Z,{placeholder:"请输入"})}),(0,x.jsx)(C.Z.Item,{name:"cluster",label:"集群",children:(0,x.jsx)($.Z,{showSearch:!0,optionFilterProp:"label",placeholder:"请选择",options:P.map((function(t){return{label:t,value:t}})),allowClear:!0})}),(0,x.jsx)(C.Z.Item,{name:"namespace",label:"命名空间",children:(0,x.jsx)($.Z,{showSearch:!0,optionFilterProp:"label",placeholder:"请选择",options:d.map((function(t){return{label:t,value:t}})),allowClear:!0})}),(0,x.jsx)(C.Z.Item,{name:"module",label:"模块",children:(0,x.jsx)($.Z,{showSearch:!0,optionFilterProp:"label",placeholder:"请选择",options:U.map((function(t){return{label:t,value:t}})),allowClear:!0})}),(0,x.jsx)(C.Z.Item,{name:"resource_type",label:"对象类型",children:(0,x.jsx)($.Z,{showSearch:!0,optionFilterProp:"label",placeholder:"请选择",options:p.map((function(t){return{label:t,value:t}})),allowClear:!0})}),(0,x.jsx)(C.Z.Item,{name:"resource_name",label:"对象",children:(0,x.jsx)(S.Z,{placeholder:"请输入"})}),(0,x.jsx)(C.Z.Item,{name:"action",label:"操作类型",children:(0,x.jsx)($.Z,{showSearch:!0,optionFilterProp:"label",placeholder:"请选择",options:L.map((function(t){return{label:t,value:t}})),allowClear:!0})}),(0,x.jsx)(C.Z.Item,{name:"status",label:"操作状态",children:(0,x.jsx)($.Z,{showSearch:!0,optionFilterProp:"label",placeholder:"请选择",options:l.map((function(t){return{label:"Success"===t?"成功":"失败",value:t}})),allowClear:!0})}),(0,x.jsx)(C.Z.Item,{name:"time",label:"操作时间",wrapperCol:{style:{width:348}},children:(0,x.jsx)(H,{showTime:!0,allowClear:!0})}),(0,x.jsx)(I.ZP,{type:"primary",style:{marginRight:16},onClick:function(){e.validateFields().then((function(t){var e=t.time,n=o()(t,Y);q(r()(r()({},n),{},{start_time:null==e?void 0:e[0].format("YYYY-MM-DD HH:mm:ss"),end_time:null==e?void 0:e[1].format("YYYY-MM-DD HH:mm:ss")}))}))},children:"搜 索"}),(0,x.jsx)(I.ZP,{onClick:function(){e.resetFields(),q({})},children:"重 置"})]})}),(0,x.jsx)("div",{className:k,children:(0,x.jsx)(g.Z,{tableProps:{params:{filter:J},scroll:{x:1600}},columns:[{dataIndex:"username",title:"操作人",width:160,ellipsis:!0},{dataIndex:"client_ip",title:"操作IP",width:160,ellipsis:!0},{dataIndex:"module",title:"模块",width:160,ellipsis:!0},{dataIndex:"cluster",title:"集群",width:160,ellipsis:!0},{dataIndex:"namespace",title:"命名空间",width:160,ellipsis:!0},{dataIndex:"resource_type",title:"对象类型",width:160,ellipsis:!0},{dataIndex:"resource_name",title:"对象",width:160,ellipsis:!0},{dataIndex:"action",title:"操作类型",width:120},{dataIndex:"status",title:"操作状态",width:100,ellipsis:!0,render:function(t,e){return"Success"===e.status?(0,x.jsx)(T.Z,{color:"green",children:"成功"}):(0,x.jsx)(T.Z,{color:"red",children:"失败"})}},{dataIndex:"duration",title:"耗时",render:function(t){return"-"!==t?"".concat(t,"ms"):t},width:80},{dataIndex:"operation_time",title:"操作时间",width:160,render:j.kZ},{dataIndex:"operation",title:"操作",width:80,fixed:"right",render:function(t,e){return(0,x.jsx)(w.Z,{onClick:function(){E(e)},children:"详情"})}}],request:function(){var t=c()(s()().mark((function t(e){return s()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,f.cA)(r()({page:e.current,page_size:e.pageSize},e.filter)).then((function(t){return{data:t.list||[],total:t.total||0}})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),showSearch:!1,hideTitle:!0,leftTitle:(0,x.jsx)(x.Fragment,{})})}),W&&(0,x.jsxs)(D.Z,{width:800,title:(0,x.jsxs)("div",{children:["日志详情"," ","Success"===W.status?(0,x.jsx)(T.Z,{color:"green",children:"成功"}):(0,x.jsx)(T.Z,{color:"red",children:"失败"})]}),open:!0,cancelButtonProps:{style:{display:"none"}},onOk:function(){E(void 0)},onCancel:function(){E(void 0)},children:[(0,x.jsx)("div",{children:"请求路径"}),(0,x.jsx)(_,{value:W.request_path,maxLine:10,minLine:1}),(0,x.jsx)("div",{style:{marginTop:10},children:"请求消息"}),(0,x.jsx)(_,{value:O(W.request_body),maxLine:10,minLine:3}),(0,x.jsx)("div",{style:{marginTop:10},children:"响应消息"}),(0,x.jsx)(_,{value:W.response_body,maxLine:10,minLine:3})]})]})}},56765:function(t,e,n){"use strict";n.d(e,{jp:function(){return s},kZ:function(){return c},yq:function(){return u}});var i=n(5726),r=n.n(i),a=n(11110),o=n.n(a);r().extend(o());var l=function(t){var e=(Date.now()-t)/1e3;return e<60?{duration:e,unit:"second"}:e<3600?{duration:Math.floor(e/60),unit:"minute"}:e<86400?{duration:Math.floor(e/3600),unit:"hour"}:{duration:Math.floor(e/86400),unit:"day"}},s=function(t){if(void 0===t)return"";var e=l(t);return"second"===e.unit?"1分钟内":"".concat(e.duration," ").concat({second:"秒",minute:"分钟",hour:"小时",day:"天"}[e.unit],"前")},u=function(t){var e=l(t);return"second"===e.unit?"1分钟内":"约".concat(e.duration).concat({second:"秒",minute:"分钟",hour:"小时",day:"天"}[e.unit])},c=function(t){return isNaN(Number(t))?t:r()(Number(t)).format("YYYY-MM-DD HH:mm:ss")}},4578:function(t,e){"use strict";e.Z={block:"block___kxAaL",container:"container___wBdIt","detail-name":"detail-name___faUJH",detailName:"detail-name___faUJH","container-tag":"container-tag___HAUs7",containerTag:"container-tag___HAUs7","container-state-tag":"container-state-tag___PDs0m",containerStateTag:"container-state-tag___PDs0m","container-icon-list":"container-icon-list___VIW6z",containerIconList:"container-icon-list___VIW6z",disabled:"disabled___uwFe1",editor:"editor___yJH9t","vertical-text":"vertical-text___uSve5",verticalText:"vertical-text___uSve5","error-text":"error-text___G3C7J",errorText:"error-text___G3C7J"}},10534:function(t,e,n){"use strict";var i=n(99938),r=n(66292),a=n.n(r),o=n(50959),l=n(53270),s=n(77924),u=n(25492),c=n(80785);e.Z=function(t,e){var n;c.Z&&((0,u.mf)(t)||console.error("useDebounceFn expected parameter is a function, got ".concat(typeof t)));var r=(0,l.Z)(t),d=null!==(n=null==e?void 0:e.wait)&&void 0!==n?n:1e3,h=(0,o.useMemo)((function(){return a()((function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return r.current.apply(r,(0,i.ev)([],(0,i.CR)(t),!1))}),d,e)}),[]);return(0,s.Z)((function(){h.cancel()})),{run:h,cancel:h.cancel,flush:h.flush}}},11110:function(t){t.exports=function(){"use strict";var t="minute",e=/[+-]\d\d(?::?\d\d)?/g,n=/([+-]|\d\d)/g;return function(i,r,a){var o=r.prototype;a.utc=function(t){return new r({date:t,utc:!0,args:arguments})},o.utc=function(e){var n=a(this.toDate(),{locale:this.$L,utc:!0});return e?n.add(this.utcOffset(),t):n},o.local=function(){return a(this.toDate(),{locale:this.$L,utc:!1})};var l=o.parse;o.parse=function(t){t.utc&&(this.$u=!0),this.$utils().u(t.$offset)||(this.$offset=t.$offset),l.call(this,t)};var s=o.init;o.init=function(){if(this.$u){var t=this.$d;this.$y=t.getUTCFullYear(),this.$M=t.getUTCMonth(),this.$D=t.getUTCDate(),this.$W=t.getUTCDay(),this.$H=t.getUTCHours(),this.$m=t.getUTCMinutes(),this.$s=t.getUTCSeconds(),this.$ms=t.getUTCMilliseconds()}else s.call(this)};var u=o.utcOffset;o.utcOffset=function(i,r){var a=this.$utils().u;if(a(i))return this.$u?0:a(this.$offset)?u.call(this):this.$offset;if("string"==typeof i&&(i=function(t){void 0===t&&(t="");var i=t.match(e);if(!i)return null;var r=(""+i[0]).match(n)||["-",0,0],a=r[0],o=60*+r[1]+ +r[2];return 0===o?0:"+"===a?o:-o}(i),null===i))return this;var o=Math.abs(i)<=16?60*i:i,l=this;if(r)return l.$offset=o,l.$u=0===i,l;if(0!==i){var s=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(l=this.local().add(o+s,t)).$offset=o,l.$x.$localOffset=s}else l=this.utc();return l};var c=o.format;o.format=function(t){var e=t||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return c.call(this,e)},o.valueOf=function(){var t=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*t},o.isUTC=function(){return!!this.$u},o.toISOString=function(){return this.toDate().toISOString()},o.toString=function(){return this.toDate().toUTCString()};var d=o.toDate;o.toDate=function(t){return"s"===t&&this.$offset?a(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():d.call(this)};var h=o.diff;o.diff=function(t,e,n){if(t&&this.$u===t.$u)return h.call(this,t,e,n);var i=this.local(),r=a(t).local();return h.call(i,r,e,n)}}}()}}]);