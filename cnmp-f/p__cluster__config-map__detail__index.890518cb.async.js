"use strict";(self.webpackChunkcnmp=self.webpackChunkcnmp||[]).push([[8245],{64059:function(e,n,t){var a=t(48305),i=t.n(a),s=t(81798),c=t(62193),l=t(3885),r=t(99790),o=t(69180),u=t(70334),d=t(69005),m=t(3827),f=t(91894),h=t(15268),p=t(38218),x=t(50959),k=t(11527);n.Z=function(e){var n=e.onRefresh,t=e.defaultContent,a=e.editorHeight,j=void 0===a?300:a,y=e.disabledEdit,Z=(0,x.useState)(!1),v=i()(Z,2),g=v[0],b=v[1],C=(0,x.useState)(t),_=i()(C,2),w=_[0],P=_[1],N=(0,x.useState)(t),S=i()(N,2),F=S[0],M=S[1],I=(0,x.useState)(!1),O=i()(I,2),R=O[0],V=O[1],A=(0,x.useState)(!1),L=i()(A,2),Y=L[0],T=L[1],B=(0,p.useParams)().clusterName,D=void 0===B?"":B,E=(0,x.useState)("edit"),H=i()(E,2),W=H[0],U=H[1];return(0,x.useEffect)((function(){g&&V(!0)}),[g]),(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)(c.Z,{justify:"space-between",children:["edit"===W?(0,k.jsxs)(l.Z,{children:[g?(0,k.jsx)(r.Z,{beforeUpload:function(e){var n=new FileReader;return n.readAsText(e),n.onload=function(e){var n,t=null===(n=e.target)||void 0===n?void 0:n.result;t&&M(t)},!1},accept:".yaml,.yml",showUploadList:!1,children:(0,k.jsx)(o.ZP,{type:"primary",children:"导入YAML"})}):(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(o.ZP,{type:"primary",onClick:function(){b(!0)},disabled:y,children:"编辑YAML"}),(0,k.jsx)(o.ZP,{onClick:function(){navigator.clipboard.writeText(F).then((function(){u.ZP.success("复制成功")}))},children:"复制"}),(0,k.jsx)(o.ZP,{onClick:function(){null==n||n().then((function(e){P(e),u.ZP.success("刷新成功")}))},children:"刷新"})]}),(0,k.jsx)(d.Z,{checked:R,onChange:function(e){V(e.target.checked)},children:"精简字段"}),R&&(0,k.jsx)(d.Z,{checked:Y,onChange:function(e){T(e.target.checked)},children:"隐藏status字段"})]}):(0,k.jsx)("div",{}),g&&(0,k.jsxs)(l.Z,{children:[(0,k.jsx)(o.ZP,{onClick:function(){b(!1),M(w),U("edit")},children:"取消"}),(0,k.jsx)(o.ZP,{onClick:function(){F?"edit"!==W?(0,h.e7)({yaml:F,cluster_name:D}).then((function(e){m.Z.confirm({title:"确认更新",width:800,content:e.success?(0,k.jsx)(f.Z,{message:"检查通过，点击‘应用’执行变更",type:"success",showIcon:!0}):(0,k.jsx)(f.Z,{message:"检查未通过",type:"error",description:e.message,showIcon:!0}),okText:"应用",onOk:function(){(0,h.aA)({yaml:F,cluster_name:D}).then((function(){P(F),b(!1),U("edit"),u.ZP.success("编辑成功")})).catch((function(e){u.ZP.error(e.reason)}))}})})):U("diff"):u.ZP.warning("请输入YAML")},children:"确定"})]})]}),(0,k.jsx)("div",{style:{marginTop:20},children:(0,k.jsx)(s.Z,{readOnly:!g,simplify:R,hideStatus:Y,originalValue:w,value:F,onChange:function(e){M(e||"")},diff:"diff"===W,height:j})})]})}},37534:function(e,n,t){t.r(n);var a=t(90228),i=t.n(a),s=t(87999),c=t.n(s),l=t(26068),r=t.n(l),o=t(48305),u=t.n(o),d=t(15268),m=t(64059),f=t(34015),h=t(21213),p=t(34593),x=t(29762),k=t(16249),j=t(56765),y=t(38218),Z=t(81901),v=t(47212),g=t(3827),b=t(70334),C=t(73634),_=t(19338),w=t(86309),P=t(32699),N=t.n(P),S=t(50959),F=t(11527);n.default=function(){var e=(0,y.useParams)(),n=e.clusterName,t=void 0===n?"":n,a=e.name,s=void 0===a?"":a,l=e.namespace,o=void 0===l?"":l,P=(0,Z.Z)({tab:"basic"}),M=u()(P,2),I=M[0],O=M[1],R=(0,y.useNavigate)(),V=(0,v.Z)((function(){return(0,d.Vs)({name:s,cluster_name:t,namespace:o}).then((function(e){return e.detail}))})),A=V.data,L=V.refresh,Y=(0,S.useState)(!1),T=u()(Y,2),B=T[0],D=T[1],E=Object.keys((null==A?void 0:A.labels)||{}).length>3||Object.keys((null==A?void 0:A.annotations)||{}).length>3;return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(p.Z,{items:[{title:(0,F.jsx)(y.Link,{to:"/cluster/".concat(t,"/configuration-resources/").concat(o,"/config-map"),children:"ConfigMap"})},{title:"ConfigMap详情：".concat(s)}],sourceType:"config-map",showNamespace:!0,showCreateYamlButton:!1,onParamsChange:function(e){R("/cluster/".concat(e.clusterName||t,"/configuration-resources/").concat(e.namespace||o,"/config-map"))},footRender:function(){return A&&(0,F.jsx)(x.Z,{formInitialValues:{data:N().map(A.data,(function(e,n){return{key:n,value:e}})),annotations:N().map(A.annotations,(function(e,n){return{key:n,value:e}})),labels:N().map(A.labels,(function(e,n){return{key:n,value:e}})),name:A.name},refresh:L,title:"编辑ConfigMap",yaml:A.yaml,name:A.name,editRender:function(e){return(0,F.jsx)(h.Z,r()({},e))},onDelete:function(){g.Z.confirm({title:"删除ConfigMap",content:(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)("p",{children:["确认删除ConfigMap【",A.name,"】"]}),A.refs&&(0,F.jsxs)("p",{style:{color:"#FF4D4F"},children:["当前ConfigMap已经被",A.refs.map((function(e){return"".concat(e.kind,"-").concat(e.name)})).join("、"),"引用，删除可能导致引用的工作负载失效"]})]}),onOk:function(){(0,d.ZH)({cluster_name:t,name:A.name,namespace:o}).then((function(){b.ZP.success("删除成功"),R("/cluster/".concat(t,"/configuration-resources/").concat(o,"/config-map"))}))}})}})}}),A&&(0,F.jsx)(C.Z,{activeKey:I.tab,onChange:function(e){O({tab:e})},items:[{key:"basic",label:"基础信息",children:(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)("div",{className:k.Z.block,children:(0,F.jsx)(_.Z,{items:[{key:"name",label:"名称",children:A.name},{key:"create_time",label:"创建时间",children:(0,j.kZ)(A.create_time)},{key:"update_time",label:"更新时间",children:(0,j.kZ)(A.update_time)}]})}),(0,F.jsxs)("div",{className:k.Z.block,children:[(0,F.jsx)(_.Z,{title:"注解&标签",items:[{key:"annotations",label:"注解",children:(0,F.jsx)(f.Z,{items:Object.keys(A.annotations||{}).map((function(e){return{value:"".concat(e,":").concat(A.annotations[e])}})),tagStyle:{maxWidth:300},direction:"vertical",max:B?void 0:3})},{key:"labels",label:"标签",children:(0,F.jsx)(f.Z,{items:Object.keys(A.labels||{}).map((function(e){return{value:"".concat(e,":").concat(A.labels[e])}})),tagStyle:{maxWidth:300},max:B?void 0:3,direction:"vertical"})}]}),E&&(0,F.jsx)("div",{style:{right:20,top:20,position:"absolute"},children:(0,F.jsx)("a",{onClick:function(){D(!B)},children:B?"收起":"展开"})})]}),(0,F.jsx)("div",{className:k.Z.block,children:(0,F.jsx)(w.Z,{columns:[{dataIndex:"key",title:"key",render:function(e){return(0,F.jsx)("div",{style:{wordBreak:"break-word"},children:e})}},{dataIndex:"value",title:"value",render:function(e){return(0,F.jsx)("div",{style:{wordBreak:"break-word"},children:e})}}],dataSource:N().map(A.data,(function(e,n){return{key:n,value:e}})),pagination:!1})})]})},{key:"refs",label:"引用列表",children:(0,F.jsx)("div",{className:k.Z.block,children:(0,F.jsx)(w.Z,{columns:[{dataIndex:"name",title:"名称",ellipsis:!0},{dataIndex:"kind",title:"类型",ellipsis:!0}],dataSource:A.refs,pagination:!1})})},{key:"yaml",label:"YAML",children:(0,F.jsx)("div",{className:k.Z.block,children:(0,F.jsx)(m.Z,{defaultContent:A.yaml,onRefresh:c()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.Vs)({name:s,cluster_name:t,namespace:o}).then((function(e){var n;return b.ZP.success("刷新成功"),(null===(n=e.detail)||void 0===n?void 0:n.yaml)||""})));case 1:case"end":return e.stop()}}),e)}))),editorHeight:"calc(100vh - 380px)"})})}]})]})}},29762:function(e,n,t){t.d(n,{Z:function(){return j}});var a=t(48305),i=t.n(a),s=t(36954),c=t(38218),l=t(36241),r=t(21630),o=t(62193),u=t(3885),d=t(97536),m=t(69180),f=t(50959),h="title___qEjyg",p="name___p26Np",x="dropdown___unIV5",k=t(11527),j=function(e){var n=r.Z.useForm(),t=i()(n,1)[0],a=(0,f.useState)(!1),j=i()(a,2),y=j[0],Z=j[1],v=(0,f.useState)(!1),g=i()(v,2),b=g[0],C=g[1],_=(0,c.useParams)().clusterName,w=void 0===_?"":_,P=e.title,N=e.formInitialValues,S=e.onDelete,F=e.refresh,M=e.operationRender,I=e.onRestart,O=e.editRender,R=e.yaml,V=e.name,A=(0,f.useMemo)((function(){var e=[];return void 0!==R&&e.push({label:"编辑yaml",key:"edit-yaml"}),O&&e.push({label:"编辑",key:"edit"}),I&&e.push({label:"重启",key:"restart"}),S&&e.push({label:"删除",key:"delete"}),e}),[R,P,V,w,F,S,I]);return(0,k.jsxs)("div",{className:h,children:[(0,k.jsxs)(o.Z,{justify:"space-between",children:[(0,k.jsxs)(u.Z,{children:[(0,k.jsx)("span",{className:p,children:P}),(0,k.jsx)(u.Z,{children:M&&M()})]}),A.length>0&&(0,k.jsx)(d.Z,{overlayClassName:x,menu:{items:A,onClick:function(e){if("delete"!==e.key)return"edit"===e.key?(Z(!0),void t.setFieldsValue(N||{})):void("restart"!==e.key?"edit-yaml"!==e.key||C(!0):null==I||I());null==S||S()}},children:(0,k.jsx)(m.ZP,{style:{padding:"4px 8px"},children:(0,k.jsx)(l.Z,{})})})]}),O&&O({title:P,form:t,open:y,onClose:function(){Z(!1)},onOk:function(){Z(!1),null==F||F()},type:"edit"}),b&&(0,k.jsx)(s.Z,{title:"【".concat(P,"-").concat(V,"】编辑Yaml"),defaultValue:R,clusterName:w,onCancel:function(){C(!1),null==F||F()}})]})}},16249:function(e,n){n.Z={block:"block___u4hkW"}}}]);