(self.webpackChunkcnmp=self.webpackChunkcnmp||[]).push([[6458],{36241:function(e,t,n){"use strict";var r=n(79482),i=n(50959),s=n(38930),a=n(28371),l=function(e,t){return i.createElement(a.Z,(0,r.Z)({},e,{ref:t,icon:s.Z}))},u=i.forwardRef(l);t.Z=u},64059:function(e,t,n){"use strict";var r=n(48305),i=n.n(r),s=n(81798),a=n(62193),l=n(3885),u=n(99790),o=n(69180),c=n(70334),d=n(69005),f=n(3827),h=n(91894),m=n(15268),p=n(38218),v=n(50959),x=n(11527);t.Z=function(e){var t=e.onRefresh,n=e.defaultContent,r=e.editorHeight,j=void 0===r?300:r,Z=e.disabledEdit,y=(0,v.useState)(!1),g=i()(y,2),_=g[0],b=g[1],C=(0,v.useState)(n),k=i()(C,2),w=k[0],P=k[1],$=(0,v.useState)(n),S=i()($,2),T=S[0],M=S[1],N=(0,v.useState)(!1),R=i()(N,2),E=R[0],O=R[1],Y=(0,v.useState)(!1),I=i()(Y,2),D=I[0],L=I[1],F=(0,p.useParams)().clusterName,U=void 0===F?"":F,A=(0,v.useState)("edit"),H=i()(A,2),q=H[0],V=H[1];return(0,v.useEffect)((function(){_&&O(!0)}),[_]),(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)(a.Z,{justify:"space-between",children:["edit"===q?(0,x.jsxs)(l.Z,{children:[_?(0,x.jsx)(u.Z,{beforeUpload:function(e){var t=new FileReader;return t.readAsText(e),t.onload=function(e){var t,n=null===(t=e.target)||void 0===t?void 0:t.result;n&&M(n)},!1},accept:".yaml,.yml",showUploadList:!1,children:(0,x.jsx)(o.ZP,{type:"primary",children:"导入YAML"})}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(o.ZP,{type:"primary",onClick:function(){b(!0)},disabled:Z,children:"编辑YAML"}),(0,x.jsx)(o.ZP,{onClick:function(){navigator.clipboard.writeText(T).then((function(){c.ZP.success("复制成功")}))},children:"复制"}),(0,x.jsx)(o.ZP,{onClick:function(){null==t||t().then((function(e){P(e),c.ZP.success("刷新成功")}))},children:"刷新"})]}),(0,x.jsx)(d.Z,{checked:E,onChange:function(e){O(e.target.checked)},children:"精简字段"}),E&&(0,x.jsx)(d.Z,{checked:D,onChange:function(e){L(e.target.checked)},children:"隐藏status字段"})]}):(0,x.jsx)("div",{}),_&&(0,x.jsxs)(l.Z,{children:[(0,x.jsx)(o.ZP,{onClick:function(){b(!1),M(w),V("edit")},children:"取消"}),(0,x.jsx)(o.ZP,{onClick:function(){T?"edit"!==q?(0,m.e7)({yaml:T,cluster_name:U}).then((function(e){f.Z.confirm({title:"确认更新",width:800,content:e.success?(0,x.jsx)(h.Z,{message:"检查通过，点击‘应用’执行变更",type:"success",showIcon:!0}):(0,x.jsx)(h.Z,{message:"检查未通过",type:"error",description:e.message,showIcon:!0}),okText:"应用",onOk:function(){(0,m.aA)({yaml:T,cluster_name:U}).then((function(){P(T),b(!1),V("edit"),c.ZP.success("编辑成功")})).catch((function(e){c.ZP.error(e.reason)}))}})})):V("diff"):c.ZP.warning("请输入YAML")},children:"确定"})]})]}),(0,x.jsx)("div",{style:{marginTop:20},children:(0,x.jsx)(s.Z,{readOnly:!_,simplify:E,hideStatus:D,originalValue:w,value:T,onChange:function(e){M(e||"")},diff:"diff"===q,height:j})})]})}},44161:function(e,t,n){"use strict";n.d(t,{Z:function(){return M}});var r=n(82092),i=n.n(r),s=n(26068),a=n.n(s),l=n(90228),u=n.n(l),o=n(15558),c=n.n(o),d=n(87999),f=n.n(d),h=n(48305),m=n.n(h),p=n(95974),v=n(76489),x=n(45778),j=n(52850),Z=n(69180),y=n(70334),g=n(96286),_=n(82187),b=n.n(_),C=n(32699),k=n.n(C),w=n(50959),P=n(59739),$="editable-table___ELOJW",S=n(11527),T=function(e,t,n){return void 0===t||""===t?e:e.filter((function(e){return!n||n(e,t)}))},M=function(e){var t=e.defaultIsEdit,n=void 0!==t&&t,r=e.placeholder,s=e.columns,l=e.editTitle,o=e.searchWidth,d=e.search,h=e.onSave,_=e.hide,C=e.operationOptions,M=e.editable,N=e.recordCreatorProps,R=e.rowKey,E=void 0===R?"id":R,O=e.tableProps,Y=(0,j.Z)(e),I=m()(Y,2),D=I[0],L=I[1],F=(0,w.useState)(""),U=m()(F,2),A=U[0],H=U[1],q=(0,w.useState)(n),V=m()(q,2),B=V[0],z=V[1],K=(0,x.T)(e.editorFormRef),W=(0,w.useRef)(),J=(0,w.useState)([]),G=m()(J,2),Q=G[0],X=G[1],ee=(0,w.useState)([]),te=m()(ee,2),ne=te[0],re=te[1],ie=(0,w.useMemo)((function(){return T(D,A,d)}),[D,d,A]),se=(0,w.useState)(0),ae=m()(se,2),le=ae[0],ue=ae[1];(0,w.useEffect)((function(){re(T(D||[],A,d))}),[D,d,A]),(0,w.useEffect)((function(){X(B&&(null==D?void 0:D.map((function(e){return e[E]})))||[])}),[B,D,E]);var oe=function(){var e=f()(u()().mark((function e(){var t,n,r,i;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=k().differenceBy(ne,ie,E),n=k().differenceBy(ie,ne,E),r=k().intersectionBy(ne,ie,E),i=[].concat(c()(t),c()(D.filter((function(e){return!n.some((function(t){return e[E]===t[E]}))})).map((function(e){var t=r.findIndex((function(t){return e[E]===t[E]}));return t>-1?r[t]:e})))),!h){e.next=7;break}return e.next=7,h(i);case 7:L(i),z(!1);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,S.jsx)(v.Z,a()({rowKey:E,className:b()($,e.className),headerTitle:B||"string"!=typeof l?(0,S.jsx)("span",{onClick:function(){B||z(!0)},children:l}):(0,S.jsx)(Z.ZP,{type:"primary",onClick:function(){B||z(!0)},children:l}),toolBarRender:function(){return null!=_&&_.toolBarRender?[]:B?[(0,S.jsx)(Z.ZP,{onClick:function(){re(ie),z(!1),ue(le+1)},children:"取消"},"cancel"),(0,S.jsx)(Z.ZP,{type:"primary",onClick:f()(u()().mark((function e(){var t;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,null===(t=K.current)||void 0===t?void 0:t.validateFields();case 3:e.next=9;break;case 5:return e.prev=5,e.t0=e.catch(0),y.ZP.warning("存在校验未通过项，请修改"),e.abrupt("return");case 9:oe();case 10:case"end":return e.stop()}}),e,null,[[0,5]])}))),children:"确认"},"ok")]:[(0,S.jsx)(g.Z,{style:{width:null!=o?o:300},value:A,placeholder:r,onChange:function(e){H(e.target.value)},allowClear:!0,suffix:(0,S.jsx)(p.Z,{style:{color:"#918f8f"}})},"__search__input")]},editableFormRef:K,columns:[].concat(c()(s),c()(B?[{dataIndex:"operation",title:"操作",valueType:"option",width:(null==C?void 0:C.width)||250,render:function(){return null}}]:[])),recordCreatorProps:!!B&&a()({position:"top",newRecordType:"dataSource",record:function(){return i()({},E,(0,P.Z)())}},N),value:ne,onChange:function(e){re(e)},actionRef:W,editable:a()({type:"multiple",editableKeys:Q,actionRender:function(e,t,n){return[n.delete]},onValuesChange:function(t,n){var r;(re(n),null!=_&&_.toolBarRender)&&(null===(r=e.onChange)||void 0===r||r.call(e,n))},onChange:function(e){X(e)}},M)},O),le)}},45778:function(e,t,n){"use strict";n.d(t,{T:function(){return i}});var r=n(50959),i=function(e,t){var n=(0,r.useRef)(t);return e||n}},57826:function(e,t,n){"use strict";var r=n(90228),i=n.n(r),s=n(26068),a=n.n(s),l=n(87999),u=n.n(l),o=n(15268),c=n(32643),d=n(93441),f=n(3885),h=n(69180),m=n(70334),p=n(21630),v=n(96286),x=n(18772),j=(n(50959),n(11527));t.Z=function(e){var t=e.form,n=e.title,r=e.open,s=e.onClose,l=e.type,Z=e.onOk,y=e.id;return(0,j.jsx)(d.Z,{open:r,title:n,width:800,onClose:function(){s(),t.resetFields()},extra:(0,j.jsxs)(f.Z,{children:[(0,j.jsx)(h.ZP,{onClick:function(){s(),t.resetFields()},children:"取消"}),(0,j.jsx)(h.ZP,{type:"primary",onClick:u()(i()().mark((function e(){var n;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.validateFields();case 2:if(n=e.sent,"edit"!==l){e.next=8;break}return e.next=6,(0,o.$h)(a()({id:y},n));case 6:e.next=10;break;case 8:return e.next=10,(0,o.Pi)(a()({},n));case 10:m.ZP.success("操作成功"),null==Z||Z();case 12:case"end":return e.stop()}}),e)}))),children:"确认"})]}),children:(0,j.jsxs)(p.Z,{labelCol:{span:3},wrapperCol:{span:21},form:t,children:[(0,j.jsx)(p.Z.Item,{label:"角色名称",required:!0,name:"name",rules:[{required:!0,message:"请输入角色名称"},{max:50,message:"角色名称最大50字符"}],children:(0,j.jsx)(v.Z,{placeholder:"请输入角色名称"})}),(0,j.jsx)(p.Z.Item,{label:"角色类型",name:"role_type",tooltip:{title:(0,j.jsxs)("div",{children:[(0,j.jsx)("div",{children:"集群角色允许绑定全部命名空间"}),(0,j.jsx)("div",{children:"普通角色仅允许绑定指定的命名空间"}),(0,j.jsx)("div",{children:"涉及集群级别的resources，建议定义为集群角色"})]}),overlayInnerStyle:{width:320}},children:(0,j.jsxs)(x.ZP.Group,{disabled:"edit"===l,children:[(0,j.jsx)(x.ZP,{value:"CLUSTER",children:"集群"}),(0,j.jsx)(x.ZP,{value:"NAMESPACE",children:"普通"})]})}),(0,j.jsx)(p.Z.Item,{label:"角色备注",name:"description",rules:[{max:200,message:"备注最大200字符"}],children:(0,j.jsx)(v.Z.TextArea,{placeholder:"请输入集群备注"})}),(0,j.jsx)(p.Z.Item,{label:"YAML",required:!0,name:"yaml",tooltip:{title:"所有角色的kind都为ClusterRole，在授权时可以选择将角色绑定到全部命名空间或指定命名空间",overlayInnerStyle:{width:390}},children:(0,j.jsx)(c.ZP,{theme:"vs-dark",language:"yaml",height:300,options:{minimap:{enabled:!1},fontSize:14,scrollBeyondLastLine:!1}})})]})})}},65773:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return D}});var r=n(82092),i=n.n(r),s=n(90228),a=n.n(s),l=n(87999),u=n.n(l),o=n(26068),c=n.n(o),d=n(48305),f=n.n(d),h=n(15268),m=n(64059),p=n(44161),v=n(34654),x=n(57826),j=n(34593),Z=n(29762),y=n(89629),g=n(56765),_=n(38218),b=n(94537),C=n(47212),k=n(3827),w=n(3885),P=n(89169),$=n(70334),S=n(73634),T=n(69180),M=n(62193),N=n(50959),R=n(59739),E="block___qcfvE",O="row___jYTXM",Y=n(11527),I=function(e,t){return!t||[e.value||"",e.key||""].some((function(e){return e.toLowerCase().indexOf(t.toLowerCase())>-1}))},D=function(){var e=(0,b.NL)(),t=(0,_.useParams)().roleId,n=void 0===t?"":t,r=(0,_.useNavigate)(),s=(0,v.J)(),l=(0,y.M6)({variables:{list_all:"1"}}).data,o=(0,y.o_)({variables:{list_all:"1"}}).data,d=(0,N.useState)([]),D=f()(d,2),L=D[0],F=D[1],U=(0,C.Z)((function(){return(0,h.aM)({role_id:n}).then((function(e){return e.detail}))})),A=U.data,H=U.refreshAsync;(0,N.useEffect)((function(){(0,h.r5)({list_all:"1",role_id:n}).then((function(e){F(e.list)}))}),[]);var q,V=(0,N.useMemo)((function(){var e;return Object.fromEntries((null==l||null===(e=l.list)||void 0===e?void 0:e.map((function(e){return[e.id,{text:e.name}]})))||[])}),[l]),B=(0,N.useMemo)((function(){var e;return Object.fromEntries((null==o||null===(e=o.list)||void 0===e?void 0:e.map((function(e){return[e.user_group_id,{text:e.user_group_name}]})))||[])}),[l]),z=(0,N.useMemo)((function(){return L.map((function(e){return c()(c()({},e),{},{user_group_id:"".concat(e.user_group_id),cluster_id:"".concat(e.cluster_id),id:(0,R.Z)()})}))}),[L]);return(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(j.Z,{items:[{title:"授权管理 "},{title:(0,Y.jsx)(_.Link,{to:"/user/manager",children:"角色管理"})},{title:"角色详情：".concat(null==A?void 0:A.name)}],showCluster:!1,showCreateYamlButton:!1,footRender:function(){return A&&(0,Y.jsx)(Z.Z,{formInitialValues:A,refresh:H,onDelete:function(){k.Z.confirm({title:(0,Y.jsxs)(w.Z,{children:["删除角色","CLUSTER"===A.role_type?(0,Y.jsx)(P.Z,{color:"blue",children:"集群"}):(0,Y.jsx)(P.Z,{color:"green",children:"普通"})]}),content:(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)("p",{children:"确认删除角色【角色A】？"}),(0,Y.jsx)("p",{children:"删除后所有角色关联授权会同时被删除"})]}),onOk:function(){(0,h.t8)({id:A.id}).then((function(){$.ZP.success("删除成功"),r("/user/manager")}))}})},title:"角色",editRender:null!=A&&A.is_default?void 0:function(e){return(0,Y.jsx)(x.Z,c()(c()({},e),{},{id:null==A?void 0:A.id}))}})}}),(0,Y.jsx)(S.Z,{items:[{label:"授权管理",key:"auth",children:(0,Y.jsx)(p.Z,{value:z,search:I,placeholder:"模糊搜索用户、集群",onSave:function(){var e=u()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,h.YT)({role_id:Number(n),bindings:t});case 2:$.ZP.success("编辑授权成功"),s();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),columns:[{dataIndex:"user_group_id",title:"用户组",valueType:"select",valueEnum:B,fieldProps:{placeholder:"请选择用户组"}},{dataIndex:"cluster_id",title:"集群",valueType:"select",valueEnum:V,formItemProps:{rules:[{required:!0,message:"此项是必填项"}]},fieldProps:function(e,t){return{placeholder:"请选择集群",onChange:(n=u()(a()().mark((function n(){return a()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:e.setFieldsValue(i()({},t.entity.id,c()(c()({},e.getFieldsValue()),{},{namespace:void 0})));case 1:case"end":return n.stop()}}),n)}))),function(){return n.apply(this,arguments)})};var n}},{dataIndex:"namespace",title:"命名空间",valueType:"select",dependencies:["cluster_id"],formItemProps:{rules:[{required:!0,message:"此项是必填项"}]},fieldProps:{placeholder:"请选择命名空间",disabled:"NAMESPACE"===(null==A?void 0:A.role_type)},request:(q=u()(a()().mark((function t(n){var r,i;return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.fetchQuery(c()(c()({},y.gt.getFetchOptions({cluster_name:V[n.cluster_id].text})),{},{staleTime:3e5}));case 2:return i=t.sent,t.abrupt("return",[{label:"全部命名空间",value:"all"}].concat((null===(r=i.list)||void 0===r?void 0:r.map((function(e){return{label:e.name,value:e.name}})))||[]));case 4:case"end":return t.stop()}}),t)}))),function(e){return q.apply(this,arguments)})}],editTitle:(0,Y.jsxs)(w.Z,{children:[(0,Y.jsx)(T.ZP,{type:"primary",children:"编辑授权"}),A&&("CLUSTER"===(null==A?void 0:A.role_type)?(0,Y.jsx)(P.Z,{color:"blue",children:"集群"}):(0,Y.jsx)(P.Z,{color:"green",children:"普通"}))]})})},{key:"basic",label:"基础信息",children:A&&(0,Y.jsxs)("div",{className:E,children:[(0,Y.jsxs)(M.Z,{className:O,children:[(0,Y.jsx)("div",{children:"角色名"}),(0,Y.jsx)("div",{children:A.name})]}),(0,Y.jsxs)(M.Z,{className:O,children:[(0,Y.jsx)("div",{children:"角色类型"}),(0,Y.jsx)("div",{children:"CLUSTER"===A.role_type?(0,Y.jsx)(P.Z,{color:"blue",children:"集群"}):(0,Y.jsx)(P.Z,{color:"green",children:"普通"})})]}),(0,Y.jsxs)(M.Z,{className:O,children:[(0,Y.jsx)("div",{children:"默认角色"}),(0,Y.jsx)("div",{children:A.is_default?(0,Y.jsx)(P.Z,{children:"是"}):(0,Y.jsx)(P.Z,{color:"blue",children:"否"})})]}),(0,Y.jsxs)(M.Z,{className:O,children:[(0,Y.jsx)("div",{children:"最后更新人"}),(0,Y.jsx)("div",{children:A.update_by})]}),(0,Y.jsxs)(M.Z,{className:O,children:[(0,Y.jsx)("div",{children:"最后更新时间"}),(0,Y.jsx)("div",{children:(0,g.kZ)(A.update_time)})]}),(0,Y.jsxs)(M.Z,{className:O,children:[(0,Y.jsx)("div",{children:"备注"}),(0,Y.jsx)("div",{children:A.description})]})]})},{label:"YAML",key:"YAML",children:(0,Y.jsx)("div",{className:E,children:(0,Y.jsx)(m.Z,{disabledEdit:null==A?void 0:A.is_default,onRefresh:u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,H();case 2:return t=e.sent,e.abrupt("return",t.yaml);case 4:case"end":return e.stop()}}),e)}))),defaultContent:(null==A?void 0:A.yaml)||"",editorHeight:500})})}]})]})}},29762:function(e,t,n){"use strict";n.d(t,{Z:function(){return j}});var r=n(48305),i=n.n(r),s=n(36954),a=n(38218),l=n(36241),u=n(21630),o=n(62193),c=n(3885),d=n(97536),f=n(69180),h=n(50959),m="title___qEjyg",p="name___p26Np",v="dropdown___unIV5",x=n(11527),j=function(e){var t=u.Z.useForm(),n=i()(t,1)[0],r=(0,h.useState)(!1),j=i()(r,2),Z=j[0],y=j[1],g=(0,h.useState)(!1),_=i()(g,2),b=_[0],C=_[1],k=(0,a.useParams)().clusterName,w=void 0===k?"":k,P=e.title,$=e.formInitialValues,S=e.onDelete,T=e.refresh,M=e.operationRender,N=e.onRestart,R=e.editRender,E=e.yaml,O=e.name,Y=(0,h.useMemo)((function(){var e=[];return void 0!==E&&e.push({label:"编辑yaml",key:"edit-yaml"}),R&&e.push({label:"编辑",key:"edit"}),N&&e.push({label:"重启",key:"restart"}),S&&e.push({label:"删除",key:"delete"}),e}),[E,P,O,w,T,S,N]);return(0,x.jsxs)("div",{className:m,children:[(0,x.jsxs)(o.Z,{justify:"space-between",children:[(0,x.jsxs)(c.Z,{children:[(0,x.jsx)("span",{className:p,children:P}),(0,x.jsx)(c.Z,{children:M&&M()})]}),Y.length>0&&(0,x.jsx)(d.Z,{overlayClassName:v,menu:{items:Y,onClick:function(e){if("delete"!==e.key)return"edit"===e.key?(y(!0),void n.setFieldsValue($||{})):void("restart"!==e.key?"edit-yaml"!==e.key||C(!0):null==N||N());null==S||S()}},children:(0,x.jsx)(f.ZP,{style:{padding:"4px 8px"},children:(0,x.jsx)(l.Z,{})})})]}),R&&R({title:P,form:n,open:Z,onClose:function(){y(!1)},onOk:function(){y(!1),null==T||T()},type:"edit"}),b&&(0,x.jsx)(s.Z,{title:"【".concat(P,"-").concat(O,"】编辑Yaml"),defaultValue:E,clusterName:w,onCancel:function(){C(!1),null==T||T()}})]})}},56765:function(e,t,n){"use strict";n.d(t,{jp:function(){return u},kZ:function(){return c},yq:function(){return o}});var r=n(5726),i=n.n(r),s=n(11110),a=n.n(s);i().extend(a());var l=function(e){var t=(Date.now()-e)/1e3;return t<60?{duration:t,unit:"second"}:t<3600?{duration:Math.floor(t/60),unit:"minute"}:t<86400?{duration:Math.floor(t/3600),unit:"hour"}:{duration:Math.floor(t/86400),unit:"day"}},u=function(e){if(void 0===e)return"";var t=l(e);return"second"===t.unit?"1分钟内":"".concat(t.duration," ").concat({second:"秒",minute:"分钟",hour:"小时",day:"天"}[t.unit],"前")},o=function(e){var t=l(e);return"second"===t.unit?"1分钟内":"约".concat(t.duration).concat({second:"秒",minute:"分钟",hour:"小时",day:"天"}[t.unit])},c=function(e){return isNaN(Number(e))?e:i()(Number(e)).format("YYYY-MM-DD HH:mm:ss")}},11110:function(e){e.exports=function(){"use strict";var e="minute",t=/[+-]\d\d(?::?\d\d)?/g,n=/([+-]|\d\d)/g;return function(r,i,s){var a=i.prototype;s.utc=function(e){return new i({date:e,utc:!0,args:arguments})},a.utc=function(t){var n=s(this.toDate(),{locale:this.$L,utc:!0});return t?n.add(this.utcOffset(),e):n},a.local=function(){return s(this.toDate(),{locale:this.$L,utc:!1})};var l=a.parse;a.parse=function(e){e.utc&&(this.$u=!0),this.$utils().u(e.$offset)||(this.$offset=e.$offset),l.call(this,e)};var u=a.init;a.init=function(){if(this.$u){var e=this.$d;this.$y=e.getUTCFullYear(),this.$M=e.getUTCMonth(),this.$D=e.getUTCDate(),this.$W=e.getUTCDay(),this.$H=e.getUTCHours(),this.$m=e.getUTCMinutes(),this.$s=e.getUTCSeconds(),this.$ms=e.getUTCMilliseconds()}else u.call(this)};var o=a.utcOffset;a.utcOffset=function(r,i){var s=this.$utils().u;if(s(r))return this.$u?0:s(this.$offset)?o.call(this):this.$offset;if("string"==typeof r&&(r=function(e){void 0===e&&(e="");var r=e.match(t);if(!r)return null;var i=(""+r[0]).match(n)||["-",0,0],s=i[0],a=60*+i[1]+ +i[2];return 0===a?0:"+"===s?a:-a}(r),null===r))return this;var a=Math.abs(r)<=16?60*r:r,l=this;if(i)return l.$offset=a,l.$u=0===r,l;if(0!==r){var u=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(l=this.local().add(a+u,e)).$offset=a,l.$x.$localOffset=u}else l=this.utc();return l};var c=a.format;a.format=function(e){var t=e||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return c.call(this,t)},a.valueOf=function(){var e=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*e},a.isUTC=function(){return!!this.$u},a.toISOString=function(){return this.toDate().toISOString()},a.toString=function(){return this.toDate().toUTCString()};var d=a.toDate;a.toDate=function(e){return"s"===e&&this.$offset?s(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():d.call(this)};var f=a.diff;a.diff=function(e,t,n){if(e&&this.$u===e.$u)return f.call(this,e,t,n);var r=this.local(),i=s(e).local();return f.call(r,i,t,n)}}}()}}]);