"use strict";(self.webpackChunkcnmp=self.webpackChunkcnmp||[]).push([[1473],{69346:function(e,t,n){n.d(t,{Z:function(){return b}});var o=n(15558),r=n.n(o),l=n(26068),i=n.n(l),a=n(48305),d=n.n(a),s=n(56330),c=n(79179),u=n(60125),h=n(10534),f=n(65460),m=n(80699),v=n(82187),p=n.n(v),x=n(50959),g="no-left-title___t8LWq",j=n(11527),b=function(e){var t=e.placeholder,n=e.request,o=e.columns,l=e.leftTitle,a=e.tableProps,v=e.showSearch,b=void 0===v||v,Z=e.dataSource,w=e.searchWidth,_=e.rightTitle,C=void 0===_?[]:_,y=e.refreshDeps,k=e.actionRef,I=e.hideTitle,F=(0,u.T)(k),P=(0,x.useState)(""),S=d()(P,2),N=S[0],A=S[1],q=(0,x.useRef)(""),T=(0,h.Z)((function(){var e,t;null===(e=F.current)||void 0===e||null===(t=e.reloadAndRest)||void 0===t||t.call(e)}),{wait:500}).run;return(0,f.Z)((function(){var e;null===(e=F.current)||void 0===e||e.reload()}),y||[]),(0,j.jsx)(c.Z,i()({className:p()((""===l||void 0===l)&&g),actionRef:F,headerTitle:l,dataSource:Z,search:!1,columns:o,request:n&&function(e){return n(i()(i()({},e),{},{keyword:q.current}))},pagination:{showSizeChanger:!0},options:{reload:!!n},toolBarRender:!I&&function(){return[].concat(r()(C),r()(b?[(0,j.jsx)(m.Z,{style:{width:null!=w?w:300},value:N,placeholder:t,onChange:function(e){A(e.target.value),q.current=e.target.value,T()},allowClear:!0,suffix:(0,j.jsx)(s.Z,{style:{color:"#918f8f"}})},"__search__input")]:[]))}},a))}},60148:function(e,t,n){n.d(t,{Z:function(){return c}});var o=n(26068),r=n.n(o),l=n(59614),i=n(26059),a=n(85584),d=(n(50959),"tag___Cjdmk"),s=n(11527),c=function(e){var t=e.items,n=e.max,o=e.direction,c=void 0===o?"horizontal":o,u=e.tagStyle;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.Z,{direction:c,size:[4,0],wrap:!0,children:t.slice(0,n).map((function(e,t){return(0,s.jsx)(i.Z,{title:e.value,children:(0,s.jsx)(a.Z,{className:d,color:e.color,style:r()({overflow:"hidden",textOverflow:"ellipsis"},u),children:e.value},t)},t)}))}),n&&t.length>n&&(0,s.jsx)(i.Z,{color:"#ffffff",title:(0,s.jsx)(s.Fragment,{children:t.slice(n).map((function(e,t){return(0,s.jsx)(a.Z,{className:d,color:e.color,children:e.value},t)}))}),children:(0,s.jsx)(a.Z,{className:d,children:"..."})})]})}},60125:function(e,t,n){n.d(t,{T:function(){return r}});var o=n(50959),r=function(e,t){var n=(0,o.useRef)(t);return e||n}},69603:function(e,t,n){n.r(t);var o=n(48305),r=n.n(o),l=n(25298),i=n.n(l),a=n(17069),d=n.n(a),s=n(82092),c=n.n(s),u=n(30813),h=n(54690),f=n(31906),m=n(16639),v=n(2918),p=n(35028),x=n(72306),g=n(59614),j=n(97628),b=n(80699),Z=n(24390),w=n(94687),_=n(80487),C=n(32699),y=n.n(C),k=n(40892),I=n(50959),F=n(40191),P=n(11527),S=(k.editor.IContentWidget,k.editor.ICodeEditor,function(){function e(t,n,o){var r=this;i()(this,e),c()(this,"domNode",void 0),this.placeholder=t,this.editor=n,this.monaco=o,n.onDidChangeModelContent((function(){return r.onDidChangeModelContent()})),this.onDidChangeModelContent()}return d()(e,[{key:"onDidChangeModelContent",value:function(){""===this.editor.getValue()?this.editor.addContentWidget(this):this.editor.removeContentWidget(this)}},{key:"getId",value:function(){return e.ID}},{key:"getDomNode",value:function(){return this.domNode||(this.domNode=document.createElement("div"),this.domNode.setAttribute("class","placeholder-content-widget"),this.domNode.style.width="max-content",this.domNode.style.whiteSpace="pre-wrap",this.domNode.style.pointerEvents="none",this.domNode.textContent=this.placeholder,this.editor.applyFontInfo(this.domNode)),this.domNode}},{key:"getPosition",value:function(){return{position:{lineNumber:1,column:1},preference:[this.monaco.editor.ContentWidgetPositionPreference.EXACT]}}},{key:"dispose",value:function(){this.editor.removeContentWidget(this)}}]),e}());c()(S,"ID","editor.widget.placeholderHint");t.default=function(){var e=m.Z.useForm(),t=r()(e,1)[0],n=(0,I.useState)([]),o=r()(n,2),l=o[0],i=o[1],a=(0,I.useState)(!1),d=r()(a,2),s=d[0],c=d[1];return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)("div",{className:F.Z.block,children:(0,P.jsx)(v.Z,{items:[{title:"集群列表"}]})}),(0,P.jsx)(h.Z,{leftTitle:function(e){return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(p.ZP,{type:"primary",onClick:function(){c(!0)},children:"导入集群"}),(0,P.jsx)(x.Z,{open:s,title:"导入K8S集群",width:800,onClose:function(){c(!1),t.resetFields()},extra:(0,P.jsxs)(g.Z,{children:[(0,P.jsx)(p.ZP,{onClick:function(){c(!1),t.resetFields()},children:"取消"}),(0,P.jsx)(p.ZP,{type:"primary",onClick:function(){t.validateFields().then((function(n){(0,u.$S)({name:n.name,description:n.description,import_type:n.import_type,import_detail:{kube_config:n.kube_config,api_server:n.api_server,context:n.context}}).then((function(){var n;j.ZP.success("导入成功"),c(!1),t.resetFields(),null===(n=e.current)||void 0===n||n.reload()}))}))},children:"确认"})]}),children:(0,P.jsxs)(m.Z,{labelCol:{span:4},wrapperCol:{span:20},form:t,children:[(0,P.jsx)(m.Z.Item,{label:"集群名称",required:!0,name:"name",rules:[{required:!0,message:"请输入集群名称"},{max:100,message:"集群名称最大100字符"}],children:(0,P.jsx)(b.Z,{placeholder:"请输入集群名称"})}),(0,P.jsx)(m.Z.Item,{label:"备注",name:"description",rules:[{max:1e3,message:"备注最大100字符"}],children:(0,P.jsx)(b.Z.TextArea,{placeholder:"请输入集群备注"})}),(0,P.jsx)(m.Z.Item,{label:"管理方式",required:!0,name:"import_type",initialValue:"KubeConfig",children:(0,P.jsxs)(Z.ZP.Group,{children:[(0,P.jsx)(Z.ZP,{value:"KubeConfig",children:"KubeConfig"}),(0,P.jsx)(Z.ZP,{value:"Token",disabled:!0,children:"Token"})]})}),(0,P.jsx)(m.Z.Item,{label:"KubeConfig",required:!0,name:"kube_config",children:(0,P.jsx)(f.ZP,{theme:"vs-dark",language:"yaml",height:300,options:{minimap:{enabled:!1},fontSize:14,scrollBeyondLastLine:!1},onMount:function(e,t){new S("请在执行kubectl指令所在机器的用户目录下的 .kube/config 文件的内容粘贴到此处\n注意包含集群的CA证书和用户认证信息",e,t)},onChange:function(e){try{var n,o,r=_.ZP.load(e||""),a=null==r||null===(n=r.clusters)||void 0===n||null===(n=n[0])||void 0===n||null===(n=n.cluster)||void 0===n?void 0:n.server;t.setFieldsValue({api_server:a});var d=null==r||null===(o=r.contexts)||void 0===o?void 0:o.map((function(e){var t;return null==e||null===(t=e.context)||void 0===t?void 0:t.cluster})).filter((function(e){return void 0!==e}));if(d&&!y().isEqual(d,l))if(i(d),d.length>0){var s=t.getFieldValue("context");d.some((function(e){return s===e}))||t.setFieldsValue({context:d[0]})}else t.setFieldsValue({context:void 0});else void 0===d&&(i([]),t.setFieldsValue({context:void 0}))}catch(e){t.setFieldsValue({api_server:void 0,context:void 0})}}})}),(0,P.jsx)(m.Z.Item,{label:"API Server地址",required:!0,name:"api_server",children:(0,P.jsx)(b.Z,{placeholder:"请输入API Server地址，为空时会自动读取KubeConfig文件的内容"})}),(0,P.jsx)(m.Z.Item,{label:"Context",required:!0,name:"context",children:(0,P.jsx)(w.Z,{placeholder:"请选择Context，会自动读取KubeConfig文件的内容",options:l.map((function(e){return{label:e,value:e}}))})})]})})]})},request:function(e){return(0,u.LB)({page:e.current,page_size:e.pageSize,keyword:e.keyword}).then((function(e){return{total:e.total,data:e.list||[]}}))},deletable:!0})]})}},54690:function(e,t,n){n.d(t,{Z:function(){return A}});var o=n(26068),r=n.n(o),l=n(90228),i=n.n(l),a=n(87999),d=n.n(a),s=n(15558),c=n.n(s),u=n(67825),h=n.n(u),f=n(30813),m=n(69346),v=n(60148),p=n(32030),x=n(51142),g=n(26059),j=n(41637),b=n(69042),Z=n(88934),w=n(80699),_=n(97628),C=n(50959),y="ellipsis-text___uYXM_",k="comment___kKz5f",I="follow___EsJHj",F=n(11527),P=["showAll","leftTitle","dataSource","request","deletable","showFollow"],S={0:{label:"运行中",color:"#52C41A"},1:{label:"异常",color:"#FF4D4F"},2:{label:"离线",color:"#AAAAAA"}},N={0:{label:"健康",color:"green"},1:{label:"内存使用量过80%",color:"red"},2:{label:"离线",color:"green"},3:{label:"CPU使用量过80%",color:"red"},4:{label:"磁盘使用量过80%",color:"red"},5:{label:"网络IO过高",color:"red"},6:{label:"节点状态异常",color:"red"},7:{label:"调度器异常",color:"red"},8:{label:"控制器管理器异常",color:"red"},9:{label:"存储异常",color:"red"}},A=function(e){var t=e.showAll,n=e.leftTitle,o=e.dataSource,l=e.request,a=e.deletable,s=e.showFollow,u=void 0===s||s,A=h()(e,P),q=(0,C.useRef)(null),T=(0,C.useMemo)((function(){var e,t=(e={follow:u},[{title:"名称/备注",dataIndex:"name",width:220,render:function(t,n){return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)(x.Z,{children:[(0,F.jsx)(g.Z,{title:t,overlayInnerStyle:{width:100,overflow:"hidden"},children:(0,F.jsx)(p.Link,{to:"/cluster/".concat(t,"/namespace"),style:{maxWidth:160},className:y,children:t})}),(null==e?void 0:e.follow)&&(0,F.jsx)(j.Z,{count:1,className:I})]}),(0,F.jsx)(g.Z,{title:t,overlayInnerStyle:{width:100,overflow:"hidden"},children:(0,F.jsx)("div",{className:"".concat(k," ").concat(y),style:{maxWidth:200},children:n.description})})]})}},{title:"状态",dataIndex:"cluster_state",width:80,render:function(e){var t,n;return(0,F.jsx)("span",{style:{color:(null===(t=S[e])||void 0===t?void 0:t.color)||"#000000"},children:null===(n=S[e])||void 0===n?void 0:n.label})}},{title:"健康检查",dataIndex:"health_state",width:240,render:function(e){return(0,F.jsx)(v.Z,{items:e.map((function(e){var t,n;return{value:null===(t=N[e])||void 0===t?void 0:t.label,color:null===(n=N[e])||void 0===n?void 0:n.color}}))})}},{title:"版本",dataIndex:"server_version",width:160},{title:"创建时间",dataIndex:"build_date",width:160},{title:"节点数",dataIndex:"node_count",width:100},{title:"CPU使用量",dataIndex:"cpu_usage",width:180,render:function(e,t){var n=e?e/t.cpu_total*100:0,o="#1677ff";return n>80?o="#ff4d4f":n>60&&(o="#faad14"),(0,F.jsxs)("div",{children:[(0,F.jsx)("div",{children:"".concat(e||0,"/").concat(t.cpu_total||0,"核")}),(0,F.jsx)(b.Z,{style:{marginBottom:0},percent:n,strokeColor:o,format:function(){return Math.round(n)+"%"}})]})}},{title:"内存使用量",dataIndex:"memory_usage",width:180,render:function(e,t){var n=e?e/t.memory_total*100:0,o="#1677ff";return n>80?o="#ff4d4f":n>60&&(o="#faad14"),(0,F.jsxs)("div",{children:[(0,F.jsx)("div",{children:"".concat(e||0,"/").concat(t.memory_total||0,"GB")}),(0,F.jsx)(b.Z,{style:{marginBottom:0},percent:n,strokeColor:o,format:function(){return Math.round(n)+"%"}})]})}}]);return a?[].concat(c()(t),[{title:"操作",dataIndex:"operation",width:100,render:function(e,t){return(0,F.jsx)("a",{onClick:function(){var e,n=Z.Z.confirm({title:"删除集群",content:(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)("p",{children:["删除命名空间,确认删除集群【$",t.name,"】"]})," ",(0,F.jsx)(w.Z,{placeholder:"请输入集群名",onChange:function(e){e.target.value===t.name?n.update({okButtonProps:{disabled:!1}}):n.update({okButtonProps:{disabled:!0}})}})]}),okButtonProps:{disabled:!0},onOk:(e=d()(i()().mark((function e(){var n;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,f.Ue)({id:t.id});case 2:_.ZP.success("删除成功"),null===(n=q.current)||void 0===n||n.reload();case 4:case"end":return e.stop()}}),e)}))),function(){return e.apply(this,arguments)})})},children:"删除"})}}]):t}),[a,u]);return(0,F.jsx)(m.Z,{searchWidth:320,actionRef:q,columns:T,request:l,leftTitle:"function"==typeof n?null==n?void 0:n(q):n,placeholder:"模糊搜索集群名称、备注、状态、版本",showSearch:!t,tableProps:r()(r()({rowKey:"id"},A),{},{pagination:!t&&void 0}),dataSource:o})}},40191:function(e,t){t.Z={block:"block___QmcSu"}}}]);