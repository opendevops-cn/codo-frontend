"use strict";(self.webpackChunkcnmp=self.webpackChunkcnmp||[]).push([[4529],{66780:function(e,n,l){l.d(n,{Z:function(){return o}});var r=l(79482),t=l(50959),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zM704 536c0 4.4-3.6 8-8 8H544v152c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V544H328c-4.4 0-8-3.6-8-8v-48c0-4.4 3.6-8 8-8h152V328c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v152h152c4.4 0 8 3.6 8 8v48z"}}]},name:"plus-square",theme:"filled"},i=l(28371),s=function(e,n){return t.createElement(i.Z,(0,r.Z)({},e,{ref:n,icon:a}))};var o=t.forwardRef(s)},50660:function(e,n,l){var r=l(79482),t=l(50959),a=l(92484),i=l(28371),s=function(e,n){return t.createElement(i.Z,(0,r.Z)({},e,{ref:n,icon:a.Z}))},o=t.forwardRef(s);n.Z=o},37610:function(e,n,l){var r=l(48305),t=l.n(r),a=l(22927),i=l(66780),s=l(21630),o=l(75929),u=l(62193),c=l(3885),d=l(14621),m=l(32699),f=l.n(m),v=l(50959),x=l(11527);n.Z=function(e){var n=e.operationProps,l=e.label,r=e.name,m=e.fieldRender,h=e.labelCol,p=e.itemMax,Z=e.addText,j=e.showSwitch,b=e.minItem,y=(0,v.useState)(!0),g=t()(y,2),k=g[0],w=g[1],_=s.Z.useFormInstance(),P=(0,v.useRef)();return(0,v.useEffect)((function(){if(j){var e=_.getFieldValue([r]);w(!(!e||f().isEmpty(e)))}}),[_,j,r]),(0,x.jsx)(x.Fragment,{children:(0,x.jsxs)(s.Z.Item,{labelCol:h,label:l,children:[j&&(0,x.jsx)("div",{style:{height:32,display:"flex",alignItems:"center",marginBottom:k?10:0},children:(0,x.jsx)(o.Z,{value:k,onChange:function(e){w(e),e?P.current?_.setFieldValue([r],P.current):_.setFieldValue([r],[{type:"default"}]):(P.current=_.getFieldValue([r]),_.setFieldValue([r],[]))}})}),k&&(0,x.jsx)(s.Z.List,{name:r,children:function(e,l){return(0,x.jsxs)(x.Fragment,{children:[e.map((function(n,r){return(0,x.jsxs)(u.Z,{gap:16,children:[m(n,r,l),(!b||b<e.length)&&(0,x.jsx)(a.Z,{style:{display:"flex",alignSelf:"baseline",paddingTop:10},onClick:function(){l.remove(n.name)}})]},n.key)})),(0,x.jsx)("div",{children:(0,x.jsx)(d.Z,{disabled:!!p&&e.length>=p,onClick:function(){var e;l.add(null==n||null===(e=n.add)||void 0===e?void 0:e.defaultValue)},children:(0,x.jsxs)(c.Z,{children:[(0,x.jsx)(i.Z,{style:{fontSize:20,verticalAlign:"text-bottom"}}),null!=Z?Z:"添加"]})})})]})}})]})})}},13885:function(e,n,l){var r=l(26068),t=l.n(r),a=l(15558),i=l.n(a),s=l(21630),o=l(96286),u=l(37610),c=l(32699),d=l.n(c),m=(l(50959),l(11527)),f=function(e,n,l,r){var t=r||{},a=t.repeat,s=t.required,o=t.rules;return[].concat(i()(s?[{required:!0,message:"string"==typeof s?s:"请输入"}]:[]),i()(a?[]:[{validator:function(r,t){return(n.getFieldValue(l[0])||[]).some((function(n,r){return!d().isNil(null==n?void 0:n[l[1]])&&n[l[1]]===t&&e!==r}))?Promise.reject(new Error("string"==typeof a?a:"存在重复值，请修改")):Promise.resolve()}}]),i()(o||[]))};n.Z=function(e){var n=e.keyOption,l=void 0===n?{}:n,r=e.valueOption,a=void 0===r?{}:r,i=e.placeholder,c=e.label,d=e.name,v=e.keyRules,x=e.valueRules,h=e.addText,p=s.Z.useFormInstance();return(0,m.jsx)(u.Z,{label:c,name:d,addText:h,fieldRender:function(e,n){var r,u;return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(s.Z.Item,{name:[e.name,"key"],rules:f(n,p,[d,"key"],t()({required:!0,repeat:!1,rules:[]},l))||(null==v?void 0:v(n))||[],style:{width:"100%"},children:(0,m.jsx)(o.Z,{placeholder:null!==(r=null==i?void 0:i[0])&&void 0!==r?r:"请输入键"})}),(0,m.jsx)(s.Z.Item,{name:[e.name,"value"],rules:f(n,p,[d,"value"],t()({required:!1,repeat:!0,rules:[]},a))||(null==x?void 0:x(n))||[],style:{width:"100%"},children:(0,m.jsx)(o.Z,{placeholder:null!==(u=null==i?void 0:i[1])&&void 0!==u?u:"请输入值"})})]})}})}},14621:function(e,n,l){l.d(n,{Z:function(){return c}});var r=l(26068),t=l.n(r),a=l(67825),i=l.n(a),s=(l(50959),"disabled___nnQy2"),o=l(11527),u=["disabled","children","onClick","className"],c=function(e){var n=e.disabled,l=e.children,r=e.onClick,a=e.className,c=void 0===a?"":a,d=i()(e,u);return(0,o.jsx)("a",t()(t()({className:n?s+" "+c:c,onClick:function(){n||null==r||r()}},d),{},{children:l}))}},57108:function(e,n,l){l.d(n,{Z:function(){return Q}});var r=l(90228),t=l.n(r),a=l(26068),i=l.n(a),s=l(67825),o=l.n(s),u=l(87999),c=l.n(u),d=l(15558),m=l.n(d),f=l(48305),v=l.n(f),x=l(15268),h=l(13885),p=l(37610),Z=l(80173),j=l(21630),b=l(13702),y=l(22639),g=l(50959),k=l(11527),w=function(e){var n=e.label,l=e.name,r=j.Z.useWatch(l);return(0,k.jsx)(p.Z,{label:n,name:l,itemMax:4,fieldRender:function(e,n){var l;return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(j.Z.Item,{name:[e.name,"name"],rules:[{required:!0,message:"请选择"}],children:(0,k.jsx)(b.Z,{placeholder:"请选择",options:Z.v.map((function(e){return i()(i()({},e),{},{disabled:null==r?void 0:r.some((function(n){return n&&n.name===e.value}))})})),style:{width:200}})}),(0,k.jsx)(j.Z.Item,{name:[e.name,"value"],rules:[{required:!0,message:"请输入"},{pattern:/^-?\d+$/,message:"请输入整数"}],children:(0,k.jsx)(y.Z,{placeholder:"请输入整数",style:{width:200},suffix:null!=r&&r[n]?null===(l=Z.v.find((function(e){return e.value===r[n].name})))||void 0===l?void 0:l.suffix:""})})]})}})},_=function(e){var n=e.label,l=e.name,r=j.Z.useWatch(l);return console.log("formData",r),(0,k.jsxs)(j.Z.Item,{label:n,children:[(0,k.jsx)(j.Z.Item,{labelCol:{span:4},label:"窗口稳定时间",name:[l,"stabilizationWindowSeconds"],children:(0,k.jsx)(y.Z,{placeholder:"窗口稳定时间stabilizationWindowSeconds",style:{width:320},suffix:"秒"})}),(0,k.jsx)(j.Z.Item,{labelCol:{span:4},label:"selectPolicy",name:[l,"selectPolicy"],children:(0,k.jsx)(b.Z,{placeholder:"请选择",style:{width:320},allowClear:!0,options:[{value:"Max",label:"Max"},{value:"Min",label:"Min"},{value:"Disable",label:"Disable"}]})}),(0,k.jsx)(p.Z,{label:"Policy",name:[l,"policies"],itemMax:2,labelCol:{span:4},fieldRender:function(e,n){var l,t;return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(j.Z.Item,{name:[e.name,"periodSeconds"],children:(0,k.jsx)(y.Z,{placeholder:"步长periodSeconds",style:{width:180},suffix:"秒"})}),(0,k.jsx)(j.Z.Item,{name:[e.name,"type"],children:(0,k.jsx)(b.Z,{placeholder:"请输入键",style:{width:160},options:Z.g.map((function(e){var n;return i()(i()({},e),{},{disabled:null==r||null===(n=r.policies)||void 0===n?void 0:n.some((function(n){return n&&n.type===e.value}))})}))})}),(0,k.jsx)(j.Z.Item,{name:[e.name,"value"],children:(0,k.jsx)(y.Z,{placeholder:"请输入整数",style:{width:160},suffix:null!=r&&null!==(l=r.policies)&&void 0!==l&&l[n]?null===(t=Z.g.find((function(e){return e.value===(null==r?void 0:r.policies[n].type)})))||void 0===t?void 0:t.suffix:""})})]})}})]})},P=l(89629),C=l(38218),I=l(79482),F=l(20661),R=l(28371),q=function(e,n){return g.createElement(R.Z,(0,I.Z)({},e,{ref:n,icon:F.Z}))};var M=g.forwardRef(q),E=l(48145),V=function(e,n){return g.createElement(R.Z,(0,I.Z)({},e,{ref:n,icon:E.Z}))};var z=g.forwardRef(V),N=l(70334),S=l(93441),D=l(3885),O=l(69180),H=l(64297),T=l(75398),W=l(96286),Y=l(60913),A=l(75929),$=l(5726),B=l.n($),L=["offline_deadline","annotations","labels","selector"],Q=function(e){var n=e.form,l=e.title,r=e.open,a=e.onClose,s=e.type,u=e.onOk,d=(0,C.useParams)(),f=d.clusterName,p=void 0===f?"":f,Z=d.namespace,I=void 0===Z?"":Z,F=(0,P.gt)({variables:{list_all:1,cluster_name:p}}).data,R=(0,g.useState)(!1),q=v()(R,2),E=q[0],V=q[1],$=function(e){var l=e.index,r=e.max,t=e.type,a=e.shouldPattern,i=void 0===a||a;return[].concat(m()(r?[{max:r,message:"最长".concat(r,"个字符")}]:[]),m()(i?[{message:"支持字母、数字及分隔符（“-”、“_”、”.”、“/”），需以字母、数字开头",pattern:/^[a-zA-Z0-9][a-zA-Z0-9./_-]*$/}]:[]),m()("key"===t?[{required:!0,message:"请输入".concat(t)},{validator:function(e,r){return(n.getFieldValue("labels")||[]).some((function(e,n){return e.key===r&&l!==n}))?Promise.reject(new Error("存在重复key，请修改key")):Promise.resolve()}}]:[]))};return(0,k.jsx)(S.Z,{open:r,title:l,width:900,onClose:function(){n.resetFields(),a()},extra:(0,k.jsxs)(D.Z,{children:[(0,k.jsx)(O.ZP,{onClick:function(){a(),n.resetFields()},children:"取消"}),(0,k.jsx)(O.ZP,{type:"primary",onClick:function(){n.validateFields().then(function(){var e=c()(t()().mark((function e(l){var r,a,c,d,m,f;return t()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=l.offline_deadline,a=l.annotations,c=l.labels,d=l.selector,m=o()(l,L),f=i()(i()({},m),{},{annotations:a?Object.fromEntries(a.map((function(e){return[e.key,e.value]}))):void 0,labels:c?Object.fromEntries(c.map((function(e){return[e.key,e.value]}))):void 0,selector:d?Object.fromEntries(d.map((function(e){return[e.key,e.value]}))):void 0,offline_deadline:r?B()(r).valueOf():void 0,cluster_name:p}),"create"!==s){e.next=8;break}return e.next=5,(0,x.dW)(f);case 5:N.ZP.success("创建成功"),e.next=11;break;case 8:return e.next=10,(0,x.tZ)(f);case 10:N.ZP.success("编辑成功");case 11:n.resetFields(),null==u||u();case 13:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}())},children:"确认"})]}),children:(0,k.jsx)(H.ZP,{theme:{components:{Divider:{orientationMargin:.001}}},children:(0,k.jsxs)(j.Z,{labelCol:{span:4},form:n,children:[(0,k.jsx)(T.Z,{orientation:"left",children:"基础信息"}),(0,k.jsx)(j.Z.Item,{label:"名称",name:"name",rules:[{required:!0,message:"请输入名称"},{max:63,message:"最长63个字符"},{pattern:/^[a-z0-9][a-z0-9.-]*[a-z0-9]$/,message:"只能包含小写字母、数字、分隔符(“-“）、小数点(“.”)，且必须以小写字母或数字开头和结尾"}],children:(0,k.jsx)(W.Z,{disabled:"edit"===s,placeholder:"最长63个字符，只能包含小写字母、数字、分隔符(“-“）、小数点(“.”)，且必须以小写字母或数字开头和结尾"})}),(0,k.jsx)(j.Z.Item,{label:"命名空间",name:"namespace",rules:[{required:!0,message:"请输入命名空间"}],initialValue:I,children:(0,k.jsx)(b.Z,{options:null==F?void 0:F.list.map((function(e){return{value:e.name,label:e.name}})),disabled:"edit"===s})}),(0,k.jsx)(h.Z,{name:"selector",label:"选择器",form:n,keyRules:function(e){return $({index:e,max:316,type:"key"})},valueRules:function(e){return $({index:e,max:63,type:"key"})}}),(0,k.jsx)(h.Z,{name:"labels",label:"标签",form:n,keyRules:function(e){return $({index:e,max:316,type:"key"})},valueRules:function(e){return $({index:e,max:63,type:"key"})}}),(0,k.jsx)(h.Z,{name:"annotations",label:"注解",form:n,keyRules:function(e){return $({index:e,max:316,type:"key"})},valueRules:function(e){return $({index:e,type:"key",shouldPattern:!1})}}),(0,k.jsx)(T.Z,{orientation:"left",children:"版本管理"}),(0,k.jsx)(j.Z.Item,{label:"线上版本",name:"online_version",rules:[{required:!0,message:"请输入线上版本"},{max:63,message:"最长63个字符"},{validator:function(e,n){return n.split(".").length>4?Promise.reject(new Error("最多4个数字，数字间使用【.】,例：1.0.1.1")):Promise.resolve()}}],children:(0,k.jsx)(W.Z,{placeholder:"请输入线上版本，onlineVersion，最多支持4位，例：1.0.1.1"})}),(0,k.jsx)(j.Z.Item,{label:"历史版本下线",name:"offline_deadline",rules:[{required:!0,message:"请选择历史版本下线时间"}],children:(0,k.jsx)(Y.default,{showTime:!0})}),(0,k.jsx)(j.Z.Item,{label:"历史版本启用扩缩容",name:"enable_scale_up",children:(0,k.jsx)(A.Z,{checkedChildren:"开",unCheckedChildren:"关"})}),(0,k.jsx)(T.Z,{orientation:"left",children:"伸缩策略"}),(0,k.jsx)(j.Z.Item,{label:"最小实例数",name:"min_replicas",rules:[{required:!0,message:"请输入最小实例数"},{validator:function(e,n){return n<0?Promise.reject(new Error("最小实例数大于等于0")):Promise.resolve()}}],children:(0,k.jsx)(y.Z,{placeholder:"请输入",style:{width:200}})}),(0,k.jsx)(j.Z.Item,{label:"最大实例数",name:"max_replicas",rules:[{required:!0,message:"请输入最大实例数"},{validator:function(e,l){return l<0||l<n.getFieldValue("min_replicas")?Promise.reject(new Error("大实例数大于等于0并且大于等于最小实例数")):Promise.resolve()}}],children:(0,k.jsx)(y.Z,{placeholder:"请输入",style:{width:200}})}),(0,k.jsx)(w,{label:"扩容/锁定指标",name:"scale_up_metrics"},"scale_up_metrics"),(0,k.jsx)(w,{label:"缩容指标",name:"scale_down_metrics"},"scale_down_metrics"),(0,k.jsx)(T.Z,{orientation:"left",children:(0,k.jsxs)("a",{onClick:function(){V(!E)},children:["伸缩限制 ",E?(0,k.jsx)(M,{}):(0,k.jsx)(z,{})]})}),E&&[{label:"扩容策略",key:"scale_up"},{label:" 缩容策略",key:"scale_down"}].map((function(e){return(0,k.jsx)(_,{name:e.key,label:e.label},e.key)}))]})})})}},80173:function(e,n,l){l.d(n,{g:function(){return t},v:function(){return r}});var r=[{value:"virtual_cpu",label:"CPU利用率",suffix:"%"},{value:"virtual_memory",label:"内存利用率",suffix:"%"},{value:"entity_count",label:"entity数量",suffix:"个"},{value:"online_number",label:"在线人数",suffix:"个"}],t=[{value:"Pods",label:"Pod数量"},{value:"Percent",label:"Pod百分比",suffix:"%"}]},56765:function(e,n,l){l.d(n,{jp:function(){return o},kZ:function(){return c},yq:function(){return u}});var r=l(5726),t=l.n(r),a=l(11110),i=l.n(a);t().extend(i());var s=function(e){var n=(Date.now()-e)/1e3;return n<60?{duration:n,unit:"second"}:n<3600?{duration:Math.floor(n/60),unit:"minute"}:n<86400?{duration:Math.floor(n/3600),unit:"hour"}:{duration:Math.floor(n/86400),unit:"day"}},o=function(e){if(void 0===e)return"";var n=s(e);return"second"===n.unit?"1分钟内":"".concat(n.duration," ").concat({second:"秒",minute:"分钟",hour:"小时",day:"天"}[n.unit],"前")},u=function(e){var n=s(e);return"second"===n.unit?"1分钟内":"约".concat(n.duration).concat({second:"秒",minute:"分钟",hour:"小时",day:"天"}[n.unit])},c=function(e){return isNaN(Number(e))?e:t()(Number(e)).format("YYYY-MM-DD HH:mm:ss")}}}]);