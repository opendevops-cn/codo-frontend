"use strict";(self.webpackChunkcnmp=self.webpackChunkcnmp||[]).push([[2326],{83260:function(e,t,n){n.r(t);var a=n(26068),l=n.n(a),i=n(48305),r=n.n(i),s=n(15268),d=n(79890),p=n(34654),c=n(2586),o=n(38218),u=n(21630),x=n(3827),h=n(70334),j=n(18772),m=n(96286),g=n(69180),Z=(n(50959),n(11527)),y=function(e){var t=e.onCancel,n=e.onOk,a=e.initialValues,i=(0,o.useParams)(),d=i.clusterName,p=void 0===d?"":d,c=i.name,g=void 0===c?"":c,y=i.namespace,v=void 0===y?"":y,b=u.Z.useForm(),f=r()(b,1)[0],P=u.Z.useWatch("update_strategy_type",f);return(0,Z.jsx)(x.Z,{title:"更新策略",open:!0,width:600,onCancel:t,onOk:function(){f.validateFields().then((function(e){(0,s.h4)(l()({cluster_name:p,name:g,namespace:v},e)).then((function(){null==n||n(),h.ZP.success("更新策略成功")}))}))},children:(0,Z.jsxs)(u.Z,{form:f,labelCol:{span:6},initialValues:a,children:[(0,Z.jsx)(u.Z.Item,{label:"更新方式",name:"update_strategy_type",initialValue:"RollingUpdate",tooltip:{title:(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)("p",{children:"spec.updateStrategy.type"}),(0,Z.jsxs)("p",{children:["RollingUpdate：注入+滚动更新，可配置更多更新策略",(0,Z.jsx)("br",{}),"NotUpdate：不更新，此模式下只会包含注入能力",(0,Z.jsx)("br",{})]})]}),overlayInnerStyle:{width:360}},children:(0,Z.jsxs)(j.ZP.Group,{children:[(0,Z.jsx)(j.ZP,{value:"RollingUpdate",children:"滚动更新 RollingUpdate"}),(0,Z.jsx)(j.ZP,{value:"NotUpdate",children:"不更新 NotUpdate"})]})}),"RollingUpdate"===P&&(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(u.Z.Item,{label:"保留副本数",tooltip:{title:(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)("p",{children:"spec.updateStrategy.partition"}),(0,Z.jsxs)("p",{children:["滚动更新过程中，保留旧版本Pod的数量或百分比。 ",(0,Z.jsx)("br",{}),"如果是数字，控制器会将 (replicas - partition) 数量的 Pod 更新到最新版本。",(0,Z.jsx)("br",{}),"如果是百分比，控制器会将 (replicas * (100% - partition)) 数量的 Pod 更新到最新版本。"]})]}),overlayInnerStyle:{width:560}},name:"partition",rules:[{pattern:/^(?:[1-9][0-9]*|0)%?$/,message:"仅允许大于等于0的整数，或者正百分数"}],initialValue:"0",children:(0,Z.jsx)(m.Z,{placeholder:"大于等于0的整数，或者正百分数（default：0）"})}),(0,Z.jsx)(u.Z.Item,{label:"最大不可用副本数",tooltip:{title:(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)("p",{children:"spec.updateStrategy.maxUnavailable"}),(0,Z.jsxs)("p",{children:["滚动更新过程中，不可用副本数的最大值。",(0,Z.jsx)("br",{}),"该取值可以是一个绝对值（例如：5），也可以是一个相对于期望副本数的百分比（例如：10%）； 如果填写百分比，则以期望副本数乘以该百分比后向下取整的方式计算对应的绝对值；",(0,Z.jsx)("br",{}),"当最大超出副本数 maxSurge 为 0 时，此数值（maxUnavailable）不能为 0；默认值为 25%；",(0,Z.jsx)("br",{})," 例如：假设此值被设定为 30%，当滚动更新开始时，旧的副本集（ReplicaSet）可以缩容到期望 副本数的 70%；在新副本集扩容的过程中，一旦新的 Pod 已就绪，旧的副本集可以进一步缩容， 整个滚动更新过程中，确保新旧就绪副本数之和不低于期望副本数的 70%。"]})]}),overlayInnerStyle:{width:630}},name:"max_unavailable",rules:[{pattern:/^(?:[1-9][0-9]*|0)%?$/,message:"仅允许大于等于0的整数，或者正百分数"}],initialValue:"1",children:(0,Z.jsx)(m.Z,{placeholder:"大于等于0的整数，或者正百分数（default：1）"})}),(0,Z.jsx)(u.Z.Item,{label:"暂停注入",tooltip:{title:(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)("p",{children:"spec.updateStrategy.paused"}),(0,Z.jsx)("p",{children:"通过设置 paused 为 true 暂停发布，此时对于新创建的、扩容的pod依旧会实现注入能力，已经更新的pod会保持更新后的版本不动，还没有更新的pod会暂停更新。"})]}),overlayInnerStyle:{width:630}},name:"pause",initialValue:!1,children:(0,Z.jsxs)(j.ZP.Group,{children:[(0,Z.jsx)(j.ZP,{value:!1,children:"否"}),(0,Z.jsx)(j.ZP,{value:!0,children:"是"})]})})]})]})})};t.default=function(){var e=(0,p.J)();return(0,Z.jsx)(Z.Fragment,{children:(0,Z.jsx)(c.Z,{type:"sidecar-set",operationRender:function(t){return(0,Z.jsx)(Z.Fragment,{children:(0,Z.jsx)(d.Z,{modalRender:function(n){return(0,Z.jsx)(y,{initialValues:t.update_strategy,onCancel:n,onOk:function(){n(),e()}})},children:(0,Z.jsx)(g.ZP,{children:"更新策略"})})})}})})}}}]);