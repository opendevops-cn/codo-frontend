(self.webpackChunkcnmp=self.webpackChunkcnmp||[]).push([[828],{27274:function(e,t,n){"use strict";n.d(t,{Z:function(){return Z}});var r=n(15558),i=n.n(r),s=n(26068),o=n.n(s),a=n(48305),u=n.n(a),l=n(45778),c=n(95974),d=n(41710),f=n(10534),h=n(65460),v=n(96286),m=n(50959),x="table___Rup7Y",p=n(11527),Z=function(e){var t=e.placeholder,n=e.request,r=e.columns,s=e.leftTitle,a=e.tableProps,Z=e.showSearch,j=void 0===Z||Z,g=e.dataSource,$=e.searchWidth,C=e.rightTitle,y=void 0===C?[]:C,S=e.refreshDeps,k=e.actionRef,b=e.hideTitle,T=e.searchStyle,w=e.onSearch,D=(0,l.T)(k),M=(0,m.useState)(""),_=u()(M,2),Y=_[0],O=_[1],I=(0,m.useRef)(""),R=(0,f.Z)((function(){var e,t;null==w||w(Y),null===(e=D.current)||void 0===e||null===(t=e.reloadAndRest)||void 0===t||t.call(e)}),{wait:500}).run;return(0,h.Z)((function(){var e;null===(e=D.current)||void 0===e||e.reload()}),S||[]),(0,p.jsx)(d.Z,o()({className:x,actionRef:D,headerTitle:s,dataSource:g,search:!1,columns:r,request:n&&function(e){return n(o()(o()({},e),{},{keyword:I.current}))},pagination:{showSizeChanger:!0,defaultPageSize:50},options:{reload:!!n},toolBarRender:!b&&function(){return[].concat(i()(y),i()(j?[(0,p.jsx)(v.Z,{style:o()({width:null!=$?$:300},T),value:Y,placeholder:t,onChange:function(e){O(e.target.value),I.current=e.target.value,R()},allowClear:!0,suffix:(0,p.jsx)(c.Z,{style:{color:"#918f8f"}})},"__search__input")]:[]))}},a))}},14621:function(e,t,n){"use strict";n.d(t,{Z:function(){return c}});var r=n(26068),i=n.n(r),s=n(67825),o=n.n(s),a=(n(50959),"disabled___nnQy2"),u=n(11527),l=["disabled","children","onClick","className"],c=function(e){var t=e.disabled,n=e.children,r=e.onClick,s=e.className,c=void 0===s?"":s,d=o()(e,l);return(0,u.jsx)("a",i()(i()({className:t?a+" "+c:c,onClick:function(){t||null==r||r()}},d),{},{children:n}))}},45778:function(e,t,n){"use strict";n.d(t,{T:function(){return i}});var r=n(50959),i=function(e,t){var n=(0,r.useRef)(t);return e||n}},57826:function(e,t,n){"use strict";var r=n(90228),i=n.n(r),s=n(26068),o=n.n(s),a=n(87999),u=n.n(a),l=n(15268),c=n(32643),d=n(93441),f=n(3885),h=n(69180),v=n(70334),m=n(21630),x=n(96286),p=n(18772),Z=(n(50959),n(11527));t.Z=function(e){var t=e.form,n=e.title,r=e.open,s=e.onClose,a=e.type,j=e.onOk,g=e.id;return(0,Z.jsx)(d.Z,{open:r,title:n,width:800,onClose:function(){s(),t.resetFields()},extra:(0,Z.jsxs)(f.Z,{children:[(0,Z.jsx)(h.ZP,{onClick:function(){s(),t.resetFields()},children:"取消"}),(0,Z.jsx)(h.ZP,{type:"primary",onClick:u()(i()().mark((function e(){var n;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.validateFields();case 2:if(n=e.sent,"edit"!==a){e.next=8;break}return e.next=6,(0,l.$h)(o()({id:g},n));case 6:e.next=10;break;case 8:return e.next=10,(0,l.Pi)(o()({},n));case 10:v.ZP.success("操作成功"),null==j||j();case 12:case"end":return e.stop()}}),e)}))),children:"确认"})]}),children:(0,Z.jsxs)(m.Z,{labelCol:{span:3},wrapperCol:{span:21},form:t,children:[(0,Z.jsx)(m.Z.Item,{label:"角色名称",required:!0,name:"name",rules:[{required:!0,message:"请输入角色名称"},{max:50,message:"角色名称最大50字符"}],children:(0,Z.jsx)(x.Z,{placeholder:"请输入角色名称"})}),(0,Z.jsx)(m.Z.Item,{label:"角色类型",name:"role_type",tooltip:{title:(0,Z.jsxs)("div",{children:[(0,Z.jsx)("div",{children:"集群角色允许绑定全部命名空间"}),(0,Z.jsx)("div",{children:"普通角色仅允许绑定指定的命名空间"}),(0,Z.jsx)("div",{children:"涉及集群级别的resources，建议定义为集群角色"})]}),overlayInnerStyle:{width:320}},children:(0,Z.jsxs)(p.ZP.Group,{disabled:"edit"===a,children:[(0,Z.jsx)(p.ZP,{value:"CLUSTER",children:"集群"}),(0,Z.jsx)(p.ZP,{value:"NAMESPACE",children:"普通"})]})}),(0,Z.jsx)(m.Z.Item,{label:"角色备注",name:"description",rules:[{max:200,message:"备注最大200字符"}],children:(0,Z.jsx)(x.Z.TextArea,{placeholder:"请输入集群备注"})}),(0,Z.jsx)(m.Z.Item,{label:"YAML",required:!0,name:"yaml",tooltip:{title:"所有角色的kind都为ClusterRole，在授权时可以选择将角色绑定到全部命名空间或指定命名空间",overlayInnerStyle:{width:390}},children:(0,Z.jsx)(c.ZP,{theme:"vs-dark",language:"yaml",height:300,options:{minimap:{enabled:!1},fontSize:14,scrollBeyondLastLine:!1}})})]})})}},61745:function(e,t,n){"use strict";n.r(t);var r=n(48305),i=n.n(r),s=n(15268),o=n(27274),a=n(14621),u=n(57826),l=n(34593),c=n(56765),d=n(38218),f=n(21630),h=n(69180),v=n(89169),m=n(3885),x=n(3827),p=n(70334),Z=n(50959),j=n(11527);t.default=function(){var e=(0,Z.useState)(!1),t=i()(e,2),n=t[0],r=t[1],g=(0,Z.useState)(),$=i()(g,2),C=$[0],y=$[1],S=f.Z.useForm(),k=i()(S,1)[0],b=(0,Z.useRef)();return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(l.Z,{items:[{title:"授权管理 "},{title:"角色管理"}],showCluster:!1,showCreateYamlButton:!1}),(0,j.jsx)(o.Z,{placeholder:"模糊搜索角色名、角色类型、备注",searchWidth:320,actionRef:b,leftTitle:(0,j.jsx)(h.ZP,{type:"primary",onClick:function(){r(!0),y(void 0),k.setFieldsValue({})},children:"新建角色"}),request:function(e){return(0,s.e5)({keyword:e.keyword,page:e.current,page_size:e.pageSize}).then((function(e){return{data:e.list,total:e.total}}))},columns:[{dataIndex:"name",title:"角色名",render:function(e,t){return(0,j.jsx)(d.Link,{to:"/user/manager/".concat(t.id),children:t.name})}},{dataIndex:"role_type",title:"角色类型",render:function(e){return"CLUSTER"===e?(0,j.jsx)(v.Z,{color:"blue",children:"集群"}):(0,j.jsx)(v.Z,{color:"green",children:"普通"})}},{dataIndex:"is_default",title:"默认角色",render:function(e){return e?(0,j.jsx)(v.Z,{children:"是"}):(0,j.jsx)(v.Z,{color:"blue",children:"否"})}},{dataIndex:"description",title:"备注"},{dataIndex:"update_time",title:"最后更新时间",render:c.kZ},{dataIndex:"operate",title:"操作",render:function(e,t){return(0,j.jsxs)(m.Z,{children:[(0,j.jsx)(a.Z,{disabled:t.is_default,onClick:function(){r(!0),y(t),k.setFieldsValue(t)},children:"编辑"}),(0,j.jsx)(a.Z,{onClick:function(){x.Z.confirm({title:(0,j.jsxs)(m.Z,{children:["删除角色","CLUSTER"===t.role_type?(0,j.jsx)(v.Z,{color:"blue",children:"集群"}):(0,j.jsx)(v.Z,{color:"green",children:"普通"})]}),content:(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)("p",{children:["确认删除角色【",t.name,"】？"]}),(0,j.jsx)("p",{children:"删除后所有角色关联授权会同时被删除"})]}),onOk:function(){(0,s.t8)({id:t.id}).then((function(){var e;p.ZP.success("删除成功"),null===(e=b.current)||void 0===e||e.reload(!0)}))}})},children:"删除"})]})}}]}),(0,j.jsx)(u.Z,{title:C?"编辑角色":"新建角色",form:k,open:n,id:null==C?void 0:C.id,type:C?"edit":"create",onOk:function(){var e;null===(e=b.current)||void 0===e||e.reload(),r(!1)},onClose:function(){r(!1)}})]})}},56765:function(e,t,n){"use strict";n.d(t,{jp:function(){return u},kZ:function(){return c},yq:function(){return l}});var r=n(5726),i=n.n(r),s=n(11110),o=n.n(s);i().extend(o());var a=function(e){var t=(Date.now()-e)/1e3;return t<60?{duration:t,unit:"second"}:t<3600?{duration:Math.floor(t/60),unit:"minute"}:t<86400?{duration:Math.floor(t/3600),unit:"hour"}:{duration:Math.floor(t/86400),unit:"day"}},u=function(e){if(void 0===e)return"";var t=a(e);return"second"===t.unit?"1分钟内":"".concat(t.duration," ").concat({second:"秒",minute:"分钟",hour:"小时",day:"天"}[t.unit],"前")},l=function(e){var t=a(e);return"second"===t.unit?"1分钟内":"约".concat(t.duration).concat({second:"秒",minute:"分钟",hour:"小时",day:"天"}[t.unit])},c=function(e){return isNaN(Number(e))?e:i()(Number(e)).format("YYYY-MM-DD HH:mm:ss")}},10534:function(e,t,n){"use strict";var r=n(99938),i=n(66292),s=n.n(i),o=n(50959),a=n(53270),u=n(77924),l=n(25492),c=n(80785);t.Z=function(e,t){var n;c.Z&&((0,l.mf)(e)||console.error("useDebounceFn expected parameter is a function, got ".concat(typeof e)));var i=(0,a.Z)(e),d=null!==(n=null==t?void 0:t.wait)&&void 0!==n?n:1e3,f=(0,o.useMemo)((function(){return s()((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return i.current.apply(i,(0,r.ev)([],(0,r.CR)(e),!1))}),d,t)}),[]);return(0,u.Z)((function(){f.cancel()})),{run:f,cancel:f.cancel,flush:f.flush}}},11110:function(e){e.exports=function(){"use strict";var e="minute",t=/[+-]\d\d(?::?\d\d)?/g,n=/([+-]|\d\d)/g;return function(r,i,s){var o=i.prototype;s.utc=function(e){return new i({date:e,utc:!0,args:arguments})},o.utc=function(t){var n=s(this.toDate(),{locale:this.$L,utc:!0});return t?n.add(this.utcOffset(),e):n},o.local=function(){return s(this.toDate(),{locale:this.$L,utc:!1})};var a=o.parse;o.parse=function(e){e.utc&&(this.$u=!0),this.$utils().u(e.$offset)||(this.$offset=e.$offset),a.call(this,e)};var u=o.init;o.init=function(){if(this.$u){var e=this.$d;this.$y=e.getUTCFullYear(),this.$M=e.getUTCMonth(),this.$D=e.getUTCDate(),this.$W=e.getUTCDay(),this.$H=e.getUTCHours(),this.$m=e.getUTCMinutes(),this.$s=e.getUTCSeconds(),this.$ms=e.getUTCMilliseconds()}else u.call(this)};var l=o.utcOffset;o.utcOffset=function(r,i){var s=this.$utils().u;if(s(r))return this.$u?0:s(this.$offset)?l.call(this):this.$offset;if("string"==typeof r&&(r=function(e){void 0===e&&(e="");var r=e.match(t);if(!r)return null;var i=(""+r[0]).match(n)||["-",0,0],s=i[0],o=60*+i[1]+ +i[2];return 0===o?0:"+"===s?o:-o}(r),null===r))return this;var o=Math.abs(r)<=16?60*r:r,a=this;if(i)return a.$offset=o,a.$u=0===r,a;if(0!==r){var u=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(a=this.local().add(o+u,e)).$offset=o,a.$x.$localOffset=u}else a=this.utc();return a};var c=o.format;o.format=function(e){var t=e||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return c.call(this,t)},o.valueOf=function(){var e=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*e},o.isUTC=function(){return!!this.$u},o.toISOString=function(){return this.toDate().toISOString()},o.toString=function(){return this.toDate().toUTCString()};var d=o.toDate;o.toDate=function(e){return"s"===e&&this.$offset?s(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():d.call(this)};var f=o.diff;o.diff=function(e,t,n){if(e&&this.$u===e.$u)return f.call(this,e,t,n);var r=this.local(),i=s(e).local();return f.call(r,i,t,n)}}}()}}]);