(self.webpackChunkcnmp=self.webpackChunkcnmp||[]).push([[63],{27274:function(t,e,n){"use strict";n.d(e,{Z:function(){return x}});var r=n(15558),i=n.n(r),a=n(26068),o=n.n(a),s=n(48305),u=n.n(s),l=n(45778),c=n(95974),d=n(41710),f=n(10534),h=n(65460),v=n(96286),m=n(50959),p="table___Rup7Y",g=n(11527),x=function(t){var e=t.placeholder,n=t.request,r=t.columns,a=t.leftTitle,s=t.tableProps,x=t.showSearch,$=void 0===x||x,w=t.dataSource,y=t.searchWidth,j=t.rightTitle,Z=void 0===j?[]:j,_=t.refreshDeps,b=t.actionRef,C=t.hideTitle,T=t.searchStyle,k=t.onSearch,S=(0,l.T)(b),D=(0,m.useState)(""),I=u()(D,2),O=I[0],M=I[1],R=(0,m.useRef)(""),Y=(0,f.Z)((function(){var t,e;null==k||k(O),null===(t=S.current)||void 0===t||null===(e=t.reloadAndRest)||void 0===e||e.call(t)}),{wait:500}).run;return(0,h.Z)((function(){var t;null===(t=S.current)||void 0===t||t.reload()}),_||[]),(0,g.jsx)(d.Z,o()({className:p,actionRef:S,headerTitle:a,dataSource:w,search:!1,columns:r,request:n&&function(t){return n(o()(o()({},t),{},{keyword:R.current}))},pagination:{showSizeChanger:!0,defaultPageSize:50},options:{reload:!!n},toolBarRender:!C&&function(){return[].concat(i()(Z),i()($?[(0,g.jsx)(v.Z,{style:o()({width:null!=y?y:300},T),value:O,placeholder:e,onChange:function(t){M(t.target.value),R.current=t.target.value,Y()},allowClear:!0,suffix:(0,g.jsx)(c.Z,{style:{color:"#918f8f"}})},"__search__input")]:[]))}},s))}},45778:function(t,e,n){"use strict";n.d(e,{T:function(){return i}});var r=n(50959),i=function(t,e){var n=(0,r.useRef)(e);return t||n}},78471:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return R}});var r=n(90228),i=n.n(r),a=n(87999),o=n.n(a),s=n(26068),u=n.n(s),l=n(48305),c=n.n(l),d=n(15268),f=n(79890),h=n(27274),v=n(42912),m=n(34593),p=n(36954),g=n(16782),x=n(56765),$=n(38218),w=n(47212),y=n(4561),j=n(62193),Z=n(3885),_=n(3827),b=n(96286),C=n(70334),T=n(69180),k=n(13702),S=n(50959),D="tag___fJOIz",I="max-width-300___NNmZV",O=n(11527),M=function(t){return t?Object.entries(t).map((function(t){var e=c()(t,2);return{key:e[0],value:e[1]}})):[]},R=function(){var t=(0,$.useParams)(),e=t.clusterName,n=void 0===e?"":e,r=t.namespace,a=void 0===r?"":r,s=(0,S.useRef)(),l=(0,w.Z)((function(){return(0,d.BQ)({cluster_name:n,list_all:"1",namespace:a}).then((function(t){var e;return(null==t||null===(e=t.list)||void 0===e?void 0:e.map((function(t){return{label:t,value:t}})))||[]}))})).data,R=(0,S.useState)(),Y=c()(R,2),N=Y[0],P=Y[1];return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(m.Z,{items:[{title:"Ingress"}],showNamespace:!0}),(0,O.jsx)(h.Z,{actionRef:s,columns:[{dataIndex:"name",title:"名称",width:200,ellipsis:!0,className:I,render:function(t,e){return(0,O.jsx)(g.Z,{follow_type:"Ingress",follow_value:e.name,follow:e.is_followed,style:{paddingRight:6},title:e.name,children:(0,O.jsx)($.Link,{to:"/cluster/".concat(n,"/service-network/").concat(a,"/ingress/").concat(e.name),children:e.name})})}},{dataIndex:"ingress_class_name",title:"类型",width:120},{dataIndex:"vip",title:"VIP",width:120},{dataIndex:"ingress_rules",title:"转发规则",render:function(t,e){var n,r=[];return null===(n=e.ingress_rules)||void 0===n||n.forEach((function(t,n){var i;null==t||null===(i=t.ingressRuleValue)||void 0===i||null===(i=i.http)||void 0===i||null===(i=i.paths)||void 0===i||i.forEach((function(i,a){var o;r.push((0,O.jsx)(y.Z,{title:(0,O.jsx)("pre",{children:e.ingress_rules_str}),overlayStyle:{maxWidth:900},children:(0,O.jsx)(j.Z,{style:{marginTop:0===n&&0===a?0:10},children:[{value:t.host,color:"rgb(18,73,135)",maxWidth:500},{value:i.path,color:"rgb(198, 94, 175)"},{value:i.pathType,color:"rgb(250, 173, 20)"},{value:null===(o=i.backend)||void 0===o||null===(o=o.service)||void 0===o||null===(o=o.port)||void 0===o?void 0:o.number,color:"rgb(181, 181, 181)"}].filter((function(t){return t.value})).map((function(t,e){return(0,O.jsx)("div",{className:D,style:{backgroundColor:t.color,maxWidth:t.maxWidth},children:t.value},e)}))},"".concat(n,"-").concat(a))}))}))})),r}},{dataIndex:"create_time",title:"创建时间",render:x.kZ,width:160},{dataIndex:"operation",title:"操作",fixed:"right",width:160,render:function(t,e){return(0,O.jsxs)(Z.Z,{children:[(0,O.jsx)(f.Z,{modalRender:function(t){return(0,O.jsx)(v.Z,{onCancel:t,onOk:function(){var e;t(),null===(e=s.current)||void 0===e||e.reload(!1)},initialValues:u()(u()({},e),{},{tls:e.tls.map((function(t){var e;return u()(u()({},t),{},{type:(null===(e=t.hosts)||void 0===e?void 0:e.length)>0?"define":"default"})})),labels:M(e.labels),annotations:M(e.annotations)})})},children:(0,O.jsx)("a",{children:"编辑"})}),(0,O.jsx)(f.Z,{modalRender:function(t){return(0,O.jsx)(p.Z,{defaultValue:e.yaml,clusterName:n,onCancel:function(){t()}})},children:(0,O.jsx)("a",{children:"编辑yaml"})}),(0,O.jsx)("a",{onClick:function(){var t=_.Z.confirm({title:"删除Ingress",width:420,content:(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)("p",{children:["Ingress【",e.name,"】？"]}),(0,O.jsx)("p",{style:{color:"#FF4D4F"},children:"删除Ingress可能导致关联服务无法访问，请谨慎操作。"}),(0,O.jsx)(b.Z,{placeholder:"请输入Ingress名称",onChange:function(n){n.target.value===e.name?t.update({okButtonProps:{disabled:!1}}):t.update({okButtonProps:{disabled:!0}})}})]}),okButtonProps:{disabled:!0},onOk:function(){(0,d.pt)({cluster_name:n,name:e.name,namespace:a}).then((function(){var t,e;C.ZP.success("删除成功"),null===(t=s.current)||void 0===t||null===(e=t.reset)||void 0===e||e.call(t)}))}})},children:"删除"})]})}}],request:function(){var t=o()(i()().mark((function t(e){var r;return i()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,d.xT)({cluster_name:n,page:e.current,page_size:e.pageSize,keyword:e.keyword,namespace:a,host:N});case 2:return r=t.sent,t.abrupt("return",{data:r.list||[],total:r.total||0});case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),tableProps:{scroll:{x:"max-content"},rowKey:"name",tableLayout:"fixed",params:{host:N}},leftTitle:(0,O.jsx)(f.Z,{modalRender:function(t){return(0,O.jsx)(v.Z,{onCancel:t,onOk:function(){var e;t(),null===(e=s.current)||void 0===e||e.reload(!0)}})},children:(0,O.jsx)(T.ZP,{type:"primary",children:"新建Ingress"})}),placeholder:"模糊搜索Ingress名称、域名",rightTitle:[(0,O.jsx)(k.Z,{placeholder:"请选择域名进行筛选",style:{width:200},value:N,onChange:P,options:l,showSearch:!0,allowClear:!0,filterOption:function(t,e){var n;return null==e||null===(n=e.label)||void 0===n?void 0:n.toLowerCase().includes(t.toLowerCase())}},"filter")]})]})}},56765:function(t,e,n){"use strict";n.d(e,{jp:function(){return u},kZ:function(){return c},yq:function(){return l}});var r=n(5726),i=n.n(r),a=n(11110),o=n.n(a);i().extend(o());var s=function(t){var e=(Date.now()-t)/1e3;return e<60?{duration:e,unit:"second"}:e<3600?{duration:Math.floor(e/60),unit:"minute"}:e<86400?{duration:Math.floor(e/3600),unit:"hour"}:{duration:Math.floor(e/86400),unit:"day"}},u=function(t){if(void 0===t)return"";var e=s(t);return"second"===e.unit?"1分钟内":"".concat(e.duration," ").concat({second:"秒",minute:"分钟",hour:"小时",day:"天"}[e.unit],"前")},l=function(t){var e=s(t);return"second"===e.unit?"1分钟内":"约".concat(e.duration).concat({second:"秒",minute:"分钟",hour:"小时",day:"天"}[e.unit])},c=function(t){return isNaN(Number(t))?t:i()(Number(t)).format("YYYY-MM-DD HH:mm:ss")}},11110:function(t){t.exports=function(){"use strict";var t="minute",e=/[+-]\d\d(?::?\d\d)?/g,n=/([+-]|\d\d)/g;return function(r,i,a){var o=i.prototype;a.utc=function(t){return new i({date:t,utc:!0,args:arguments})},o.utc=function(e){var n=a(this.toDate(),{locale:this.$L,utc:!0});return e?n.add(this.utcOffset(),t):n},o.local=function(){return a(this.toDate(),{locale:this.$L,utc:!1})};var s=o.parse;o.parse=function(t){t.utc&&(this.$u=!0),this.$utils().u(t.$offset)||(this.$offset=t.$offset),s.call(this,t)};var u=o.init;o.init=function(){if(this.$u){var t=this.$d;this.$y=t.getUTCFullYear(),this.$M=t.getUTCMonth(),this.$D=t.getUTCDate(),this.$W=t.getUTCDay(),this.$H=t.getUTCHours(),this.$m=t.getUTCMinutes(),this.$s=t.getUTCSeconds(),this.$ms=t.getUTCMilliseconds()}else u.call(this)};var l=o.utcOffset;o.utcOffset=function(r,i){var a=this.$utils().u;if(a(r))return this.$u?0:a(this.$offset)?l.call(this):this.$offset;if("string"==typeof r&&(r=function(t){void 0===t&&(t="");var r=t.match(e);if(!r)return null;var i=(""+r[0]).match(n)||["-",0,0],a=i[0],o=60*+i[1]+ +i[2];return 0===o?0:"+"===a?o:-o}(r),null===r))return this;var o=Math.abs(r)<=16?60*r:r,s=this;if(i)return s.$offset=o,s.$u=0===r,s;if(0!==r){var u=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(s=this.local().add(o+u,t)).$offset=o,s.$x.$localOffset=u}else s=this.utc();return s};var c=o.format;o.format=function(t){var e=t||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return c.call(this,e)},o.valueOf=function(){var t=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*t},o.isUTC=function(){return!!this.$u},o.toISOString=function(){return this.toDate().toISOString()},o.toString=function(){return this.toDate().toUTCString()};var d=o.toDate;o.toDate=function(t){return"s"===t&&this.$offset?a(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():d.call(this)};var f=o.diff;o.diff=function(t,e,n){if(t&&this.$u===t.$u)return f.call(this,t,e,n);var r=this.local(),i=a(t).local();return f.call(r,i,e,n)}}}()}}]);