"use strict";(self.webpackChunkcnmp=self.webpackChunkcnmp||[]).push([[8506],{66780:function(e,n,r){r.d(n,{Z:function(){return o}});var l=r(79482),t=r(50959),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zM704 536c0 4.4-3.6 8-8 8H544v152c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V544H328c-4.4 0-8-3.6-8-8v-48c0-4.4 3.6-8 8-8h152V328c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v152h152c4.4 0 8 3.6 8 8v48z"}}]},name:"plus-square",theme:"filled"},s=r(28371),i=function(e,n){return t.createElement(s.Z,(0,l.Z)({},e,{ref:n,icon:a}))};var o=t.forwardRef(i)},37610:function(e,n,r){var l=r(48305),t=r.n(l),a=r(22927),s=r(66780),i=r(21630),o=r(75929),u=r(62193),d=r(3885),c=r(14621),p=r(32699),m=r.n(p),f=r(50959),v=r(11527);n.Z=function(e){var n=e.operationProps,r=e.label,l=e.name,p=e.fieldRender,h=e.labelCol,x=e.itemMax,Z=e.addText,g=e.showSwitch,j=e.minItem,b=(0,f.useState)(!0),y=t()(b,2),P=y[0],C=y[1],w=i.Z.useFormInstance(),F=(0,f.useRef)();return(0,f.useEffect)((function(){if(g){var e=w.getFieldValue([l]);C(!(!e||m().isEmpty(e)))}}),[w,g,l]),(0,v.jsx)(v.Fragment,{children:(0,v.jsxs)(i.Z.Item,{labelCol:h,label:r,children:[g&&(0,v.jsx)("div",{style:{height:32,display:"flex",alignItems:"center",marginBottom:P?10:0},children:(0,v.jsx)(o.Z,{value:P,onChange:function(e){C(e),e?F.current?w.setFieldValue([l],F.current):w.setFieldValue([l],[{type:"default"}]):(F.current=w.getFieldValue([l]),w.setFieldValue([l],[]))}})}),P&&(0,v.jsx)(i.Z.List,{name:l,children:function(e,r){return(0,v.jsxs)(v.Fragment,{children:[e.map((function(n,l){return(0,v.jsxs)(u.Z,{gap:16,children:[p(n,l,r),(!j||j<e.length)&&(0,v.jsx)(a.Z,{style:{display:"flex",alignSelf:"baseline",paddingTop:10},onClick:function(){r.remove(n.name)}})]},n.key)})),(0,v.jsx)("div",{children:(0,v.jsx)(c.Z,{disabled:!!x&&e.length>=x,onClick:function(){var e;r.add(null==n||null===(e=n.add)||void 0===e?void 0:e.defaultValue)},children:(0,v.jsxs)(d.Z,{children:[(0,v.jsx)(s.Z,{style:{fontSize:20,verticalAlign:"text-bottom"}}),null!=Z?Z:"添加"]})})})]})}})]})})}},13885:function(e,n,r){var l=r(26068),t=r.n(l),a=r(15558),s=r.n(a),i=r(21630),o=r(96286),u=r(37610),d=r(32699),c=r.n(d),p=(r(50959),r(11527)),m=function(e,n,r,l){var t=l||{},a=t.repeat,i=t.required,o=t.rules;return[].concat(s()(i?[{required:!0,message:"string"==typeof i?i:"请输入"}]:[]),s()(a?[]:[{validator:function(l,t){return(n.getFieldValue(r[0])||[]).some((function(n,l){return!c().isNil(null==n?void 0:n[r[1]])&&n[r[1]]===t&&e!==l}))?Promise.reject(new Error("string"==typeof a?a:"存在重复值，请修改")):Promise.resolve()}}]),s()(o||[]))};n.Z=function(e){var n=e.keyOption,r=void 0===n?{}:n,l=e.valueOption,a=void 0===l?{}:l,s=e.placeholder,d=e.label,c=e.name,f=e.keyRules,v=e.valueRules,h=e.addText,x=i.Z.useFormInstance();return(0,p.jsx)(u.Z,{label:d,name:c,addText:h,fieldRender:function(e,n){var l,u;return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(i.Z.Item,{name:[e.name,"key"],rules:m(n,x,[c,"key"],t()({required:!0,repeat:!1,rules:[]},r))||(null==f?void 0:f(n))||[],style:{width:"100%"},children:(0,p.jsx)(o.Z,{placeholder:null!==(l=null==s?void 0:s[0])&&void 0!==l?l:"请输入键"})}),(0,p.jsx)(i.Z.Item,{name:[e.name,"value"],rules:m(n,x,[c,"value"],t()({required:!1,repeat:!0,rules:[]},a))||(null==v?void 0:v(n))||[],style:{width:"100%"},children:(0,p.jsx)(o.Z,{placeholder:null!==(u=null==s?void 0:s[1])&&void 0!==u?u:"请输入值"})})]})}})}},14621:function(e,n,r){r.d(n,{Z:function(){return d}});var l=r(26068),t=r.n(l),a=r(67825),s=r.n(a),i=(r(50959),"disabled___nnQy2"),o=r(11527),u=["disabled","children","onClick","className"],d=function(e){var n=e.disabled,r=e.children,l=e.onClick,a=e.className,d=void 0===a?"":a,c=s()(e,u);return(0,o.jsx)("a",t()(t()({className:n?i+" "+d:d,onClick:function(){n||null==l||l()}},c),{},{children:r}))}},42912:function(e,n,r){r.d(n,{Z:function(){return ne}});var l=r(90228),t=r.n(l),a=r(26068),s=r.n(a),i=r(87999),o=r.n(i),u=r(48305),d=r.n(u),c=r(89629),p=r(38218),m=r(66780),f=r(21630),v=r(70334),h=r(3827),x=r(96286),Z=r(13702),g=r(50959),j=r(15268),b=r(37610),y=r(13885),P=r(62319),C=r(31123),w=r(35361),F=r(56929),k=r(41716),q=r(39477),_=r(59561),T=r(11527),I=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],V=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],z=function(e,n){var r=e.fieldProps,l=e.children,t=e.params,a=e.proFieldProps,s=e.mode,i=e.valueEnum,o=e.request,u=e.showSearch,d=e.options,c=(0,F.Z)(e,I),p=(0,g.useContext)(q.Z);return(0,T.jsx)(_.Z,(0,w.Z)((0,w.Z)({valueEnum:(0,k.h)(i),request:o,params:t,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,w.Z)({options:d,mode:s,showSearch:u,getPopupContainer:p.getPopupContainer},r),ref:n,proFieldProps:a},c),{},{children:l}))},S=g.forwardRef((function(e,n){var r=e.fieldProps,l=e.children,t=e.params,a=e.proFieldProps,s=e.mode,i=e.valueEnum,o=e.request,u=e.options,d=(0,F.Z)(e,V),c=(0,w.Z)({options:u,mode:s||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},r),p=(0,g.useContext)(q.Z);return(0,T.jsx)(_.Z,(0,w.Z)((0,w.Z)({valueEnum:(0,k.h)(i),request:o,params:t,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,w.Z)({getPopupContainer:p.getPopupContainer},c),ref:n,proFieldProps:a},d),{},{children:l}))})),R=g.forwardRef(z);R.SearchSelect=S,R.displayName="ProFormComponent";var E=R,A=r(71983),N=r(36746),O=r(959),B=r(74276),L=r(26814),M=r(71770),$=["fieldProps","proFieldProps"],H=["fieldProps","proFieldProps"],D="text",U=function(e){var n=(0,B.Z)(e.open||!1,{value:e.open,onChange:e.onOpenChange}),r=(0,O.Z)(n,2),l=r[0],t=r[1];return(0,T.jsx)(f.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(n){var r,a=n.getFieldValue(e.name||[]);return(0,T.jsx)(L.Z,(0,w.Z)((0,w.Z)({getPopupContainer:function(e){return e&&e.parentNode?e.parentNode:e},onOpenChange:t,content:(0,T.jsxs)("div",{style:{padding:"4px 0"},children:[null===(r=e.statusRender)||void 0===r?void 0:r.call(e,a),e.strengthText?(0,T.jsx)("div",{style:{marginTop:10},children:(0,T.jsx)("span",{children:e.strengthText})}):null]}),overlayStyle:{width:240},placement:"right"},e.popoverProps),{},{open:l,children:e.children}))}})},W=function(e){var n=e.fieldProps,r=e.proFieldProps,l=(0,F.Z)(e,$);return(0,T.jsx)(_.Z,(0,w.Z)({valueType:D,fieldProps:n,filedConfig:{valueType:D},proFieldProps:r},l))};W.Password=function(e){var n=e.fieldProps,r=e.proFieldProps,l=(0,F.Z)(e,H),t=(0,g.useState)(!1),a=(0,O.Z)(t,2),s=a[0],i=a[1];return null!=n&&n.statusRender&&l.name?(0,T.jsx)(U,{name:l.name,statusRender:null==n?void 0:n.statusRender,popoverProps:null==n?void 0:n.popoverProps,strengthText:null==n?void 0:n.strengthText,open:s,onOpenChange:i,children:(0,T.jsx)(_.Z,(0,w.Z)({valueType:"password",fieldProps:(0,w.Z)((0,w.Z)({},(0,M.Z)(n,["statusRender","popoverProps","strengthText"])),{},{onBlur:function(e){var r;null==n||null===(r=n.onBlur)||void 0===r||r.call(n,e),i(!1)},onClick:function(e){var r;null==n||null===(r=n.onClick)||void 0===r||r.call(n,e),i(!0)}}),proFieldProps:r,filedConfig:{valueType:D}},l))}):(0,T.jsx)(_.Z,(0,w.Z)({valueType:"password",fieldProps:n,proFieldProps:r,filedConfig:{valueType:D}},l))},W.displayName="ProFormComponent";var Q=W,G=r(2843),J=r(69387),K=r(47212),X="form-list-edit___bdeCl",Y={icon:(0,T.jsx)(m.Z,{style:{fontSize:20}}),creatorButtonText:"添加",type:"link",style:{width:100,textAlign:"left",justifyContent:"left",padding:"4px 0"}},ee=function(e){if(!e)return{};var n={};return e.forEach((function(e){n[e.key]=e.value})),n},ne=function(e){var n=e.initialValues,r=e.open,l=void 0===r||r,a=e.onCancel,i=e.onOk,u=f.Z.useForm(),m=d()(u,1)[0],g=!!n,w=f.Z.useWatch("tls",m),F=(0,p.useParams)(),k=F.clusterName,q=void 0===k?"":k,_=F.namespace,I=void 0===_?"":_,V=(0,c.gt)({variables:{list_all:1,cluster_name:q}}).data,z=(0,K.Z)((function(){return(0,j.zu)({cluster_name:q,list_all:1,namespace:I}).then((function(e){return e.list||[]}))})).data,S=void 0===z?[]:z,R=(0,K.Z)((function(){return(0,j.jj)({cluster_name:q,list_all:1}).then((function(e){return e.list||[]}))})).data,O=void 0===R?[]:R,B=function(){var e=o()(t()().mark((function e(){var r;return t()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.validateFields();case 2:if(r=e.sent,n){e.next=9;break}return e.next=6,(0,j.H6)(s()(s()({cluster_name:q,namespace:I},r),{},{labels:ee(r.labels),annotations:ee(r.annotations)}));case 6:v.ZP.success("创建成功"),e.next=12;break;case 9:return e.next=11,(0,j.zd)(s()(s()({cluster_name:q},r),{},{labels:ee(r.labels),annotations:ee(r.annotations)}));case 11:v.ZP.success("编辑成功");case 12:null==i||i();case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,T.jsx)(h.Z,{open:l,title:n?"编辑Ingress":"新建Ingress",width:1100,onCancel:a,onOk:B,style:{top:20},maskClosable:!1,children:(0,T.jsxs)(C.A,{style:{maxHeight:"calc(100vh - 160px)",overflow:"auto",padding:"0 10px"},submitter:{render:!1},form:m,layout:"horizontal",labelCol:{span:2},initialValues:n,children:[(0,T.jsx)(f.Z.Item,{label:"名称",name:"name",required:!0,validateFirst:!0,rules:[{required:!0},{pattern:/^[a-z][a-z0-9-]*[a-z0-9]$/,message:"名称只能包含小写字母、数字、分隔符(“-“），且必须以小写字母开头、小写字母或数字结尾"},{max:63,message:"名称最大长度63字符"},{min:2,message:"名称最小长度2字符"}],children:(0,T.jsx)(x.Z,{disabled:g,placeholder:"长度 2-63 个字符，只能包含小写字母、数字、分隔符(“-“），且必须以小写字母开头、小写字母或数字结尾"})}),(0,T.jsx)(f.Z.Item,{label:"命名空间",name:"namespace",rules:[{required:!0}],required:!0,initialValue:I,children:(0,T.jsx)(Z.Z,{disabled:g,options:null==V?void 0:V.list.map((function(e){return{value:e.name,label:e.name}}))})}),(0,T.jsx)(f.Z.Item,{label:"IngressClass",name:"ingress_class_name",children:(0,T.jsx)(Z.Z,{placeholder:"请选择IngressClass",allowClear:!0,options:null==O?void 0:O.map((function(e){return{value:e.name,label:e.name}}))})}),(0,T.jsx)(b.Z,{label:"TLS证书",name:"tls",showSwitch:!0,operationProps:{add:{defaultValue:{type:"define"}}},minItem:1,fieldRender:function(e){var n,r=null==w||null===(n=w[e.name])||void 0===n?void 0:n.type;return console.log("filed",m.getFieldValue(["tls",e.name,"type"])),(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(f.Z.Item,{name:[e.name,"type"],children:(0,T.jsx)(Z.Z,{style:{width:160},options:[{label:"默认",value:"default",disabled:null==w?void 0:w.some((function(e){return"default"===(null==e?void 0:e.type)}))},{label:"指定",value:"define"}]})}),(0,T.jsx)(f.Z.Item,{name:[e.name,"hosts"],rules:[{required:"default"!==r,message:"请输入域名"}],children:(0,T.jsx)(Z.Z,{mode:"tags",style:{width:360},placeholder:"default"===r?"全部域名":"请输入域名，按回车可输入多个",disabled:"default"===r})}),(0,T.jsx)(E,{name:[e.name,"secret_name"],width:240,placeholder:"请选择TLS secret",rules:[{required:!0}],request:o()(t()().mark((function e(){var n,r;return t()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,j.k2)({cluster_name:q,list_all:1,namespace:I});case 2:return r=e.sent,e.abrupt("return",(null===(n=r.list)||void 0===n?void 0:n.map((function(e){return{value:e.name,label:e.name}})))||[]);case 4:case"end":return e.stop()}}),e)})))})]})}}),(0,T.jsx)(A.u,{className:X,name:"ingress_rules",label:"转发规则",required:!0,rules:[{validator:function(e,n,r){n&&n.length>0?r():r("请添加转发规则，最少有一条转发规则")}}],creatorButtonProps:Y,itemRender:function(e,n){var r=e.listDom,l=e.action,t=n.record;return(0,T.jsx)(N.Z,{bordered:!0,extra:l,title:null==t?void 0:t.name,style:{marginBlockEnd:8},children:r})},children:function(e,n){return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(Q,{name:"host",label:"域名",required:!0,placeholder:"请输入域名",rules:[{required:!0}],width:360}),(0,T.jsx)(A.u,{name:["ingressRuleValue","http","paths"],label:"路径",required:!0,creatorButtonProps:Y,rules:[{validator:function(e,n,r){n&&n.length>0?r():r("请添加路径，最少保留一行路径")}}],children:function(e,r){return(0,T.jsxs)(G.UW,{size:10,children:[(0,T.jsx)(Q,{name:"path",required:!0,placeholder:"请输入路径",width:240,rules:[{required:!0},{pattern:/^\//,message:"路径需要以 / 开头"}]}),(0,T.jsx)(E,{name:"pathType",required:!0,placeholder:"匹配规则",rules:[{required:!0}],width:160,valueEnum:P.$}),(0,T.jsx)(E,{name:["backend","service","name"],required:!0,placeholder:"Service",rules:[{required:!0}],width:160,onChange:function(){m.setFieldValue(["ingress_rules",n,"ingressRuleValue","http","paths",r,"backend","service","port"],void 0)},fieldProps:{options:S.map((function(e){return{label:e.name,value:e.name}}))}}),(0,T.jsx)(J.Z,{name:[["backend","service","name"]],children:function(e){var n,r,l=null==e||null===(n=e.backend)||void 0===n||null===(n=n.service)||void 0===n?void 0:n.name;return(0,T.jsx)(E,{name:["backend","service","port","number"],required:!0,placeholder:"Port",width:160,rules:[{required:!0}],fieldProps:{options:l?null===(r=S.find((function(e){return e.name===l})))||void 0===r||null===(r=r.ports)||void 0===r?void 0:r.map((function(e){var n;return{label:"".concat(null!==(n=e.name)&&void 0!==n?n:"","(").concat(e.port,")"),value:e.port}})):[]}})}})]})}})]})}}),(0,T.jsx)(y.Z,{name:"labels",label:"标签",keyOption:{rules:[{max:316,message:"最多支持316字符"},{pattern:/^[a-zA-Z0-9][-/_.a-zA-Z0-9]*[a-zA-Z0-9]$/,message:"仅支持字母、数字、分隔符（“-“、”/”）、下滑线（“_”）小数点（”.”），需要字母或数字开头和结尾 正则"}]},valueOption:{rules:[{max:63,message:"最多支持63字符"},{pattern:/^[a-zA-Z0-9][-/_.a-zA-Z0-9]*[a-zA-Z0-9]$/,message:"仅支持字母、数字、分隔符（“-“、”/”）、下滑线（“_”）小数点（”.”），需要字母或数字开头和结尾 正则"}]}}),(0,T.jsx)(y.Z,{name:"annotations",label:"注解",keyOption:{rules:[{max:316,message:"最多支持316字符"},{pattern:/^[a-zA-Z0-9][-/_.a-zA-Z0-9]*[a-zA-Z0-9]$/,message:"仅支持字母、数字、分隔符（“-“、”/”）、下滑线（“_”）小数点（”.”），需要字母或数字开头和结尾 正则"}]}})]})})}},62319:function(e,n,r){r.d(n,{$:function(){return l}});var l={Exact:"精确匹配",Prefix:"前缀匹配",ImplementationSpecific:"控制器提供"}},10534:function(e,n,r){var l=r(99938),t=r(66292),a=r.n(t),s=r(50959),i=r(53270),o=r(77924),u=r(25492),d=r(80785);n.Z=function(e,n){var r;d.Z&&((0,u.mf)(e)||console.error("useDebounceFn expected parameter is a function, got ".concat(typeof e)));var t=(0,i.Z)(e),c=null!==(r=null==n?void 0:n.wait)&&void 0!==r?r:1e3,p=(0,s.useMemo)((function(){return a()((function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.current.apply(t,(0,l.ev)([],(0,l.CR)(e),!1))}),c,n)}),[]);return(0,o.Z)((function(){p.cancel()})),{run:p,cancel:p.cancel,flush:p.flush}}}}]);