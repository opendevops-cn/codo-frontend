(self.webpackChunkcnmp=self.webpackChunkcnmp||[]).push([[3173],{27274:function(e,t,n){"use strict";n.d(t,{Z:function(){return g}});var r=n(15558),o=n.n(r),a=n(26068),u=n.n(a),i=n(48305),s=n.n(i),c=n(45778),l=n(95974),d=n(41710),f=n(10534),h=n(65460),v=n(96286),m=n(50959),p="table___Rup7Y",_=n(11527),g=function(e){var t=e.placeholder,n=e.request,r=e.columns,a=e.leftTitle,i=e.tableProps,g=e.showSearch,x=void 0===g||g,$=e.dataSource,y=e.searchWidth,b=e.rightTitle,w=void 0===b?[]:b,j=e.refreshDeps,C=e.actionRef,D=e.hideTitle,Z=e.searchStyle,k=e.onSearch,S=(0,c.T)(C),M=(0,m.useState)(""),T=s()(M,2),I=T[0],P=T[1],U=(0,m.useRef)(""),O=(0,f.Z)((function(){var e,t;null==k||k(I),null===(e=S.current)||void 0===e||null===(t=e.reloadAndRest)||void 0===t||t.call(e)}),{wait:500}).run;return(0,h.Z)((function(){var e;null===(e=S.current)||void 0===e||e.reload()}),j||[]),(0,_.jsx)(d.Z,u()({className:p,actionRef:S,headerTitle:a,dataSource:$,search:!1,columns:r,request:n&&function(e){return n(u()(u()({},e),{},{keyword:U.current}))},pagination:{showSizeChanger:!0,defaultPageSize:50},options:{reload:!!n},toolBarRender:!D&&function(){return[].concat(o()(w),o()(x?[(0,_.jsx)(v.Z,{style:u()({width:null!=y?y:300},Z),value:I,placeholder:t,onChange:function(e){P(e.target.value),U.current=e.target.value,O()},allowClear:!0,suffix:(0,_.jsx)(l.Z,{style:{color:"#918f8f"}})},"__search__input")]:[]))}},i))}},87545:function(e,t,n){"use strict";n.d(t,{E:function(){return r}});var r={Healthy:{label:"健康",color:"green"},DiskPressure:{label:"磁盘空间异常",color:"red"},MemoryPressure:{label:"内存空间异常",color:"red"},PIDPressure:{label:"进程异常",color:"red"},NetworkUnavailable:{label:"网络异常",color:"red"},RouteUnavailable:{label:"路由异常",color:"red"},CpuUsageHigh:{label:"Cpu使用过高",color:"red"},MemoryUsageHigh:{label:"内存使用过高",color:"red"}}},45778:function(e,t,n){"use strict";n.d(t,{T:function(){return o}});var r=n(50959),o=function(e,t){var n=(0,r.useRef)(t);return e||n}},57231:function(e,t,n){"use strict";n.r(t),n.d(t,{nodeStateMap:function(){return y}});var r=n(90228),o=n.n(r),a=n(87999),u=n.n(a),i=n(15268),s=n(27274),c=n(34015),l=n(87545),d=n(34593),f=n(16782),h=n(56765),v=n(38218),m=n(67813),p=n(3885),_=n(3827),g=n(70334),x=n(50959),$=n(11527),y={NodeReady:{label:"运行中",color:"#52C41A"},NodeError:{label:"异常",color:"#FF4D4F"}};t.default=function(){var e=(0,v.useParams)().clusterName,t=void 0===e?"":e,n=(0,x.useRef)();return(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(d.Z,{items:[{title:"节点管理"}],sourceType:"node"}),(0,$.jsx)(s.Z,{actionRef:n,tableProps:{rowKey:"uid",scroll:{x:1800}},placeholder:"模糊搜索节点名称",request:function(){var e=u()(o()().mark((function e(n){var r;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,i.z_)({keyword:n.keyword,page:n.current,page_size:n.pageSize,cluster_name:t});case 2:return r=e.sent,e.abrupt("return",{total:r.total,data:r.list});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),columns:[{title:"名称",dataIndex:"name",render:function(e,n){return(0,$.jsx)(f.Z,{follow_type:"Node",follow_value:n.name,follow:n.is_followed,style:{paddingRight:6},title:e,children:(0,$.jsx)(v.Link,{to:"/cluster/".concat(t,"/node/").concat(n.name),children:n.name})})},width:160},{title:"状态",dataIndex:"state",width:160,render:function(e,t){var n,r;return(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)("span",{style:{color:(null===(n=y[e])||void 0===n?void 0:n.color)||""},children:null===(r=y[e])||void 0===r?void 0:r.label}),t.unschedulable?(0,$.jsx)("span",{style:{color:"var(--color-error)"},children:"(已封锁)"}):(0,$.jsx)("span",{style:{color:"var(--color-subtitle)"},children:"(可调度)"})]})}},{title:"健康检查",dataIndex:"health_state",width:160,render:function(e){return(0,$.jsx)(c.Z,{items:e.map((function(e){var t,n;return{value:null===(t=l.E[e])||void 0===t?void 0:t.label,color:null===(n=l.E[e])||void 0===n?void 0:n.color}})),max:3})}},{title:"IP",dataIndex:"internal_ip",width:120,ellipsis:!0},{title:"pod数量",dataIndex:"pod_total",width:120,render:function(e,t){return"".concat(t.resource_usage.pod_usage,"/").concat(t.resource_usage.pod_total)}},{title:"CPU请求分配率",dataIndex:"cpu_usage",width:180,render:function(e,t){var n=t.resource_usage.requests_cpu_usage?t.resource_usage.requests_cpu_usage/t.resource_usage.node_allocatable_cpu*100:0,r="#1677ff";return n>80?r="#ff4d4f":n>60&&(r="#faad14"),(0,$.jsxs)("div",{children:[(0,$.jsx)("div",{children:"".concat(t.resource_usage.requests_cpu_usage||0,"/").concat(t.resource_usage.node_allocatable_cpu||0,"核")}),(0,$.jsx)(m.Z,{style:{marginBottom:0},percent:n,strokeColor:r,format:function(){return Math.round(n)+"%"}})]})}},{title:"内存请求分配率",dataIndex:"memory_usage",width:180,render:function(e,t){var n=t.resource_usage.requests_memory_usage?t.resource_usage.requests_memory_usage/t.resource_usage.node_allocatable_memory*100:0,r="#1677ff";return n>80?r="#ff4d4f":n>60&&(r="#faad14"),(0,$.jsxs)("div",{children:[(0,$.jsx)("div",{children:"".concat(t.resource_usage.requests_memory_usage||0,"/").concat(t.resource_usage.node_allocatable_memory||0,"GB")}),(0,$.jsx)(m.Z,{style:{marginBottom:0},percent:n,strokeColor:r,format:function(){return Math.round(n)+"%"}})]})}},{title:"角色",dataIndex:"roles",width:120,ellipsis:!0,render:function(e,t){var n;return(null===(n=t.roles)||void 0===n?void 0:n.join(","))||"-"}},{title:"kubelet版本",width:220,dataIndex:"kubelet_version",ellipsis:!0},{title:"系统",width:220,dataIndex:"os_image",ellipsis:!0},{title:"容器引擎",width:220,dataIndex:"container_runtime_version",ellipsis:!0},{title:"创建时间",width:160,dataIndex:"create_time",render:h.kZ},{title:"操作",dataIndex:"operation",fixed:"right",render:function(e,r){return(0,$.jsxs)(p.Z,{children:[(0,$.jsx)("a",{onClick:u()(o()().mark((function e(){var a;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,i.UR)({name:r.name,cluster_name:t});case 2:a=e.sent,_.Z.confirm({title:"【".concat(r.name,"】驱逐节点上pod"),width:600,content:(0,$.jsxs)($.Fragment,{children:[(0,$.jsxs)("p",{children:["驱逐pod数：",a.detail.ready_to_evict_pods_count,"，忽略pod数：",a.detail.ignore_evict_pods_count]}),(0,$.jsx)("p",{children:"节点驱逐后，将会把节点内的所有Pod（不包含DaemonSet管理的Pod）从节点中驱逐到集群内其他节点，并将节点设置为封锁状态。"}),(0,$.jsx)("p",{style:{color:"var(--color-error)"},children:"注意：本地存储的Pod被驱逐后数据将丢失，请谨慎操作"})]}),onOk:function(){(0,i.nt)({cluster_name:t,name:r.name,operation:"NodeDrain"}).then((function(){var e;g.ZP.success("驱逐成功"),null===(e=n.current)||void 0===e||e.reload()}))}});case 4:case"end":return e.stop()}}),e)}))),children:"驱逐"}),(0,$.jsx)("a",{onClick:function(){_.Z.confirm({title:"【".concat(r.name,"】").concat(r.unschedulable?"取消封锁":"封锁","节点上pod"),content:r.unschedulable?"节点取消封锁后将允许新的Pod调度到该节点。":"封锁节点后，将不接受新的Pod调度到该节点，需要手动取消封锁的节点。",onOk:function(){(0,i.nt)({cluster_name:t,name:r.name,operation:r.unschedulable?"NodeUncordon":"NodeCordon"}).then((function(){var e;g.ZP.success(r.unschedulable?"取消封锁成功":"封锁成功"),null===(e=n.current)||void 0===e||e.reload()}))}})},children:r.unschedulable?"取消封锁":"封锁"})]})}}]})]})}},56765:function(e,t,n){"use strict";n.d(t,{jp:function(){return s},kZ:function(){return l},yq:function(){return c}});var r=n(5726),o=n.n(r),a=n(11110),u=n.n(a);o().extend(u());var i=function(e){var t=(Date.now()-e)/1e3;return t<60?{duration:t,unit:"second"}:t<3600?{duration:Math.floor(t/60),unit:"minute"}:t<86400?{duration:Math.floor(t/3600),unit:"hour"}:{duration:Math.floor(t/86400),unit:"day"}},s=function(e){if(void 0===e)return"";var t=i(e);return"second"===t.unit?"1分钟内":"".concat(t.duration," ").concat({second:"秒",minute:"分钟",hour:"小时",day:"天"}[t.unit],"前")},c=function(e){var t=i(e);return"second"===t.unit?"1分钟内":"约".concat(t.duration).concat({second:"秒",minute:"分钟",hour:"小时",day:"天"}[t.unit])},l=function(e){return isNaN(Number(e))?e:o()(Number(e)).format("YYYY-MM-DD HH:mm:ss")}},10534:function(e,t,n){"use strict";var r=n(99938),o=n(66292),a=n.n(o),u=n(50959),i=n(53270),s=n(77924),c=n(25492),l=n(80785);t.Z=function(e,t){var n;l.Z&&((0,c.mf)(e)||console.error("useDebounceFn expected parameter is a function, got ".concat(typeof e)));var o=(0,i.Z)(e),d=null!==(n=null==t?void 0:t.wait)&&void 0!==n?n:1e3,f=(0,u.useMemo)((function(){return a()((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return o.current.apply(o,(0,r.ev)([],(0,r.CR)(e),!1))}),d,t)}),[]);return(0,s.Z)((function(){f.cancel()})),{run:f,cancel:f.cancel,flush:f.flush}}},11110:function(e){e.exports=function(){"use strict";var e="minute",t=/[+-]\d\d(?::?\d\d)?/g,n=/([+-]|\d\d)/g;return function(r,o,a){var u=o.prototype;a.utc=function(e){return new o({date:e,utc:!0,args:arguments})},u.utc=function(t){var n=a(this.toDate(),{locale:this.$L,utc:!0});return t?n.add(this.utcOffset(),e):n},u.local=function(){return a(this.toDate(),{locale:this.$L,utc:!1})};var i=u.parse;u.parse=function(e){e.utc&&(this.$u=!0),this.$utils().u(e.$offset)||(this.$offset=e.$offset),i.call(this,e)};var s=u.init;u.init=function(){if(this.$u){var e=this.$d;this.$y=e.getUTCFullYear(),this.$M=e.getUTCMonth(),this.$D=e.getUTCDate(),this.$W=e.getUTCDay(),this.$H=e.getUTCHours(),this.$m=e.getUTCMinutes(),this.$s=e.getUTCSeconds(),this.$ms=e.getUTCMilliseconds()}else s.call(this)};var c=u.utcOffset;u.utcOffset=function(r,o){var a=this.$utils().u;if(a(r))return this.$u?0:a(this.$offset)?c.call(this):this.$offset;if("string"==typeof r&&(r=function(e){void 0===e&&(e="");var r=e.match(t);if(!r)return null;var o=(""+r[0]).match(n)||["-",0,0],a=o[0],u=60*+o[1]+ +o[2];return 0===u?0:"+"===a?u:-u}(r),null===r))return this;var u=Math.abs(r)<=16?60*r:r,i=this;if(o)return i.$offset=u,i.$u=0===r,i;if(0!==r){var s=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(i=this.local().add(u+s,e)).$offset=u,i.$x.$localOffset=s}else i=this.utc();return i};var l=u.format;u.format=function(e){var t=e||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return l.call(this,t)},u.valueOf=function(){var e=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*e},u.isUTC=function(){return!!this.$u},u.toISOString=function(){return this.toDate().toISOString()},u.toString=function(){return this.toDate().toUTCString()};var d=u.toDate;u.toDate=function(e){return"s"===e&&this.$offset?a(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():d.call(this)};var f=u.diff;u.diff=function(e,t,n){if(e&&this.$u===e.$u)return f.call(this,e,t,n);var r=this.local(),o=a(e).local();return f.call(r,o,t,n)}}}()}}]);