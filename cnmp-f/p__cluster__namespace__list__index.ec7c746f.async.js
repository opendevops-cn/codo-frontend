(self.webpackChunkcnmp=self.webpackChunkcnmp||[]).push([[797],{66780:function(e,t,n){"use strict";n.d(t,{Z:function(){return c}});var a=n(79482),s=n(50959),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zM704 536c0 4.4-3.6 8-8 8H544v152c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V544H328c-4.4 0-8-3.6-8-8v-48c0-4.4 3.6-8 8-8h152V328c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v152h152c4.4 0 8 3.6 8 8v48z"}}]},name:"plus-square",theme:"filled"},r=n(28371),l=function(e,t){return s.createElement(r.Z,(0,a.Z)({},e,{ref:t,icon:i}))};var c=s.forwardRef(l)},14621:function(e,t,n){"use strict";n.d(t,{Z:function(){return u}});var a=n(26068),s=n.n(a),i=n(67825),r=n.n(i),l=(n(50959),"disabled___nnQy2"),c=n(11527),o=["disabled","children","onClick","className"],u=function(e){var t=e.disabled,n=e.children,a=e.onClick,i=e.className,u=void 0===i?"":i,d=r()(e,o);return(0,c.jsx)("a",s()(s()({className:t?l+" "+u:u,onClick:function(){t||null==a||a()}},d),{},{children:n}))}},74683:function(e,t,n){"use strict";n.r(t);var a=n(90228),s=n.n(a),i=n(87999),r=n.n(i),l=n(48305),c=n.n(l),o=n(15268),u=n(67453),d=n(79890),f=n(27274),h=n(34015),m=n(14621),x=n(26104),p=n(93055),v=n(34593),j=n(36954),Z=n(16782),g=n(56765),y=n(38218),k=n(56260),$=n(21374),b=n(43566),C=n(22927),w=n(66780),_=n(21630),T=n(69180),D=n(3885),S=n(4561),z=n(3827),I=n(96286),O=n(70334),F=n(97536),P=n(62193),A=n(32699),V=n.n(A),M=n(50959),q=n(11527);t.default=function(){var e=(0,y.useParams)().clusterName,t=void 0===e?"":e,n=_.Z.useForm(),a=c()(n,1)[0],i=(0,M.useState)(),l=c()(i,2),A=l[0],U=l[1],H=(0,M.useRef)(),Y=function(){U(void 0),a.resetFields()};return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(v.Z,{items:[{title:"命名空间"}],sourceType:"namespace"}),(0,q.jsx)(f.Z,{actionRef:H,placeholder:"模糊搜索命名空间名称、备注",leftTitle:(0,q.jsx)(T.ZP,{type:"primary",onClick:function(){U("add"),a.resetFields()},children:"新建命名空间"}),refreshDeps:[t],request:function(){var e=r()(s()().mark((function e(n){var a;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.V)({keyword:n.keyword,page:n.current,page_size:n.pageSize,cluster_name:t});case 2:return a=e.sent,e.abrupt("return",{total:a.total,data:a.list});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),columns:[{title:"名称",dataIndex:"name",render:function(e,n){return(0,q.jsx)(Z.Z,{follow_type:"Namespace",follow_value:n.name,follow:n.is_followed,style:{paddingRight:6},title:e,children:(0,q.jsx)(y.Link,{to:"/cluster/".concat(t,"/namespace/").concat(n.name),children:e})})},width:200},{title:"状态",dataIndex:"state",render:function(e){return(0,q.jsxs)(D.Z,{style:{color:"Active"===e?"#52C41A":""},children:["Active"===e?(0,q.jsx)(k.Z,{}):(0,q.jsx)($.Z,{}),e]})},width:120},{dataIndex:"labels",title:"标签",width:180,render:function(e,t){return"-"===e?"-":(0,q.jsx)(h.Z,{items:Object.keys(t.labels||{}).map((function(e){return{value:"".concat(e,":").concat(t.labels[e])}})),tagStyle:{maxWidth:110},max:1})}},{dataIndex:"annotations",title:"注解",width:180,render:function(e,t){return"-"===e?"-":(0,q.jsx)(h.Z,{items:Object.keys(t.annotations||{}).map((function(e){return{value:"".concat(e,":").concat(t.annotations[e])}})),tagStyle:{maxWidth:110},max:1})}},{title:"创建时间",dataIndex:"create_time",render:g.kZ,width:160},{title:"备注",dataIndex:"description",render:function(e){return e||"-"},width:160,ellipsis:!0},{title:"操作",width:220,dataIndex:"operation",render:function(e,n){return(0,q.jsxs)(D.Z,{children:[(0,q.jsx)("a",{onClick:function(){!function(e){U("edit"),a.setFieldsValue({name:e.name,description:e.description||"",annotations:V().map(e.annotations,(function(e,t){return{key:t,value:e}})),labels:V().map(e.labels,(function(e,t){return{key:t,value:e}}))})}(n)},children:"编辑"}),(0,q.jsx)(d.Z,{modalRender:function(e){return(0,q.jsx)(j.Z,{defaultValue:n.yaml,clusterName:t,onCancel:function(){e()}})},children:(0,q.jsx)("a",{children:"编辑yaml"})}),(0,q.jsx)(S.Z,{title:n.is_default?"不可删除默认命名空间":"",children:(0,q.jsx)(m.Z,{disabled:n.is_default,onClick:function(){var e=z.Z.confirm({title:"删除命名空间",content:(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)("p",{children:["确认删除命名空间【",n.name,"】"]}),(0,q.jsx)("p",{style:{color:"#FF4D4F"},children:"删除命名空间将销毁该命名空间下的所有资源，销毁后不可恢复，请谨慎操作。"}),(0,q.jsx)(I.Z,{placeholder:"请输入命名空间名称",onChange:function(t){t.target.value===n.name?e.update({okButtonProps:{disabled:!1}}):e.update({okButtonProps:{disabled:!0}})}})]}),okButtonProps:{disabled:!0},onOk:function(){(0,o.u1)({cluster_name:t,name:n.name}).then((function(){var e,t;O.ZP.success("删除成功"),null===(e=H.current)||void 0===e||null===(t=e.reset)||void 0===t||t.call(e)}))}})},children:"删除"})}),(0,q.jsx)(F.Z,{menu:{items:[{label:(0,q.jsx)(d.Z,{modalRender:function(e){return(0,q.jsx)(p.Z,{namespace:n.name,onCancel:function(){e()}})},children:"设置资源配额"}),key:"quota"},{label:(0,q.jsx)(d.Z,{modalRender:function(e){return(0,q.jsx)(x.Z,{namespace:n.name,onCancel:function(){e()}})},children:"设置资源限制"}),key:"limit"}]},children:(0,q.jsx)("a",{onClick:function(e){return e.preventDefault()},children:(0,q.jsxs)(D.Z,{children:["更多",(0,q.jsx)(b.Z,{})]})})})]})}}],tableProps:{rowKey:"name",scroll:{x:1e3}}}),(0,q.jsx)(z.Z,{title:"add"===A?"新建命名空间":"编辑命名空间",open:!!A,onCancel:function(){Y()},onOk:function(){a.validateFields().then((function(e){"add"===A?(0,o.N3)({name:e.name,description:e.description,cluster_name:t,annotations:V().mapValues(V().keyBy(e.annotations,"key"),"value"),labels:V().mapValues(V().keyBy(e.labels,"key"),"value")}).then((function(){var e,t;O.ZP.success("创建命名空间成功"),null===(e=H.current)||void 0===e||null===(t=e.reset)||void 0===t||t.call(e),Y()})).catch((function(e){O.ZP.error(e.message)})):"edit"===A&&(0,o.Nq)({cluster_name:t,name:e.name,description:e.description,annotations:V().mapValues(V().keyBy(e.annotations,"key"),"value"),labels:V().mapValues(V().keyBy(e.labels,"key"),"value")}).then((function(){var e;O.ZP.success("编辑命名空间成功"),null===(e=H.current)||void 0===e||e.reload(),Y()})).catch((function(e){O.ZP.error(e.message)}))}))},width:800,children:(0,q.jsxs)(_.Z,{labelCol:{span:2},wrapperCol:{span:22},form:a,style:{marginTop:30},children:[(0,q.jsx)(_.Z.Item,{label:"名称",required:!0,name:"name",rules:[{required:!0,message:"请输入集群名称"},{max:63,message:"名称最大63字符"},{pattern:/^[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/,message:"只能包含小写字母、数字及分隔符，且必须以小写字母、数字开头和结尾"}],children:(0,q.jsx)(I.Z,{disabled:"edit"===A,placeholder:"最长63个字符，只能包含小写字母、数字及分隔符，且必须以小写字母、数字开头和结尾"})}),(0,q.jsx)(_.Z.Item,{label:"标签",children:(0,q.jsx)(_.Z.List,{name:"labels",children:function(e,t){var n=t.add,s=t.remove;return(0,q.jsxs)(q.Fragment,{children:[e.map((function(e,t){return(0,q.jsxs)(P.Z,{gap:16,children:[(0,q.jsx)(_.Z.Item,{name:[e.name,"key"],style:{width:"100%"},rules:[{required:!0,message:"请输入key"},{max:63,message:"最长63个字符"},{message:"支持字母、数字及分隔符（“-”、“_”、”.”、“/”），需以字母、数字开头",pattern:/^[a-zA-Z0-9][a-zA-Z0-9./_-]*$/},{validator:function(e,n){return(a.getFieldValue("labels")||[]).some((function(e,a){return e.key===n&&t!==a}))?Promise.reject(new Error("存在重复key，请修改key")):Promise.resolve()}}],children:(0,q.jsx)(I.Z,{placeholder:"请输入键"})}),(0,q.jsx)(_.Z.Item,{name:[e.name,"value"],style:{width:"100%"},rules:[{required:!0,message:"请输入value"},{max:63,message:"最长63个字符"},{message:"支持字母、数字及分隔符（“-”、“_”、”.”、“/”），需以字母、数字开头",pattern:/^[a-zA-Z0-9][a-zA-Z0-9./_-]*$/}],children:(0,q.jsx)(I.Z,{placeholder:"请输入值"})}),(0,q.jsx)(C.Z,{style:{display:"flex",alignSelf:"baseline",paddingTop:10},onClick:function(){s(e.name)}})]},e.key)})),(0,q.jsx)("div",{children:(0,q.jsx)("a",{onClick:function(){n()},children:(0,q.jsxs)(D.Z,{children:[(0,q.jsx)(w.Z,{style:{fontSize:20,verticalAlign:"text-bottom"}}),"添加"]})})})]})}})}),(0,q.jsx)(_.Z.Item,{label:"注解",children:(0,q.jsx)(_.Z.List,{name:"annotations",children:function(e,t){var n=t.add,s=t.remove;return(0,q.jsxs)(q.Fragment,{children:[e.map((function(e,t){return(0,q.jsxs)(P.Z,{gap:16,children:[(0,q.jsx)(_.Z.Item,{name:[e.name,"key"],rules:[{required:!0,message:"请输入key"},{max:63,message:"最长63个字符"},{message:"支持字母、数字及分隔符（“-”、“_”、”.”、“/”），需以字母、数字开头",pattern:/^[a-zA-Z0-9][a-zA-Z0-9./_-]*$/},{validator:function(e,n){return(a.getFieldValue("annotations")||[]).some((function(e,a){return e.key===n&&t!==a}))?Promise.reject(new Error("存在重复key，请修改key")):Promise.resolve()}}],style:{width:"100%"},children:(0,q.jsx)(I.Z,{placeholder:"请输入键"})}),(0,q.jsx)(_.Z.Item,{name:[e.name,"value"],rules:[{required:!0,message:"请输入value"}],style:{width:"100%"},children:(0,q.jsx)(I.Z,{placeholder:"请输入值"})}),(0,q.jsx)(C.Z,{style:{display:"flex",alignSelf:"baseline",paddingTop:10},onClick:function(){s(e.name)}})]},e.key)})),(0,q.jsx)("div",{children:(0,q.jsx)("a",{onClick:function(){n()},children:(0,q.jsxs)(D.Z,{children:[(0,q.jsx)(w.Z,{style:{fontSize:20,verticalAlign:"text-bottom"}}),"添加"]})})})]})}})}),(0,q.jsx)(_.Z.Item,{label:"备注",name:"description",rules:[{max:1e3,message:"备注最大1000字符"}],children:(0,q.jsx)(I.Z.TextArea,{placeholder:"请输入备注，不超过1000字符",rows:4})})]})})]})}},11110:function(e){e.exports=function(){"use strict";var e="minute",t=/[+-]\d\d(?::?\d\d)?/g,n=/([+-]|\d\d)/g;return function(a,s,i){var r=s.prototype;i.utc=function(e){return new s({date:e,utc:!0,args:arguments})},r.utc=function(t){var n=i(this.toDate(),{locale:this.$L,utc:!0});return t?n.add(this.utcOffset(),e):n},r.local=function(){return i(this.toDate(),{locale:this.$L,utc:!1})};var l=r.parse;r.parse=function(e){e.utc&&(this.$u=!0),this.$utils().u(e.$offset)||(this.$offset=e.$offset),l.call(this,e)};var c=r.init;r.init=function(){if(this.$u){var e=this.$d;this.$y=e.getUTCFullYear(),this.$M=e.getUTCMonth(),this.$D=e.getUTCDate(),this.$W=e.getUTCDay(),this.$H=e.getUTCHours(),this.$m=e.getUTCMinutes(),this.$s=e.getUTCSeconds(),this.$ms=e.getUTCMilliseconds()}else c.call(this)};var o=r.utcOffset;r.utcOffset=function(a,s){var i=this.$utils().u;if(i(a))return this.$u?0:i(this.$offset)?o.call(this):this.$offset;if("string"==typeof a&&(a=function(e){void 0===e&&(e="");var a=e.match(t);if(!a)return null;var s=(""+a[0]).match(n)||["-",0,0],i=s[0],r=60*+s[1]+ +s[2];return 0===r?0:"+"===i?r:-r}(a),null===a))return this;var r=Math.abs(a)<=16?60*a:a,l=this;if(s)return l.$offset=r,l.$u=0===a,l;if(0!==a){var c=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(l=this.local().add(r+c,e)).$offset=r,l.$x.$localOffset=c}else l=this.utc();return l};var u=r.format;r.format=function(e){var t=e||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return u.call(this,t)},r.valueOf=function(){var e=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*e},r.isUTC=function(){return!!this.$u},r.toISOString=function(){return this.toDate().toISOString()},r.toString=function(){return this.toDate().toUTCString()};var d=r.toDate;r.toDate=function(e){return"s"===e&&this.$offset?i(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():d.call(this)};var f=r.diff;r.diff=function(e,t,n){if(e&&this.$u===e.$u)return f.call(this,e,t,n);var a=this.local(),s=i(e).local();return f.call(a,s,t,n)}}}()}}]);