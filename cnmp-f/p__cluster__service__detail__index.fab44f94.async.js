"use strict";(self.webpackChunkcnmp=self.webpackChunkcnmp||[]).push([[3781],{86844:function(e,t,n){n.r(t);var a=n(90228),c=n.n(a),i=n(87999),l=n.n(i),r=n(15558),s=n.n(r),o=n(26068),d=n.n(o),u=n(82092),m=n.n(u),h=n(48305),p=n.n(h),v=n(34593),x=n(15268),f=n(64059),y=n(27274),b=n(34015),k=n(57014),j=n(29762),Z=n(43162),g=n(39383),_=n(56292),S=n(75026),w=n(56765),P=n(38218),C=n(81901),N=n(47212),I=n(3827),B=n(96286),F=n(70334),M=n(73634),O=n(49072),R=n(19338),W=n(3885),A=n(89169),D=n(50959),E=n(11527),L=function(e){return e?Object.entries(e).map((function(e){var t=p()(e,2),n=t[0],a=t[1];return m()({},n,a)})):[]};t.default=function(){var e=(0,P.useParams)(),t=e.clusterName,n=void 0===t?"":t,a=e.name,i=void 0===a?"":a,r=e.namespace,o=void 0===r?"":r,u=(0,C.Z)({tab:"pods"}),m=p()(u,2),h=m[0],T=m[1],H=(0,D.useState)(!1),V=p()(H,2),Y=V[0],K=V[1],q=(0,P.useNavigate)(),z=(0,N.Z)((function(){return(0,x.sS)({name:i,cluster_name:n,namespace:o}).then((function(e){return e.detail}))}),{pollingInterval:2e3,pollingWhenHidden:!1}),G=z.data,J=z.refreshAsync,Q=z.refresh,U=(0,D.useMemo)((function(){var e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.entries(e).map((function(e){var t=p()(e,2),n=t[0],a=t[1];return{value:"".concat(n,":").concat(a)}}))};return[e(null==G?void 0:G.annotations),e(null==G?void 0:G.labels),e(null==G?void 0:G.selector)]}),[G]),X=U.some((function(e){return e.length>3})),$=(0,D.useMemo)((function(){return!X||Y?U:U.map((function(e){return e.slice(0,3)}))}),[Y,X,U]);return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(v.Z,{items:[{title:(0,E.jsx)(P.Link,{to:"/cluster/".concat(n,"/service-network/").concat(o?"".concat(o,"/"):"","service"),children:"Service"})},{title:"Service详情：".concat(i)}],showCreateYamlButton:!1,showNamespace:!0,onParamsChange:function(e){q("/cluster/".concat(e.clusterName,"/service-network/").concat(e.namespace,"/service"))},footRender:function(){return G&&(0,E.jsx)(j.Z,{yaml:G.yaml,name:G.name,refresh:Q,title:"Service",editRender:function(e){return(0,E.jsx)(k.Z,{onCancel:e.onClose,onOk:function(){e.onClose(),Q()},open:e.open,initialValues:d()(d()({},G),{},{labels:L(G.labels),selector:L(G.selector),annotations:L(G.annotations)})})},onDelete:function(){var e=I.Z.confirm({title:"删除Service",width:420,content:(0,E.jsxs)(E.Fragment,{children:[(0,E.jsxs)("p",{children:["确认删除Service【",G.name,"】？"]}),(0,E.jsx)("p",{style:{color:"#FF4D4F"},children:"删除Service可能导致关联服务无法访问，请谨慎操作。"}),(0,E.jsx)(B.Z,{placeholder:"请输入Service名称",onChange:function(t){t.target.value===G.name?e.update({okButtonProps:{disabled:!1}}):e.update({okButtonProps:{disabled:!0}})}})]}),okButtonProps:{disabled:!0},onOk:function(){(0,x.dM)({cluster_name:n,name:G.name,namespace:o}).then((function(){F.ZP.success("删除成功"),q("/cluster/".concat(n,"/service-network/").concat(o?"".concat(o,"/"):"","service"))}))}})}})}}),G&&(0,E.jsx)(M.Z,{activeKey:h.tab,onChange:function(e){T({tab:e})},items:[{key:"pods",label:"Pods",children:(0,E.jsx)("div",{className:S.Z.block,children:(0,E.jsx)(_.Z,{detailData:G,active:"pods"===h.tab,type:"service",showReplicaToolbar:!1})})},{key:"info",label:"基础信息",children:(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(O.Z,{style:{marginBottom:20},children:(0,E.jsx)(R.Z,{title:"基础信息",items:[{key:"name",label:"名称",children:G.name},{key:"svc_type",label:"类型",children:(0,E.jsxs)(W.Z,{children:[G.svc_type,G.vip&&(0,E.jsx)("span",{children:(0,E.jsx)(A.Z,{color:"blue",children:"VIP"})})]})},{key:"cluster_ip",label:"ClusterIP",children:G.cluster_ip},{key:"session_affinity",label:"会话保持",children:G.session_affinity},{key:"create_time",label:"创建时间",children:(0,w.kZ)(G.create_time)},{key:"update_time",label:"更新时间",children:(0,w.kZ)(G.update_time)}]})}),(0,E.jsxs)(O.Z,{style:{marginBottom:20},children:[(0,E.jsx)(R.Z,{title:"注解&标签&选择器",items:[{key:"annotations",label:"注解",children:(0,E.jsx)(b.Z,{items:$[0],tagStyle:{maxWidth:300},direction:"vertical"})},{key:"labels",label:"标签",children:(0,E.jsx)(b.Z,{items:$[1],tagStyle:{maxWidth:300},direction:"vertical"})}].concat(s()($[2]?[{key:"selector",label:"选择器",children:(0,E.jsx)(b.Z,{items:$[2],tagStyle:{maxWidth:300},direction:"vertical"})}]:[]))}),X&&(0,E.jsx)("div",{style:{textAlign:"right"},children:(0,E.jsx)("a",{onClick:function(){K(!Y)},children:Y?"收起":"展开"})})]}),(0,E.jsx)(y.Z,{leftTitle:"端口映射",showSearch:!1,dataSource:"ExternalName"===G.svc_type?[{name:G.external_name}]:G.ports||[],columns:"ExternalName"===G.svc_type?[{title:"ExternalName",dataIndex:"name"}]:[{title:"名称",dataIndex:"name",ellipsis:!0,width:300},{title:"服务端口",dataIndex:"port"},{title:"协议",dataIndex:"protocol"}].concat(s()("NodePort"===G.svc_type?[{title:"节点端口",dataIndex:"nodePort"}]:[]),[{title:"容器端口",dataIndex:"targetPort"}])})]})},{key:"event",label:"事件",children:(0,E.jsx)("div",{className:S.Z.block,style:{padding:"16px 0"},children:(0,E.jsx)(Z.Z,{type:g.L.service,name:G.name,leftTitle:"健康检查"})})},{key:"yaml",label:"YAML",children:(0,E.jsx)("div",{className:S.Z.block,children:(0,E.jsx)(f.Z,{defaultContent:G.yaml||"",onRefresh:l()(c()().mark((function e(){var t;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,J();case 2:return t=e.sent,F.ZP.success("刷新成功"),e.abrupt("return",t.yaml);case 5:case"end":return e.stop()}}),e)}))),editorHeight:"calc(100vh - 380px)"})})}]})]})}}}]);