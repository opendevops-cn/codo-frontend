"use strict";(self.webpackChunkcnmp=self.webpackChunkcnmp||[]).push([[4348],{71923:function(e,n,a){a.r(n);var l=a(26068),s=a.n(l),r=a(48305),i=a.n(r),t=a(15268),c=a(79890),d=a(34654),o=a(2586),u=a(38218),m=a(21630),x=a(3827),p=a(70334),h=a(22639),j=a(96286),P=a(18772),Z=a(69180),b=(a(50959),a(11527)),f=function(e){var n=e.onCancel,a=e.onOk,l=e.initialValues,r=m.Z.useForm(),c=i()(r,1)[0],d=(0,u.useParams)(),o=d.clusterName,P=void 0===o?"":o,Z=d.name,f=void 0===Z?"":Z,g=d.namespace,v=void 0===g?"":g;return(0,b.jsx)(x.Z,{open:!0,title:"设置扩容步长",width:700,onCancel:n,onOk:function(){c.validateFields().then((function(e){(0,t.kd)(s()({cluster_name:P,name:f,namespace:v},e)).then((function(){a(),p.ZP.success("更新策略成功")}))}))},children:(0,b.jsxs)(m.Z,{labelCol:{span:8},wrapperCol:{span:16},style:{marginTop:20},form:c,initialValues:l,children:[(0,b.jsx)(m.Z.Item,{name:"minReadySeconds",label:"minReadySeconds",children:(0,b.jsx)(h.Z,{min:0,placeholder:"请输入最小reday状态的秒数",style:{width:"100%"}})}),(0,b.jsx)(m.Z.Item,{name:"MaxUnavailable",label:"ScaleStrategy.MaxUnavailable",rules:[{pattern:/^-?\d+%?$/,message:"仅允许整数或者百分数"}],children:(0,b.jsx)(j.Z,{placeholder:"请输入最大不可用pod数，允许整数或百分数"})})]})})},g=function(e){var n=e.onCancel,a=e.onOk,l=e.initialValues,r=m.Z.useForm(),c=i()(r,1)[0],d=(0,u.useParams)(),o=d.clusterName,h=void 0===o?"":o,Z=d.name,f=void 0===Z?"":Z,g=d.namespace,v=void 0===g?"":g,y=m.Z.useWatch("update_strategy_type",c);return(0,b.jsx)(x.Z,{title:"更新策略",open:!0,width:800,onCancel:n,onOk:function(){c.validateFields().then((function(e){(0,t.S8)(s()({cluster_name:h,name:f,namespace:v},e)).then((function(){a(),p.ZP.success("更新策略成功")}))}))},children:(0,b.jsxs)(m.Z,{form:c,labelCol:{span:5},initialValues:l,children:[(0,b.jsx)(m.Z.Item,{name:"update_strategy_type",label:"更新方式",initialValue:"InPlaceIfPossible",children:(0,b.jsxs)(P.ZP.Group,{children:[(0,b.jsx)(P.ZP,{value:"InPlaceIfPossible",children:"优先原地升级 InPlaceIfPossible"}),(0,b.jsx)(P.ZP,{value:"InPlaceOnly",children:"仅原地升级 InPlaceOnly"}),(0,b.jsx)(P.ZP,{value:"Recreate",children:"重新创建 Recreate"})]})}),"Recreate"!==y&&(0,b.jsx)(m.Z.Item,{name:"gracePeriodSeconds",label:"升级等待秒数",initialValue:0,tooltip:{title:(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("p",{children:"gracePeriodSeconds"}),(0,b.jsx)("p",{children:"如果配置了 gracePeriodSeconds 这个字段，控制器在原地升级的过程中会先把 Pod status 改为 not-ready，然后等一段时间（gracePeriodSeconds），最后再去修改 Pod spec 中的镜像版本。"})]}),overlayInnerStyle:{width:630}},rules:[{required:!0,message:"分片不能为空"},{pattern:/^(0|[1-9]\d*)$/,message:"0或者正整数"}],children:(0,b.jsx)(j.Z,{placeholder:"大于等于0的整数（default：0）"})}),"InPlaceIfPossible"===y&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(m.Z.Item,{name:"max_surge",label:"最大超出副本数",initialValue:"25%",rules:[{required:!0,message:"最大超出副本数不能为空"},{pattern:/^(?:[0-9]\d*|100(?:\.0+)?|(?:[0-9]|[1-9]\d)(?:\.\d+)?)%$/,message:"大于等于0的整数，或者正百分数"}],tooltip:{title:(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("p",{children:"maxSurge"}),(0,b.jsxs)("p",{children:["滚动更新过程中，可以超出期望副本数的最大值。",(0,b.jsx)("br",{}),"该取值可以是一个绝对值（例如：5），也可以是一个相对于期望副本数的百分比（例如：10%）；",(0,b.jsx)("br",{}),"如果填写百分比，则以期望副本数乘以该百分比后向上取整的方式计算对应的绝对值；",(0,b.jsx)("br",{}),"当最大不可用副本数 maxUnavailable 为 0 时，此数值（maxSurge）不能为 0；默认值为 25%。",(0,b.jsx)("br",{}),"例如：假设此值被设定为30%，当滚动更新开始时，新的副本集（ReplicaSet）可以立刻扩容， 但是旧 Pod 和新 Pod 的总数不超过 Deployment 期待副本数（spec.repilcas）的 130%。 一旦旧 Pod 被终止后，新的副本集可以进一步扩容，但是整个滚动更新过程中，新旧 Pod 的总 数不超过 Deployment 期待副本数（spec.repilcas）的 130%。"]})]}),overlayInnerStyle:{width:630}},children:(0,b.jsx)(j.Z,{placeholder:"大于等于0的整数，或者正百分数（default：25%）"})}),(0,b.jsx)(m.Z.Item,{name:"max_unavailable",label:"最大不可用副本数",initialValue:"25%",rules:[{required:!0,message:"最大不可用副本数不能为空"},{pattern:/^(?:[0-9]\d*|100(?:\.0+)?|(?:[0-9]|[1-9]\d)(?:\.\d+)?)%$/,message:"大于等于0的整数，或者正百分数"}],tooltip:{overlayInnerStyle:{width:630},title:(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("p",{children:"maxUnavailable"}),(0,b.jsxs)("p",{children:["滚动更新过程中，不可用副本数的最大值。",(0,b.jsx)("br",{}),"该取值可以是一个绝对值（例如：5），也可以是一个相对于期望副本数的百分比（例如：10%）；",(0,b.jsx)("br",{}),"如果填写百分比，则以期望副本数乘以该百分比后向下取整的方式计算对应的绝对值；",(0,b.jsx)("br",{}),"当最大超出副本数 maxSurge 为 0 时，此数值（maxUnavailable）不能为 0；默认值为 25%；",(0,b.jsx)("br",{}),"例如：假设此值被设定为 30%，当滚动更新开始时，旧的副本集（ReplicaSet）可以缩容到期望 副本数的 70%；在新副本集扩容的过程中，一旦新的 Pod 已就绪，旧的副本集可以进一步缩容， 整个滚动更新过程中，确保新旧就绪副本数之和不低于期望副本数的 70%。"]})]})},children:(0,b.jsx)(j.Z,{placeholder:"大于等于0的整数，或者正百分数（default：25%）"})})]})]})})};n.default=function(){var e=(0,d.J)();return(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(o.Z,{type:"clone-set",operationRender:function(n){return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(c.Z,{modalRender:function(a){return(0,b.jsx)(f,{onCancel:a,initialValues:n.scale_strategy,onOk:function(){a(),e()}})},children:(0,b.jsx)(Z.ZP,{children:"设置扩容步长"})}),(0,b.jsx)(c.Z,{modalRender:function(a){return(0,b.jsx)(g,{onCancel:a,onOk:function(){a(),e()},initialValues:n.update_strategy})},children:(0,b.jsx)(Z.ZP,{children:"更新策略"})})]})}})})}}}]);