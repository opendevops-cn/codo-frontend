"use strict";(self.webpackChunkcnmp=self.webpackChunkcnmp||[]).push([[2692],{64059:function(e,n,t){var l=t(48305),i=t.n(l),a=t(81798),s=t(62193),c=t(3885),r=t(99790),o=t(69180),d=t(70334),u=t(69005),m=t(3827),h=t(91894),f=t(15268),v=t(38218),p=t(50959),y=t(11527);n.Z=function(e){var n=e.onRefresh,t=e.defaultContent,l=e.editorHeight,x=void 0===l?300:l,j=e.disabledEdit,b=(0,p.useState)(!1),k=i()(b,2),Z=k[0],_=k[1],g=(0,p.useState)(t),w=i()(g,2),S=w[0],C=w[1],P=(0,p.useState)(t),N=i()(P,2),O=N[0],z=N[1],W=(0,p.useState)(!1),F=i()(W,2),R=F[0],V=F[1],A=(0,p.useState)(!1),E=i()(A,2),T=E[0],L=E[1],M=(0,v.useParams)().clusterName,Y=void 0===M?"":M,I=(0,p.useState)("edit"),H=i()(I,2),q=H[0],D=H[1];return(0,p.useEffect)((function(){Z&&V(!0)}),[Z]),(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)(s.Z,{justify:"space-between",children:["edit"===q?(0,y.jsxs)(c.Z,{children:[Z?(0,y.jsx)(r.Z,{beforeUpload:function(e){var n=new FileReader;return n.readAsText(e),n.onload=function(e){var n,t=null===(n=e.target)||void 0===n?void 0:n.result;t&&z(t)},!1},accept:".yaml,.yml",showUploadList:!1,children:(0,y.jsx)(o.ZP,{type:"primary",children:"导入YAML"})}):(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(o.ZP,{type:"primary",onClick:function(){_(!0)},disabled:j,children:"编辑YAML"}),(0,y.jsx)(o.ZP,{onClick:function(){navigator.clipboard.writeText(O).then((function(){d.ZP.success("复制成功")}))},children:"复制"}),(0,y.jsx)(o.ZP,{onClick:function(){null==n||n().then((function(e){C(e),d.ZP.success("刷新成功")}))},children:"刷新"})]}),(0,y.jsx)(u.Z,{checked:R,onChange:function(e){V(e.target.checked)},children:"精简字段"}),R&&(0,y.jsx)(u.Z,{checked:T,onChange:function(e){L(e.target.checked)},children:"隐藏status字段"})]}):(0,y.jsx)("div",{}),Z&&(0,y.jsxs)(c.Z,{children:[(0,y.jsx)(o.ZP,{onClick:function(){_(!1),z(S),D("edit")},children:"取消"}),(0,y.jsx)(o.ZP,{onClick:function(){O?"edit"!==q?(0,f.e7)({yaml:O,cluster_name:Y}).then((function(e){m.Z.confirm({title:"确认更新",width:800,content:e.success?(0,y.jsx)(h.Z,{message:"检查通过，点击‘应用’执行变更",type:"success",showIcon:!0}):(0,y.jsx)(h.Z,{message:"检查未通过",type:"error",description:e.message,showIcon:!0}),okText:"应用",onOk:function(){(0,f.aA)({yaml:O,cluster_name:Y}).then((function(){C(O),_(!1),D("edit"),d.ZP.success("编辑成功")})).catch((function(e){d.ZP.error(e.reason)}))}})})):D("diff"):d.ZP.warning("请输入YAML")},children:"确定"})]})]}),(0,y.jsx)("div",{style:{marginTop:20},children:(0,y.jsx)(a.Z,{readOnly:!Z,simplify:R,hideStatus:T,originalValue:S,value:O,onChange:function(e){z(e||"")},diff:"diff"===q,height:x})})]})}},55387:function(e,n,t){t.r(n);var l=t(90228),i=t.n(l),a=t(87999),s=t.n(a),c=t(26068),r=t.n(c),o=t(48305),d=t.n(o),u=t(15268),m=t(64059),h=t(34015),f=t(57108),v=t(80173),p=t(34593),y=t(29762),x=t(16249),j=t(56765),b=t(38218),k=t(81901),Z=t(50660),_=t(47212),g=t(3827),w=t(70334),S=t(73634),C=t(19338),P=t(3885),N=t(4561),O=t(5726),z=t.n(O),W=t(32699),F=t.n(W),R=t(50959),V=t(11527),A=function(e){return F().isEmpty(e)?"-":(0,V.jsx)("div",{children:null==e?void 0:e.map((function(e){var n=v.g.find((function(n){return n.value===e.type}));return(0,V.jsxs)("div",{children:[null==n?void 0:n.label,"：",e.value,(null==n?void 0:n.suffix)||"","，periodSeconds：",e.periodSeconds,"秒"]},e.type)}))})},E=function(e){return F().isEmpty(e)?"-":(0,V.jsx)("div",{children:null==e?void 0:e.map((function(e){var n=v.v.find((function(n){return n.value===e.name}));return(0,V.jsxs)("div",{children:[null==n?void 0:n.label,"：",e.value,(null==n?void 0:n.suffix)||"","，当前值：",e.current_value||0,(null==n?void 0:n.suffix)||""]},e.name)}))})};n.default=function(){var e,n,t,l,a=(0,b.useParams)(),c=a.clusterName,o=void 0===c?"":c,v=a.name,O=void 0===v?"":v,W=a.namespace,F=void 0===W?"":W,T=(0,b.useNavigate)(),L=(0,k.Z)({tab:"basic"}),M=d()(L,2),Y=M[0],I=M[1],H=(0,_.Z)((function(){return(0,u.qV)({name:O,cluster_name:o,namespace:F}).then((function(e){return e.detail}))})),q=H.data,D=H.refresh,U=(0,R.useState)(!1),B=d()(U,2),K=B[0],G=B[1],J=Object.keys((null==q?void 0:q.labels)||{}).length>3||Object.keys((null==q?void 0:q.annotations)||{}).length>3;return(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(p.Z,{onParamsChange:function(e){T("/cluster/".concat((null==e?void 0:e.clusterName)||o,"/scale/").concat((null==e?void 0:e.namespace)||F,"/ezrollout"))},items:[{title:(0,V.jsx)(b.Link,{to:"/cluster/".concat(o,"/scale/").concat(F,"/ezrollout/"),children:"版本伸缩"})},{title:"版本伸缩详情：".concat(O)}],sourceType:"ezrollout",showNamespace:!0,showCreateYamlButton:!1,footRender:function(){return q&&(0,V.jsx)(y.Z,{formInitialValues:r()(r()({},q),{},{annotations:Object.entries(q.annotations||{}).map((function(e){return{key:e[0],value:e[1]}})),selector:Object.entries(q.selector||{}).map((function(e){return{key:e[0],value:e[1]}})),labels:Object.entries(q.labels||{}).map((function(e){return{key:e[0],value:e[1]}})),offline_deadline:z()(Number(q.offline_deadline))}),refresh:D,title:"编辑版本伸缩",yaml:q.yaml,name:q.name,sourceType:"ezrollout",editRender:function(e){return(0,V.jsx)(f.Z,r()({},e))},onDelete:function(){g.Z.confirm({title:"【".concat(q.name,"】删除"),content:(0,V.jsx)(V.Fragment,{children:(0,V.jsxs)("p",{children:["确认删除：HPA- ",q.name,"？"]})}),onOk:function(){(0,u.Hc)({cluster_name:o,name:q.name,namespace:F}).then((function(){w.ZP.success("删除成功"),T("/cluster/".concat(o,"/scale/").concat(F,"/ezrollout"))}))}})}})}}),q&&(0,V.jsx)(S.Z,{activeKey:Y.tab,onChange:function(e){I({tab:e})},items:[{key:"basic",label:"基础信息",children:(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)("div",{className:x.Z.block,children:(0,V.jsx)(C.Z,{items:[{key:"name",label:"名称",children:q.name},{key:"namespace",label:"命名空间",children:q.namespace},{key:"ready",label:"ready",children:(0,V.jsxs)(P.Z,{children:[(0,V.jsx)("span",{style:{color:q.ready?"var(--color-success)":"var(--color-error)"},children:q.ready?"true":"false"}),(0,V.jsx)(N.Z,{title:(0,V.jsxs)(V.Fragment,{children:[(0,V.jsxs)("div",{children:["ready:",q.ready?"true":"false"]}),(0,V.jsxs)("div",{children:["latestErrorMessage:",q.latest_error_message||"-"]}),(0,V.jsxs)("div",{children:["latestErrorTime:",q.latest_error_time||"-"]})]}),children:(0,V.jsx)(Z.Z,{})})]})},{key:"online_version",label:"线上版本",children:q.online_version},{key:"offline_deadline",label:"历史版本下线",children:(0,j.kZ)(q.offline_deadline)},{key:"create_time",label:"创建时间",children:(0,j.kZ)(q.create_time||"")},{key:"update_time",label:"更新时间",children:""}]})}),(0,V.jsx)("div",{className:x.Z.block,children:(0,V.jsx)(C.Z,{title:"伸缩策略",items:[{key:"min_replicas",label:"最小实例数",children:q.min_replicas},{key:"max_replicas",label:"最大实例数",children:q.max_replicas},{key:"current_replicas",label:"当前实例数",children:q.current_replicas},{key:"scale_up_stabilizationWindowSeconds",label:"扩容窗口",children:"stabilizationWindowSeconds：".concat((null===(e=q.scale_up)||void 0===e?void 0:e.stabilizationWindowSeconds)||0,"秒")},{key:"scale_up_policies",label:"扩容策略",children:A(null===(n=q.scale_up)||void 0===n?void 0:n.policies)},{key:"scale_up_metrics",label:"扩容/锁定指标",children:E(q.scale_up_metrics)},{key:"scale_down_stabilizationWindowSeconds",label:"缩容窗口",children:"stabilizationWindowSeconds：".concat((null===(t=q.scale_down)||void 0===t?void 0:t.stabilizationWindowSeconds)||0,"秒")},{key:"scale_up_policies",label:"缩容策略",children:A(null===(l=q.scale_down)||void 0===l?void 0:l.policies)},{key:"scale_down_metrics",label:"缩容指标",children:E(q.scale_down_metrics)}]})}),(0,V.jsxs)("div",{className:x.Z.block,children:[(0,V.jsx)(C.Z,{title:"注解&标签",items:[{key:"annotations",label:"注解",children:(0,V.jsx)(h.Z,{items:Object.keys(q.annotations||{}).map((function(e){return{value:"".concat(e,":").concat(q.annotations[e])}})),tagStyle:{maxWidth:300},direction:"vertical",max:K?void 0:3})},{key:"labels",label:"标签",children:(0,V.jsx)(h.Z,{items:Object.keys(q.labels||{}).map((function(e){return{value:"".concat(e,":").concat(q.labels[e])}})),tagStyle:{maxWidth:300},max:K?void 0:3,direction:"vertical"})},{key:"selector",label:"选择器",children:(0,V.jsx)(h.Z,{items:Object.keys(q.selector||{}).map((function(e){return{value:"".concat(e,":").concat(q.selector[e])}})),tagStyle:{maxWidth:300},max:K?void 0:3,direction:"vertical"})}]}),J&&(0,V.jsx)("div",{style:{right:20,top:20,position:"absolute"},children:(0,V.jsx)("a",{onClick:function(){G(!K)},children:K?"收起":"展开"})})]})]})},{key:"yaml",label:"YAML",children:(0,V.jsx)("div",{className:x.Z.block,children:(0,V.jsx)(m.Z,{defaultContent:q.yaml||"",onRefresh:s()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.qV)({name:O,cluster_name:o,namespace:F}).then((function(e){var n;return w.ZP.success("刷新成功"),(null===(n=e.detail)||void 0===n?void 0:n.yaml)||""})));case 1:case"end":return e.stop()}}),e)}))),editorHeight:"calc(100vh - 380px)"})})}]})]})}},29762:function(e,n,t){t.d(n,{Z:function(){return x}});var l=t(48305),i=t.n(l),a=t(36954),s=t(38218),c=t(36241),r=t(21630),o=t(62193),d=t(3885),u=t(97536),m=t(69180),h=t(50959),f="title___qEjyg",v="name___p26Np",p="dropdown___unIV5",y=t(11527),x=function(e){var n=r.Z.useForm(),t=i()(n,1)[0],l=(0,h.useState)(!1),x=i()(l,2),j=x[0],b=x[1],k=(0,h.useState)(!1),Z=i()(k,2),_=Z[0],g=Z[1],w=(0,s.useParams)().clusterName,S=void 0===w?"":w,C=e.title,P=e.formInitialValues,N=e.onDelete,O=e.refresh,z=e.operationRender,W=e.onRestart,F=e.editRender,R=e.yaml,V=e.name,A=(0,h.useMemo)((function(){var e=[];return void 0!==R&&e.push({label:"编辑yaml",key:"edit-yaml"}),F&&e.push({label:"编辑",key:"edit"}),W&&e.push({label:"重启",key:"restart"}),N&&e.push({label:"删除",key:"delete"}),e}),[R,C,V,S,O,N,W]);return(0,y.jsxs)("div",{className:f,children:[(0,y.jsxs)(o.Z,{justify:"space-between",children:[(0,y.jsxs)(d.Z,{children:[(0,y.jsx)("span",{className:v,children:C}),(0,y.jsx)(d.Z,{children:z&&z()})]}),A.length>0&&(0,y.jsx)(u.Z,{overlayClassName:p,menu:{items:A,onClick:function(e){if("delete"!==e.key)return"edit"===e.key?(b(!0),void t.setFieldsValue(P||{})):void("restart"!==e.key?"edit-yaml"!==e.key||g(!0):null==W||W());null==N||N()}},children:(0,y.jsx)(m.ZP,{style:{padding:"4px 8px"},children:(0,y.jsx)(c.Z,{})})})]}),F&&F({title:C,form:t,open:j,onClose:function(){b(!1)},onOk:function(){b(!1),null==O||O()},type:"edit"}),_&&(0,y.jsx)(a.Z,{title:"【".concat(C,"-").concat(V,"】编辑Yaml"),defaultValue:R,clusterName:S,onCancel:function(){g(!1),null==O||O()}})]})}},16249:function(e,n){n.Z={block:"block___u4hkW"}}}]);