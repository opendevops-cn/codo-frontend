(self.webpackChunkcnmp=self.webpackChunkcnmp||[]).push([[3025],{1160:function(t,e,n){"use strict";n.d(e,{Z:function(){return u}});var r=n(79482),a=n(50959),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"},c=n(28371),s=function(t,e){return a.createElement(c.Z,(0,r.Z)({},t,{ref:e,icon:i}))};var u=a.forwardRef(s)},13749:function(t,e,n){"use strict";n.d(e,{Z:function(){return p}});var r=n(79482),a=n(50959),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h720c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"minus",theme:"outlined"},c=n(28371),s=function(t,e){return a.createElement(c.Z,(0,r.Z)({},t,{ref:e,icon:i}))};var u=a.forwardRef(s),o=n(64910),l=n(22639),f=n(69180),d=n(32699),h=n.n(d),m="main___yy0nV",v=n(11527),p=function(t){var e=t.onChange,n=t.value,r=t.style,a=t.min,i=t.max;return(0,v.jsx)(l.Z,{controls:!1,addonBefore:(0,v.jsx)(f.ZP,{onClick:function(){h().isNil(n)?null==e||e(a||0):h().isNil(a)?null==e||e(n-1):null==e||e(Math.max(a,n-1))},children:(0,v.jsx)(u,{})}),addonAfter:(0,v.jsx)(f.ZP,{onClick:function(){h().isNil(n)?null==e||e(i||0):h().isNil(i)?null==e||e(n+1):null==e||e(Math.min(i,n+1))},children:(0,v.jsx)(o.Z,{})}),value:n,onChange:function(t){null!==t&&(null==e||e(t))},style:r,className:m})}},27274:function(t,e,n){"use strict";n.d(e,{Z:function(){return g}});var r=n(15558),a=n.n(r),i=n(26068),c=n.n(i),s=n(48305),u=n.n(s),o=n(45778),l=n(95974),f=n(41710),d=n(10534),h=n(65460),m=n(96286),v=n(50959),p="table___Rup7Y",x=n(11527),g=function(t){var e=t.placeholder,n=t.request,r=t.columns,i=t.leftTitle,s=t.tableProps,g=t.showSearch,Z=void 0===g||g,$=t.dataSource,j=t.searchWidth,y=t.rightTitle,w=void 0===y?[]:y,C=t.refreshDeps,R=t.actionRef,S=t.hideTitle,T=t.searchStyle,_=t.onSearch,D=(0,o.T)(R),M=(0,v.useState)(""),k=u()(M,2),O=k[0],Y=k[1],b=(0,v.useRef)(""),N=(0,d.Z)((function(){var t,e;null==_||_(O),null===(t=D.current)||void 0===t||null===(e=t.reloadAndRest)||void 0===e||e.call(t)}),{wait:500}).run;return(0,h.Z)((function(){var t;null===(t=D.current)||void 0===t||t.reload()}),C||[]),(0,x.jsx)(f.Z,c()({className:p,actionRef:D,headerTitle:i,dataSource:$,search:!1,columns:r,request:n&&function(t){return n(c()(c()({},t),{},{keyword:b.current}))},pagination:{showSizeChanger:!0,defaultPageSize:50},options:{reload:!!n},toolBarRender:!S&&function(){return[].concat(a()(w),a()(Z?[(0,x.jsx)(m.Z,{style:c()({width:null!=j?j:300},T),value:O,placeholder:e,onChange:function(t){Y(t.target.value),b.current=t.target.value,N()},allowClear:!0,suffix:(0,x.jsx)(l.Z,{style:{color:"#918f8f"}})},"__search__input")]:[]))}},s))}},45778:function(t,e,n){"use strict";n.d(e,{T:function(){return a}});var r=n(50959),a=function(t,e){var n=(0,r.useRef)(e);return t||n}},23025:function(t,e,n){"use strict";n.d(e,{Z:function(){return _}});var r=n(90228),a=n.n(r),i=n(87999),c=n.n(i),s=n(79890),u=n(27274),o=n(34015),l=n(34593),f=n(36954),d=n(16782),h=n(48305),m=n.n(h),v=n(13749),p=n(3827),x=n(70334),g=n(62193),Z=n(50959),$=n(11527),j=function(t){var e=t.onCancel,n=t.defaultValue,r=void 0===n?null:n,a=t.title,i=t.onOk,c=(0,Z.useState)(r),s=m()(c,2),u=s[0],o=s[1];return(0,$.jsx)(p.Z,{open:!0,title:a,onCancel:e,onOk:function(){null!==u?i(u):x.ZP.warning("请输入副本数")},children:(0,$.jsxs)(g.Z,{align:"center",style:{marginTop:20},children:[(0,$.jsx)("div",{style:{marginRight:20},children:"副本数"}),(0,$.jsx)(v.Z,{min:0,value:u,onChange:o,style:{width:200}})]})})},y=n(39585),w=n(56765),C=n(38218),R=n(56260),S=n(1160),T=n(3885),_=function(t){var e=(0,C.useParams)(),n=e.clusterName,r=void 0===n?"":n,i=e.namespace,h=t.api,m=t.type,v=void 0===m?"":m,g=(0,Z.useRef)(),_=function(t,e){var n,r,a;(x.ZP.success("修改成功"),e)?null===(n=g.current)||void 0===n||null===(r=n.reloadAndRest)||void 0===r||r.call(n):null===(a=g.current)||void 0===a||a.reload();t()};return(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(l.Z,{items:[{title:(0,y.H9)(v)}],sourceType:v,showNamespace:!0}),(0,$.jsx)(u.Z,{actionRef:g,request:function(){var t=c()(a()().mark((function t(e){var n;return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h.list({cluster_name:r,page:e.current,page_size:e.pageSize,keyword:e.keyword,namespace:i});case 2:return n=t.sent,t.abrupt("return",{data:n.list||[],total:n.total||0});case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),placeholder:"模糊搜索负载名称、镜像、标签",columns:[{dataIndex:"name",title:"名称",render:function(t,e){return(0,$.jsx)(d.Z,{follow_type:(0,y.H9)(v),follow_value:e.name,follow:e.is_followed,style:{paddingRight:6},title:t,children:(0,$.jsx)(C.Link,{to:"/cluster/".concat(r,"/workloads/").concat(i,"/").concat(v,"/detail/").concat(e.name),children:t})})},width:200},{dataIndex:"namespace",title:"命名空间",width:100},{dataIndex:"containers",title:"镜像",width:214,render:function(t,e){return(0,$.jsx)(o.Z,{tagStyle:{maxWidth:150},items:e.containers.map((function(t){return{value:t.image}})),max:1})}},{dataIndex:"status",title:"状态",width:220,render:function(t,e){return(0,$.jsxs)("span",{children:[(0,$.jsxs)(T.Z,{size:4,style:{color:e.spec_replicas===t.readyReplicas?"var(--color-success)":"var(--color-warning)"},children:[e.spec_replicas===t.readyReplicas?(0,$.jsx)(R.Z,{}):(0,$.jsx)(S.Z,{}),(0,$.jsxs)("span",{children:["就绪: ",t.readyReplicas,"/",e.spec_replicas]})]})," ","| 已更新: ",t.updatedReplicas," | 可用:",t.availableReplicas]})}},{dataIndex:"create_time",title:"创建时间",width:160,render:w.kZ},{dataIndex:"operation",title:"操作",fixed:"right",width:220,render:function(t,e){return(0,$.jsxs)(T.Z,{children:[(0,$.jsx)(s.Z,{modalRender:function(t){return(0,$.jsx)(f.Z,{title:"【".concat((0,y.H9)(v),"-").concat(e.name,"】"),defaultValue:e.yaml,clusterName:r,onCancel:function(){t()},sourceType:v})},children:(0,$.jsx)("a",{children:"编辑yaml"})}),h.scale&&(0,$.jsx)(s.Z,{modalRender:function(t){return(0,$.jsx)(j,{title:"【".concat(e.name,"】伸缩"),onCancel:function(){t()},defaultValue:e.status.replicas,onOk:function(n){h.scale({name:e.name,cluster_name:r,namespace:e.namespace,replicas:n}).then((function(){_(t)}))}})},children:(0,$.jsx)("a",{children:"伸缩"})}),(0,$.jsx)(s.Z,{modalRender:function(t){return(0,$.jsxs)(p.Z,{open:!0,title:"【".concat(e.name,"】重启"),onCancel:function(){t()},onOk:function(){h.restart({name:e.name,cluster_name:r,namespace:e.namespace}).then((function(){_(t)}))},children:["确认重新部署：",e.name,"？"]})},children:(0,$.jsx)("a",{children:"重启"})}),(0,$.jsx)(s.Z,{modalRender:function(t){return(0,$.jsxs)(p.Z,{open:!0,title:"【".concat(e.name,"】删除"),onCancel:function(){t()},onOk:function(){h.delete({name:e.name,cluster_name:r,namespace:e.namespace}).then((function(){_(t,!0)}))},children:["确认删除资源：",e.name,"？"]})},children:(0,$.jsx)("a",{children:"删除"})})]})}}],tableProps:{polling:3e3,rowKey:"name",scroll:{x:1e3}}})]})}},56765:function(t,e,n){"use strict";n.d(e,{jp:function(){return u},kZ:function(){return l},yq:function(){return o}});var r=n(5726),a=n.n(r),i=n(11110),c=n.n(i);a().extend(c());var s=function(t){var e=(Date.now()-t)/1e3;return e<60?{duration:e,unit:"second"}:e<3600?{duration:Math.floor(e/60),unit:"minute"}:e<86400?{duration:Math.floor(e/3600),unit:"hour"}:{duration:Math.floor(e/86400),unit:"day"}},u=function(t){if(void 0===t)return"";var e=s(t);return"second"===e.unit?"1分钟内":"".concat(e.duration," ").concat({second:"秒",minute:"分钟",hour:"小时",day:"天"}[e.unit],"前")},o=function(t){var e=s(t);return"second"===e.unit?"1分钟内":"约".concat(e.duration).concat({second:"秒",minute:"分钟",hour:"小时",day:"天"}[e.unit])},l=function(t){return isNaN(Number(t))?t:a()(Number(t)).format("YYYY-MM-DD HH:mm:ss")}},10534:function(t,e,n){"use strict";var r=n(99938),a=n(66292),i=n.n(a),c=n(50959),s=n(53270),u=n(77924),o=n(25492),l=n(80785);e.Z=function(t,e){var n;l.Z&&((0,o.mf)(t)||console.error("useDebounceFn expected parameter is a function, got ".concat(typeof t)));var a=(0,s.Z)(t),f=null!==(n=null==e?void 0:e.wait)&&void 0!==n?n:1e3,d=(0,c.useMemo)((function(){return i()((function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return a.current.apply(a,(0,r.ev)([],(0,r.CR)(t),!1))}),f,e)}),[]);return(0,u.Z)((function(){d.cancel()})),{run:d,cancel:d.cancel,flush:d.flush}}},11110:function(t){t.exports=function(){"use strict";var t="minute",e=/[+-]\d\d(?::?\d\d)?/g,n=/([+-]|\d\d)/g;return function(r,a,i){var c=a.prototype;i.utc=function(t){return new a({date:t,utc:!0,args:arguments})},c.utc=function(e){var n=i(this.toDate(),{locale:this.$L,utc:!0});return e?n.add(this.utcOffset(),t):n},c.local=function(){return i(this.toDate(),{locale:this.$L,utc:!1})};var s=c.parse;c.parse=function(t){t.utc&&(this.$u=!0),this.$utils().u(t.$offset)||(this.$offset=t.$offset),s.call(this,t)};var u=c.init;c.init=function(){if(this.$u){var t=this.$d;this.$y=t.getUTCFullYear(),this.$M=t.getUTCMonth(),this.$D=t.getUTCDate(),this.$W=t.getUTCDay(),this.$H=t.getUTCHours(),this.$m=t.getUTCMinutes(),this.$s=t.getUTCSeconds(),this.$ms=t.getUTCMilliseconds()}else u.call(this)};var o=c.utcOffset;c.utcOffset=function(r,a){var i=this.$utils().u;if(i(r))return this.$u?0:i(this.$offset)?o.call(this):this.$offset;if("string"==typeof r&&(r=function(t){void 0===t&&(t="");var r=t.match(e);if(!r)return null;var a=(""+r[0]).match(n)||["-",0,0],i=a[0],c=60*+a[1]+ +a[2];return 0===c?0:"+"===i?c:-c}(r),null===r))return this;var c=Math.abs(r)<=16?60*r:r,s=this;if(a)return s.$offset=c,s.$u=0===r,s;if(0!==r){var u=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(s=this.local().add(c+u,t)).$offset=c,s.$x.$localOffset=u}else s=this.utc();return s};var l=c.format;c.format=function(t){var e=t||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return l.call(this,e)},c.valueOf=function(){var t=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*t},c.isUTC=function(){return!!this.$u},c.toISOString=function(){return this.toDate().toISOString()},c.toString=function(){return this.toDate().toUTCString()};var f=c.toDate;c.toDate=function(t){return"s"===t&&this.$offset?i(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():f.call(this)};var d=c.diff;c.diff=function(t,e,n){if(t&&this.$u===t.$u)return d.call(this,t,e,n);var r=this.local(),a=i(t).local();return d.call(r,a,e,n)}}}()}}]);