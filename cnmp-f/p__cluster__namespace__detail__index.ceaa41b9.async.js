"use strict";(self.webpackChunkcnmp=self.webpackChunkcnmp||[]).push([[4947],{64059:function(e,n,t){var a=t(48305),c=t.n(a),r=t(81798),i=t(62193),s=t(3885),o=t(99790),l=t(69180),u=t(70334),d=t(69005),m=t(3827),x=t(91894),f=t(15268),h=t(38218),p=t(50959),j=t(11527);n.Z=function(e){var n=e.onRefresh,t=e.defaultContent,a=e.editorHeight,_=void 0===a?300:a,Z=e.disabledEdit,v=(0,p.useState)(!1),y=c()(v,2),k=y[0],g=y[1],C=(0,p.useState)(t),b=c()(C,2),P=b[0],w=b[1],S=(0,p.useState)(t),N=c()(S,2),R=N[0],I=N[1],A=(0,p.useState)(!1),B=c()(A,2),L=B[0],Y=B[1],G=(0,p.useState)(!1),M=c()(G,2),T=M[0],q=M[1],U=(0,h.useParams)().clusterName,V=void 0===U?"":U,O=(0,p.useState)("edit"),F=c()(O,2),E=F[0],H=F[1];return(0,p.useEffect)((function(){k&&Y(!0)}),[k]),(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)(i.Z,{justify:"space-between",children:["edit"===E?(0,j.jsxs)(s.Z,{children:[k?(0,j.jsx)(o.Z,{beforeUpload:function(e){var n=new FileReader;return n.readAsText(e),n.onload=function(e){var n,t=null===(n=e.target)||void 0===n?void 0:n.result;t&&I(t)},!1},accept:".yaml,.yml",showUploadList:!1,children:(0,j.jsx)(l.ZP,{type:"primary",children:"导入YAML"})}):(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(l.ZP,{type:"primary",onClick:function(){g(!0)},disabled:Z,children:"编辑YAML"}),(0,j.jsx)(l.ZP,{onClick:function(){navigator.clipboard.writeText(R).then((function(){u.ZP.success("复制成功")}))},children:"复制"}),(0,j.jsx)(l.ZP,{onClick:function(){null==n||n().then((function(e){w(e),u.ZP.success("刷新成功")}))},children:"刷新"})]}),(0,j.jsx)(d.Z,{checked:L,onChange:function(e){Y(e.target.checked)},children:"精简字段"}),L&&(0,j.jsx)(d.Z,{checked:T,onChange:function(e){q(e.target.checked)},children:"隐藏status字段"})]}):(0,j.jsx)("div",{}),k&&(0,j.jsxs)(s.Z,{children:[(0,j.jsx)(l.ZP,{onClick:function(){g(!1),I(P),H("edit")},children:"取消"}),(0,j.jsx)(l.ZP,{onClick:function(){R?"edit"!==E?(0,f.e7)({yaml:R,cluster_name:V}).then((function(e){m.Z.confirm({title:"确认更新",width:800,content:e.success?(0,j.jsx)(x.Z,{message:"检查通过，点击‘应用’执行变更",type:"success",showIcon:!0}):(0,j.jsx)(x.Z,{message:"检查未通过",type:"error",description:e.message,showIcon:!0}),okText:"应用",onOk:function(){(0,f.aA)({yaml:R,cluster_name:V}).then((function(){w(R),g(!1),H("edit"),u.ZP.success("编辑成功")})).catch((function(e){u.ZP.error(e.reason)}))}})})):H("diff"):u.ZP.warning("请输入YAML")},children:"确定"})]})]}),(0,j.jsx)("div",{style:{marginTop:20},children:(0,j.jsx)(r.Z,{readOnly:!k,simplify:L,hideStatus:T,originalValue:P,value:R,onChange:function(e){I(e||"")},diff:"diff"===E,height:_})})]})}},23650:function(e,n,t){t.r(n),t.d(n,{default:function(){return M}});var a=t(90228),c=t.n(a),r=t(87999),i=t.n(r),s=t(48305),o=t.n(s),l=t(15268),u=t(79890),d=t(64059),m=t(34015),x=t(26104),f=t(93055),h=t(27274),p=t(36954),j=t(56765),_=t(38218),Z=t(47212),v=t(69180),y=t(3885),k=t(3827),g=t(70334),C=t(50959),b=t(11527),P=function(){var e=(0,_.useParams)(),n=e.clusterName,t=void 0===n?"":n,a=e.name,r=void 0===a?"":a,s=(0,Z.Z)(i()(c()().mark((function e(){var n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.oy)({cluster_name:t,namespace:r,list_all:1});case 2:return n=e.sent,e.abrupt("return",n.list);case 4:case"end":return e.stop()}}),e)})))),o=s.data,d=s.refresh,x=(0,Z.Z)(i()(c()().mark((function e(){var n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.S3)({cluster_name:t,namespace:r,list_all:1});case 2:return n=e.sent,e.abrupt("return",n.list);case 4:case"end":return e.stop()}}),e)})))),f=x.data,C=x.refresh;return(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Z,{dataSource:o,leftTitle:"资源配额 ResourceQuota",showSearch:!1,rightTitle:[(0,b.jsx)(u.Z,{modalRender:function(e){return(0,b.jsx)(p.Z,{defaultValue:"",clusterName:t,onCancel:function(){e()},diffBeforeSubmit:!1})},children:(0,b.jsx)(v.ZP,{type:"primary",children:"YAML创建资源"})},"edit")],columns:[{dataIndex:"name",title:"名称",width:200,ellipsis:!0},{dataIndex:"hard_resource",key:"hard_resource1",title:"计算资源配额",render:function(e,n){var t=n.used_resource;return(0,b.jsx)(m.Z,{direction:"vertical",items:["CPU请求：".concat(t.cpu_request," /  ").concat(e.cpu_request||"无限制","  Core"),"CPU上限：".concat(t.cpu_limit," /  ").concat(e.cpu_limit||"无限制","  Core"),"内存请求：".concat(t.mem_request," /  ").concat(e.mem_request||"无限制","  GiB"),"内存上限：".concat(t.mem_limit," /  ").concat(e.mem_limit||"无限制","  GiB")]})}},{dataIndex:"hard_resource",key:"hard_resource2",title:"存储资源配额",render:function(e,n){var t=n.used_resource;return(0,b.jsx)(m.Z,{direction:"vertical",items:["存储请求总量：".concat(t.max_resource_storage," /  ").concat(e.max_resource_storage||"无限制","  GiB"),"存储卷：".concat(t.max_persistent_volume_claim," /  ").concat(e.max_persistent_volume_claim||"无限制","  个")]})}},{dataIndex:"hard_resource",key:"hard_resource3",title:"其他资源配额",render:function(e,n){var t=n.used_resource;return(0,b.jsx)(m.Z,{direction:"vertical",items:["Pod数量：".concat(t.max_pod," /  ").concat(e.max_pod||"无限制","  个"),"ConfigMap数量：".concat(t.max_configmap," /  ").concat(e.max_configmap||"无限制","  个"),"Secret数量：".concat(t.max_secret," /  ").concat(e.max_secret||"无限制","  个"),"service数量：".concat(t.max_service," /  ").concat(e.max_service||"无限制","  个")]})}},{dataIndex:"scopes",title:"Scopes",render:function(e,n){return(0,b.jsx)(m.Z,{direction:"vertical",items:n.scopes})}},{dataIndex:"create_time",title:"创建时间",render:j.kZ,width:160},{dataIndex:"operate",title:"操作",width:140,fixed:"right",render:function(e,n){return(0,b.jsxs)(y.Z,{children:[(0,b.jsx)(u.Z,{modalRender:function(e){return(0,b.jsx)(p.Z,{defaultValue:null==n?void 0:n.yaml,clusterName:t,onCancel:function(){e()}})},children:(0,b.jsx)("a",{children:"编辑YAML"})}),(0,b.jsx)("a",{onClick:function(){var e;k.Z.confirm({title:"删除【".concat(n.name,"】"),content:"确认删除ResourceQuota【".concat(n.name,"】？"),onOk:(e=i()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.gb)({cluster_name:t,namespace:r,name:n.name});case 2:g.ZP.success("删除成功"),d();case 4:case"end":return e.stop()}}),e)}))),function(){return e.apply(this,arguments)})})},children:"删除"})]})}}],tableProps:{scroll:{x:1500}}}),(0,b.jsx)(h.Z,{tableProps:{style:{marginTop:10},scroll:{x:1200}},showSearch:!1,leftTitle:"资源限制 LimitRange",dataSource:f,rightTitle:[(0,b.jsx)(u.Z,{modalRender:function(e){return(0,b.jsx)(p.Z,{defaultValue:"",clusterName:t,onCancel:function(){e()},diffBeforeSubmit:!1})},children:(0,b.jsx)(v.ZP,{type:"primary",children:"YAML创建资源"})},"edit")],columns:[{dataIndex:"name",title:"名称"},{dataIndex:"container_limit_range",title:"容器资源限制",render:function(e){return(0,b.jsx)(m.Z,{direction:"vertical",items:["默认CPU请求：  ".concat(e.default_cpu_request||"无限制","  Core"),"默认CPU上限：  ".concat(e.default_cpu||"无限制","  Core"),"默认内存请求：  ".concat(e.default_mem_request||"无限制","  GiB"),"默认内存上限：  ".concat(e.default_mem||"无限制","  GiB"),"最小CPU：  ".concat(e.min_cpu||"无限制","  Core"),"最大CPU：  ".concat(e.max_cpu||"无限制","  Core"),"最小内存：  ".concat(e.min_mem||"无限制","  GiB"),"最大内存：  ".concat(e.max_mem||"无限制","  GiB")]})}},{dataIndex:"pod_limit_range",title:"Pod资源限制",render:function(e){return(0,b.jsx)(m.Z,{direction:"vertical",items:["最大CPU： ".concat(e.max_cpu," /  ").concat(e.max_cpu||"无限制","  Core"),"最大内存： ".concat(e.max_mem," /  ").concat(e.max_mem||"无限制","  GiB")]})}},{dataIndex:"persistent_volume_claim_limit_range",title:"存储卷声明资源限制",render:function(e){return(0,b.jsx)(m.Z,{direction:"vertical",items:["最小存储请求： ".concat(e.min_resource_storage_request||"无限制","  GiB"),"最大存储请求：".concat(e.max_resource_storage_request||"无限制","  GiB")]})}},{dataIndex:"create_time",title:"创建时间",render:j.kZ,width:160},{dataIndex:"operate",title:"操作",fixed:"right",width:140,render:function(e,n){return(0,b.jsxs)(y.Z,{children:[(0,b.jsx)(u.Z,{modalRender:function(e){return(0,b.jsx)(p.Z,{defaultValue:null==n?void 0:n.yaml,clusterName:t,onCancel:function(){e()}})},children:(0,b.jsx)("a",{children:"编辑YAML"})}),(0,b.jsx)("a",{onClick:function(){var e;k.Z.confirm({title:"删除【".concat(n.name,"】"),content:"确认删除LimitRange【".concat(n.name,"】？"),onOk:(e=i()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.oC)({cluster_name:t,namespace:r,name:n.name});case 2:g.ZP.success("删除成功"),C();case 4:case"end":return e.stop()}}),e)}))),function(){return e.apply(this,arguments)})})},children:"删除"})]})}}]})]})},w=t(34593),S=t(29762),N=t(81901),R=t(72596),I=t(62193),A=t(73634),B=t(63983),L=t(19338),Y="block___YGY15",G=function(e){return(0,b.jsx)(R.Z,{span:e.span||8,style:{minHeight:36,lineHeight:"36px"},children:(0,b.jsxs)(I.Z,{children:[(0,b.jsx)("div",{style:{width:100},children:e.label}),(0,b.jsx)("div",{style:e.style,children:e.value})]})})},M=function(){var e=(0,_.useParams)(),n=e.clusterName,t=void 0===n?"":n,a=e.name,r=void 0===a?"":a,s=(0,_.useNavigate)(),h=(0,N.Z)({tab:"basic"}),p=o()(h,2),Z=p[0],y=p[1],R=(0,C.useState)(),I=o()(R,2),M=I[0],T=I[1];return(0,C.useEffect)((function(){(0,l.Q1)({name:r,cluster_name:t}).then((function(e){T(e)}))}),[]),(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(w.Z,{items:[{title:(0,b.jsx)(_.Link,{to:"/cluster/".concat(t,"/namespace"),children:"命名空间"})},{title:"命名空间详情：".concat(r)}],sourceType:"namespace",showCreateYamlButton:!1,onParamsChange:function(e){s("/cluster/".concat(e.clusterName||t,"/namespace"))},footRender:function(){return M&&(0,b.jsx)(S.Z,{title:"命名空间",yaml:M.yaml,name:M.name,operationRender:function(){return[(0,b.jsx)(u.Z,{modalRender:function(e){return(0,b.jsx)(f.Z,{namespace:r,onCancel:function(){e()}})},children:(0,b.jsx)(v.ZP,{children:"设置资源配额"})},"0"),(0,b.jsx)(u.Z,{modalRender:function(e){return(0,b.jsx)(x.Z,{namespace:r,onCancel:function(){e()}})},children:(0,b.jsx)(v.ZP,{children:"设置资源限制"})},"1")]},sourceType:"namespace",onDelete:function(){k.Z.confirm({title:"【".concat(M.name,"】删除"),content:(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)("p",{children:["确认删除：",M.name,"？"]})}),onOk:function(){(0,l.u1)({cluster_name:t,name:r}).then((function(){s("/cluster/".concat(t,"/namespace")),g.ZP.success("删除成功")}))}})}})}}),M&&(0,b.jsx)(A.Z,{activeKey:Z.tab,onChange:function(e){y({tab:e})},items:[{key:"basic",label:"基础信息",children:(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:Y,children:[(0,b.jsxs)(B.Z,{children:[(0,b.jsx)(G,{label:"名称",value:M.name}),(0,b.jsx)(G,{label:"状态",value:M.state,style:{color:"Active"===M.state?"#52C41A":""}}),(0,b.jsx)(G,{label:"创建时间",value:(0,j.kZ)(M.create_time)})]}),(0,b.jsx)(B.Z,{children:(0,b.jsx)(G,{label:"备注",span:24,value:M.description||"-"})})]}),(0,b.jsx)("div",{className:Y,children:(0,b.jsx)(L.Z,{title:"注解&标签",items:[{key:"annotations",label:"注解",children:(0,b.jsx)(m.Z,{items:Object.keys(M.annotations||{}).map((function(e){return{value:"".concat(e,":").concat(M.annotations[e])}})),tagStyle:{maxWidth:300},direction:"vertical"})},{key:"labels",label:"标签",children:(0,b.jsx)(m.Z,{items:Object.keys(M.labels||{}).map((function(e){return{value:"".concat(e,":").concat(M.labels[e])}})),tagStyle:{maxWidth:300},direction:"vertical"})}]})})]})},{key:"resource",label:"资源管理",children:(0,b.jsx)(P,{})},{key:"YAML",label:"YAML",children:(0,b.jsx)("div",{className:Y,children:(0,b.jsx)(d.Z,{defaultContent:M.yaml,editorHeight:500,onRefresh:i()(c()().mark((function e(){var n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.Q1)({name:r,cluster_name:t});case 2:return n=e.sent,e.abrupt("return",n.yaml);case 4:case"end":return e.stop()}}),e)})))})})}]})]})}},29762:function(e,n,t){t.d(n,{Z:function(){return _}});var a=t(48305),c=t.n(a),r=t(36954),i=t(38218),s=t(36241),o=t(21630),l=t(62193),u=t(3885),d=t(97536),m=t(69180),x=t(50959),f="title___qEjyg",h="name___p26Np",p="dropdown___unIV5",j=t(11527),_=function(e){var n=o.Z.useForm(),t=c()(n,1)[0],a=(0,x.useState)(!1),_=c()(a,2),Z=_[0],v=_[1],y=(0,x.useState)(!1),k=c()(y,2),g=k[0],C=k[1],b=(0,i.useParams)().clusterName,P=void 0===b?"":b,w=e.title,S=e.formInitialValues,N=e.onDelete,R=e.refresh,I=e.operationRender,A=e.onRestart,B=e.editRender,L=e.yaml,Y=e.name,G=(0,x.useMemo)((function(){var e=[];return void 0!==L&&e.push({label:"编辑yaml",key:"edit-yaml"}),B&&e.push({label:"编辑",key:"edit"}),A&&e.push({label:"重启",key:"restart"}),N&&e.push({label:"删除",key:"delete"}),e}),[L,w,Y,P,R,N,A]);return(0,j.jsxs)("div",{className:f,children:[(0,j.jsxs)(l.Z,{justify:"space-between",children:[(0,j.jsxs)(u.Z,{children:[(0,j.jsx)("span",{className:h,children:w}),(0,j.jsx)(u.Z,{children:I&&I()})]}),G.length>0&&(0,j.jsx)(d.Z,{overlayClassName:p,menu:{items:G,onClick:function(e){if("delete"!==e.key)return"edit"===e.key?(v(!0),void t.setFieldsValue(S||{})):void("restart"!==e.key?"edit-yaml"!==e.key||C(!0):null==A||A());null==N||N()}},children:(0,j.jsx)(m.ZP,{style:{padding:"4px 8px"},children:(0,j.jsx)(s.Z,{})})})]}),B&&B({title:w,form:t,open:Z,onClose:function(){v(!1)},onOk:function(){v(!1),null==R||R()},type:"edit"}),g&&(0,j.jsx)(r.Z,{title:"【".concat(w,"-").concat(Y,"】编辑Yaml"),defaultValue:L,clusterName:P,onCancel:function(){C(!1),null==R||R()}})]})}}}]);