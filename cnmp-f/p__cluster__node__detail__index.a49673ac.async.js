(self.webpackChunkcnmp=self.webpackChunkcnmp||[]).push([[3630],{36241:function(e,t,n){"use strict";var r=n(79482),a=n(50959),o=n(38930),s=n(28371),i=function(e,t){return a.createElement(s.Z,(0,r.Z)({},e,{ref:t,icon:o.Z}))},l=a.forwardRef(i);t.Z=l},64059:function(e,t,n){"use strict";var r=n(48305),a=n.n(r),o=n(81798),s=n(62193),i=n(3885),l=n(99790),c=n(69180),u=n(70334),d=n(69005),f=n(3827),h=n(91894),m=n(15268),p=n(38218),v=n(50959),x=n(11527);t.Z=function(e){var t=e.onRefresh,n=e.defaultContent,r=e.editorHeight,_=void 0===r?300:r,y=e.disabledEdit,g=(0,v.useState)(!1),j=a()(g,2),b=j[0],Z=j[1],k=(0,v.useState)(n),C=a()(k,2),w=C[0],P=C[1],S=(0,v.useState)(n),I=a()(S,2),T=I[0],N=I[1],$=(0,v.useState)(!1),R=a()($,2),M=R[0],q=R[1],U=(0,v.useState)(!1),D=a()(U,2),O=D[0],F=D[1],Y=(0,p.useParams)().clusterName,E=void 0===Y?"":Y,V=(0,v.useState)("edit"),A=a()(V,2),H=A[0],W=A[1];return(0,v.useEffect)((function(){b&&q(!0)}),[b]),(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)(s.Z,{justify:"space-between",children:["edit"===H?(0,x.jsxs)(i.Z,{children:[b?(0,x.jsx)(l.Z,{beforeUpload:function(e){var t=new FileReader;return t.readAsText(e),t.onload=function(e){var t,n=null===(t=e.target)||void 0===t?void 0:t.result;n&&N(n)},!1},accept:".yaml,.yml",showUploadList:!1,children:(0,x.jsx)(c.ZP,{type:"primary",children:"导入YAML"})}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(c.ZP,{type:"primary",onClick:function(){Z(!0)},disabled:y,children:"编辑YAML"}),(0,x.jsx)(c.ZP,{onClick:function(){navigator.clipboard.writeText(T).then((function(){u.ZP.success("复制成功")}))},children:"复制"}),(0,x.jsx)(c.ZP,{onClick:function(){null==t||t().then((function(e){P(e),u.ZP.success("刷新成功")}))},children:"刷新"})]}),(0,x.jsx)(d.Z,{checked:M,onChange:function(e){q(e.target.checked)},children:"精简字段"}),M&&(0,x.jsx)(d.Z,{checked:O,onChange:function(e){F(e.target.checked)},children:"隐藏status字段"})]}):(0,x.jsx)("div",{}),b&&(0,x.jsxs)(i.Z,{children:[(0,x.jsx)(c.ZP,{onClick:function(){Z(!1),N(w),W("edit")},children:"取消"}),(0,x.jsx)(c.ZP,{onClick:function(){T?"edit"!==H?(0,m.e7)({yaml:T,cluster_name:E}).then((function(e){f.Z.confirm({title:"确认更新",width:800,content:e.success?(0,x.jsx)(h.Z,{message:"检查通过，点击‘应用’执行变更",type:"success",showIcon:!0}):(0,x.jsx)(h.Z,{message:"检查未通过",type:"error",description:e.message,showIcon:!0}),okText:"应用",onOk:function(){(0,m.aA)({yaml:T,cluster_name:E}).then((function(){P(T),Z(!1),W("edit"),u.ZP.success("编辑成功")})).catch((function(e){u.ZP.error(e.reason)}))}})})):W("diff"):u.ZP.warning("请输入YAML")},children:"确定"})]})]}),(0,x.jsx)("div",{style:{marginTop:20},children:(0,x.jsx)(o.Z,{readOnly:!b,simplify:M,hideStatus:O,originalValue:w,value:T,onChange:function(e){N(e||"")},diff:"diff"===H,height:_})})]})}},27274:function(e,t,n){"use strict";n.d(t,{Z:function(){return _}});var r=n(15558),a=n.n(r),o=n(26068),s=n.n(o),i=n(48305),l=n.n(i),c=n(45778),u=n(95974),d=n(41710),f=n(10534),h=n(65460),m=n(96286),p=n(50959),v="table___Rup7Y",x=n(11527),_=function(e){var t=e.placeholder,n=e.request,r=e.columns,o=e.leftTitle,i=e.tableProps,_=e.showSearch,y=void 0===_||_,g=e.dataSource,j=e.searchWidth,b=e.rightTitle,Z=void 0===b?[]:b,k=e.refreshDeps,C=e.actionRef,w=e.hideTitle,P=e.searchStyle,S=e.onSearch,I=(0,c.T)(C),T=(0,p.useState)(""),N=l()(T,2),$=N[0],R=N[1],M=(0,p.useRef)(""),q=(0,f.Z)((function(){var e,t;null==S||S($),null===(e=I.current)||void 0===e||null===(t=e.reloadAndRest)||void 0===t||t.call(e)}),{wait:500}).run;return(0,h.Z)((function(){var e;null===(e=I.current)||void 0===e||e.reload()}),k||[]),(0,x.jsx)(d.Z,s()({className:v,actionRef:I,headerTitle:o,dataSource:g,search:!1,columns:r,request:n&&function(e){return n(s()(s()({},e),{},{keyword:M.current}))},pagination:{showSizeChanger:!0,defaultPageSize:50},options:{reload:!!n},toolBarRender:!w&&function(){return[].concat(a()(Z),a()(y?[(0,x.jsx)(m.Z,{style:s()({width:null!=j?j:300},P),value:$,placeholder:t,onChange:function(e){R(e.target.value),M.current=e.target.value,q()},allowClear:!0,suffix:(0,x.jsx)(u.Z,{style:{color:"#918f8f"}})},"__search__input")]:[]))}},i))}},44161:function(e,t,n){"use strict";n.d(t,{Z:function(){return N}});var r=n(82092),a=n.n(r),o=n(26068),s=n.n(o),i=n(90228),l=n.n(i),c=n(15558),u=n.n(c),d=n(87999),f=n.n(d),h=n(48305),m=n.n(h),p=n(95974),v=n(76489),x=n(45778),_=n(52850),y=n(69180),g=n(70334),j=n(96286),b=n(82187),Z=n.n(b),k=n(32699),C=n.n(k),w=n(50959),P=n(59739),S="editable-table___ELOJW",I=n(11527),T=function(e,t,n){return void 0===t||""===t?e:e.filter((function(e){return!n||n(e,t)}))},N=function(e){var t=e.defaultIsEdit,n=void 0!==t&&t,r=e.placeholder,o=e.columns,i=e.editTitle,c=e.searchWidth,d=e.search,h=e.onSave,b=e.hide,k=e.operationOptions,N=e.editable,$=e.recordCreatorProps,R=e.rowKey,M=void 0===R?"id":R,q=e.tableProps,U=(0,_.Z)(e),D=m()(U,2),O=D[0],F=D[1],Y=(0,w.useState)(""),E=m()(Y,2),V=E[0],A=E[1],H=(0,w.useState)(n),W=m()(H,2),L=W[0],B=W[1],K=(0,x.T)(e.editorFormRef),z=(0,w.useRef)(),G=(0,w.useState)([]),J=m()(G,2),X=J[0],Q=J[1],ee=(0,w.useState)([]),te=m()(ee,2),ne=te[0],re=te[1],ae=(0,w.useMemo)((function(){return T(O,V,d)}),[O,d,V]),oe=(0,w.useState)(0),se=m()(oe,2),ie=se[0],le=se[1];(0,w.useEffect)((function(){re(T(O||[],V,d))}),[O,d,V]),(0,w.useEffect)((function(){Q(L&&(null==O?void 0:O.map((function(e){return e[M]})))||[])}),[L,O,M]);var ce=function(){var e=f()(l()().mark((function e(){var t,n,r,a;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=C().differenceBy(ne,ae,M),n=C().differenceBy(ae,ne,M),r=C().intersectionBy(ne,ae,M),a=[].concat(u()(t),u()(O.filter((function(e){return!n.some((function(t){return e[M]===t[M]}))})).map((function(e){var t=r.findIndex((function(t){return e[M]===t[M]}));return t>-1?r[t]:e})))),!h){e.next=7;break}return e.next=7,h(a);case 7:F(a),B(!1);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,I.jsx)(v.Z,s()({rowKey:M,className:Z()(S,e.className),headerTitle:L||"string"!=typeof i?(0,I.jsx)("span",{onClick:function(){L||B(!0)},children:i}):(0,I.jsx)(y.ZP,{type:"primary",onClick:function(){L||B(!0)},children:i}),toolBarRender:function(){return null!=b&&b.toolBarRender?[]:L?[(0,I.jsx)(y.ZP,{onClick:function(){re(ae),B(!1),le(ie+1)},children:"取消"},"cancel"),(0,I.jsx)(y.ZP,{type:"primary",onClick:f()(l()().mark((function e(){var t;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,null===(t=K.current)||void 0===t?void 0:t.validateFields();case 3:e.next=9;break;case 5:return e.prev=5,e.t0=e.catch(0),g.ZP.warning("存在校验未通过项，请修改"),e.abrupt("return");case 9:ce();case 10:case"end":return e.stop()}}),e,null,[[0,5]])}))),children:"确认"},"ok")]:[(0,I.jsx)(j.Z,{style:{width:null!=c?c:300},value:V,placeholder:r,onChange:function(e){A(e.target.value)},allowClear:!0,suffix:(0,I.jsx)(p.Z,{style:{color:"#918f8f"}})},"__search__input")]},editableFormRef:K,columns:[].concat(u()(o),u()(L?[{dataIndex:"operation",title:"操作",valueType:"option",width:(null==k?void 0:k.width)||250,render:function(){return null}}]:[])),recordCreatorProps:!!L&&s()({position:"top",newRecordType:"dataSource",record:function(){return a()({},M,(0,P.Z)())}},$),value:ne,onChange:function(e){re(e)},actionRef:z,editable:s()({type:"multiple",editableKeys:X,actionRender:function(e,t,n){return[n.delete]},onValuesChange:function(t,n){var r;(re(n),null!=b&&b.toolBarRender)&&(null===(r=e.onChange)||void 0===r||r.call(e,n))},onChange:function(e){Q(e)}},N)},q),ie)}},87545:function(e,t,n){"use strict";n.d(t,{E:function(){return r}});var r={Healthy:{label:"健康",color:"green"},DiskPressure:{label:"磁盘空间异常",color:"red"},MemoryPressure:{label:"内存空间异常",color:"red"},PIDPressure:{label:"进程异常",color:"red"},NetworkUnavailable:{label:"网络异常",color:"red"},RouteUnavailable:{label:"路由异常",color:"red"},CpuUsageHigh:{label:"Cpu使用过高",color:"red"},MemoryUsageHigh:{label:"内存使用过高",color:"red"}}},45778:function(e,t,n){"use strict";n.d(t,{T:function(){return a}});var r=n(50959),a=function(e,t){var n=(0,r.useRef)(t);return e||n}},42528:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return le}});var r=n(26068),a=n.n(r),o=n(90228),s=n.n(o),i=n(87999),l=n.n(i),c=n(48305),u=n.n(c),d=n(15268),f=n(79890),h=n(64059),m=n(27274),p=n(34015),v=n(87545),x=n(62193),_=n(67813),y=n(50959),g="card___k9Ynl",j="row___CzKGV",b="label___sf2yj",Z=n(11527),k=function(e){var t=e.assignment,n=e.percent,r=e.title,a=e.total,o=e.usage,s=(0,y.useMemo)((function(){var e="#3BA1FF";return n>60&&n<=80?e="#faad14":n>80&&(e="#ff4d4f"),e}),[n]);return(0,Z.jsx)("div",{children:(0,Z.jsxs)("div",{className:g,children:[(0,Z.jsx)("div",{children:r}),(0,Z.jsxs)(x.Z,{style:{paddingTop:10},children:[(0,Z.jsx)("div",{style:{width:"40%"},children:(0,Z.jsx)(_.Z,{type:"circle",percent:n,strokeColor:s,size:100,format:function(){return(0,Z.jsxs)("span",{style:{color:"#000000"},children:[n,"%"]})}})}),(0,Z.jsxs)("div",{style:{width:"60%"},children:[(0,Z.jsxs)(x.Z,{className:j,children:[(0,Z.jsx)("div",{className:b,children:"已使用"}),(0,Z.jsx)("div",{style:{fontWeight:"bold"},children:o})]}),(0,Z.jsxs)(x.Z,{className:j,children:[(0,Z.jsx)("div",{className:b,children:"可分配"}),(0,Z.jsx)("div",{style:{fontWeight:"bold"},children:t})]}),(0,Z.jsxs)(x.Z,{className:j,children:[(0,Z.jsx)("div",{className:b,children:"总量"}),(0,Z.jsx)("div",{style:{fontWeight:"bold"},children:a})]})]})]})]})})},C=n(3885),w="card___HO21n",P="item___snE4Y",S=function(e){var t=e.title,n=e.data;return(0,Z.jsx)("div",{children:(0,Z.jsxs)("div",{className:w,children:[(0,Z.jsx)("div",{children:t}),(0,Z.jsx)("div",{style:{display:"flex",flexDirection:"column-reverse",height:116},children:n.reverse().map((function(e,t){var n=Math.floor(e.value/e.total*100),r="#3BA1FF";return n>60&&n<=80?r="#faad14":n>80&&(r="#ff4d4f"),(0,Z.jsxs)("div",{className:P,children:[(0,Z.jsxs)(x.Z,{justify:"space-between",children:[(0,Z.jsx)("span",{children:e.label}),(0,Z.jsxs)(C.Z,{children:[(0,Z.jsxs)("span",{style:{fontWeight:"bold"},children:[Math.floor(e.value/e.total*100),"%"]}),(0,Z.jsxs)("span",{style:{fontWeight:"bold"},children:[e.value,"/",(0,Z.jsx)("span",{style:{color:"#7f7f7f"},children:e.total})]})]})]}),(0,Z.jsx)(_.Z,{percent:n,strokeColor:r,format:function(){return""}})]},t)}))})]})})},I=n(56765),T=n(88253),N=n(72596),$=n(63983),R="block___DKXwS",M=T.Z.Title,q={NodeReady:(0,Z.jsx)("span",{style:{color:"var(--color-success)"},children:"运行中"}),NodeError:(0,Z.jsx)("span",{style:{color:"var(--color-error)"},children:"异常"})},U=function(e){return(0,Z.jsx)(N.Z,{span:8,style:{minHeight:36,lineHeight:"36px"},children:(0,Z.jsxs)(x.Z,{children:[(0,Z.jsx)("div",{style:{width:100},children:e.label}),(0,Z.jsx)("div",{style:e.style,children:e.value})]})})},D=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"前",n=Date.now(),r=(n-e)/1e3;return r<60?"1分钟内":r<3600?"".concat(Math.floor(r/60),"分钟").concat(t):r<86400?"".concat(Math.floor(r/3600),"小时").concat(t):r>=86400?"".concat(Math.floor(r/86400),"天").concat(t):""},O=function(e){var t=e.data,n=t.node_item,r=t.system_info,a=t.node_condition,o=t.resource_usage;return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsxs)("div",{className:R,children:[(0,Z.jsxs)($.Z,{children:[(0,Z.jsx)(U,{label:"名称",value:n.name}),(0,Z.jsx)(U,{label:"kubelet版本",value:n.kubelet_version}),(0,Z.jsx)(U,{label:"系统",value:r.operatingSystem})]}),(0,Z.jsxs)($.Z,{children:[(0,Z.jsx)(U,{label:"IP",value:n.internal_ip}),(0,Z.jsx)(U,{label:"kubeproxy",value:r.kubeProxyVersion}),(0,Z.jsx)(U,{label:"架构",value:r.architecture})]}),(0,Z.jsxs)($.Z,{children:[(0,Z.jsx)(U,{label:"状态",value:(0,Z.jsxs)("div",{children:[q[n.state]||""," ",n.unschedulable?(0,Z.jsx)("span",{style:{color:"var(--color-error)"},children:"(已封锁)"}):(0,Z.jsx)("span",{style:{color:"var(--color-subtitle)"},children:"(可调度)"})]})}),(0,Z.jsx)(U,{label:"容器引擎",value:n.container_runtime_version}),(0,Z.jsx)(U,{label:"镜像",value:r.osImage})]}),(0,Z.jsxs)($.Z,{children:[(0,Z.jsx)(U,{label:"健康检查",style:{paddingTop:4},value:(0,Z.jsx)(p.Z,{max:3,items:n.health_state.map((function(e){var t,n;return{value:null===(t=v.E[e])||void 0===t?void 0:t.label,color:null===(n=v.E[e])||void 0===n?void 0:n.color}}))})}),(0,Z.jsx)(U,{label:"创建时间",value:(0,I.kZ)(n.create_time)}),(0,Z.jsx)(U,{label:"内核",value:r.kernelVersion})]})]}),(0,Z.jsxs)("div",{className:R,children:[(0,Z.jsx)(M,{level:5,children:"资源用量/资源分配"}),(0,Z.jsxs)($.Z,{gutter:[16,16],children:[(0,Z.jsx)(N.Z,{span:8,children:(0,Z.jsx)(k,{title:"CPU使用量",percent:Math.floor(o.node_cpu_usage/o.node_cpu_total*100),usage:"".concat(o.node_cpu_usage," Core"),assignment:"".concat(o.node_allocatable_cpu," Core"),total:"".concat(o.node_cpu_total," Core")})}),(0,Z.jsx)(N.Z,{span:8,children:(0,Z.jsx)(k,{title:"内存使用量",percent:Math.floor(o.node_memory_usage/o.node_memory_total*100),usage:"".concat(o.node_memory_usage," GiB"),assignment:"".concat(o.node_allocatable_memory," GiB"),total:"".concat(o.node_memory_total," GiB")})}),(0,Z.jsx)(N.Z,{span:8}),(0,Z.jsx)(N.Z,{span:8,children:(0,Z.jsx)(S,{title:"CPU分配率 Core",data:[{label:"request",value:o.requests_cpu_usage,total:o.node_allocatable_cpu},{label:"limit",value:o.limits_cpu_usage,total:o.node_allocatable_cpu}]})}),(0,Z.jsx)(N.Z,{span:8,children:(0,Z.jsx)(S,{title:"内存分配率 GiB",data:[{label:"request",value:o.requests_memory_usage,total:o.node_allocatable_memory},{label:"limit",value:o.limits_memory_usage,total:o.node_allocatable_memory}]})}),(0,Z.jsx)(N.Z,{span:8,children:(0,Z.jsx)(S,{title:"Pod分配率",data:[{label:"Pod数量",value:o.pod_usage,total:o.pod_total}]})})]})]}),(0,Z.jsx)(m.Z,{leftTitle:(0,Z.jsx)(M,{level:5,children:"健康检查"}),tableProps:{pagination:!1},dataSource:a,columns:[{dataIndex:"type",title:"类型"},{dataIndex:"status",title:"状态"},{dataIndex:"reason",title:"reason"},{dataIndex:"message",title:"message"},{dataIndex:"last_heartbeat_time",title:"lastHeartbeatTime",render:function(e){return D(Number(e))}},{dataIndex:"last_transition_time",title:"lastTransitionTime",render:function(e){return D(Number(e))}}],showSearch:!1,refreshDeps:[a]})]})},F=n(15558),Y=n.n(F),E=n(44161),V=n(59739),A=function(e,t){return!t||[e.value||"",e.key||""].some((function(e){return e.toLowerCase().indexOf(t.toLowerCase())>-1}))},H=function(e){var t=e.editTitle,n=e.columns,r=e.onSave,o=e.disablePatterRule,s=(0,y.useMemo)((function(){return e.dataSource.map((function(e){return a()(a()({},e),{},{id:(0,V.Z)()})}))}),[e.dataSource]);return(0,Z.jsx)(E.Z,{placeholder:"模糊搜索标签Key、Value",searchWidth:400,defaultValue:s,onSave:r,editTitle:t,search:A,columns:Y()(n.map((function(e){return a()(a()({},e),{},{formItemProps:function(t,n){return{rules:"select"===e.valueType?[{required:e.required,message:"此项是必填项"}]:[{required:e.required,message:"此项是必填项"}].concat(Y()(o?[]:[{message:"支持字母、数字及分隔符（“-”、“_”、”.”、“/”），需以字母、数字开头",pattern:/^[a-zA-Z0-9][a-zA-Z0-9./_-]*$/}]),[{max:63,message:"长度支持1-63个字符"},{validator:function(r,a){if(!e.only)return Promise.resolve();var o=t.getFieldsValue();return Object.keys(o).filter((function(e){var t;return e!==(null===(t=n.rowKey)||void 0===t?void 0:t[0])})).some((function(e){return o[e][n.dataIndex]===a}))?Promise.reject(new Error("".concat(e.title,"值不能重复"))):Promise.resolve()}}])}}})})))})},W=n(21630),L=n(3827),B=n(75929),K=n(18772),z=n(22639);var G=function(e){var t=e.name,n=e.onCancel,r=e.onOk,a=W.Z.useForm(),o=u()(a,1)[0],i=W.Z.useWatch("type",o);return(0,Z.jsxs)(L.Z,{open:!0,title:"【".concat(t,"】驱逐pod"),onCancel:n,width:600,onOk:l()(s()().mark((function e(){var t,n;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.validateFields();case 2:n=e.sent,r({force:n.force,grace_period_seconds:null!==(t=n.grace_period_seconds)&&void 0!==t?t:30});case 4:case"end":return e.stop()}}),e)}))),children:[(0,Z.jsxs)(W.Z,{labelCol:{span:4},form:o,style:{marginTop:20},children:[(0,Z.jsx)(W.Z.Item,{label:"force",name:"force",children:(0,Z.jsx)(B.Z,{})}),(0,Z.jsx)(W.Z.Item,{label:"Grace period",name:"type",initialValue:"default",children:(0,Z.jsx)(K.ZP.Group,{options:[{label:"使用Pod默认值",value:"default"},{label:"自定义值",value:"custom"}]})}),"custom"===i&&(0,Z.jsx)(W.Z.Item,{label:" ",name:"grace_period_seconds",colon:!1,style:{marginTop:-16},required:!1,rules:[{required:!0,message:"请输入"}],children:(0,Z.jsx)(z.Z,{addonAfter:"秒",min:0,max:1e6,precision:0,placeholder:"请输入"})})]}),(0,Z.jsx)("p",{children:"此操作将暂停当前节点的调度, 请手动恢复"}),(0,Z.jsx)("p",{style:{color:"var(--color-error)"},children:"注意：本地存储的Pod被驱逐后数据将丢失，请谨慎操作"})]})},J=n(34593),X=n(29762),Q=n(16249),ee=n(38218),te=n(47212),ne=n(69180),re=n(70334),ae=n(73634);function oe(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}var se=function(e,t){return"".concat(e>1e3?"".concat(oe(e/1e3,2)," core"):"".concat(e," m"),"（").concat(oe(e/t*100,2),"%）")},ie=function(e,t){var n="";return n=e>1073741824?"".concat(oe(e/1073741824,2)," Gib"):e>1048576?"".concat(oe(e/1048576,2)," Mib"):"".concat(oe(e/1024,2)," Kib"),"".concat(n,"（").concat(oe(e/t*100,2),"%）")},le=function(){var e=(0,ee.useParams)(),t=e.clusterName,n=void 0===t?"":t,r=e.name,o=void 0===r?"":r,i=(0,ee.useNavigate)(),c=(0,y.useRef)(),v=(0,te.Z)((function(){return(0,d.pC)({name:o,cluster_name:n})})),x=v.data,_=v.refresh,g=v.refreshAsync,j=(0,te.Z)((function(){return(0,d.EI)({list_all:"1",cluster_name:n,node_name:o}).then((function(e){return e.list}))})),b=j.data,k=j.refreshAsync,C=(0,y.useState)(""),w=u()(C,2),P=w[0],S=w[1],T=(0,y.useMemo)((function(){return""===P?b:(null==b?void 0:b.filter((function(e){return["name","status","namespace","workload","containers"].some((function(t){return"string"==typeof e[t]?(console.log(e[t].toUpperCase().includes(P.toUpperCase())),e[t].toUpperCase().includes(P.toUpperCase())):!!Array.isArray(e[t])&&e[t].some((function(e){var t,n;return console.log(null==e||null===(t=e.image)||void 0===t?void 0:t.toUpperCase().includes(P.toUpperCase())),(null==e||null===(n=e.image)||void 0===n?void 0:n.toUpperCase().includes(P.toUpperCase()))||!1}))}))})))||[]}),[P,b]);return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(J.Z,{sourceType:"node",items:[{title:(0,Z.jsx)(ee.Link,{to:"/cluster/".concat(n,"/node"),children:"节点管理"})},{title:"节点详情:".concat(o)}],onParamsChange:function(e){i("/cluster/".concat(e.clusterName||n,"/node"))},footRender:function(){return x&&(0,Z.jsx)(X.Z,{title:"节点详情",operationRender:function(){return[(0,Z.jsx)(ne.ZP,{danger:!0,onClick:l()(s()().mark((function e(){var t;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,d.UR)({name:o,cluster_name:n});case 2:t=e.sent,L.Z.confirm({title:"【".concat(o,"】驱逐节点上pod"),width:600,content:(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsxs)("p",{children:["驱逐pod数：",t.detail.ready_to_evict_pods_count,"，忽略pod数：",t.detail.ignore_evict_pods_count]}),(0,Z.jsx)("p",{children:"节点驱逐后，将会把节点内的所有Pod（不包含DaemonSet管理的Pod）从节点中驱逐到集群内其他节点，并将节点设置为封锁状态。"}),(0,Z.jsx)("p",{style:{color:"var(--color-error)"},children:"注意：本地存储的Pod被驱逐后数据将丢失，请谨慎操作"})]}),onOk:function(){(0,d.nt)({cluster_name:n,name:o,operation:"NodeDrain"}).then((function(){re.ZP.success("驱逐成功"),_()}))}});case 4:case"end":return e.stop()}}),e)}))),children:"驱逐"},"1"),(0,Z.jsx)(ne.ZP,{danger:!0,onClick:function(){L.Z.confirm({title:"【".concat(o,"】").concat(x.unschedulable?"取消封锁":"封锁","节点上pod"),content:x.unschedulable?"节点取消封锁后将允许新的Pod调度到该节点。":"封锁节点后，将不接受新的Pod调度到该节点，需要手动取消封锁的节点。",onOk:function(){(0,d.nt)({cluster_name:n,name:o,operation:x.unschedulable?"NodeUncordon":"NodeCordon"}).then((function(){re.ZP.success(x.unschedulable?"取消封锁成功":"封锁成功"),_()}))}})},children:x.unschedulable?"取消封锁":"封锁"},"2")]}})}}),x&&(0,Z.jsx)(ae.Z,{items:[{key:"basic",label:"基础信息",children:(0,Z.jsx)(O,{data:x})},{key:"pods",label:"Pods",children:(0,Z.jsx)(m.Z,{placeholder:"模糊搜索pod名称、状态、命名空间、镜像、所属工作负载",searchWidth:440,dataSource:T||[],actionRef:c,onSearch:function(e){S(e)},tableProps:{scroll:{x:2400},pagination:!1},columns:[{dataIndex:"name",title:"名称",width:200,ellipsis:!0},{dataIndex:"status",title:"状态",width:120,render:function(e){return["Running","Succeeded","Completed"].includes(e)?(0,Z.jsx)("span",{style:{color:"#52C41A"},children:e}):["Pending","Unknown"].includes(e)?(0,Z.jsx)("span",{style:{color:"#F59A23"},children:e}):["Failed","CrashLoopBackOff"].includes(e)?(0,Z.jsx)("span",{style:{color:"#FF4D4F"},children:e}):e},sorter:function(e,t){return e.status.localeCompare(t.status)}},{dataIndex:"namespace",title:"命名空间",minWidth:120,ellipsis:!0},{dataIndex:"containers",title:"镜像",width:160,render:function(e,t){return(0,Z.jsx)(p.Z,{tagStyle:{maxWidth:150},items:t.containers.map((function(e){return{value:e.image}})),direction:"vertical"})}},{dataIndex:"ready_count",title:"Ready",width:100,render:function(e,t){return"".concat(e,"/").concat(t.containers.length)}},{dataIndex:"restart_count",title:"重启",width:100,sorter:function(e,t){return e.restart_count-t.restart_count}},{dataIndex:["resource_usage","cpu_request"],key:"cpu_request",title:"CPU Request",width:160,render:function(e,t){return se(e,t.resource_usage.total_cpu_request)},sorter:function(e,t){return e.resource_usage.cpu_request-t.resource_usage.cpu_request}},{dataIndex:["resource_usage","cpu_limit"],title:"CPU Limit",width:160,render:function(e,t){return se(e,t.resource_usage.total_cpu_limit)},sorter:function(e,t){return e.resource_usage.cpu_limit-t.resource_usage.cpu_limit}},{dataIndex:["resource_usage","memory_request"],title:"Memory Request",width:160,render:function(e,t){return ie(e,t.resource_usage.total_memory_request)},sorter:function(e,t){return e.resource_usage.memory_request-t.resource_usage.memory_request}},{dataIndex:["resource_usage","memory_limit"],title:"Memory Limit",width:160,render:function(e,t){return ie(e,t.resource_usage.total_memory_limit)},sorter:function(e,t){return e.resource_usage.memory_limit-t.resource_usage.memory_limit}},{dataIndex:["resource_usage","ephemeral_storage_request"],title:"EphemeralStorage Request",width:210,render:function(e,t){return ie(e,t.resource_usage.total_ephemeral_storage_request)},sorter:function(e,t){return e.resource_usage.ephemeral_storage_request-t.resource_usage.ephemeral_storage_request}},{dataIndex:["resource_usage","ephemeral_storage_limit"],title:"EphemeralStorage Limit",width:200,render:function(e,t){return ie(e,t.resource_usage.total_ephemeral_storage_limit)},sorter:function(e,t){return e.resource_usage.ephemeral_storage_limit-t.resource_usage.ephemeral_storage_limit}},{dataIndex:"create_time",title:"运行时间",minWidth:160,render:I.kZ,sorter:function(e,t){return e.create_time-t.create_time}},{dataIndex:"workload",title:"所属工作负载",ellipsis:!0},{dataIndex:"operation",title:"操作",fixed:"right",width:100,render:function(e,t){return(0,Z.jsx)(f.Z,{modalRender:function(e){return(0,Z.jsx)(G,{name:t.name,onCancel:e,onOk:function(r){(0,d.yJ)(a()({cluster_name:n,namespace:t.namespace,pod_name:t.name,node_name:o},r)).then((function(){re.ZP.success("驱逐成功"),k(),e()}))}})},children:(0,Z.jsx)("a",{children:"驱逐"})})}}]})},{key:"labels",label:"标签",children:(0,Z.jsx)(H,{onSave:function(){var e=l()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,d.SV)({name:o,cluster_name:n,labels:t.reduce((function(e,t){var n=t.key,r=t.value;return e[n]=r,e}),{})});case 2:re.ZP.success("操作成功");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),dataSource:Object.keys((null==x?void 0:x.labels)||{}).map((function(e){var t;return{key:e,value:(null==x||null===(t=x.labels)||void 0===t?void 0:t[e])||""}})),columns:[{title:"Key",dataIndex:"key",only:!0,required:!0},{title:"Value",dataIndex:"value"}],editTitle:"编辑标签"})},{key:"annotations",label:"注解",children:(0,Z.jsx)(H,{disablePatterRule:!0,onSave:function(){var e=l()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,d.SV)({name:o,cluster_name:n,annotations:t.reduce((function(e,t){var n=t.key,r=t.value;return e[n]=r,e}),{})});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),dataSource:Object.keys((null==x?void 0:x.annotations)||{}).map((function(e){var t;return{key:e,value:(null==x||null===(t=x.annotations)||void 0===t?void 0:t[e])||""}})),columns:[{title:"Key",dataIndex:"key",only:!0,required:!0},{title:"Value",dataIndex:"value"}],editTitle:"编辑注解"})},{key:"taints",label:"污点",children:(0,Z.jsx)(H,{onSave:function(){var e=l()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,d.SV)({name:o,cluster_name:n,taints:t});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),dataSource:(null==x?void 0:x.taints)||[],columns:[{title:"Key",dataIndex:"key",only:!0,required:!0},{title:"Value",dataIndex:"value"},{title:"效果",dataIndex:"effect",valueType:"select",valueEnum:{NoSchedule:{text:"NoSchedule"},NoExecute:{text:"NoExecute"},PreferNoSchedule:{text:"PreferNoSchedule"}}}],editTitle:"编辑污点"})},{key:"yaml",label:"YAML",children:(0,Z.jsx)("div",{className:Q.Z.block,children:(0,Z.jsx)(h.Z,{onRefresh:l()(s()().mark((function e(){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",g().then((function(e){return e.yaml})));case 1:case"end":return e.stop()}}),e)}))),defaultContent:x.yaml,editorHeight:500})})}]})]})}},29762:function(e,t,n){"use strict";n.d(t,{Z:function(){return _}});var r=n(48305),a=n.n(r),o=n(36954),s=n(38218),i=n(36241),l=n(21630),c=n(62193),u=n(3885),d=n(97536),f=n(69180),h=n(50959),m="title___qEjyg",p="name___p26Np",v="dropdown___unIV5",x=n(11527),_=function(e){var t=l.Z.useForm(),n=a()(t,1)[0],r=(0,h.useState)(!1),_=a()(r,2),y=_[0],g=_[1],j=(0,h.useState)(!1),b=a()(j,2),Z=b[0],k=b[1],C=(0,s.useParams)().clusterName,w=void 0===C?"":C,P=e.title,S=e.formInitialValues,I=e.onDelete,T=e.refresh,N=e.operationRender,$=e.onRestart,R=e.editRender,M=e.yaml,q=e.name,U=(0,h.useMemo)((function(){var e=[];return void 0!==M&&e.push({label:"编辑yaml",key:"edit-yaml"}),R&&e.push({label:"编辑",key:"edit"}),$&&e.push({label:"重启",key:"restart"}),I&&e.push({label:"删除",key:"delete"}),e}),[M,P,q,w,T,I,$]);return(0,x.jsxs)("div",{className:m,children:[(0,x.jsxs)(c.Z,{justify:"space-between",children:[(0,x.jsxs)(u.Z,{children:[(0,x.jsx)("span",{className:p,children:P}),(0,x.jsx)(u.Z,{children:N&&N()})]}),U.length>0&&(0,x.jsx)(d.Z,{overlayClassName:v,menu:{items:U,onClick:function(e){if("delete"!==e.key)return"edit"===e.key?(g(!0),void n.setFieldsValue(S||{})):void("restart"!==e.key?"edit-yaml"!==e.key||k(!0):null==$||$());null==I||I()}},children:(0,x.jsx)(f.ZP,{style:{padding:"4px 8px"},children:(0,x.jsx)(i.Z,{})})})]}),R&&R({title:P,form:n,open:y,onClose:function(){g(!1)},onOk:function(){g(!1),null==T||T()},type:"edit"}),Z&&(0,x.jsx)(o.Z,{title:"【".concat(P,"-").concat(q,"】编辑Yaml"),defaultValue:M,clusterName:w,onCancel:function(){k(!1),null==T||T()}})]})}},56765:function(e,t,n){"use strict";n.d(t,{jp:function(){return l},kZ:function(){return u},yq:function(){return c}});var r=n(5726),a=n.n(r),o=n(11110),s=n.n(o);a().extend(s());var i=function(e){var t=(Date.now()-e)/1e3;return t<60?{duration:t,unit:"second"}:t<3600?{duration:Math.floor(t/60),unit:"minute"}:t<86400?{duration:Math.floor(t/3600),unit:"hour"}:{duration:Math.floor(t/86400),unit:"day"}},l=function(e){if(void 0===e)return"";var t=i(e);return"second"===t.unit?"1分钟内":"".concat(t.duration," ").concat({second:"秒",minute:"分钟",hour:"小时",day:"天"}[t.unit],"前")},c=function(e){var t=i(e);return"second"===t.unit?"1分钟内":"约".concat(t.duration).concat({second:"秒",minute:"分钟",hour:"小时",day:"天"}[t.unit])},u=function(e){return isNaN(Number(e))?e:a()(Number(e)).format("YYYY-MM-DD HH:mm:ss")}},16249:function(e,t){"use strict";t.Z={block:"block___u4hkW"}},10534:function(e,t,n){"use strict";var r=n(99938),a=n(66292),o=n.n(a),s=n(50959),i=n(53270),l=n(77924),c=n(25492),u=n(80785);t.Z=function(e,t){var n;u.Z&&((0,c.mf)(e)||console.error("useDebounceFn expected parameter is a function, got ".concat(typeof e)));var a=(0,i.Z)(e),d=null!==(n=null==t?void 0:t.wait)&&void 0!==n?n:1e3,f=(0,s.useMemo)((function(){return o()((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return a.current.apply(a,(0,r.ev)([],(0,r.CR)(e),!1))}),d,t)}),[]);return(0,l.Z)((function(){f.cancel()})),{run:f,cancel:f.cancel,flush:f.flush}}},11110:function(e){e.exports=function(){"use strict";var e="minute",t=/[+-]\d\d(?::?\d\d)?/g,n=/([+-]|\d\d)/g;return function(r,a,o){var s=a.prototype;o.utc=function(e){return new a({date:e,utc:!0,args:arguments})},s.utc=function(t){var n=o(this.toDate(),{locale:this.$L,utc:!0});return t?n.add(this.utcOffset(),e):n},s.local=function(){return o(this.toDate(),{locale:this.$L,utc:!1})};var i=s.parse;s.parse=function(e){e.utc&&(this.$u=!0),this.$utils().u(e.$offset)||(this.$offset=e.$offset),i.call(this,e)};var l=s.init;s.init=function(){if(this.$u){var e=this.$d;this.$y=e.getUTCFullYear(),this.$M=e.getUTCMonth(),this.$D=e.getUTCDate(),this.$W=e.getUTCDay(),this.$H=e.getUTCHours(),this.$m=e.getUTCMinutes(),this.$s=e.getUTCSeconds(),this.$ms=e.getUTCMilliseconds()}else l.call(this)};var c=s.utcOffset;s.utcOffset=function(r,a){var o=this.$utils().u;if(o(r))return this.$u?0:o(this.$offset)?c.call(this):this.$offset;if("string"==typeof r&&(r=function(e){void 0===e&&(e="");var r=e.match(t);if(!r)return null;var a=(""+r[0]).match(n)||["-",0,0],o=a[0],s=60*+a[1]+ +a[2];return 0===s?0:"+"===o?s:-s}(r),null===r))return this;var s=Math.abs(r)<=16?60*r:r,i=this;if(a)return i.$offset=s,i.$u=0===r,i;if(0!==r){var l=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(i=this.local().add(s+l,e)).$offset=s,i.$x.$localOffset=l}else i=this.utc();return i};var u=s.format;s.format=function(e){var t=e||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return u.call(this,t)},s.valueOf=function(){var e=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*e},s.isUTC=function(){return!!this.$u},s.toISOString=function(){return this.toDate().toISOString()},s.toString=function(){return this.toDate().toUTCString()};var d=s.toDate;s.toDate=function(e){return"s"===e&&this.$offset?o(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():d.call(this)};var f=s.diff;s.diff=function(e,t,n){if(e&&this.$u===e.$u)return f.call(this,e,t,n);var r=this.local(),a=o(e).local();return f.call(r,a,t,n)}}}()}}]);