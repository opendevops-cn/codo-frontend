"use strict";(self.webpackChunkcnmp=self.webpackChunkcnmp||[]).push([[7014],{66780:function(e,n,t){t.d(n,{Z:function(){return o}});var r=t(79482),a=t(50959),l={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zM704 536c0 4.4-3.6 8-8 8H544v152c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V544H328c-4.4 0-8-3.6-8-8v-48c0-4.4 3.6-8 8-8h152V328c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v152h152c4.4 0 8 3.6 8 8v48z"}}]},name:"plus-square",theme:"filled"},i=t(28371),s=function(e,n){return a.createElement(i.Z,(0,r.Z)({},e,{ref:n,icon:l}))};var o=a.forwardRef(s)},50660:function(e,n,t){var r=t(79482),a=t(50959),l=t(92484),i=t(28371),s=function(e,n){return a.createElement(i.Z,(0,r.Z)({},e,{ref:n,icon:l.Z}))},o=a.forwardRef(s);n.Z=o},37610:function(e,n,t){var r=t(48305),a=t.n(r),l=t(22927),i=t(66780),s=t(21630),o=t(75929),u=t(62193),c=t(3885),d=t(14621),m=t(32699),f=t.n(m),p=t(50959),v=t(11527);n.Z=function(e){var n=e.operationProps,t=e.label,r=e.name,m=e.fieldRender,h=e.labelCol,x=e.itemMax,Z=e.addText,j=e.showSwitch,y=e.minItem,g=(0,p.useState)(!0),P=a()(g,2),b=P[0],I=P[1],_=s.Z.useFormInstance(),C=(0,p.useRef)();return(0,p.useEffect)((function(){if(j){var e=_.getFieldValue([r]);I(!(!e||f().isEmpty(e)))}}),[_,j,r]),(0,v.jsx)(v.Fragment,{children:(0,v.jsxs)(s.Z.Item,{labelCol:h,label:t,children:[j&&(0,v.jsx)("div",{style:{height:32,display:"flex",alignItems:"center",marginBottom:b?10:0},children:(0,v.jsx)(o.Z,{value:b,onChange:function(e){I(e),e?C.current?_.setFieldValue([r],C.current):_.setFieldValue([r],[{type:"default"}]):(C.current=_.getFieldValue([r]),_.setFieldValue([r],[]))}})}),b&&(0,v.jsx)(s.Z.List,{name:r,children:function(e,t){return(0,v.jsxs)(v.Fragment,{children:[e.map((function(n,r){return(0,v.jsxs)(u.Z,{gap:16,children:[m(n,r,t),(!y||y<e.length)&&(0,v.jsx)(l.Z,{style:{display:"flex",alignSelf:"baseline",paddingTop:10},onClick:function(){t.remove(n.name)}})]},n.key)})),(0,v.jsx)("div",{children:(0,v.jsx)(d.Z,{disabled:!!x&&e.length>=x,onClick:function(){var e;t.add(null==n||null===(e=n.add)||void 0===e?void 0:e.defaultValue)},children:(0,v.jsxs)(c.Z,{children:[(0,v.jsx)(i.Z,{style:{fontSize:20,verticalAlign:"text-bottom"}}),null!=Z?Z:"添加"]})})})]})}})]})})}},13885:function(e,n,t){var r=t(26068),a=t.n(r),l=t(15558),i=t.n(l),s=t(21630),o=t(96286),u=t(37610),c=t(32699),d=t.n(c),m=(t(50959),t(11527)),f=function(e,n,t,r){var a=r||{},l=a.repeat,s=a.required,o=a.rules;return[].concat(i()(s?[{required:!0,message:"string"==typeof s?s:"请输入"}]:[]),i()(l?[]:[{validator:function(r,a){return(n.getFieldValue(t[0])||[]).some((function(n,r){return!d().isNil(null==n?void 0:n[t[1]])&&n[t[1]]===a&&e!==r}))?Promise.reject(new Error("string"==typeof l?l:"存在重复值，请修改")):Promise.resolve()}}]),i()(o||[]))};n.Z=function(e){var n=e.keyOption,t=void 0===n?{}:n,r=e.valueOption,l=void 0===r?{}:r,i=e.placeholder,c=e.label,d=e.name,p=e.keyRules,v=e.valueRules,h=e.addText,x=s.Z.useFormInstance();return(0,m.jsx)(u.Z,{label:c,name:d,addText:h,fieldRender:function(e,n){var r,u;return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(s.Z.Item,{name:[e.name,"key"],rules:f(n,x,[d,"key"],a()({required:!0,repeat:!1,rules:[]},t))||(null==p?void 0:p(n))||[],style:{width:"100%"},children:(0,m.jsx)(o.Z,{placeholder:null!==(r=null==i?void 0:i[0])&&void 0!==r?r:"请输入键"})}),(0,m.jsx)(s.Z.Item,{name:[e.name,"value"],rules:f(n,x,[d,"value"],a()({required:!1,repeat:!0,rules:[]},l))||(null==v?void 0:v(n))||[],style:{width:"100%"},children:(0,m.jsx)(o.Z,{placeholder:null!==(u=null==i?void 0:i[1])&&void 0!==u?u:"请输入值"})})]})}})}},44161:function(e,n,t){t.d(n,{Z:function(){return z}});var r=t(82092),a=t.n(r),l=t(26068),i=t.n(l),s=t(90228),o=t.n(s),u=t(15558),c=t.n(u),d=t(87999),m=t.n(d),f=t(48305),p=t.n(f),v=t(95974),h=t(76489),x=t(45778),Z=t(52850),j=t(69180),y=t(70334),g=t(96286),P=t(82187),b=t.n(P),I=t(32699),_=t.n(I),C=t(50959),k=t(59739),w="editable-table___ELOJW",S=t(11527),N=function(e,n,t){return void 0===n||""===n?e:e.filter((function(e){return!t||t(e,n)}))},z=function(e){var n=e.defaultIsEdit,t=void 0!==n&&n,r=e.placeholder,l=e.columns,s=e.editTitle,u=e.searchWidth,d=e.search,f=e.onSave,P=e.hide,I=e.operationOptions,z=e.editable,F=e.recordCreatorProps,R=e.rowKey,E=void 0===R?"id":R,T=e.tableProps,V=(0,Z.Z)(e),A=p()(V,2),q=A[0],B=A[1],O=(0,C.useState)(""),H=p()(O,2),L=H[0],$=H[1],K=(0,C.useState)(t),M=p()(K,2),W=M[0],D=M[1],G=(0,x.T)(e.editorFormRef),J=(0,C.useRef)(),U=(0,C.useState)([]),Q=p()(U,2),Y=Q[0],X=Q[1],ee=(0,C.useState)([]),ne=p()(ee,2),te=ne[0],re=ne[1],ae=(0,C.useMemo)((function(){return N(q,L,d)}),[q,d,L]),le=(0,C.useState)(0),ie=p()(le,2),se=ie[0],oe=ie[1];(0,C.useEffect)((function(){re(N(q||[],L,d))}),[q,d,L]),(0,C.useEffect)((function(){X(W&&(null==q?void 0:q.map((function(e){return e[E]})))||[])}),[W,q,E]);var ue=function(){var e=m()(o()().mark((function e(){var n,t,r,a;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=_().differenceBy(te,ae,E),t=_().differenceBy(ae,te,E),r=_().intersectionBy(te,ae,E),a=[].concat(c()(n),c()(q.filter((function(e){return!t.some((function(n){return e[E]===n[E]}))})).map((function(e){var n=r.findIndex((function(n){return e[E]===n[E]}));return n>-1?r[n]:e})))),!f){e.next=7;break}return e.next=7,f(a);case 7:B(a),D(!1);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,S.jsx)(h.Z,i()({rowKey:E,className:b()(w,e.className),headerTitle:W||"string"!=typeof s?(0,S.jsx)("span",{onClick:function(){W||D(!0)},children:s}):(0,S.jsx)(j.ZP,{type:"primary",onClick:function(){W||D(!0)},children:s}),toolBarRender:function(){return null!=P&&P.toolBarRender?[]:W?[(0,S.jsx)(j.ZP,{onClick:function(){re(ae),D(!1),oe(se+1)},children:"取消"},"cancel"),(0,S.jsx)(j.ZP,{type:"primary",onClick:m()(o()().mark((function e(){var n;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,null===(n=G.current)||void 0===n?void 0:n.validateFields();case 3:e.next=9;break;case 5:return e.prev=5,e.t0=e.catch(0),y.ZP.warning("存在校验未通过项，请修改"),e.abrupt("return");case 9:ue();case 10:case"end":return e.stop()}}),e,null,[[0,5]])}))),children:"确认"},"ok")]:[(0,S.jsx)(g.Z,{style:{width:null!=u?u:300},value:L,placeholder:r,onChange:function(e){$(e.target.value)},allowClear:!0,suffix:(0,S.jsx)(v.Z,{style:{color:"#918f8f"}})},"__search__input")]},editableFormRef:G,columns:[].concat(c()(l),c()(W?[{dataIndex:"operation",title:"操作",valueType:"option",width:(null==I?void 0:I.width)||250,render:function(){return null}}]:[])),recordCreatorProps:!!W&&i()({position:"top",newRecordType:"dataSource",record:function(){return a()({},E,(0,k.Z)())}},F),value:te,onChange:function(e){re(e)},actionRef:J,editable:i()({type:"multiple",editableKeys:Y,actionRender:function(e,n,t){return[t.delete]},onValuesChange:function(n,t){var r;(re(t),null!=P&&P.toolBarRender)&&(null===(r=e.onChange)||void 0===r||r.call(e,t))},onChange:function(e){X(e)}},z)},T),se)}},14621:function(e,n,t){t.d(n,{Z:function(){return c}});var r=t(26068),a=t.n(r),l=t(67825),i=t.n(l),s=(t(50959),"disabled___nnQy2"),o=t(11527),u=["disabled","children","onClick","className"],c=function(e){var n=e.disabled,t=e.children,r=e.onClick,l=e.className,c=void 0===l?"":l,d=i()(e,u);return(0,o.jsx)("a",a()(a()({className:n?s+" "+c:c,onClick:function(){n||null==r||r()}},d),{},{children:t}))}},57014:function(e,n,t){t.d(n,{Z:function(){return O}});var r=t(15558),a=t.n(r),l=t(90228),i=t.n(l),s=t(87999),o=t.n(s),u=t(48305),c=t.n(u),d=t(26068),m=t.n(d),f=t(44161),p=t(89629),v=t(38218),h=t(50660),x=t(21630),Z=t(70334),j=t(3827),y=t(96286),g=t(13702),P=t(62193),b=t(18772),I=t(4561),_=t(3885),C=t(69005),k=t(75929),w=t(22639),S=t(50959),N=t(59739),z=t(15268),F=t(13885),R=t(32699),E=t.n(R),T="edit-table___LpP6q",V="tag-select___Ag9kJ",A="required___zcSmy",q=t(11527),B=function(e){if(!e)return{};var n={};return e.forEach((function(e){n[e.key]=e.value})),n};var O=function(e){var n=e.open,t=void 0===n||n,r=e.onCancel,l=e.onOk,s=(0,S.useMemo)((function(){var n;return e.initialValues?m()(m()({},e.initialValues),{},{ports:null===(n=e.initialValues.ports)||void 0===n?void 0:n.map((function(e){return m()({id:(0,N.Z)()},e)}))}):void 0}),[e.initialValues]),u=x.Z.useForm(),d=c()(u,1)[0],R=!!s,O=x.Z.useWatch("headless",d),H=x.Z.useWatch("svc_type",d),L=x.Z.useWatch("session_affinity",d),$=(0,S.useRef)(),K=(0,v.useParams)(),M=K.clusterName,W=void 0===M?"":M,D=K.namespace,G=void 0===D?"":D,J=(0,p.gt)({variables:{list_all:1,cluster_name:W}}).data,U=function(){var e=o()(i()().mark((function e(){var n,t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.validateFields();case 2:return t=e.sent,e.next=5,null===(n=$.current)||void 0===n?void 0:n.validateFields();case 5:if(s){e.next=11;break}return e.next=8,(0,z.uK)(m()(m()({cluster_name:W},t),{},{labels:B(t.labels),selector:B(t.selector),annotations:B(t.annotations)}));case 8:Z.ZP.success("创建成功"),e.next=14;break;case 11:return e.next=13,(0,z.kY)(m()(m()({cluster_name:W},t),{},{labels:B(t.labels),selector:B(t.selector),annotations:B(t.annotations)}));case 13:Z.ZP.success("编辑成功");case 14:null==l||l();case 15:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,q.jsx)(j.Z,{open:t,title:s?"编辑Service":"新建Service",width:1230,onCancel:r,onOk:U,style:{top:20},maskClosable:!1,children:(0,q.jsxs)(x.Z,{form:d,labelCol:{span:2},initialValues:s,style:{maxHeight:"calc(100vh - 160px)",overflow:"auto",padding:"0 10px"},children:[(0,q.jsx)(x.Z.Item,{label:"名称",name:"name",required:!0,validateFirst:!0,rules:[{required:!0},{pattern:/^[a-z][a-z0-9-]*[a-z0-9]$/,message:"名称只能包含小写字母、数字、分隔符(“-“），且必须以小写字母开头、小写字母或数字结尾"},{max:63,message:"名称最大长度63字符"},{min:2,message:"名称最小长度2字符"}],children:(0,q.jsx)(y.Z,{disabled:R,placeholder:"长度 2-63 个字符，只能包含小写字母、数字、分隔符(“-“），且必须以小写字母开头、小写字母或数字结尾"})}),(0,q.jsx)(x.Z.Item,{label:"命名空间",name:"namespace",rules:[{required:!0}],required:!0,initialValue:G,children:(0,q.jsx)(g.Z,{disabled:R,options:null==J?void 0:J.list.map((function(e){return{value:e.name,label:e.name}}))})}),(0,q.jsx)(x.Z.Item,{label:"类型",children:(0,q.jsxs)(P.Z,{children:[(0,q.jsx)(x.Z.Item,{noStyle:!0,name:"svc_type",initialValue:"ClusterIP",children:(0,q.jsxs)(b.ZP.Group,{buttonStyle:"solid",children:[(0,q.jsx)(b.ZP.Button,{value:"ClusterIP",children:"ClusterIP"}),(0,q.jsx)(b.ZP.Button,{value:"NodePort",children:"NodePort"}),(0,q.jsx)(b.ZP.Button,{value:"ExternalName",disabled:!0,children:(0,q.jsx)(I.Z,{title:"暂不支持ExternalName类型的Service创建",children:"ExternalName"})}),(0,q.jsx)(b.ZP.Button,{value:"LoadBalancer",disabled:!0,children:(0,q.jsx)(I.Z,{title:"暂不支持LoadBalancer类型的Service创建",children:"LoadBalancer"})})]})}),"ClusterIP"===H&&(0,q.jsxs)(_.Z,{style:{marginLeft:10},size:0,children:[(0,q.jsx)(x.Z.Item,{noStyle:!0,name:"headless",valuePropName:"checked",children:(0,q.jsx)(C.Z,{children:"设置为Headless（None）"})}),(0,q.jsx)(I.Z,{title:"Headless Service 不会创建 ClusterIP，但会获取所有 Pod 的 DNS 记录，通过 Headless Service 可以查询到所有 Pod 的 IP 地址，如 StatefulSet 使用 Headless Service 实现 Pod 间的相互访问。",children:(0,q.jsx)(h.Z,{style:{marginLeft:-10}})})]})]})}),"ExternalName"===H?(0,q.jsx)(q.Fragment,{children:(0,q.jsx)(x.Z.Item,{label:"externalName",name:"external_name",children:(0,q.jsx)(y.Z,{placeholder:"请输入externalName",allowClear:!0})})}):(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(x.Z.Item,{name:"publish_not_ready_addresses",label:"未就绪发布",tooltip:"即使容器组未就绪，也将作为 Service 的后端；适用于部分需要在完成初始化之间进行成员发现的集群，例如 elasticSearch 等，启用时，publishNotReadyAddresses = true",children:(0,q.jsx)(k.Z,{})}),(0,q.jsx)(x.Z.Item,{label:"端口映射",name:"ports",required:!0,rules:[{required:!0}],children:(0,q.jsx)(f.Z,{hide:{toolBarRender:!0},editorFormRef:$,defaultIsEdit:!0,className:T,operationOptions:{width:120},recordCreatorProps:{position:"bottom",creatorButtonText:"添加映射"},columns:[{dataIndex:"name",title:"名称",valueType:"text",fieldProps:{placeholder:"name"}},{dataIndex:"port",title:(0,q.jsx)("span",{className:A,children:"服务端口"}),valueType:"digit",fieldProps:{placeholder:"1-65535",style:{width:"100%"},precision:0},formItemProps:{rules:[{required:!0,message:"此项是必填项"},{validator:function(e,n,t){n<1||n>65535?t("仅支持1-65535"):t()}}]}},{dataIndex:"protocol",title:(0,q.jsx)("span",{className:A,children:"协议"}),valueType:"select",valueEnum:{TCP:"TCP",UDP:"UDP",SCTP:"SCTP"},fieldProps:{placeholder:"请选择协议"},formItemProps:{rules:[{required:!0,message:"此项是必填项"}]}}].concat(a()("NodePort"===H?[{dataIndex:"nodePort",title:"节点端口",valueType:"digit",width:140,fieldProps:{placeholder:"30000-32767",style:{width:"100%"},precision:0},formItemProps:{rules:[{validator:function(e,n,t){n<3e4||n>32767?t("仅支持30000-32767"):t()}}]}}]:[]),[{dataIndex:"targetPort",title:(0,q.jsx)("span",{className:A,children:"容器端口"}),valueType:"text",fieldProps:{placeholder:"1-65535或字符串",style:{width:"100%"}},formItemProps:{rules:[{required:!0,message:"此项是必填项"},{max:15,message:"最多支持15字符"}]}}])})}),!O&&(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(x.Z.Item,{label:"externalIPs",name:"external_ips",rules:[{validator:function(e,n){if(!n)return Promise.resolve();var t=n.filter((function(e){return!/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(e)}));return t.length>0?Promise.reject(new Error(t.join(",")+" 不符合ip格式，请修改。")):Promise.resolve()}}],tooltip:"Kubernetes 并不管理这些 IP 地址，您必须自行确保这些 IP 地址的流量被转发到集群中的某一个（或多个）节点",children:(0,q.jsx)(g.Z,{mode:"tags",className:V,placeholder:"请输入ExternalIPs，按回车可输入多个",open:!1})}),(0,q.jsx)(x.Z.Item,{label:"会话保持",children:(0,q.jsxs)(_.Z,{children:[(0,q.jsx)(x.Z.Item,{noStyle:!0,name:"session_affinity",initialValue:"None",children:(0,q.jsx)(b.ZP.Group,{options:[{value:"None",label:"None"},{value:"ClientIP",label:"ClientIP"}]})}),"ClientIP"===L&&(0,q.jsx)(x.Z.Item,{noStyle:!0,name:"session_affinity_seconds",rules:[{required:!0,message:"请输入timeoutSeconds"},{validator:function(e,n){return!E().isNil(n)&&(n<0||n>86400)?Promise.reject(new Error("仅支持0-86400")):Promise.resolve()}}],children:(0,q.jsx)(w.Z,{precision:0,placeholder:"timeoutSeconds，0-86400",style:{width:200}})})]})})]})]}),(0,q.jsx)(F.Z,{name:"selector",label:"选择器",keyOption:{rules:[{max:316,message:"最多支持316字符"},{pattern:/^[a-zA-Z0-9][-/_.a-zA-Z0-9]*[a-zA-Z0-9]$/,message:"仅支持字母、数字、分隔符（“-“、”/”）、下滑线（“_”）小数点（”.”），需要字母或数字开头和结尾 正则"}]},valueOption:{rules:[{max:63,message:"最多支持63字符"},{pattern:/^[a-zA-Z0-9][-/_.a-zA-Z0-9]*[a-zA-Z0-9]$/,message:"仅支持字母、数字、分隔符（“-“、”/”）、下滑线（“_”）小数点（”.”），需要字母或数字开头和结尾 正则"}]}}),(0,q.jsx)(F.Z,{name:"labels",label:"标签",keyOption:{rules:[{max:316,message:"最多支持316字符"},{pattern:/^[a-zA-Z0-9][-/_.a-zA-Z0-9]*[a-zA-Z0-9]$/,message:"仅支持字母、数字、分隔符（“-“、”/”）、下滑线（“_”）小数点（”.”），需要字母或数字开头和结尾 正则"}]},valueOption:{rules:[{max:63,message:"最多支持63字符"},{pattern:/^[a-zA-Z0-9][-/_.a-zA-Z0-9]*[a-zA-Z0-9]$/,message:"仅支持字母、数字、分隔符（“-“、”/”）、下滑线（“_”）小数点（”.”），需要字母或数字开头和结尾 正则"}]}}),(0,q.jsx)(F.Z,{name:"annotations",label:"注解",keyOption:{rules:[{max:316,message:"最多支持316字符"},{pattern:/^[a-zA-Z0-9][-/_.a-zA-Z0-9]*[a-zA-Z0-9]$/,message:"仅支持字母、数字、分隔符（“-“、”/”）、下滑线（“_”）小数点（”.”），需要字母或数字开头和结尾 正则"}]}})]})})}}}]);