(self.webpackChunkcnmp=self.webpackChunkcnmp||[]).push([[2671],{50660:function(e,t,n){"use strict";var r=n(79482),a=n(50959),i=n(92484),o=n(28371),u=function(e,t){return a.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:i.Z}))},s=a.forwardRef(u);t.Z=s},27274:function(e,t,n){"use strict";n.d(t,{Z:function(){return x}});var r=n(15558),a=n.n(r),i=n(26068),o=n.n(i),u=n(48305),s=n.n(u),l=n(45778),c=n(95974),d=n(41710),f=n(10534),p=n(65460),h=n(96286),m=n(50959),v="table___Rup7Y",g=n(11527),x=function(e){var t=e.placeholder,n=e.request,r=e.columns,i=e.leftTitle,u=e.tableProps,x=e.showSearch,_=void 0===x||x,y=e.dataSource,Z=e.searchWidth,b=e.rightTitle,w=void 0===b?[]:b,C=e.refreshDeps,j=e.actionRef,k=e.hideTitle,S=e.searchStyle,$=e.onSearch,T=(0,l.T)(j),P=(0,m.useState)(""),I=s()(P,2),R=I[0],F=I[1],D=(0,m.useRef)(""),O=(0,f.Z)((function(){var e,t;null==$||$(R),null===(e=T.current)||void 0===e||null===(t=e.reloadAndRest)||void 0===t||t.call(e)}),{wait:500}).run;return(0,p.Z)((function(){var e;null===(e=T.current)||void 0===e||e.reload()}),C||[]),(0,g.jsx)(d.Z,o()({className:v,actionRef:T,headerTitle:i,dataSource:y,search:!1,columns:r,request:n&&function(e){return n(o()(o()({},e),{},{keyword:D.current}))},pagination:{showSizeChanger:!0,defaultPageSize:50},options:{reload:!!n},toolBarRender:!k&&function(){return[].concat(a()(w),a()(_?[(0,g.jsx)(h.Z,{style:o()({width:null!=Z?Z:300},S),value:R,placeholder:t,onChange:function(e){F(e.target.value),D.current=e.target.value,O()},allowClear:!0,suffix:(0,g.jsx)(c.Z,{style:{color:"#918f8f"}})},"__search__input")]:[]))}},u))}},44161:function(e,t,n){"use strict";n.d(t,{Z:function(){return I}});var r=n(82092),a=n.n(r),i=n(26068),o=n.n(i),u=n(90228),s=n.n(u),l=n(15558),c=n.n(l),d=n(87999),f=n.n(d),p=n(48305),h=n.n(p),m=n(95974),v=n(76489),g=n(45778),x=n(52850),_=n(69180),y=n(70334),Z=n(96286),b=n(82187),w=n.n(b),C=n(32699),j=n.n(C),k=n(50959),S=n(59739),$="editable-table___ELOJW",T=n(11527),P=function(e,t,n){return void 0===t||""===t?e:e.filter((function(e){return!n||n(e,t)}))},I=function(e){var t=e.defaultIsEdit,n=void 0!==t&&t,r=e.placeholder,i=e.columns,u=e.editTitle,l=e.searchWidth,d=e.search,p=e.onSave,b=e.hide,C=e.operationOptions,I=e.editable,R=e.recordCreatorProps,F=e.rowKey,D=void 0===F?"id":F,O=e.tableProps,q=(0,x.Z)(e),M=h()(q,2),Y=M[0],U=M[1],B=(0,k.useState)(""),E=h()(B,2),N=E[0],L=E[1],H=(0,k.useState)(n),z=h()(H,2),K=z[0],A=z[1],V=(0,g.T)(e.editorFormRef),W=(0,k.useRef)(),J=(0,k.useState)([]),G=h()(J,2),Q=G[0],X=G[1],ee=(0,k.useState)([]),te=h()(ee,2),ne=te[0],re=te[1],ae=(0,k.useMemo)((function(){return P(Y,N,d)}),[Y,d,N]),ie=(0,k.useState)(0),oe=h()(ie,2),ue=oe[0],se=oe[1];(0,k.useEffect)((function(){re(P(Y||[],N,d))}),[Y,d,N]),(0,k.useEffect)((function(){X(K&&(null==Y?void 0:Y.map((function(e){return e[D]})))||[])}),[K,Y,D]);var le=function(){var e=f()(s()().mark((function e(){var t,n,r,a;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=j().differenceBy(ne,ae,D),n=j().differenceBy(ae,ne,D),r=j().intersectionBy(ne,ae,D),a=[].concat(c()(t),c()(Y.filter((function(e){return!n.some((function(t){return e[D]===t[D]}))})).map((function(e){var t=r.findIndex((function(t){return e[D]===t[D]}));return t>-1?r[t]:e})))),!p){e.next=7;break}return e.next=7,p(a);case 7:U(a),A(!1);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,T.jsx)(v.Z,o()({rowKey:D,className:w()($,e.className),headerTitle:K||"string"!=typeof u?(0,T.jsx)("span",{onClick:function(){K||A(!0)},children:u}):(0,T.jsx)(_.ZP,{type:"primary",onClick:function(){K||A(!0)},children:u}),toolBarRender:function(){return null!=b&&b.toolBarRender?[]:K?[(0,T.jsx)(_.ZP,{onClick:function(){re(ae),A(!1),se(ue+1)},children:"取消"},"cancel"),(0,T.jsx)(_.ZP,{type:"primary",onClick:f()(s()().mark((function e(){var t;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,null===(t=V.current)||void 0===t?void 0:t.validateFields();case 3:e.next=9;break;case 5:return e.prev=5,e.t0=e.catch(0),y.ZP.warning("存在校验未通过项，请修改"),e.abrupt("return");case 9:le();case 10:case"end":return e.stop()}}),e,null,[[0,5]])}))),children:"确认"},"ok")]:[(0,T.jsx)(Z.Z,{style:{width:null!=l?l:300},value:N,placeholder:r,onChange:function(e){L(e.target.value)},allowClear:!0,suffix:(0,T.jsx)(m.Z,{style:{color:"#918f8f"}})},"__search__input")]},editableFormRef:V,columns:[].concat(c()(i),c()(K?[{dataIndex:"operation",title:"操作",valueType:"option",width:(null==C?void 0:C.width)||250,render:function(){return null}}]:[])),recordCreatorProps:!!K&&o()({position:"top",newRecordType:"dataSource",record:function(){return a()({},D,(0,S.Z)())}},R),value:ne,onChange:function(e){re(e)},actionRef:W,editable:o()({type:"multiple",editableKeys:Q,actionRender:function(e,t,n){return[n.delete]},onValuesChange:function(t,n){var r;(re(n),null!=b&&b.toolBarRender)&&(null===(r=e.onChange)||void 0===r||r.call(e,n))},onChange:function(e){X(e)}},I)},O),ue)}},45778:function(e,t,n){"use strict";n.d(t,{T:function(){return a}});var r=n(50959),a=function(e,t){var n=(0,r.useRef)(t);return e||n}},46494:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return K}});var r=n(48305),a=n.n(r),i=n(15268),o=n(79890),u=n(27274),s=n(90228),l=n.n(s),c=n(82092),d=n.n(c),f=n(87999),p=n.n(f),h=n(26068),m=n.n(h),v=n(44161),g=n(47043),x=n(69150),_=n(23214),y={mockUrl:"https://tc-apidoc.123u.com/mock/370",devUrl:"",prodUrl:"",path:"/api/v1/usergroup/grant",method:g.n$.POST,requestHeaders:{},requestBodyType:g.Py.json,responseBodyType:g.b.json,dataKey:"data",paramNames:[],queryNames:[],requestDataOptional:!1,requestDataJsonSchema:{},responseDataJsonSchema:{},requestFunctionName:"postApiV1UsergroupGrant",queryStringArrayFormat:g.s0.brackets,extraInfo:{}},Z=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return _.Z.apply(void 0,[(0,x.Pl)(y,e)].concat(n))};Z.requestConfig=y,Z.queryKey="codo_k8s_post_api_v1_usergroup_grant";var b=n(89629),w=n(50660),C=n(94537),j=n(47212),k=n(21630),S=n(3827),$=n(70334),T=n(13702),P=n(4561),I=n(89169),R=n(32699),F=n.n(R),D=n(50959),O=n(59739),q="table___U47x0",M=n(11527),Y=function(e){var t,n,r=e.onCancel,o=e.onOk,u=e.idList,s=F().isEmpty(u),c=(0,C.NL)(),f=(0,D.useRef)(),h=(0,b.M6)({variables:{list_all:1}}).data,g=(0,b.o_)({variables:{list_all:1}}).data,x=(0,b.tY)({variables:{list_all:1}}),_=x.data,y=x.isLoading,R=k.Z.useForm(),Y=a()(R,1)[0],U=(0,D.useMemo)((function(){var e;return Object.fromEntries((null==h||null===(e=h.list)||void 0===e?void 0:e.map((function(e){return[e.id,{text:e.name}]})))||[])}),[h]),B=(0,j.Z)((function(){return(0,i.cb)({user_group_id:u[0],list_all:1})}),{ready:!s}),E=B.data,N=B.loading;return(0,D.useEffect)((function(){E&&Y.setFieldsValue({roles:E.role_detail.map((function(e){return m()(m()({},e),{},{cluster_id:"".concat(e.cluster_id),namespace:"".concat(e.namespace),role_id:"".concat(e.role_id),id:(0,O.Z)()})}))})}),[E]),(0,M.jsx)(S.Z,{open:!0,maskClosable:!1,title:s?"添加用户组授权":"管理用户授权",width:860,onCancel:r,onOk:function(){Y.validateFields().then((function(e){var t;null===(t=f.current)||void 0===t||t.validateFields().then((function(){s?Z(e).then((function(){$.ZP.success("添加成功"),o()})):(0,i.YF)(e).then((function(){$.ZP.success("编辑成功"),o()}))})).catch((function(){$.ZP.warning("存在校验未通过项，请修改")}))}))},children:(0,M.jsxs)(k.Z,{style:{marginTop:20},form:Y,children:[(0,M.jsx)(k.Z.Item,{required:!0,label:"用户组",labelCol:{span:2},wrapperCol:{span:22},name:"user_group_ids",rules:[{required:!0,message:"请选择用户组"}],initialValue:s?[]:u,children:(0,M.jsx)(T.Z,{disabled:!s,mode:"multiple",optionFilterProp:"label",options:null==g?void 0:g.list.map((function(e){return{label:e.user_group_name,value:e.user_group_id}||[]}))})}),(0,M.jsx)(k.Z.Item,{rules:[{required:!0,message:"请选择角色"}],label:"角色",name:"roles",labelCol:{span:2},wrapperCol:{span:22},children:!y&&(0,M.jsx)(v.Z,{className:q,editorFormRef:f,operationOptions:{width:80},editable:{saveText:"添加角色"},tableProps:{loading:N},columns:[{dataIndex:"cluster_id",title:"集群",valueType:"select",valueEnum:U,formItemProps:{rules:[{required:!0,message:"此项是必填项"}]},fieldProps:function(e,t){return{showSearch:!0,optionFilterProp:"label",placeholder:"请选择集群",onChange:(n=p()(l()().mark((function n(){return l()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:e.setFieldsValue(d()({},t.entity.id,m()(m()({},e.getFieldsValue()),{},{namespace:void 0})));case 1:case"end":return n.stop()}}),n)}))),function(){return n.apply(this,arguments)})};var n}},{dataIndex:"namespace",title:"命名空间",valueType:"select",dependencies:["cluster_id"],formItemProps:{rules:[{required:!0,message:"此项是必填项"}]},fieldProps:{placeholder:"请选择命名空间",showSearch:!0,optionFilterProp:"label"},request:(n=p()(l()().mark((function e(t){var n,r;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.fetchQuery(m()(m()({},b.gt.getFetchOptions({cluster_name:U[t.cluster_id].text,list_all:1})),{},{staleTime:3e5}));case 2:return r=e.sent,e.abrupt("return",[{label:"全部命名空间",value:"all"}].concat((null===(n=r.list)||void 0===n?void 0:n.map((function(e){return{label:e.name,value:e.name}})))||[]));case 4:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{dataIndex:"role_id",title:"角色",valueType:"select",fieldProps:{placeholder:"请选择角色",showSearch:!0,optionFilterProp:"label"},dependencies:["namespace"],request:(t=p()(l()().mark((function e(t){var n;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(null===(n="all"===t.namespace||void 0===t.namespace?null==_?void 0:_.list:null==_?void 0:_.list.filter((function(e){return"NAMESPACE"===e.role_type})))||void 0===n?void 0:n.map((function(e){return{label:(0,M.jsxs)(M.Fragment,{children:[e.name,(0,M.jsx)(P.Z,{overlayInnerStyle:{backgroundColor:"#ffffff"},overlayStyle:{backgroundColor:"#ffffff"},title:"CLUSTER"===e.role_type?(0,M.jsx)(I.Z,{color:"blue",children:"集群"}):(0,M.jsx)(I.Z,{color:"green",children:"普通"}),children:(0,M.jsx)(w.Z,{style:{marginLeft:6}})})]}),value:"".concat(e.id)}})))||[]);case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)}),formItemProps:{rules:[{required:!0,message:"此项是必填项"}]}}],defaultIsEdit:!0,hide:{toolBarRender:!0},recordCreatorProps:{position:"bottom",creatorButtonText:"添加角色"}})})]})})},U=n(91894),B=function(e){var t=e.cancel,n=e.id,r=(0,D.useRef)();return(0,M.jsx)(M.Fragment,{children:(0,M.jsxs)(S.Z,{title:"成员",width:800,open:!0,cancelButtonProps:{style:{display:"none"}},onOk:function(){t()},onCancel:function(){t()},children:[(0,M.jsx)(U.Z,{message:(0,M.jsxs)(M.Fragment,{children:["用户组成员管理，请在管理后台进行配置，",(0,M.jsx)("a",{children:"快速访问"})]}),type:"info",showIcon:!0}),(0,M.jsx)(u.Z,{placeholder:"模糊搜索用户名、昵称、邮箱、来源",tableProps:{rowKey:"user_group_id"},request:function(){var e=p()(l()().mark((function e(t){var a;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.current){e.next=4;break}return e.next=3,(0,i.s$)({user_group_id:n});case 3:r.current=e.sent;case 4:return a=r.current.list,a=(a=""===t.keyword?a:a.filter((function(e){return["user_name","nick_name","email"].some((function(n){return e[n].toLowerCase().includes(t.keyword)}))}))).slice((t.current-1)*t.pageSize,t.current*t.pageSize),e.abrupt("return",{total:a.length,data:a});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),columns:[{dataIndex:"user_id",title:"ID"},{dataIndex:"user_name",title:"用户名"},{dataIndex:"nick_name",title:"昵称"},{dataIndex:"email",title:"邮箱"},{dataIndex:"source",title:"来源"}]})]})})},E=n(34593),N=n(56765),L=n(73634),H=n(69180),z=n(3885),K=function(){var e=(0,D.useRef)(),t=(0,D.useState)(!1),n=a()(t,2),r=n[0],s=n[1],l=(0,D.useState)([]),c=a()(l,2),d=c[0],f=c[1];return(0,M.jsxs)(M.Fragment,{children:[r&&(0,M.jsx)(Y,{onCancel:function(){f([]),s(!1)},onOk:function(){var t;f([]),s(!1),null===(t=e.current)||void 0===t||t.reload(!0)},idList:d}),(0,M.jsx)(E.Z,{items:[{title:"授权管理 "},{title:"用户组授权"}],showCluster:!1,showCreateYamlButton:!1}),(0,M.jsx)(L.Z,{items:[{key:"group",label:"用户组",children:(0,M.jsx)(u.Z,{leftTitle:(0,M.jsx)(H.ZP,{onClick:function(){f([]),s(!0)},type:"primary",children:"添加授权用户组"}),tableProps:{rowKey:"user_group_id"},placeholder:"模糊搜索用户组名",actionRef:e,request:function(e){return(0,i.Fd)({keyword:e.keyword,page:e.current,page_size:e.pageSize}).then((function(e){return{total:e.total,data:e.list}}))},columns:[{dataIndex:"user_group_name",title:"用户组名"},{dataIndex:"granted_cluster_count",title:"授权集群数"},{dataIndex:"granted_role_count",title:"角色数"},{dataIndex:"update_time",title:"更新时间",render:N.kZ},{dataIndex:"operation",title:"操作",render:function(t,n){return(0,M.jsxs)(z.Z,{children:[(0,M.jsx)("div",{onClick:function(){f([n.user_group_id]),s(!0)},children:(0,M.jsx)("a",{children:"管理授权"})}),(0,M.jsx)("div",{onClick:function(){S.Z.confirm({title:"删除用户授权",content:"确认删除用户【".concat(n.user_group_name,"】全部授权，删除后用户不在拥有集群访问权限？"),onOk:function(){(0,i.pv)({user_group_id:n.user_group_id}).then((function(){var t;$.ZP.success("删除成功"),null===(t=e.current)||void 0===t||t.reload(!0)}))}})},children:(0,M.jsx)("a",{children:"删除授权"})}),(0,M.jsx)(o.Z,{modalRender:function(e){return(0,M.jsx)(B,{cancel:e,id:n.user_group_id})},children:(0,M.jsx)("a",{children:"成员"})})]})}}]})}]})]})}},56765:function(e,t,n){"use strict";n.d(t,{jp:function(){return s},kZ:function(){return c},yq:function(){return l}});var r=n(5726),a=n.n(r),i=n(11110),o=n.n(i);a().extend(o());var u=function(e){var t=(Date.now()-e)/1e3;return t<60?{duration:t,unit:"second"}:t<3600?{duration:Math.floor(t/60),unit:"minute"}:t<86400?{duration:Math.floor(t/3600),unit:"hour"}:{duration:Math.floor(t/86400),unit:"day"}},s=function(e){if(void 0===e)return"";var t=u(e);return"second"===t.unit?"1分钟内":"".concat(t.duration," ").concat({second:"秒",minute:"分钟",hour:"小时",day:"天"}[t.unit],"前")},l=function(e){var t=u(e);return"second"===t.unit?"1分钟内":"约".concat(t.duration).concat({second:"秒",minute:"分钟",hour:"小时",day:"天"}[t.unit])},c=function(e){return isNaN(Number(e))?e:a()(Number(e)).format("YYYY-MM-DD HH:mm:ss")}},10534:function(e,t,n){"use strict";var r=n(99938),a=n(66292),i=n.n(a),o=n(50959),u=n(53270),s=n(77924),l=n(25492),c=n(80785);t.Z=function(e,t){var n;c.Z&&((0,l.mf)(e)||console.error("useDebounceFn expected parameter is a function, got ".concat(typeof e)));var a=(0,u.Z)(e),d=null!==(n=null==t?void 0:t.wait)&&void 0!==n?n:1e3,f=(0,o.useMemo)((function(){return i()((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return a.current.apply(a,(0,r.ev)([],(0,r.CR)(e),!1))}),d,t)}),[]);return(0,s.Z)((function(){f.cancel()})),{run:f,cancel:f.cancel,flush:f.flush}}},11110:function(e){e.exports=function(){"use strict";var e="minute",t=/[+-]\d\d(?::?\d\d)?/g,n=/([+-]|\d\d)/g;return function(r,a,i){var o=a.prototype;i.utc=function(e){return new a({date:e,utc:!0,args:arguments})},o.utc=function(t){var n=i(this.toDate(),{locale:this.$L,utc:!0});return t?n.add(this.utcOffset(),e):n},o.local=function(){return i(this.toDate(),{locale:this.$L,utc:!1})};var u=o.parse;o.parse=function(e){e.utc&&(this.$u=!0),this.$utils().u(e.$offset)||(this.$offset=e.$offset),u.call(this,e)};var s=o.init;o.init=function(){if(this.$u){var e=this.$d;this.$y=e.getUTCFullYear(),this.$M=e.getUTCMonth(),this.$D=e.getUTCDate(),this.$W=e.getUTCDay(),this.$H=e.getUTCHours(),this.$m=e.getUTCMinutes(),this.$s=e.getUTCSeconds(),this.$ms=e.getUTCMilliseconds()}else s.call(this)};var l=o.utcOffset;o.utcOffset=function(r,a){var i=this.$utils().u;if(i(r))return this.$u?0:i(this.$offset)?l.call(this):this.$offset;if("string"==typeof r&&(r=function(e){void 0===e&&(e="");var r=e.match(t);if(!r)return null;var a=(""+r[0]).match(n)||["-",0,0],i=a[0],o=60*+a[1]+ +a[2];return 0===o?0:"+"===i?o:-o}(r),null===r))return this;var o=Math.abs(r)<=16?60*r:r,u=this;if(a)return u.$offset=o,u.$u=0===r,u;if(0!==r){var s=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(u=this.local().add(o+s,e)).$offset=o,u.$x.$localOffset=s}else u=this.utc();return u};var c=o.format;o.format=function(e){var t=e||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return c.call(this,t)},o.valueOf=function(){var e=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*e},o.isUTC=function(){return!!this.$u},o.toISOString=function(){return this.toDate().toISOString()},o.toString=function(){return this.toDate().toUTCString()};var d=o.toDate;o.toDate=function(e){return"s"===e&&this.$offset?i(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():d.call(this)};var f=o.diff;o.diff=function(e,t,n){if(e&&this.$u===e.$u)return f.call(this,e,t,n);var r=this.local(),a=i(e).local();return f.call(r,a,t,n)}}}()}}]);