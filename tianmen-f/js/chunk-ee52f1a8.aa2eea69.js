(window["webpackJsonp_gw"]=window["webpackJsonp_gw"]||[]).push([["chunk-ee52f1a8"],{"3f57":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t._self._c;return e("div",{staticStyle:{height:"100%"}},[e("Alert",{attrs:{type:"success","show-icon":""}},[t._v("\n    使用说明：\n    "),e("Icon",{attrs:{slot:"icon",type:"ios-bulb-outline"},slot:"icon"}),e("template",{slot:"desc"},[t._v("服务启动时，将自己的节点信息注册到etcd，包括：服务名称、ip、端口\n      网关服务从etcd监听服务节点信息，保存到缓存中，从客户端请求的url中提取服务名称，通过服务名称查找节点信息，将请求转发到后端服务\n    ")])],2),e("Affix",{attrs:{"offset-top":80}},[e("div",{staticClass:"search-con search-con-top"},[e("Button",{staticClass:"search-btn",attrs:{type:"info"},on:{click:t.handlerAdd}},[t._v("注册服务")])],1)]),e("Table",{attrs:{size:"small",columns:t.columns,data:t.tableData,border:"","span-method":t.handleSpan}}),e("service-edit",{attrs:{modalData:t.modalData,formValidate:t.svcData},on:{"handle-submit-service":t.saveData,"modal-close":t.handlerModalClose}})],1)},n=[],s=(a("8e6e"),a("ac6a"),a("456d"),a("bd86")),o=a("2f62"),i=a("90de"),l=a("66df"),c=function(){return l["a"].request({url:"/api/admin/services/list",method:"get"})},u=function(t,e){return l["a"].request({url:"/api/admin/services/save",method:e,data:t})},d=function(t){return l["a"].request({url:"/api/admin/services/remove",method:"delete",data:t})},m=function(){var t=this,e=t._self._c;return e("Drawer",{staticStyle:{"background-color":"#f8f8f9"},attrs:{title:t.modalData.title,width:"700px",draggable:"","mask-closable":!1,"footer-hide":!0},model:{value:t.modalData.show,callback:function(e){t.$set(t.modalData,"show",e)},expression:"modalData.show"}},[e("Form",{ref:"formValidate",attrs:{model:t.formValidate,rules:t.ruleValidate,"label-width":100,"label-colon":!0}},[e("FormItem",{attrs:{label:"服务名",prop:"service_name"}},[e("Input",{attrs:{maxlength:"15",type:"text",placeholder:"请输入服务名..."},model:{value:t.formValidate.service_name,callback:function(e){t.$set(t.formValidate,"service_name",e)},expression:"formValidate.service_name"}})],1),e("FormItem",{attrs:{label:"upstream",prop:"upstream"}},[e("Input",{attrs:{maxlength:"50",type:"text",placeholder:"请输入upstream..."},model:{value:t.formValidate.upstream,callback:function(e){t.$set(t.formValidate,"upstream",e)},expression:"formValidate.upstream"}})],1),e("FormItem",{attrs:{label:"权重",prop:"weight"}},[e("InputNumber",{attrs:{max:100,min:1,placeholder:""},model:{value:t.formValidate.weight,callback:function(e){t.$set(t.formValidate,"weight",e)},expression:"formValidate.weight"}})],1),e("FormItem",{attrs:{label:"是否启用"}},[e("i-switch",{attrs:{size:"large","true-color":"#19be6b","true-value":1,"false-value":0},model:{value:t.formValidate.status,callback:function(e){t.$set(t.formValidate,"status",e)},expression:"formValidate.status"}},[e("span",{attrs:{slot:"open"},slot:"open"},[t._v("启用")]),e("span",{attrs:{slot:"close"},slot:"close"},[t._v("禁用")])])],1),e("FormItem",[e("Button",{attrs:{type:"primary",loading:t.btnLoading},on:{click:function(e){return t.handleSubmit("formValidate")}}},[t._v("提交")]),e("Button",{staticStyle:{"margin-left":"8px"},on:{click:function(e){return t.handlerReset("formValidate")}}},[t._v("重置")])],1)],1)],1)},h=[],p=(a("7f7f"),{name:"serviceEdit",props:{modalData:{type:Object,default:{}},formValidate:{type:Object,default:{}}},data:function(){return{btnLoading:!1,ruleValidate:{upstream:[{required:!0,message:"The upstream cannot be empty",trigger:"blur"}],service_name:[{required:!0,message:"所在服务/应用不能为空",trigger:"blur"}]}}},methods:{handleCancel:function(){this.$emit("modal-close")},handleSubmit:function(t){var e=this;this.$refs[t].validate((function(t){t?(e.btnLoading=!0,setTimeout((function(){e.$emit("handle-submit-service",e.formValidate,e.modalData.action),e.btnLoading=!1}),500)):e.$Message.error("表单校验不通过!")}))},handlerReset:function(t){this.$refs[t].resetFields()}}}),f=p,v=a("2877"),b=Object(v["a"])(f,m,h,!1,null,null,null),g=b.exports;function w(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,r)}return a}function y(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?w(Object(a),!0).forEach((function(e){Object(s["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):w(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var D={components:{serviceEdit:g},data:function(){var t=this;return{columns:[{title:"服务编码",key:"service_name",minWidth:120,maxWidth:150,sortable:!0},{title:"upstream",key:"upstream",minWidth:150},{title:"权重",key:"weight",minWidth:80,maxWidth:130,sortable:!0},{title:"状态",key:"handle",width:100,render:function(t,e){var a=e.row.status;return t("div",1===a?[t("Tag",{props:{color:"green"}},"up")]:0===a?[t("Tag",{props:{color:"orange"}},"down")]:[t("Tag",{props:{color:"error"}},"未知")])}},{title:"更新时间",key:"time",width:155,render:function(t,e){return t("div",Object(i["b"])(new Date(e.row.time),"yyyy-MM-dd hh:mm"))}},{title:"#",key:"handle",minWidth:110,maxWidth:130,render:function(e,a){return e("div",[e("a",{style:{marginRight:"5px"},on:{click:function(){t.handlerEdit(a.row)}}},"编辑"),e("a",{on:{click:function(){t.handlerDelete(a)}}},"删除")])}}],tableData:[],pluginList:[],svcData:{weight:1,status:1},modalData:{},spanArr:[],pos:null}},methods:{handleGetGwServices:function(){var t=this;c().then((function(e){t.tableData=e.data,t.getSpanArr(e.data)}))},handlerAdd:function(){this.svcData=this.$options.data().svcData,this.svcData={weight:1,status:1},this.modalData={show:!0,title:"注册服务节点",action:"post"}},handlerEdit:function(t){this.svcData=t,this.modalData={show:!0,title:"编辑服务节点信息",action:"post"}},handlerModalClose:function(){this.handlerGetFuncsList()},saveData:function(t,e){var a=this;console.log(t,e),u(t,e).then((function(t){a.$Message.success("成功"),a.modalData.show=!1,a.handleGetGwServices()}))},handlerDelete:function(t){var e=this;this.$Modal.confirm({title:"提醒",content:"<p>确定要删除服务节点：《".concat(t.row.upstream,"》之后无法找回，请谨慎操作！</p>"),onOk:function(){setTimeout((function(){d({key:t.row.key}).then((function(t){e.$Message.success("删除成功"),e.handleGetGwServices()}))}),500)},onCancel:function(){e.$Message.info("回头是岸~")}})},getSpanArr:function(t){this.spanArr=[];for(var e=0;e<t.length;e++)0===e?(this.spanArr.push(1),this.pos=0):t[e].service_name===t[e-1].service_name?(this.spanArr[this.pos]+=1,this.spanArr.push(0)):(this.spanArr.push(1),this.pos=e)},handleSpan:function(t){t.row,t.column;var e=t.rowIndex,a=t.columnIndex;if(0===a){var r=this.spanArr[e],n=r>0?1:0;return{rowspan:r,colspan:n}}}},watch:{},computed:y({},Object(o["e"])({rules:function(t){return t.user.rules}})),mounted:function(){this.handleGetGwServices()}},k=D,O=(a("78c6"),Object(v["a"])(k,r,n,!1,null,"ab0fbd8e",null));e["default"]=O.exports},"78c6":function(t,e,a){"use strict";a("e2ed")},e2ed:function(t,e,a){}}]);